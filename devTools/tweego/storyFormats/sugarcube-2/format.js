window.storyFormat({"name":"SugarCube","version":"2.36.1","description":"A full featured, highly customizable story format.  See its <a href=\"http://www.motoslave.net/sugarcube/2/#documentation\" target=\"_blank\">documentation</a>.","author":"Thomas Michael Edwards","image":"icon.svg","url":"http://www.motoslave.net/sugarcube/","license":"BSD-2-Clause","proofing":false,"source":"<!DOCTYPE html>\n<html data-init=\"no-js\">\n<head>\n<meta charset=\"UTF-8\" />\n<title>{{STORY_NAME}}</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<!--\n\nSugarCube (v2.36.1): A free (gratis and libre) story format.\n\nCopyright © 2013–2021 Thomas Michael Edwards <thomasmedwards@gmail.com>.\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this\n   list of conditions and the following disclaimer.\n2. Redistributions in binary form must reproduce the above copyright notice,\n   this list of conditions and the following disclaimer in the documentation\n   and/or other materials provided with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\nANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n-->\n<script id=\"script-libraries\" type=\"text/javascript\">\nif(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.setAttribute(\"data-init\", \"loading\");\n/*! @source http://purl.eligrey.com/github/classList.js/blob/1.2.20171210/classList.js */\n\"document\"in self&&(\"classList\"in document.createElement(\"_\")&&(!document.createElementNS||\"classList\"in document.createElementNS(\"http://www.w3.org/2000/svg\",\"g\"))||!function(t){\"use strict\";if(\"Element\"in t){var e=\"classList\",n=\"prototype\",i=t.Element[n],s=Object,r=String[n].trim||function(){return this.replace(/^\\s+|\\s+$/g,\"\")},o=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},c=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},a=function(t,e){if(\"\"===e)throw new c(\"SYNTAX_ERR\",\"The token must not be empty.\");if(/\\s/.test(e))throw new c(\"INVALID_CHARACTER_ERR\",\"The token must not contain space characters.\");return o.call(t,e)},l=function(t){for(var e=r.call(t.getAttribute(\"class\")||\"\"),n=e?e.split(/\\s+/):[],i=0,s=n.length;s>i;i++)this.push(n[i]);this._updateClassName=function(){t.setAttribute(\"class\",this.toString())}},u=l[n]=[],h=function(){return new l(this)};if(c[n]=Error[n],u.item=function(t){return this[t]||null},u.contains=function(t){return~a(this,t+\"\")},u.add=function(){var t,e=arguments,n=0,i=e.length,s=!1;do t=e[n]+\"\",~a(this,t)||(this.push(t),s=!0);while(++n<i);s&&this._updateClassName()},u.remove=function(){var t,e,n=arguments,i=0,s=n.length,r=!1;do for(t=n[i]+\"\",e=a(this,t);~e;)this.splice(e,1),r=!0,e=a(this,t);while(++i<s);r&&this._updateClassName()},u.toggle=function(t,e){var n=this.contains(t),i=n?e!==!0&&\"remove\":e!==!1&&\"add\";return i&&this[i](t),e===!0||e===!1?e:!n},u.replace=function(t,e){var n=a(t+\"\");~n&&(this.splice(n,1,e),this._updateClassName())},u.toString=function(){return this.join(\" \")},s.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{s.defineProperty(i,e,f)}catch(p){void 0!==p.number&&-2146823252!==p.number||(f.enumerable=!1,s.defineProperty(i,e,f))}}else s[n].__defineGetter__&&i.__defineGetter__(e,h)}}(self),function(){\"use strict\";var t=document.createElement(\"_\");if(t.classList.add(\"c1\",\"c2\"),!t.classList.contains(\"c2\")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var n,i=arguments.length;for(n=0;i>n;n++)t=arguments[n],e.call(this,t)}};e(\"add\"),e(\"remove\")}if(t.classList.toggle(\"c3\",!1),t.classList.contains(\"c3\")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}\"replace\"in document.createElement(\"_\").classList||(DOMTokenList.prototype.replace=function(t,e){var n=this.toString().split(\" \"),i=n.indexOf(t+\"\");~i&&(n=n.slice(i),this.remove.apply(this,n),this.add(e),this.add.apply(this,n.slice(1)))}),t=null}());\n/*! jQuery v3.7.1 | (c) OpenJS Foundation and other contributors | jquery.org/license */\n!function(e,t){\"use strict\";\"object\"==typeof module&&\"object\"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error(\"jQuery requires a window with a document\");return t(e)}:t(e)}(\"undefined\"!=typeof window?window:this,function(ie,e){\"use strict\";var oe=[],r=Object.getPrototypeOf,ae=oe.slice,g=oe.flat?function(e){return oe.flat.call(e)}:function(e){return oe.concat.apply([],e)},s=oe.push,se=oe.indexOf,n={},i=n.toString,ue=n.hasOwnProperty,o=ue.toString,a=o.call(Object),le={},v=function(e){return\"function\"==typeof e&&\"number\"!=typeof e.nodeType&&\"function\"!=typeof e.item},y=function(e){return null!=e&&e===e.window},C=ie.document,u={type:!0,src:!0,nonce:!0,noModule:!0};function m(e,t,n){var r,i,o=(n=n||C).createElement(\"script\");if(o.text=e,t)for(r in u)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+\"\":\"object\"==typeof e||\"function\"==typeof e?n[i.call(e)]||\"object\":typeof e}var t=\"3.7.1\",l=/HTML$/i,ce=function(e,t){return new ce.fn.init(e,t)};function c(e){var t=!!e&&\"length\"in e&&e.length,n=x(e);return!v(e)&&!y(e)&&(\"array\"===n||0===t||\"number\"==typeof t&&0<t&&t-1 in e)}function fe(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}ce.fn=ce.prototype={jquery:t,constructor:ce,length:0,toArray:function(){return ae.call(this)},get:function(e){return null==e?ae.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=ce.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return ce.each(this,e)},map:function(n){return this.pushStack(ce.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(ce.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(ce.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:oe.sort,splice:oe.splice},ce.extend=ce.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for(\"boolean\"==typeof a&&(l=a,a=arguments[s]||{},s++),\"object\"==typeof a||v(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],\"__proto__\"!==t&&a!==r&&(l&&r&&(ce.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||ce.isPlainObject(n)?n:{},i=!1,a[t]=ce.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},ce.extend({expando:\"jQuery\"+(t+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||\"[object Object]\"!==i.call(e))&&(!(t=r(e))||\"function\"==typeof(n=ue.call(t,\"constructor\")&&t.constructor)&&o.call(n)===a)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){m(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(c(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},text:function(e){var t,n=\"\",r=0,i=e.nodeType;if(!i)while(t=e[r++])n+=ce.text(t);return 1===i||11===i?e.textContent:9===i?e.documentElement.textContent:3===i||4===i?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&(c(Object(e))?ce.merge(n,\"string\"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:se.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!l.test(t||n&&n.nodeName||\"HTML\")},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(c(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:le}),\"function\"==typeof Symbol&&(ce.fn[Symbol.iterator]=oe[Symbol.iterator]),ce.each(\"Boolean Number String Function Array Date RegExp Object Error Symbol\".split(\" \"),function(e,t){n[\"[object \"+t+\"]\"]=t.toLowerCase()});var pe=oe.pop,de=oe.sort,he=oe.splice,ge=\"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",ve=new RegExp(\"^\"+ge+\"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\"+ge+\"+$\",\"g\");ce.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var f=/([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\x80-\\uFFFF\\w-]/g;function p(e,t){return t?\"\\0\"===e?\"\\ufffd\":e.slice(0,-1)+\"\\\\\"+e.charCodeAt(e.length-1).toString(16)+\" \":\"\\\\\"+e}ce.escapeSelector=function(e){return(e+\"\").replace(f,p)};var ye=C,me=s;!function(){var e,b,w,o,a,T,r,C,d,i,k=me,S=ce.expando,E=0,n=0,s=W(),c=W(),u=W(),h=W(),l=function(e,t){return e===t&&(a=!0),0},f=\"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",t=\"(?:\\\\\\\\[\\\\da-fA-F]{1,6}\"+ge+\"?|\\\\\\\\[^\\\\r\\\\n\\\\f]|[\\\\w-]|[^\\0-\\\\x7f])+\",p=\"\\\\[\"+ge+\"*(\"+t+\")(?:\"+ge+\"*([*^$|!~]?=)\"+ge+\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\"+t+\"))|)\"+ge+\"*\\\\]\",g=\":(\"+t+\")(?:\\\\((('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\"+p+\")*)|.*)\\\\)|)\",v=new RegExp(ge+\"+\",\"g\"),y=new RegExp(\"^\"+ge+\"*,\"+ge+\"*\"),m=new RegExp(\"^\"+ge+\"*([>+~]|\"+ge+\")\"+ge+\"*\"),x=new RegExp(ge+\"|>\"),j=new RegExp(g),A=new RegExp(\"^\"+t+\"$\"),D={ID:new RegExp(\"^#(\"+t+\")\"),CLASS:new RegExp(\"^\\\\.(\"+t+\")\"),TAG:new RegExp(\"^(\"+t+\"|[*])\"),ATTR:new RegExp(\"^\"+p),PSEUDO:new RegExp(\"^\"+g),CHILD:new RegExp(\"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\"+ge+\"*(even|odd|(([+-]|)(\\\\d*)n|)\"+ge+\"*(?:([+-]|)\"+ge+\"*(\\\\d+)|))\"+ge+\"*\\\\)|)\",\"i\"),bool:new RegExp(\"^(?:\"+f+\")$\",\"i\"),needsContext:new RegExp(\"^\"+ge+\"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\"+ge+\"*((?:-\\\\d)?\\\\d*)\"+ge+\"*\\\\)|)(?=[^-]|$)\",\"i\")},N=/^(?:input|select|textarea|button)$/i,q=/^h\\d$/i,L=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,H=/[+~]/,O=new RegExp(\"\\\\\\\\[\\\\da-fA-F]{1,6}\"+ge+\"?|\\\\\\\\([^\\\\r\\\\n\\\\f])\",\"g\"),P=function(e,t){var n=\"0x\"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},M=function(){V()},R=J(function(e){return!0===e.disabled&&fe(e,\"fieldset\")},{dir:\"parentNode\",next:\"legend\"});try{k.apply(oe=ae.call(ye.childNodes),ye.childNodes),oe[ye.childNodes.length].nodeType}catch(e){k={apply:function(e,t){me.apply(e,ae.call(t))},call:function(e){me.apply(e,ae.call(arguments,1))}}}function I(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],\"string\"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(V(e),e=e||T,C)){if(11!==p&&(u=L.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return k.call(n,a),n}else if(f&&(a=f.getElementById(i))&&I.contains(e,a)&&a.id===i)return k.call(n,a),n}else{if(u[2])return k.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&e.getElementsByClassName)return k.apply(n,e.getElementsByClassName(i)),n}if(!(h[t+\" \"]||d&&d.test(t))){if(c=t,f=e,1===p&&(x.test(t)||m.test(t))){(f=H.test(t)&&U(e.parentNode)||e)==e&&le.scope||((s=e.getAttribute(\"id\"))?s=ce.escapeSelector(s):e.setAttribute(\"id\",s=S)),o=(l=Y(t)).length;while(o--)l[o]=(s?\"#\"+s:\":scope\")+\" \"+Q(l[o]);c=l.join(\",\")}try{return k.apply(n,f.querySelectorAll(c)),n}catch(e){h(t,!0)}finally{s===S&&e.removeAttribute(\"id\")}}}return re(t.replace(ve,\"$1\"),e,n,r)}function W(){var r=[];return function e(t,n){return r.push(t+\" \")>b.cacheLength&&delete e[r.shift()],e[t+\" \"]=n}}function F(e){return e[S]=!0,e}function $(e){var t=T.createElement(\"fieldset\");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function B(t){return function(e){return fe(e,\"input\")&&e.type===t}}function _(t){return function(e){return(fe(e,\"input\")||fe(e,\"button\"))&&e.type===t}}function z(t){return function(e){return\"form\"in e?e.parentNode&&!1===e.disabled?\"label\"in e?\"label\"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&R(e)===t:e.disabled===t:\"label\"in e&&e.disabled===t}}function X(a){return F(function(o){return o=+o,F(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function U(e){return e&&\"undefined\"!=typeof e.getElementsByTagName&&e}function V(e){var t,n=e?e.ownerDocument||e:ye;return n!=T&&9===n.nodeType&&n.documentElement&&(r=(T=n).documentElement,C=!ce.isXMLDoc(T),i=r.matches||r.webkitMatchesSelector||r.msMatchesSelector,r.msMatchesSelector&&ye!=T&&(t=T.defaultView)&&t.top!==t&&t.addEventListener(\"unload\",M),le.getById=$(function(e){return r.appendChild(e).id=ce.expando,!T.getElementsByName||!T.getElementsByName(ce.expando).length}),le.disconnectedMatch=$(function(e){return i.call(e,\"*\")}),le.scope=$(function(){return T.querySelectorAll(\":scope\")}),le.cssHas=$(function(){try{return T.querySelector(\":has(*,:jqfake)\"),!1}catch(e){return!0}}),le.getById?(b.filter.ID=function(e){var t=e.replace(O,P);return function(e){return e.getAttribute(\"id\")===t}},b.find.ID=function(e,t){if(\"undefined\"!=typeof t.getElementById&&C){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(O,P);return function(e){var t=\"undefined\"!=typeof e.getAttributeNode&&e.getAttributeNode(\"id\");return t&&t.value===n}},b.find.ID=function(e,t){if(\"undefined\"!=typeof t.getElementById&&C){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode(\"id\"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode(\"id\"))&&n.value===e)return[o]}return[]}}),b.find.TAG=function(e,t){return\"undefined\"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},b.find.CLASS=function(e,t){if(\"undefined\"!=typeof t.getElementsByClassName&&C)return t.getElementsByClassName(e)},d=[],$(function(e){var t;r.appendChild(e).innerHTML=\"<a id='\"+S+\"' href='' disabled='disabled'></a><select id='\"+S+\"-\\r\\\\' disabled='disabled'><option selected=''></option></select>\",e.querySelectorAll(\"[selected]\").length||d.push(\"\\\\[\"+ge+\"*(?:value|\"+f+\")\"),e.querySelectorAll(\"[id~=\"+S+\"-]\").length||d.push(\"~=\"),e.querySelectorAll(\"a#\"+S+\"+*\").length||d.push(\".#.+[+~]\"),e.querySelectorAll(\":checked\").length||d.push(\":checked\"),(t=T.createElement(\"input\")).setAttribute(\"type\",\"hidden\"),e.appendChild(t).setAttribute(\"name\",\"D\"),r.appendChild(e).disabled=!0,2!==e.querySelectorAll(\":disabled\").length&&d.push(\":enabled\",\":disabled\"),(t=T.createElement(\"input\")).setAttribute(\"name\",\"\"),e.appendChild(t),e.querySelectorAll(\"[name='']\").length||d.push(\"\\\\[\"+ge+\"*name\"+ge+\"*=\"+ge+\"*(?:''|\\\"\\\")\")}),le.cssHas||d.push(\":has\"),d=d.length&&new RegExp(d.join(\"|\")),l=function(e,t){if(e===t)return a=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!le.sortDetached&&t.compareDocumentPosition(e)===n?e===T||e.ownerDocument==ye&&I.contains(ye,e)?-1:t===T||t.ownerDocument==ye&&I.contains(ye,t)?1:o?se.call(o,e)-se.call(o,t):0:4&n?-1:1)}),T}for(e in I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){if(V(e),C&&!h[t+\" \"]&&(!d||!d.test(t)))try{var n=i.call(e,t);if(n||le.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){h(t,!0)}return 0<I(t,T,null,[e]).length},I.contains=function(e,t){return(e.ownerDocument||e)!=T&&V(e),ce.contains(e,t)},I.attr=function(e,t){(e.ownerDocument||e)!=T&&V(e);var n=b.attrHandle[t.toLowerCase()],r=n&&ue.call(b.attrHandle,t.toLowerCase())?n(e,t,!C):void 0;return void 0!==r?r:e.getAttribute(t)},I.error=function(e){throw new Error(\"Syntax error, unrecognized expression: \"+e)},ce.uniqueSort=function(e){var t,n=[],r=0,i=0;if(a=!le.sortStable,o=!le.sortStable&&ae.call(e,0),de.call(e,l),a){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)he.call(e,n[r],1)}return o=null,e},ce.fn.uniqueSort=function(){return this.pushStack(ce.uniqueSort(ae.apply(this)))},(b=ce.expr={cacheLength:50,createPseudo:F,match:D,attrHandle:{},find:{},relative:{\">\":{dir:\"parentNode\",first:!0},\" \":{dir:\"parentNode\"},\"+\":{dir:\"previousSibling\",first:!0},\"~\":{dir:\"previousSibling\"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(O,P),e[3]=(e[3]||e[4]||e[5]||\"\").replace(O,P),\"~=\"===e[2]&&(e[3]=\" \"+e[3]+\" \"),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),\"nth\"===e[1].slice(0,3)?(e[3]||I.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(\"even\"===e[3]||\"odd\"===e[3])),e[5]=+(e[7]+e[8]||\"odd\"===e[3])):e[3]&&I.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return D.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||\"\":n&&j.test(n)&&(t=Y(n,!0))&&(t=n.indexOf(\")\",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(O,P).toLowerCase();return\"*\"===e?function(){return!0}:function(e){return fe(e,t)}},CLASS:function(e){var t=s[e+\" \"];return t||(t=new RegExp(\"(^|\"+ge+\")\"+e+\"(\"+ge+\"|$)\"))&&s(e,function(e){return t.test(\"string\"==typeof e.className&&e.className||\"undefined\"!=typeof e.getAttribute&&e.getAttribute(\"class\")||\"\")})},ATTR:function(n,r,i){return function(e){var t=I.attr(e,n);return null==t?\"!=\"===r:!r||(t+=\"\",\"=\"===r?t===i:\"!=\"===r?t!==i:\"^=\"===r?i&&0===t.indexOf(i):\"*=\"===r?i&&-1<t.indexOf(i):\"$=\"===r?i&&t.slice(-i.length)===i:\"~=\"===r?-1<(\" \"+t.replace(v,\" \")+\" \").indexOf(i):\"|=\"===r&&(t===i||t.slice(0,i.length+1)===i+\"-\"))}},CHILD:function(d,e,t,h,g){var v=\"nth\"!==d.slice(0,3),y=\"last\"!==d.slice(-4),m=\"of-type\"===e;return 1===h&&0===g?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u=v!==y?\"nextSibling\":\"previousSibling\",l=e.parentNode,c=m&&e.nodeName.toLowerCase(),f=!n&&!m,p=!1;if(l){if(v){while(u){o=e;while(o=o[u])if(m?fe(o,c):1===o.nodeType)return!1;s=u=\"only\"===d&&!s&&\"nextSibling\"}return!0}if(s=[y?l.firstChild:l.lastChild],y&&f){p=(a=(r=(i=l[S]||(l[S]={}))[d]||[])[0]===E&&r[1])&&r[2],o=a&&l.childNodes[a];while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if(1===o.nodeType&&++p&&o===e){i[d]=[E,a,p];break}}else if(f&&(p=a=(r=(i=e[S]||(e[S]={}))[d]||[])[0]===E&&r[1]),!1===p)while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if((m?fe(o,c):1===o.nodeType)&&++p&&(f&&((i=o[S]||(o[S]={}))[d]=[E,p]),o===e))break;return(p-=g)===h||p%h==0&&0<=p/h}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||I.error(\"unsupported pseudo: \"+e);return a[S]?a(o):1<a.length?(t=[e,e,\"\",o],b.setFilters.hasOwnProperty(e.toLowerCase())?F(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=se.call(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:F(function(e){var r=[],i=[],s=ne(e.replace(ve,\"$1\"));return s[S]?F(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:F(function(t){return function(e){return 0<I(t,e).length}}),contains:F(function(t){return t=t.replace(O,P),function(e){return-1<(e.textContent||ce.text(e)).indexOf(t)}}),lang:F(function(n){return A.test(n||\"\")||I.error(\"unsupported lang: \"+n),n=n.replace(O,P).toLowerCase(),function(e){var t;do{if(t=C?e.lang:e.getAttribute(\"xml:lang\")||e.getAttribute(\"lang\"))return(t=t.toLowerCase())===n||0===t.indexOf(n+\"-\")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=ie.location&&ie.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===r},focus:function(e){return e===function(){try{return T.activeElement}catch(e){}}()&&T.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:z(!1),disabled:z(!0),checked:function(e){return fe(e,\"input\")&&!!e.checked||fe(e,\"option\")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return q.test(e.nodeName)},input:function(e){return N.test(e.nodeName)},button:function(e){return fe(e,\"input\")&&\"button\"===e.type||fe(e,\"button\")},text:function(e){var t;return fe(e,\"input\")&&\"text\"===e.type&&(null==(t=e.getAttribute(\"type\"))||\"text\"===t.toLowerCase())},first:X(function(){return[0]}),last:X(function(e,t){return[t-1]}),eq:X(function(e,t,n){return[n<0?n+t:n]}),even:X(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:X(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:X(function(e,t,n){var r;for(r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:X(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=B(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=_(e);function G(){}function Y(e,t){var n,r,i,o,a,s,u,l=c[e+\" \"];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=y.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=m.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(ve,\" \")}),a=a.slice(n.length)),b.filter)!(r=D[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?I.error(e):c(e,s).slice(0)}function Q(e){for(var t=0,n=e.length,r=\"\";t<n;t++)r+=e[t].value;return r}function J(a,e,t){var s=e.dir,u=e.next,l=u||s,c=t&&\"parentNode\"===l,f=n++;return e.first?function(e,t,n){while(e=e[s])if(1===e.nodeType||c)return a(e,t,n);return!1}:function(e,t,n){var r,i,o=[E,f];if(n){while(e=e[s])if((1===e.nodeType||c)&&a(e,t,n))return!0}else while(e=e[s])if(1===e.nodeType||c)if(i=e[S]||(e[S]={}),u&&fe(e,u))e=e[s]||e;else{if((r=i[l])&&r[0]===E&&r[1]===f)return o[2]=r[2];if((i[l]=o)[2]=a(e,t,n))return!0}return!1}}function K(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Z(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function ee(d,h,g,v,y,e){return v&&!v[S]&&(v=ee(v)),y&&!y[S]&&(y=ee(y,e)),F(function(e,t,n,r){var i,o,a,s,u=[],l=[],c=t.length,f=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)I(e,t[r],n);return n}(h||\"*\",n.nodeType?[n]:n,[]),p=!d||!e&&h?f:Z(f,u,d,n,r);if(g?g(p,s=y||(e?d:c||v)?[]:t,n,r):s=p,v){i=Z(s,l),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(s[l[o]]=!(p[l[o]]=a))}if(e){if(y||d){if(y){i=[],o=s.length;while(o--)(a=s[o])&&i.push(p[o]=a);y(null,s=[],i,r)}o=s.length;while(o--)(a=s[o])&&-1<(i=y?se.call(e,a):u[o])&&(e[i]=!(t[i]=a))}}else s=Z(s===t?s.splice(c,s.length):s),y?y(null,t,s,r):k.apply(t,s)})}function te(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[\" \"],s=o?1:0,u=J(function(e){return e===i},a,!0),l=J(function(e){return-1<se.call(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!=w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[J(K(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return ee(1<s&&K(c),1<s&&Q(e.slice(0,s-1).concat({value:\" \"===e[s-2].type?\"*\":\"\"})).replace(ve,\"$1\"),t,s<n&&te(e.slice(s,n)),n<r&&te(e=e.slice(n)),n<r&&Q(e))}c.push(t)}return K(c)}function ne(e,t){var n,v,y,m,x,r,i=[],o=[],a=u[e+\" \"];if(!a){t||(t=Y(e)),n=t.length;while(n--)(a=te(t[n]))[S]?i.push(a):o.push(a);(a=u(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l=\"0\",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG(\"*\",i),h=E+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==T||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==T||(V(o),n=!C);while(s=v[a++])if(s(o,t||T,n)){k.call(r,o);break}i&&(E=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=pe.call(r));f=Z(f)}k.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&ce.uniqueSort(r)}return i&&(E=h,w=p),c},m?F(r):r))).selector=e}return a}function re(e,t,n,r){var i,o,a,s,u,l=\"function\"==typeof e&&e,c=!r&&Y(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&\"ID\"===(a=o[0]).type&&9===t.nodeType&&C&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(O,P),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=D.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(O,P),H.test(o[0].type)&&U(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&Q(o)))return k.apply(n,r),n;break}}}return(l||ne(e,c))(r,t,!C,n,!t||H.test(e)&&U(t.parentNode)||t),n}G.prototype=b.filters=b.pseudos,b.setFilters=new G,le.sortStable=S.split(\"\").sort(l).join(\"\")===S,V(),le.sortDetached=$(function(e){return 1&e.compareDocumentPosition(T.createElement(\"fieldset\"))}),ce.find=I,ce.expr[\":\"]=ce.expr.pseudos,ce.unique=ce.uniqueSort,I.compile=ne,I.select=re,I.setDocument=V,I.tokenize=Y,I.escape=ce.escapeSelector,I.getText=ce.text,I.isXML=ce.isXMLDoc,I.selectors=ce.expr,I.support=ce.support,I.uniqueSort=ce.uniqueSort}();var d=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&ce(e).is(n))break;r.push(e)}return r},h=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},b=ce.expr.match.needsContext,w=/^<([a-z][^\\/\\0>:\\x20\\t\\r\\n\\f]*)[\\x20\\t\\r\\n\\f]*\\/?>(?:<\\/\\1>|)$/i;function T(e,n,r){return v(n)?ce.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?ce.grep(e,function(e){return e===n!==r}):\"string\"!=typeof n?ce.grep(e,function(e){return-1<se.call(n,e)!==r}):ce.filter(n,e,r)}ce.filter=function(e,t,n){var r=t[0];return n&&(e=\":not(\"+e+\")\"),1===t.length&&1===r.nodeType?ce.find.matchesSelector(r,e)?[r]:[]:ce.find.matches(e,ce.grep(t,function(e){return 1===e.nodeType}))},ce.fn.extend({find:function(e){var t,n,r=this.length,i=this;if(\"string\"!=typeof e)return this.pushStack(ce(e).filter(function(){for(t=0;t<r;t++)if(ce.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)ce.find(e,i[t],n);return 1<r?ce.uniqueSort(n):n},filter:function(e){return this.pushStack(T(this,e||[],!1))},not:function(e){return this.pushStack(T(this,e||[],!0))},is:function(e){return!!T(this,\"string\"==typeof e&&b.test(e)?ce(e):e||[],!1).length}});var k,S=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]+))$/;(ce.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||k,\"string\"==typeof e){if(!(r=\"<\"===e[0]&&\">\"===e[e.length-1]&&3<=e.length?[null,e,null]:S.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof ce?t[0]:t,ce.merge(this,ce.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:C,!0)),w.test(r[1])&&ce.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=C.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(ce):ce.makeArray(e,this)}).prototype=ce.fn,k=ce(C);var E=/^(?:parents|prev(?:Until|All))/,j={children:!0,contents:!0,next:!0,prev:!0};function A(e,t){while((e=e[t])&&1!==e.nodeType);return e}ce.fn.extend({has:function(e){var t=ce(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(ce.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a=\"string\"!=typeof e&&ce(e);if(!b.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&ce.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?ce.uniqueSort(o):o)},index:function(e){return e?\"string\"==typeof e?se.call(ce(e),this[0]):se.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ce.uniqueSort(ce.merge(this.get(),ce(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ce.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return d(e,\"parentNode\")},parentsUntil:function(e,t,n){return d(e,\"parentNode\",n)},next:function(e){return A(e,\"nextSibling\")},prev:function(e){return A(e,\"previousSibling\")},nextAll:function(e){return d(e,\"nextSibling\")},prevAll:function(e){return d(e,\"previousSibling\")},nextUntil:function(e,t,n){return d(e,\"nextSibling\",n)},prevUntil:function(e,t,n){return d(e,\"previousSibling\",n)},siblings:function(e){return h((e.parentNode||{}).firstChild,e)},children:function(e){return h(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(fe(e,\"template\")&&(e=e.content||e),ce.merge([],e.childNodes))}},function(r,i){ce.fn[r]=function(e,t){var n=ce.map(this,i,e);return\"Until\"!==r.slice(-5)&&(t=e),t&&\"string\"==typeof t&&(n=ce.filter(t,n)),1<this.length&&(j[r]||ce.uniqueSort(n),E.test(r)&&n.reverse()),this.pushStack(n)}});var D=/[^\\x20\\t\\r\\n\\f]+/g;function N(e){return e}function q(e){throw e}function L(e,t,n,r){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(n):e&&v(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}ce.Callbacks=function(r){var e,n;r=\"string\"==typeof r?(e=r,n={},ce.each(e.match(D)||[],function(e,t){n[t]=!0}),n):ce.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:\"\")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){ce.each(e,function(e,t){v(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&\"string\"!==x(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return ce.each(arguments,function(e,t){var n;while(-1<(n=ce.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<ce.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t=\"\",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=\"\"),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},ce.extend({Deferred:function(e){var o=[[\"notify\",\"progress\",ce.Callbacks(\"memory\"),ce.Callbacks(\"memory\"),2],[\"resolve\",\"done\",ce.Callbacks(\"once memory\"),ce.Callbacks(\"once memory\"),0,\"resolved\"],[\"reject\",\"fail\",ce.Callbacks(\"once memory\"),ce.Callbacks(\"once memory\"),1,\"rejected\"]],i=\"pending\",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},\"catch\":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return ce.Deferred(function(r){ce.each(o,function(e,t){var n=v(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&v(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+\"With\"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError(\"Thenable self-resolution\");t=e&&(\"object\"==typeof e||\"function\"==typeof e)&&e.then,v(t)?s?t.call(e,l(u,o,N,s),l(u,o,q,s)):(u++,t.call(e,l(u,o,N,s),l(u,o,q,s),l(u,o,N,o.notifyWith))):(a!==N&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){ce.Deferred.exceptionHook&&ce.Deferred.exceptionHook(e,t.error),u<=i+1&&(a!==q&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(ce.Deferred.getErrorHook?t.error=ce.Deferred.getErrorHook():ce.Deferred.getStackHook&&(t.error=ce.Deferred.getStackHook()),ie.setTimeout(t))}}return ce.Deferred(function(e){o[0][3].add(l(0,e,v(r)?r:N,e.notifyWith)),o[1][3].add(l(0,e,v(t)?t:N)),o[2][3].add(l(0,e,v(n)?n:q))}).promise()},promise:function(e){return null!=e?ce.extend(e,a):a}},s={};return ce.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+\"With\"](this===s?void 0:this,arguments),this},s[t[0]+\"With\"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=ae.call(arguments),o=ce.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?ae.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(L(e,o.done(a(t)).resolve,o.reject,!n),\"pending\"===o.state()||v(i[t]&&i[t].then)))return o.then();while(t--)L(i[t],a(t),o.reject);return o.promise()}});var H=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ce.Deferred.exceptionHook=function(e,t){ie.console&&ie.console.warn&&e&&H.test(e.name)&&ie.console.warn(\"jQuery.Deferred exception: \"+e.message,e.stack,t)},ce.readyException=function(e){ie.setTimeout(function(){throw e})};var O=ce.Deferred();function P(){C.removeEventListener(\"DOMContentLoaded\",P),ie.removeEventListener(\"load\",P),ce.ready()}ce.fn.ready=function(e){return O.then(e)[\"catch\"](function(e){ce.readyException(e)}),this},ce.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--ce.readyWait:ce.isReady)||(ce.isReady=!0)!==e&&0<--ce.readyWait||O.resolveWith(C,[ce])}}),ce.ready.then=O.then,\"complete\"===C.readyState||\"loading\"!==C.readyState&&!C.documentElement.doScroll?ie.setTimeout(ce.ready):(C.addEventListener(\"DOMContentLoaded\",P),ie.addEventListener(\"load\",P));var M=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if(\"object\"===x(n))for(s in i=!0,n)M(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,v(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(ce(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},R=/^-ms-/,I=/-([a-z])/g;function W(e,t){return t.toUpperCase()}function F(e){return e.replace(R,\"ms-\").replace(I,W)}var $=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function B(){this.expando=ce.expando+B.uid++}B.uid=1,B.prototype={cache:function(e){var t=e[this.expando];return t||(t={},$(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if(\"string\"==typeof t)i[F(t)]=n;else for(r in t)i[F(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][F(t)]},access:function(e,t,n){return void 0===t||t&&\"string\"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(F):(t=F(t))in r?[t]:t.match(D)||[]).length;while(n--)delete r[t[n]]}(void 0===t||ce.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ce.isEmptyObject(t)}};var _=new B,z=new B,X=/^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,U=/[A-Z]/g;function V(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r=\"data-\"+t.replace(U,\"-$&\").toLowerCase(),\"string\"==typeof(n=e.getAttribute(r))){try{n=\"true\"===(i=n)||\"false\"!==i&&(\"null\"===i?null:i===+i+\"\"?+i:X.test(i)?JSON.parse(i):i)}catch(e){}z.set(e,t,n)}else n=void 0;return n}ce.extend({hasData:function(e){return z.hasData(e)||_.hasData(e)},data:function(e,t,n){return z.access(e,t,n)},removeData:function(e,t){z.remove(e,t)},_data:function(e,t,n){return _.access(e,t,n)},_removeData:function(e,t){_.remove(e,t)}}),ce.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=z.get(o),1===o.nodeType&&!_.get(o,\"hasDataAttrs\"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf(\"data-\")&&(r=F(r.slice(5)),V(o,r,i[r]));_.set(o,\"hasDataAttrs\",!0)}return i}return\"object\"==typeof n?this.each(function(){z.set(this,n)}):M(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=z.get(o,n))?t:void 0!==(t=V(o,n))?t:void 0;this.each(function(){z.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){z.remove(this,e)})}}),ce.extend({queue:function(e,t,n){var r;if(e)return t=(t||\"fx\")+\"queue\",r=_.get(e,t),n&&(!r||Array.isArray(n)?r=_.access(e,t,ce.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||\"fx\";var n=ce.queue(e,t),r=n.length,i=n.shift(),o=ce._queueHooks(e,t);\"inprogress\"===i&&(i=n.shift(),r--),i&&(\"fx\"===t&&n.unshift(\"inprogress\"),delete o.stop,i.call(e,function(){ce.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+\"queueHooks\";return _.get(e,n)||_.access(e,n,{empty:ce.Callbacks(\"once memory\").add(function(){_.remove(e,[t+\"queue\",n])})})}}),ce.fn.extend({queue:function(t,n){var e=2;return\"string\"!=typeof t&&(n=t,t=\"fx\",e--),arguments.length<e?ce.queue(this[0],t):void 0===n?this:this.each(function(){var e=ce.queue(this,t,n);ce._queueHooks(this,t),\"fx\"===t&&\"inprogress\"!==e[0]&&ce.dequeue(this,t)})},dequeue:function(e){return this.each(function(){ce.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||\"fx\",[])},promise:function(e,t){var n,r=1,i=ce.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};\"string\"!=typeof e&&(t=e,e=void 0),e=e||\"fx\";while(a--)(n=_.get(o[a],e+\"queueHooks\"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var G=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,Y=new RegExp(\"^(?:([+-])=|)(\"+G+\")([a-z%]*)$\",\"i\"),Q=[\"Top\",\"Right\",\"Bottom\",\"Left\"],J=C.documentElement,K=function(e){return ce.contains(e.ownerDocument,e)},Z={composed:!0};J.getRootNode&&(K=function(e){return ce.contains(e.ownerDocument,e)||e.getRootNode(Z)===e.ownerDocument});var ee=function(e,t){return\"none\"===(e=t||e).style.display||\"\"===e.style.display&&K(e)&&\"none\"===ce.css(e,\"display\")};function te(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return ce.css(e,t,\"\")},u=s(),l=n&&n[3]||(ce.cssNumber[t]?\"\":\"px\"),c=e.nodeType&&(ce.cssNumber[t]||\"px\"!==l&&+u)&&Y.exec(ce.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)ce.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,ce.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ne={};function re(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?(\"none\"===n&&(l[c]=_.get(r,\"display\")||null,l[c]||(r.style.display=\"\")),\"\"===r.style.display&&ee(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ne[s])||(o=a.body.appendChild(a.createElement(s)),u=ce.css(o,\"display\"),o.parentNode.removeChild(o),\"none\"===u&&(u=\"block\"),ne[s]=u)))):\"none\"!==n&&(l[c]=\"none\",_.set(r,\"display\",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}ce.fn.extend({show:function(){return re(this,!0)},hide:function(){return re(this)},toggle:function(e){return\"boolean\"==typeof e?e?this.show():this.hide():this.each(function(){ee(this)?ce(this).show():ce(this).hide()})}});var xe,be,we=/^(?:checkbox|radio)$/i,Te=/<([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]*)/i,Ce=/^$|^module$|\\/(?:java|ecma)script/i;xe=C.createDocumentFragment().appendChild(C.createElement(\"div\")),(be=C.createElement(\"input\")).setAttribute(\"type\",\"radio\"),be.setAttribute(\"checked\",\"checked\"),be.setAttribute(\"name\",\"t\"),xe.appendChild(be),le.checkClone=xe.cloneNode(!0).cloneNode(!0).lastChild.checked,xe.innerHTML=\"<textarea>x</textarea>\",le.noCloneChecked=!!xe.cloneNode(!0).lastChild.defaultValue,xe.innerHTML=\"<option></option>\",le.option=!!xe.lastChild;var ke={thead:[1,\"<table>\",\"</table>\"],col:[2,\"<table><colgroup>\",\"</colgroup></table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],_default:[0,\"\",\"\"]};function Se(e,t){var n;return n=\"undefined\"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||\"*\"):\"undefined\"!=typeof e.querySelectorAll?e.querySelectorAll(t||\"*\"):[],void 0===t||t&&fe(e,t)?ce.merge([e],n):n}function Ee(e,t){for(var n=0,r=e.length;n<r;n++)_.set(e[n],\"globalEval\",!t||_.get(t[n],\"globalEval\"))}ke.tbody=ke.tfoot=ke.colgroup=ke.caption=ke.thead,ke.th=ke.td,le.option||(ke.optgroup=ke.option=[1,\"<select multiple='multiple'>\",\"</select>\"]);var je=/<|&#?\\w+;/;function Ae(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if(\"object\"===x(o))ce.merge(p,o.nodeType?[o]:o);else if(je.test(o)){a=a||f.appendChild(t.createElement(\"div\")),s=(Te.exec(o)||[\"\",\"\"])[1].toLowerCase(),u=ke[s]||ke._default,a.innerHTML=u[1]+ce.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;ce.merge(p,a.childNodes),(a=f.firstChild).textContent=\"\"}else p.push(t.createTextNode(o));f.textContent=\"\",d=0;while(o=p[d++])if(r&&-1<ce.inArray(o,r))i&&i.push(o);else if(l=K(o),a=Se(f.appendChild(o),\"script\"),l&&Ee(a),n){c=0;while(o=a[c++])Ce.test(o.type||\"\")&&n.push(o)}return f}var De=/^([^.]*)(?:\\.(.+)|)/;function Ne(){return!0}function qe(){return!1}function Le(e,t,n,r,i,o){var a,s;if(\"object\"==typeof t){for(s in\"string\"!=typeof n&&(r=r||n,n=void 0),t)Le(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&(\"string\"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=qe;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return ce().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=ce.guid++)),e.each(function(){ce.event.add(this,t,i,r,n)})}function He(e,r,t){t?(_.set(e,r,!1),ce.event.add(e,r,{namespace:!1,handler:function(e){var t,n=_.get(this,r);if(1&e.isTrigger&&this[r]){if(n)(ce.event.special[r]||{}).delegateType&&e.stopPropagation();else if(n=ae.call(arguments),_.set(this,r,n),this[r](),t=_.get(this,r),_.set(this,r,!1),n!==t)return e.stopImmediatePropagation(),e.preventDefault(),t}else n&&(_.set(this,r,ce.event.trigger(n[0],n.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Ne)}})):void 0===_.get(e,r)&&ce.event.add(e,r,Ne)}ce.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.get(t);if($(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&ce.find.matchesSelector(J,i),n.guid||(n.guid=ce.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return\"undefined\"!=typeof ce&&ce.event.triggered!==e.type?ce.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||\"\").match(D)||[\"\"]).length;while(l--)d=g=(s=De.exec(e[l])||[])[1],h=(s[2]||\"\").split(\".\").sort(),d&&(f=ce.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=ce.event.special[d]||{},c=ce.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&ce.expr.match.needsContext.test(i),namespace:h.join(\".\")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),ce.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.hasData(e)&&_.get(e);if(v&&(u=v.events)){l=(t=(t||\"\").match(D)||[\"\"]).length;while(l--)if(d=g=(s=De.exec(t[l])||[])[1],h=(s[2]||\"\").split(\".\").sort(),d){f=ce.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp(\"(^|\\\\.)\"+h.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&(\"**\"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||ce.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)ce.event.remove(e,d+t[l],n,r,!0);ce.isEmptyObject(u)&&_.remove(e,\"handle events\")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=ce.event.fix(e),l=(_.get(this,\"events\")||Object.create(null))[u.type]||[],c=ce.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=ce.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((ce.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!(\"click\"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&(\"click\"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+\" \"]&&(a[i]=r.needsContext?-1<ce(i,this).index(l):ce.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(ce.Event.prototype,t,{enumerable:!0,configurable:!0,get:v(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[ce.expando]?e:new ce.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,\"input\")&&He(t,\"click\",!0),!1},trigger:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,\"input\")&&He(t,\"click\"),!0},_default:function(e){var t=e.target;return we.test(t.type)&&t.click&&fe(t,\"input\")&&_.get(t,\"click\")||fe(t,\"a\")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ce.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},ce.Event=function(e,t){if(!(this instanceof ce.Event))return new ce.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ne:qe,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&ce.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[ce.expando]=!0},ce.Event.prototype={constructor:ce.Event,isDefaultPrevented:qe,isPropagationStopped:qe,isImmediatePropagationStopped:qe,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ne,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ne,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ne,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ce.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,\"char\":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},ce.event.addProp),ce.each({focus:\"focusin\",blur:\"focusout\"},function(r,i){function o(e){if(C.documentMode){var t=_.get(this,\"handle\"),n=ce.event.fix(e);n.type=\"focusin\"===e.type?\"focus\":\"blur\",n.isSimulated=!0,t(e),n.target===n.currentTarget&&t(n)}else ce.event.simulate(i,e.target,ce.event.fix(e))}ce.event.special[r]={setup:function(){var e;if(He(this,r,!0),!C.documentMode)return!1;(e=_.get(this,i))||this.addEventListener(i,o),_.set(this,i,(e||0)+1)},trigger:function(){return He(this,r),!0},teardown:function(){var e;if(!C.documentMode)return!1;(e=_.get(this,i)-1)?_.set(this,i,e):(this.removeEventListener(i,o),_.remove(this,i))},_default:function(e){return _.get(e.target,r)},delegateType:i},ce.event.special[i]={setup:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i);n||(C.documentMode?this.addEventListener(i,o):e.addEventListener(r,o,!0)),_.set(t,i,(n||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i)-1;n?_.set(t,i,n):(C.documentMode?this.removeEventListener(i,o):e.removeEventListener(r,o,!0),_.remove(t,i))}}}),ce.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\",pointerenter:\"pointerover\",pointerleave:\"pointerout\"},function(e,i){ce.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||ce.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),ce.fn.extend({on:function(e,t,n,r){return Le(this,e,t,n,r)},one:function(e,t,n,r){return Le(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ce(e.delegateTarget).off(r.namespace?r.origType+\".\"+r.namespace:r.origType,r.selector,r.handler),this;if(\"object\"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&\"function\"!=typeof t||(n=t,t=void 0),!1===n&&(n=qe),this.each(function(){ce.event.remove(this,e,n,t)})}});var Oe=/<script|<style|<link/i,Pe=/checked\\s*(?:[^=]|=\\s*.checked.)/i,Me=/^\\s*<!\\[CDATA\\[|\\]\\]>\\s*$/g;function Re(e,t){return fe(e,\"table\")&&fe(11!==t.nodeType?t:t.firstChild,\"tr\")&&ce(e).children(\"tbody\")[0]||e}function Ie(e){return e.type=(null!==e.getAttribute(\"type\"))+\"/\"+e.type,e}function We(e){return\"true/\"===(e.type||\"\").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute(\"type\"),e}function Fe(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(_.hasData(e)&&(s=_.get(e).events))for(i in _.remove(t,\"handle events\"),s)for(n=0,r=s[i].length;n<r;n++)ce.event.add(t,i,s[i][n]);z.hasData(e)&&(o=z.access(e),a=ce.extend({},o),z.set(t,a))}}function $e(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=v(d);if(h||1<f&&\"string\"==typeof d&&!le.checkClone&&Pe.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),$e(t,r,i,o)});if(f&&(t=(e=Ae(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=ce.map(Se(e,\"script\"),Ie)).length;c<f;c++)u=e,c!==p&&(u=ce.clone(u,!0,!0),s&&ce.merge(a,Se(u,\"script\"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,ce.map(a,We),c=0;c<s;c++)u=a[c],Ce.test(u.type||\"\")&&!_.access(u,\"globalEval\")&&ce.contains(l,u)&&(u.src&&\"module\"!==(u.type||\"\").toLowerCase()?ce._evalUrl&&!u.noModule&&ce._evalUrl(u.src,{nonce:u.nonce||u.getAttribute(\"nonce\")},l):m(u.textContent.replace(Me,\"\"),u,l))}return n}function Be(e,t,n){for(var r,i=t?ce.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||ce.cleanData(Se(r)),r.parentNode&&(n&&K(r)&&Ee(Se(r,\"script\")),r.parentNode.removeChild(r));return e}ce.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=K(e);if(!(le.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ce.isXMLDoc(e)))for(a=Se(c),r=0,i=(o=Se(e)).length;r<i;r++)s=o[r],u=a[r],void 0,\"input\"===(l=u.nodeName.toLowerCase())&&we.test(s.type)?u.checked=s.checked:\"input\"!==l&&\"textarea\"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||Se(e),a=a||Se(c),r=0,i=o.length;r<i;r++)Fe(o[r],a[r]);else Fe(e,c);return 0<(a=Se(c,\"script\")).length&&Ee(a,!f&&Se(e,\"script\")),c},cleanData:function(e){for(var t,n,r,i=ce.event.special,o=0;void 0!==(n=e[o]);o++)if($(n)){if(t=n[_.expando]){if(t.events)for(r in t.events)i[r]?ce.event.remove(n,r):ce.removeEvent(n,r,t.handle);n[_.expando]=void 0}n[z.expando]&&(n[z.expando]=void 0)}}}),ce.fn.extend({detach:function(e){return Be(this,e,!0)},remove:function(e){return Be(this,e)},text:function(e){return M(this,function(e){return void 0===e?ce.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return $e(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Re(this,e).appendChild(e)})},prepend:function(){return $e(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Re(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ce.cleanData(Se(e,!1)),e.textContent=\"\");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ce.clone(this,e,t)})},html:function(e){return M(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if(\"string\"==typeof e&&!Oe.test(e)&&!ke[(Te.exec(e)||[\"\",\"\"])[1].toLowerCase()]){e=ce.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(ce.cleanData(Se(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return $e(this,arguments,function(e){var t=this.parentNode;ce.inArray(this,n)<0&&(ce.cleanData(Se(this)),t&&t.replaceChild(e,this))},n)}}),ce.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(e,a){ce.fn[e]=function(e){for(var t,n=[],r=ce(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),ce(r[o])[a](t),s.apply(n,t.get());return this.pushStack(n)}});var _e=new RegExp(\"^(\"+G+\")(?!px)[a-z%]+$\",\"i\"),ze=/^--/,Xe=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=ie),t.getComputedStyle(e)},Ue=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ve=new RegExp(Q.join(\"|\"),\"i\");function Ge(e,t,n){var r,i,o,a,s=ze.test(t),u=e.style;return(n=n||Xe(e))&&(a=n.getPropertyValue(t)||n[t],s&&a&&(a=a.replace(ve,\"$1\")||void 0),\"\"!==a||K(e)||(a=ce.style(e,t)),!le.pixelBoxStyles()&&_e.test(a)&&Ve.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=i,u.maxWidth=o)),void 0!==a?a+\"\":a}function Ye(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText=\"position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0\",l.style.cssText=\"position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%\",J.appendChild(u).appendChild(l);var e=ie.getComputedStyle(l);n=\"1%\"!==e.top,s=12===t(e.marginLeft),l.style.right=\"60%\",o=36===t(e.right),r=36===t(e.width),l.style.position=\"absolute\",i=12===t(l.offsetWidth/3),J.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=C.createElement(\"div\"),l=C.createElement(\"div\");l.style&&(l.style.backgroundClip=\"content-box\",l.cloneNode(!0).style.backgroundClip=\"\",le.clearCloneStyle=\"content-box\"===l.style.backgroundClip,ce.extend(le,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=C.createElement(\"table\"),t=C.createElement(\"tr\"),n=C.createElement(\"div\"),e.style.cssText=\"position:absolute;left:-11111px;border-collapse:separate\",t.style.cssText=\"box-sizing:content-box;border:1px solid\",t.style.height=\"1px\",n.style.height=\"9px\",n.style.display=\"block\",J.appendChild(e).appendChild(t).appendChild(n),r=ie.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,J.removeChild(e)),a}}))}();var Qe=[\"Webkit\",\"Moz\",\"ms\"],Je=C.createElement(\"div\").style,Ke={};function Ze(e){var t=ce.cssProps[e]||Ke[e];return t||(e in Je?e:Ke[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Qe.length;while(n--)if((e=Qe[n]+t)in Je)return e}(e)||e)}var et=/^(none|table(?!-c[ea]).+)/,tt={position:\"absolute\",visibility:\"hidden\",display:\"block\"},nt={letterSpacing:\"0\",fontWeight:\"400\"};function rt(e,t,n){var r=Y.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||\"px\"):t}function it(e,t,n,r,i,o){var a=\"width\"===t?1:0,s=0,u=0,l=0;if(n===(r?\"border\":\"content\"))return 0;for(;a<4;a+=2)\"margin\"===n&&(l+=ce.css(e,n+Q[a],!0,i)),r?(\"content\"===n&&(u-=ce.css(e,\"padding\"+Q[a],!0,i)),\"margin\"!==n&&(u-=ce.css(e,\"border\"+Q[a]+\"Width\",!0,i))):(u+=ce.css(e,\"padding\"+Q[a],!0,i),\"padding\"!==n?u+=ce.css(e,\"border\"+Q[a]+\"Width\",!0,i):s+=ce.css(e,\"border\"+Q[a]+\"Width\",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e[\"offset\"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u+l}function ot(e,t,n){var r=Xe(e),i=(!le.boxSizingReliable()||n)&&\"border-box\"===ce.css(e,\"boxSizing\",!1,r),o=i,a=Ge(e,t,r),s=\"offset\"+t[0].toUpperCase()+t.slice(1);if(_e.test(a)){if(!n)return a;a=\"auto\"}return(!le.boxSizingReliable()&&i||!le.reliableTrDimensions()&&fe(e,\"tr\")||\"auto\"===a||!parseFloat(a)&&\"inline\"===ce.css(e,\"display\",!1,r))&&e.getClientRects().length&&(i=\"border-box\"===ce.css(e,\"boxSizing\",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+it(e,t,n||(i?\"border\":\"content\"),o,r,a)+\"px\"}function at(e,t,n,r,i){return new at.prototype.init(e,t,n,r,i)}ce.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ge(e,\"opacity\");return\"\"===n?\"1\":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=F(t),u=ze.test(t),l=e.style;if(u||(t=Ze(s)),a=ce.cssHooks[t]||ce.cssHooks[s],void 0===n)return a&&\"get\"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];\"string\"===(o=typeof n)&&(i=Y.exec(n))&&i[1]&&(n=te(e,t,i),o=\"number\"),null!=n&&n==n&&(\"number\"!==o||u||(n+=i&&i[3]||(ce.cssNumber[s]?\"\":\"px\")),le.clearCloneStyle||\"\"!==n||0!==t.indexOf(\"background\")||(l[t]=\"inherit\"),a&&\"set\"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=F(t);return ze.test(t)||(t=Ze(s)),(a=ce.cssHooks[t]||ce.cssHooks[s])&&\"get\"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Ge(e,t,r)),\"normal\"===i&&t in nt&&(i=nt[t]),\"\"===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),ce.each([\"height\",\"width\"],function(e,u){ce.cssHooks[u]={get:function(e,t,n){if(t)return!et.test(ce.css(e,\"display\"))||e.getClientRects().length&&e.getBoundingClientRect().width?ot(e,u,n):Ue(e,tt,function(){return ot(e,u,n)})},set:function(e,t,n){var r,i=Xe(e),o=!le.scrollboxSize()&&\"absolute\"===i.position,a=(o||n)&&\"border-box\"===ce.css(e,\"boxSizing\",!1,i),s=n?it(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e[\"offset\"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-it(e,u,\"border\",!1,i)-.5)),s&&(r=Y.exec(t))&&\"px\"!==(r[3]||\"px\")&&(e.style[u]=t,t=ce.css(e,u)),rt(0,t,s)}}}),ce.cssHooks.marginLeft=Ye(le.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Ge(e,\"marginLeft\"))||e.getBoundingClientRect().left-Ue(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+\"px\"}),ce.each({margin:\"\",padding:\"\",border:\"Width\"},function(i,o){ce.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r=\"string\"==typeof e?e.split(\" \"):[e];t<4;t++)n[i+Q[t]+o]=r[t]||r[t-2]||r[0];return n}},\"margin\"!==i&&(ce.cssHooks[i+o].set=rt)}),ce.fn.extend({css:function(e,t){return M(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Xe(e),i=t.length;a<i;a++)o[t[a]]=ce.css(e,t[a],!1,r);return o}return void 0!==n?ce.style(e,t,n):ce.css(e,t)},e,t,1<arguments.length)}}),((ce.Tween=at).prototype={constructor:at,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||ce.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(ce.cssNumber[n]?\"\":\"px\")},cur:function(){var e=at.propHooks[this.prop];return e&&e.get?e.get(this):at.propHooks._default.get(this)},run:function(e){var t,n=at.propHooks[this.prop];return this.options.duration?this.pos=t=ce.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):at.propHooks._default.set(this),this}}).init.prototype=at.prototype,(at.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=ce.css(e.elem,e.prop,\"\"))&&\"auto\"!==t?t:0},set:function(e){ce.fx.step[e.prop]?ce.fx.step[e.prop](e):1!==e.elem.nodeType||!ce.cssHooks[e.prop]&&null==e.elem.style[Ze(e.prop)]?e.elem[e.prop]=e.now:ce.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=at.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ce.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:\"swing\"},ce.fx=at.prototype.init,ce.fx.step={};var st,ut,lt,ct,ft=/^(?:toggle|show|hide)$/,pt=/queueHooks$/;function dt(){ut&&(!1===C.hidden&&ie.requestAnimationFrame?ie.requestAnimationFrame(dt):ie.setTimeout(dt,ce.fx.interval),ce.fx.tick())}function ht(){return ie.setTimeout(function(){st=void 0}),st=Date.now()}function gt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i[\"margin\"+(n=Q[r])]=i[\"padding\"+n]=e;return t&&(i.opacity=i.width=e),i}function vt(e,t,n){for(var r,i=(yt.tweeners[t]||[]).concat(yt.tweeners[\"*\"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function yt(o,e,t){var n,a,r=0,i=yt.prefilters.length,s=ce.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=st||ht(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:ce.extend({},e),opts:ce.extend(!0,{specialEasing:{},easing:ce.easing._default},t),originalProperties:e,originalOptions:t,startTime:st||ht(),duration:t.duration,tweens:[],createTween:function(e,t){var n=ce.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=F(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=ce.cssHooks[r])&&\"expand\"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=yt.prefilters[r].call(l,o,c,l.opts))return v(n.stop)&&(ce._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return ce.map(c,vt,l),v(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),ce.fx.timer(ce.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}ce.Animation=ce.extend(yt,{tweeners:{\"*\":[function(e,t){var n=this.createTween(e,t);return te(n.elem,e,Y.exec(t),n),n}]},tweener:function(e,t){v(e)?(t=e,e=[\"*\"]):e=e.match(D);for(var n,r=0,i=e.length;r<i;r++)n=e[r],yt.tweeners[n]=yt.tweeners[n]||[],yt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f=\"width\"in t||\"height\"in t,p=this,d={},h=e.style,g=e.nodeType&&ee(e),v=_.get(e,\"fxshow\");for(r in n.queue||(null==(a=ce._queueHooks(e,\"fx\")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,ce.queue(e,\"fx\").length||a.empty.fire()})})),t)if(i=t[r],ft.test(i)){if(delete t[r],o=o||\"toggle\"===i,i===(g?\"hide\":\"show\")){if(\"show\"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||ce.style(e,r)}if((u=!ce.isEmptyObject(t))||!ce.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=_.get(e,\"display\")),\"none\"===(c=ce.css(e,\"display\"))&&(l?c=l:(re([e],!0),l=e.style.display||l,c=ce.css(e,\"display\"),re([e]))),(\"inline\"===c||\"inline-block\"===c&&null!=l)&&\"none\"===ce.css(e,\"float\")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l=\"none\"===c?\"\":c)),h.display=\"inline-block\")),n.overflow&&(h.overflow=\"hidden\",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?\"hidden\"in v&&(g=v.hidden):v=_.access(e,\"fxshow\",{display:l}),o&&(v.hidden=!g),g&&re([e],!0),p.done(function(){for(r in g||re([e]),_.remove(e,\"fxshow\"),d)ce.style(e,r,d[r])})),u=vt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?yt.prefilters.unshift(e):yt.prefilters.push(e)}}),ce.speed=function(e,t,n){var r=e&&\"object\"==typeof e?ce.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return ce.fx.off?r.duration=0:\"number\"!=typeof r.duration&&(r.duration in ce.fx.speeds?r.duration=ce.fx.speeds[r.duration]:r.duration=ce.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue=\"fx\"),r.old=r.complete,r.complete=function(){v(r.old)&&r.old.call(this),r.queue&&ce.dequeue(this,r.queue)},r},ce.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ee).css(\"opacity\",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=ce.isEmptyObject(t),o=ce.speed(e,n,r),a=function(){var e=yt(this,ce.extend({},t),o);(i||_.get(this,\"finish\"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return\"string\"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||\"fx\",[]),this.each(function(){var e=!0,t=null!=i&&i+\"queueHooks\",n=ce.timers,r=_.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&pt.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||ce.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||\"fx\"),this.each(function(){var e,t=_.get(this),n=t[a+\"queue\"],r=t[a+\"queueHooks\"],i=ce.timers,o=n?n.length:0;for(t.finish=!0,ce.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),ce.each([\"toggle\",\"show\",\"hide\"],function(e,r){var i=ce.fn[r];ce.fn[r]=function(e,t,n){return null==e||\"boolean\"==typeof e?i.apply(this,arguments):this.animate(gt(r,!0),e,t,n)}}),ce.each({slideDown:gt(\"show\"),slideUp:gt(\"hide\"),slideToggle:gt(\"toggle\"),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},function(e,r){ce.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),ce.timers=[],ce.fx.tick=function(){var e,t=0,n=ce.timers;for(st=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||ce.fx.stop(),st=void 0},ce.fx.timer=function(e){ce.timers.push(e),ce.fx.start()},ce.fx.interval=13,ce.fx.start=function(){ut||(ut=!0,dt())},ce.fx.stop=function(){ut=null},ce.fx.speeds={slow:600,fast:200,_default:400},ce.fn.delay=function(r,e){return r=ce.fx&&ce.fx.speeds[r]||r,e=e||\"fx\",this.queue(e,function(e,t){var n=ie.setTimeout(e,r);t.stop=function(){ie.clearTimeout(n)}})},lt=C.createElement(\"input\"),ct=C.createElement(\"select\").appendChild(C.createElement(\"option\")),lt.type=\"checkbox\",le.checkOn=\"\"!==lt.value,le.optSelected=ct.selected,(lt=C.createElement(\"input\")).value=\"t\",lt.type=\"radio\",le.radioValue=\"t\"===lt.value;var mt,xt=ce.expr.attrHandle;ce.fn.extend({attr:function(e,t){return M(this,ce.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){ce.removeAttr(this,e)})}}),ce.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return\"undefined\"==typeof e.getAttribute?ce.prop(e,t,n):(1===o&&ce.isXMLDoc(e)||(i=ce.attrHooks[t.toLowerCase()]||(ce.expr.match.bool.test(t)?mt:void 0)),void 0!==n?null===n?void ce.removeAttr(e,t):i&&\"set\"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+\"\"),n):i&&\"get\"in i&&null!==(r=i.get(e,t))?r:null==(r=ce.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!le.radioValue&&\"radio\"===t&&fe(e,\"input\")){var n=e.value;return e.setAttribute(\"type\",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(D);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),mt={set:function(e,t,n){return!1===t?ce.removeAttr(e,n):e.setAttribute(n,n),n}},ce.each(ce.expr.match.bool.source.match(/\\w+/g),function(e,t){var a=xt[t]||ce.find.attr;xt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=xt[o],xt[o]=r,r=null!=a(e,t,n)?o:null,xt[o]=i),r}});var bt=/^(?:input|select|textarea|button)$/i,wt=/^(?:a|area)$/i;function Tt(e){return(e.match(D)||[]).join(\" \")}function Ct(e){return e.getAttribute&&e.getAttribute(\"class\")||\"\"}function kt(e){return Array.isArray(e)?e:\"string\"==typeof e&&e.match(D)||[]}ce.fn.extend({prop:function(e,t){return M(this,ce.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[ce.propFix[e]||e]})}}),ce.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ce.isXMLDoc(e)||(t=ce.propFix[t]||t,i=ce.propHooks[t]),void 0!==n?i&&\"set\"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&\"get\"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=ce.find.attr(e,\"tabindex\");return t?parseInt(t,10):bt.test(e.nodeName)||wt.test(e.nodeName)&&e.href?0:-1}}},propFix:{\"for\":\"htmlFor\",\"class\":\"className\"}}),le.optSelected||(ce.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ce.each([\"tabIndex\",\"readOnly\",\"maxLength\",\"cellSpacing\",\"cellPadding\",\"rowSpan\",\"colSpan\",\"useMap\",\"frameBorder\",\"contentEditable\"],function(){ce.propFix[this.toLowerCase()]=this}),ce.fn.extend({addClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).addClass(t.call(this,e,Ct(this)))}):(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&\" \"+Tt(r)+\" \"){for(o=0;o<e.length;o++)i=e[o],n.indexOf(\" \"+i+\" \")<0&&(n+=i+\" \");a=Tt(n),r!==a&&this.setAttribute(\"class\",a)}}):this},removeClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).removeClass(t.call(this,e,Ct(this)))}):arguments.length?(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&\" \"+Tt(r)+\" \"){for(o=0;o<e.length;o++){i=e[o];while(-1<n.indexOf(\" \"+i+\" \"))n=n.replace(\" \"+i+\" \",\" \")}a=Tt(n),r!==a&&this.setAttribute(\"class\",a)}}):this:this.attr(\"class\",\"\")},toggleClass:function(t,n){var e,r,i,o,a=typeof t,s=\"string\"===a||Array.isArray(t);return v(t)?this.each(function(e){ce(this).toggleClass(t.call(this,e,Ct(this),n),n)}):\"boolean\"==typeof n&&s?n?this.addClass(t):this.removeClass(t):(e=kt(t),this.each(function(){if(s)for(o=ce(this),i=0;i<e.length;i++)r=e[i],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==t&&\"boolean\"!==a||((r=Ct(this))&&_.set(this,\"__className__\",r),this.setAttribute&&this.setAttribute(\"class\",r||!1===t?\"\":_.get(this,\"__className__\")||\"\"))}))},hasClass:function(e){var t,n,r=0;t=\" \"+e+\" \";while(n=this[r++])if(1===n.nodeType&&-1<(\" \"+Tt(Ct(n))+\" \").indexOf(t))return!0;return!1}});var St=/\\r/g;ce.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=v(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,ce(this).val()):n)?t=\"\":\"number\"==typeof t?t+=\"\":Array.isArray(t)&&(t=ce.map(t,function(e){return null==e?\"\":e+\"\"})),(r=ce.valHooks[this.type]||ce.valHooks[this.nodeName.toLowerCase()])&&\"set\"in r&&void 0!==r.set(this,t,\"value\")||(this.value=t))})):t?(r=ce.valHooks[t.type]||ce.valHooks[t.nodeName.toLowerCase()])&&\"get\"in r&&void 0!==(e=r.get(t,\"value\"))?e:\"string\"==typeof(e=t.value)?e.replace(St,\"\"):null==e?\"\":e:void 0}}),ce.extend({valHooks:{option:{get:function(e){var t=ce.find.attr(e,\"value\");return null!=t?t:Tt(ce.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a=\"select-one\"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!fe(n.parentNode,\"optgroup\"))){if(t=ce(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=ce.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<ce.inArray(ce.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),ce.each([\"radio\",\"checkbox\"],function(){ce.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<ce.inArray(ce(e).val(),t)}},le.checkOn||(ce.valHooks[this].get=function(e){return null===e.getAttribute(\"value\")?\"on\":e.value})});var Et=ie.location,jt={guid:Date.now()},At=/\\?/;ce.parseXML=function(e){var t,n;if(!e||\"string\"!=typeof e)return null;try{t=(new ie.DOMParser).parseFromString(e,\"text/xml\")}catch(e){}return n=t&&t.getElementsByTagName(\"parsererror\")[0],t&&!n||ce.error(\"Invalid XML: \"+(n?ce.map(n.childNodes,function(e){return e.textContent}).join(\"\\n\"):e)),t};var Dt=/^(?:focusinfocus|focusoutblur)$/,Nt=function(e){e.stopPropagation()};ce.extend(ce.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||C],d=ue.call(e,\"type\")?e.type:e,h=ue.call(e,\"namespace\")?e.namespace.split(\".\"):[];if(o=f=a=n=n||C,3!==n.nodeType&&8!==n.nodeType&&!Dt.test(d+ce.event.triggered)&&(-1<d.indexOf(\".\")&&(d=(h=d.split(\".\")).shift(),h.sort()),u=d.indexOf(\":\")<0&&\"on\"+d,(e=e[ce.expando]?e:new ce.Event(d,\"object\"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join(\".\"),e.rnamespace=e.namespace?new RegExp(\"(^|\\\\.)\"+h.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:ce.makeArray(t,[e]),c=ce.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!y(n)){for(s=c.delegateType||d,Dt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||C)&&p.push(a.defaultView||a.parentWindow||ie)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(_.get(o,\"events\")||Object.create(null))[e.type]&&_.get(o,\"handle\"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&$(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!$(n)||u&&v(n[d])&&!y(n)&&((a=n[u])&&(n[u]=null),ce.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,Nt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,Nt),ce.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=ce.extend(new ce.Event,n,{type:e,isSimulated:!0});ce.event.trigger(r,null,t)}}),ce.fn.extend({trigger:function(e,t){return this.each(function(){ce.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return ce.event.trigger(e,t,n,!0)}});var qt=/\\[\\]$/,Lt=/\\r?\\n/g,Ht=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;function Pt(n,e,r,i){var t;if(Array.isArray(e))ce.each(e,function(e,t){r||qt.test(n)?i(n,t):Pt(n+\"[\"+(\"object\"==typeof t&&null!=t?e:\"\")+\"]\",t,r,i)});else if(r||\"object\"!==x(e))i(n,e);else for(t in e)Pt(n+\"[\"+t+\"]\",e[t],r,i)}ce.param=function(e,t){var n,r=[],i=function(e,t){var n=v(t)?t():t;r[r.length]=encodeURIComponent(e)+\"=\"+encodeURIComponent(null==n?\"\":n)};if(null==e)return\"\";if(Array.isArray(e)||e.jquery&&!ce.isPlainObject(e))ce.each(e,function(){i(this.name,this.value)});else for(n in e)Pt(n,e[n],t,i);return r.join(\"&\")},ce.fn.extend({serialize:function(){return ce.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ce.prop(this,\"elements\");return e?ce.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ce(this).is(\":disabled\")&&Ot.test(this.nodeName)&&!Ht.test(e)&&(this.checked||!we.test(e))}).map(function(e,t){var n=ce(this).val();return null==n?null:Array.isArray(n)?ce.map(n,function(e){return{name:t.name,value:e.replace(Lt,\"\\r\\n\")}}):{name:t.name,value:n.replace(Lt,\"\\r\\n\")}}).get()}});var Mt=/%20/g,Rt=/#.*$/,It=/([?&])_=[^&]*/,Wt=/^(.*?):[ \\t]*([^\\r\\n]*)$/gm,Ft=/^(?:GET|HEAD)$/,$t=/^\\/\\//,Bt={},_t={},zt=\"*/\".concat(\"*\"),Xt=C.createElement(\"a\");function Ut(o){return function(e,t){\"string\"!=typeof e&&(t=e,e=\"*\");var n,r=0,i=e.toLowerCase().match(D)||[];if(v(t))while(n=i[r++])\"+\"===n[0]?(n=n.slice(1)||\"*\",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Vt(t,i,o,a){var s={},u=t===_t;function l(e){var r;return s[e]=!0,ce.each(t[e]||[],function(e,t){var n=t(i,o,a);return\"string\"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s[\"*\"]&&l(\"*\")}function Gt(e,t){var n,r,i=ce.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&ce.extend(!0,e,r),e}Xt.href=Et.href,ce.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:\"GET\",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:\"application/x-www-form-urlencoded; charset=UTF-8\",accepts:{\"*\":zt,text:\"text/plain\",html:\"text/html\",xml:\"application/xml, text/xml\",json:\"application/json, text/javascript\"},contents:{xml:/\\bxml\\b/,html:/\\bhtml/,json:/\\bjson\\b/},responseFields:{xml:\"responseXML\",text:\"responseText\",json:\"responseJSON\"},converters:{\"* text\":String,\"text html\":!0,\"text json\":JSON.parse,\"text xml\":ce.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Gt(Gt(e,ce.ajaxSettings),t):Gt(ce.ajaxSettings,e)},ajaxPrefilter:Ut(Bt),ajaxTransport:Ut(_t),ajax:function(e,t){\"object\"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=ce.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?ce(y):ce.event,x=ce.Deferred(),b=ce.Callbacks(\"once memory\"),w=v.statusCode||{},a={},s={},u=\"canceled\",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Wt.exec(p))n[t[1].toLowerCase()+\" \"]=(n[t[1].toLowerCase()+\" \"]||[]).concat(t[2])}t=n[e.toLowerCase()+\" \"]}return null==t?null:t.join(\", \")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Et.href)+\"\").replace($t,Et.protocol+\"//\"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||\"*\").toLowerCase().match(D)||[\"\"],null==v.crossDomain){r=C.createElement(\"a\");try{r.href=v.url,r.href=r.href,v.crossDomain=Xt.protocol+\"//\"+Xt.host!=r.protocol+\"//\"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&\"string\"!=typeof v.data&&(v.data=ce.param(v.data,v.traditional)),Vt(Bt,v,t,T),h)return T;for(i in(g=ce.event&&v.global)&&0==ce.active++&&ce.event.trigger(\"ajaxStart\"),v.type=v.type.toUpperCase(),v.hasContent=!Ft.test(v.type),f=v.url.replace(Rt,\"\"),v.hasContent?v.data&&v.processData&&0===(v.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&(v.data=v.data.replace(Mt,\"+\")):(o=v.url.slice(f.length),v.data&&(v.processData||\"string\"==typeof v.data)&&(f+=(At.test(f)?\"&\":\"?\")+v.data,delete v.data),!1===v.cache&&(f=f.replace(It,\"$1\"),o=(At.test(f)?\"&\":\"?\")+\"_=\"+jt.guid+++o),v.url=f+o),v.ifModified&&(ce.lastModified[f]&&T.setRequestHeader(\"If-Modified-Since\",ce.lastModified[f]),ce.etag[f]&&T.setRequestHeader(\"If-None-Match\",ce.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader(\"Content-Type\",v.contentType),T.setRequestHeader(\"Accept\",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+(\"*\"!==v.dataTypes[0]?\", \"+zt+\"; q=0.01\":\"\"):v.accepts[\"*\"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u=\"abort\",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Vt(_t,v,t,T)){if(T.readyState=1,g&&m.trigger(\"ajaxSend\",[T,v]),h)return T;v.async&&0<v.timeout&&(d=ie.setTimeout(function(){T.abort(\"timeout\")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,\"No Transport\");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&ie.clearTimeout(d),c=void 0,p=r||\"\",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while(\"*\"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader(\"Content-Type\"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+\" \"+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<ce.inArray(\"script\",v.dataTypes)&&ce.inArray(\"json\",v.dataTypes)<0&&(v.converters[\"text script\"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if(\"*\"===o)o=u;else if(\"*\"!==u&&u!==o){if(!(a=l[u+\" \"+o]||l[\"* \"+o]))for(i in l)if((s=i.split(\" \"))[1]===o&&(a=l[u+\" \"+s[0]]||l[\"* \"+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e[\"throws\"])t=a(t);else try{t=a(t)}catch(e){return{state:\"parsererror\",error:a?e:\"No conversion from \"+u+\" to \"+o}}}return{state:\"success\",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader(\"Last-Modified\"))&&(ce.lastModified[f]=u),(u=T.getResponseHeader(\"etag\"))&&(ce.etag[f]=u)),204===e||\"HEAD\"===v.type?l=\"nocontent\":304===e?l=\"notmodified\":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l=\"error\",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+\"\",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?\"ajaxSuccess\":\"ajaxError\",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger(\"ajaxComplete\",[T,v]),--ce.active||ce.event.trigger(\"ajaxStop\")))}return T},getJSON:function(e,t,n){return ce.get(e,t,n,\"json\")},getScript:function(e,t){return ce.get(e,void 0,t,\"script\")}}),ce.each([\"get\",\"post\"],function(e,i){ce[i]=function(e,t,n,r){return v(t)&&(r=r||n,n=t,t=void 0),ce.ajax(ce.extend({url:e,type:i,dataType:r,data:t,success:n},ce.isPlainObject(e)&&e))}}),ce.ajaxPrefilter(function(e){var t;for(t in e.headers)\"content-type\"===t.toLowerCase()&&(e.contentType=e.headers[t]||\"\")}),ce._evalUrl=function(e,t,n){return ce.ajax({url:e,type:\"GET\",dataType:\"script\",cache:!0,async:!1,global:!1,converters:{\"text script\":function(){}},dataFilter:function(e){ce.globalEval(e,t,n)}})},ce.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=ce(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return v(n)?this.each(function(e){ce(this).wrapInner(n.call(this,e))}):this.each(function(){var e=ce(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=v(t);return this.each(function(e){ce(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not(\"body\").each(function(){ce(this).replaceWith(this.childNodes)}),this}}),ce.expr.pseudos.hidden=function(e){return!ce.expr.pseudos.visible(e)},ce.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},ce.ajaxSettings.xhr=function(){try{return new ie.XMLHttpRequest}catch(e){}};var Yt={0:200,1223:204},Qt=ce.ajaxSettings.xhr();le.cors=!!Qt&&\"withCredentials\"in Qt,le.ajax=Qt=!!Qt,ce.ajaxTransport(function(i){var o,a;if(le.cors||Qt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e[\"X-Requested-With\"]||(e[\"X-Requested-With\"]=\"XMLHttpRequest\"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,\"abort\"===e?r.abort():\"error\"===e?\"number\"!=typeof r.status?t(0,\"error\"):t(r.status,r.statusText):t(Yt[r.status]||r.status,r.statusText,\"text\"!==(r.responseType||\"text\")||\"string\"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o(\"error\"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&ie.setTimeout(function(){o&&a()})},o=o(\"abort\");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),ce.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),ce.ajaxSetup({accepts:{script:\"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"},contents:{script:/\\b(?:java|ecma)script\\b/},converters:{\"text script\":function(e){return ce.globalEval(e),e}}}),ce.ajaxPrefilter(\"script\",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type=\"GET\")}),ce.ajaxTransport(\"script\",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=ce(\"<script>\").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on(\"load error\",i=function(e){r.remove(),i=null,e&&t(\"error\"===e.type?404:200,e.type)}),C.head.appendChild(r[0])},abort:function(){i&&i()}}});var Jt,Kt=[],Zt=/(=)\\?(?=&|$)|\\?\\?/;ce.ajaxSetup({jsonp:\"callback\",jsonpCallback:function(){var e=Kt.pop()||ce.expando+\"_\"+jt.guid++;return this[e]=!0,e}}),ce.ajaxPrefilter(\"json jsonp\",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Zt.test(e.url)?\"url\":\"string\"==typeof e.data&&0===(e.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&Zt.test(e.data)&&\"data\");if(a||\"jsonp\"===e.dataTypes[0])return r=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Zt,\"$1\"+r):!1!==e.jsonp&&(e.url+=(At.test(e.url)?\"&\":\"?\")+e.jsonp+\"=\"+r),e.converters[\"script json\"]=function(){return o||ce.error(r+\" was not called\"),o[0]},e.dataTypes[0]=\"json\",i=ie[r],ie[r]=function(){o=arguments},n.always(function(){void 0===i?ce(ie).removeProp(r):ie[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Kt.push(r)),o&&v(i)&&i(o[0]),o=i=void 0}),\"script\"}),le.createHTMLDocument=((Jt=C.implementation.createHTMLDocument(\"\").body).innerHTML=\"<form></form><form></form>\",2===Jt.childNodes.length),ce.parseHTML=function(e,t,n){return\"string\"!=typeof e?[]:(\"boolean\"==typeof t&&(n=t,t=!1),t||(le.createHTMLDocument?((r=(t=C.implementation.createHTMLDocument(\"\")).createElement(\"base\")).href=C.location.href,t.head.appendChild(r)):t=C),o=!n&&[],(i=w.exec(e))?[t.createElement(i[1])]:(i=Ae([e],t,o),o&&o.length&&ce(o).remove(),ce.merge([],i.childNodes)));var r,i,o},ce.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(\" \");return-1<s&&(r=Tt(e.slice(s)),e=e.slice(0,s)),v(t)?(n=t,t=void 0):t&&\"object\"==typeof t&&(i=\"POST\"),0<a.length&&ce.ajax({url:e,type:i||\"GET\",dataType:\"html\",data:t}).done(function(e){o=arguments,a.html(r?ce(\"<div>\").append(ce.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},ce.expr.pseudos.animated=function(t){return ce.grep(ce.timers,function(e){return t===e.elem}).length},ce.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=ce.css(e,\"position\"),c=ce(e),f={};\"static\"===l&&(e.style.position=\"relative\"),s=c.offset(),o=ce.css(e,\"top\"),u=ce.css(e,\"left\"),(\"absolute\"===l||\"fixed\"===l)&&-1<(o+u).indexOf(\"auto\")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),v(t)&&(t=t.call(e,n,ce.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),\"using\"in t?t.using.call(e,f):c.css(f)}},ce.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){ce.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if(\"fixed\"===ce.css(r,\"position\"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&\"static\"===ce.css(e,\"position\"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=ce(e).offset()).top+=ce.css(e,\"borderTopWidth\",!0),i.left+=ce.css(e,\"borderLeftWidth\",!0))}return{top:t.top-i.top-ce.css(r,\"marginTop\",!0),left:t.left-i.left-ce.css(r,\"marginLeft\",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&\"static\"===ce.css(e,\"position\"))e=e.offsetParent;return e||J})}}),ce.each({scrollLeft:\"pageXOffset\",scrollTop:\"pageYOffset\"},function(t,i){var o=\"pageYOffset\"===i;ce.fn[t]=function(e){return M(this,function(e,t,n){var r;if(y(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),ce.each([\"top\",\"left\"],function(e,n){ce.cssHooks[n]=Ye(le.pixelPosition,function(e,t){if(t)return t=Ge(e,n),_e.test(t)?ce(e).position()[n]+\"px\":t})}),ce.each({Height:\"height\",Width:\"width\"},function(a,s){ce.each({padding:\"inner\"+a,content:s,\"\":\"outer\"+a},function(r,o){ce.fn[o]=function(e,t){var n=arguments.length&&(r||\"boolean\"!=typeof e),i=r||(!0===e||!0===t?\"margin\":\"border\");return M(this,function(e,t,n){var r;return y(e)?0===o.indexOf(\"outer\")?e[\"inner\"+a]:e.document.documentElement[\"client\"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body[\"scroll\"+a],r[\"scroll\"+a],e.body[\"offset\"+a],r[\"offset\"+a],r[\"client\"+a])):void 0===n?ce.css(e,t,i):ce.style(e,t,n,i)},s,n?e:void 0,n)}})}),ce.each([\"ajaxStart\",\"ajaxStop\",\"ajaxComplete\",\"ajaxError\",\"ajaxSuccess\",\"ajaxSend\"],function(e,t){ce.fn[t]=function(e){return this.on(t,e)}}),ce.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,\"**\"):this.off(t,e||\"**\",n)},hover:function(e,t){return this.on(\"mouseenter\",e).on(\"mouseleave\",t||e)}}),ce.each(\"blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\".split(\" \"),function(e,n){ce.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var en=/^[\\s\\uFEFF\\xA0]+|([^\\s\\uFEFF\\xA0])[\\s\\uFEFF\\xA0]+$/g;ce.proxy=function(e,t){var n,r,i;if(\"string\"==typeof t&&(n=e[t],t=e,e=n),v(e))return r=ae.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(ae.call(arguments)))}).guid=e.guid=e.guid||ce.guid++,i},ce.holdReady=function(e){e?ce.readyWait++:ce.ready(!0)},ce.isArray=Array.isArray,ce.parseJSON=JSON.parse,ce.nodeName=fe,ce.isFunction=v,ce.isWindow=y,ce.camelCase=F,ce.type=x,ce.now=Date.now,ce.isNumeric=function(e){var t=ce.type(e);return(\"number\"===t||\"string\"===t)&&!isNaN(e-parseFloat(e))},ce.trim=function(e){return null==e?\"\":(e+\"\").replace(en,\"$1\")},\"function\"==typeof define&&define.amd&&define(\"jquery\",[],function(){return ce});var tn=ie.jQuery,nn=ie.$;return ce.noConflict=function(e){return ie.$===ce&&(ie.$=nn),e&&ie.jQuery===ce&&(ie.jQuery=tn),ce},\"undefined\"==typeof e&&(ie.jQuery=ie.$=ce),ce});\n/*\n * jQuery throttle / debounce - v1.1 - 3/7/2010\n * http://benalman.com/projects/jquery-throttle-debounce-plugin/\n * \n * Copyright (c) 2010 \"Cowboy\" Ben Alman\n * Dual licensed under the MIT and GPL licenses.\n * http://benalman.com/about/license/\n */\n(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!==\"boolean\"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);\n/*!\n * imagesLoaded PACKAGED v4.1.4\n * JavaScript is all like \"You images are done yet or what?\"\n * MIT License\n */\n!function(e,t){\"function\"==typeof define&&define.amd?define(\"ev-emitter/ev-emitter\",t):\"object\"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}(\"undefined\"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return n.indexOf(t)==-1&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{},n=i[e]=i[e]||{};return n[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return n!=-1&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){i=i.slice(0),t=t||[];for(var n=this._onceEvents&&this._onceEvents[e],o=0;o<i.length;o++){var r=i[o],s=n&&n[r];s&&(this.off(e,r),delete n[r]),r.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(e,t){\"use strict\";\"function\"==typeof define&&define.amd?define([\"ev-emitter/ev-emitter\"],function(i){return t(e,i)}):\"object\"==typeof module&&module.exports?module.exports=t(e,require(\"ev-emitter\")):e.imagesLoaded=t(e,e.EvEmitter)}(\"undefined\"!=typeof window?window:this,function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function n(e){if(Array.isArray(e))return e;var t=\"object\"==typeof e&&\"number\"==typeof e.length;return t?d.call(e):[e]}function o(e,t,r){if(!(this instanceof o))return new o(e,t,r);var s=e;return\"string\"==typeof e&&(s=document.querySelectorAll(e)),s?(this.elements=n(s),this.options=i({},this.options),\"function\"==typeof t?r=t:i(this.options,t),r&&this.on(\"always\",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(this.check.bind(this))):void a.error(\"Bad element for imagesLoaded \"+(s||e))}function r(e){this.img=e}function s(e,t){this.url=e,this.element=t,this.img=new Image}var h=e.jQuery,a=e.console,d=Array.prototype.slice;o.prototype=Object.create(t.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(e){\"IMG\"==e.nodeName&&this.addImage(e),this.options.background===!0&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&u[t]){for(var i=e.querySelectorAll(\"img\"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if(\"string\"==typeof this.options.background){var r=e.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var u={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\\((['\"])?(.*?)\\1\\)/gi,n=i.exec(t.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,e),n=i.exec(t.backgroundImage)}},o.prototype.addImage=function(e){var t=new r(e);this.images.push(t)},o.prototype.addBackground=function(e,t){var i=new s(e,t);this.images.push(i)},o.prototype.check=function(){function e(e,i,n){setTimeout(function(){t.progress(e,i,n)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once(\"progress\",e),t.check()}):void this.complete()},o.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent(\"progress\",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log(\"progress: \"+i,e,t)},o.prototype.complete=function(){var e=this.hasAnyBroken?\"fail\":\"done\";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent(\"always\",[this]),this.jqDeferred){var t=this.hasAnyBroken?\"reject\":\"resolve\";this.jqDeferred[t](this)}},r.prototype=Object.create(t.prototype),r.prototype.check=function(){var e=this.getIsImageComplete();return e?void this.confirm(0!==this.img.naturalWidth,\"naturalWidth\"):(this.proxyImage=new Image,this.proxyImage.addEventListener(\"load\",this),this.proxyImage.addEventListener(\"error\",this),this.img.addEventListener(\"load\",this),this.img.addEventListener(\"error\",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent(\"progress\",[this,this.img,t])},r.prototype.handleEvent=function(e){var t=\"on\"+e.type;this[t]&&this[t](e)},r.prototype.onload=function(){this.confirm(!0,\"onload\"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,\"onerror\"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener(\"load\",this),this.proxyImage.removeEventListener(\"error\",this),this.img.removeEventListener(\"load\",this),this.img.removeEventListener(\"error\",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener(\"load\",this),this.img.addEventListener(\"error\",this),this.img.src=this.url;var e=this.getIsImageComplete();e&&(this.confirm(0!==this.img.naturalWidth,\"naturalWidth\"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener(\"load\",this),this.img.removeEventListener(\"error\",this)},s.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent(\"progress\",[this,this.element,t])},o.makeJQueryPlugin=function(t){t=t||e.jQuery,t&&(h=t,h.fn.imagesLoaded=function(e,t){var i=new o(this,e,t);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});\n/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */\nvar LZString={_keyStr:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return\"\";var t=\"\";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return\"\";var t=\"\",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\\+\\/\\=]/g,\"\");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return\"\";var t=\"\",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return\"\";var t=\"\",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return\"\";var t,n,r={},i={},s=\"\",o=\"\",u=\"\",a=2,f=3,l=2,c=\"\",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==\"\"){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return\"\";if(e==\"\")return null;var t=[],n,r=4,i=4,s=3,o=\"\",u=\"\",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return\"\"}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return\"\"}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!==\"undefined\"&&module!=null){module.exports=LZString}\n/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/dist/FileSaver.js */\n(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n/*! seedrandom.js v3.0.5 | (c) 2019 David Bau, all rights reserved. | Licensed under a BSD-style license */\n!function(f,a,c){var s,l=256,p=\"random\",d=c.pow(l,6),g=c.pow(2,52),y=2*g,h=l-1;function n(n,t,r){function e(){for(var n=u.g(6),t=d,r=0;n<g;)n=(n+r)*l,t*=l,r=u.g(1);for(;y<=n;)n/=2,t/=2,r>>>=1;return(n+r)/t}var o=[],i=j(function n(t,r){var e,o=[],i=typeof t;if(r&&\"object\"==i)for(e in t)try{o.push(n(t[e],r-1))}catch(n){}return o.length?o:\"string\"==i?t:t+\"\\0\"}((t=1==t?{entropy:!0}:t||{}).entropy?[n,S(a)]:null==n?function(){try{var n;return s&&(n=s.randomBytes)?n=n(l):(n=new Uint8Array(l),(f.crypto||f.msCrypto).getRandomValues(n)),S(n)}catch(n){var t=f.navigator,r=t&&t.plugins;return[+new Date,f,r,f.screen,S(a)]}}():n,3),o),u=new m(o);return e.int32=function(){return 0|u.g(4)},e.quick=function(){return u.g(4)/4294967296},e.double=e,j(S(u.S),a),(t.pass||r||function(n,t,r,e){return e&&(e.S&&v(e,u),n.state=function(){return v(u,{})}),r?(c[p]=n,t):n})(e,i,\"global\"in t?t.global:this==c,t.state)}function m(n){var t,r=n.length,u=this,e=0,o=u.i=u.j=0,i=u.S=[];for(r||(n=[r++]);e<l;)i[e]=e++;for(e=0;e<l;e++)i[e]=i[o=h&o+n[e%r]+(t=i[e])],i[o]=t;(u.g=function(n){for(var t,r=0,e=u.i,o=u.j,i=u.S;n--;)t=i[e=h&e+1],r=r*l+i[h&(i[e]=i[o=h&o+t])+(i[o]=t)];return u.i=e,u.j=o,r})(l)}function v(n,t){return t.i=n.i,t.j=n.j,t.S=n.S.slice(),t}function j(n,t){for(var r,e=n+\"\",o=0;o<e.length;)t[h&o]=h&(r^=19*t[h&o])+e.charCodeAt(o++);return S(t)}function S(n){return String.fromCharCode.apply(0,n)}if(j(c.random(),a),\"object\"==typeof module&&module.exports){module.exports=n;try{s=require(\"crypto\")}catch(n){}}else\"function\"==typeof define&&define.amd?define(function(){return n}):c[\"seed\"+p]=n}(\"undefined\"!=typeof self?self:this,[],Math);\n/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */\n!function(){for(var methods=[\"assert\",\"clear\",\"count\",\"debug\",\"dir\",\"dirxml\",\"error\",\"exception\",\"group\",\"groupCollapsed\",\"groupEnd\",\"info\",\"log\",\"markTimeline\",\"profile\",\"profileEnd\",\"table\",\"time\",\"timeEnd\",\"timeline\",\"timelineEnd\",\"timeStamp\",\"trace\",\"warn\"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();\n}else{document.documentElement.setAttribute(\"data-init\", \"lacking\");}\n</script>\n<style id=\"style-normalize\" type=\"text/css\">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}</style>\n<style id=\"style-init-screen\" type=\"text/css\">@keyframes init-loading-spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}#init-screen{display:none;z-index:500000;position:fixed;top:0;left:0;height:100%;width:100%;font:28px/1 Helmet,Freesans,sans-serif;font-weight:700;color:#eee;background-color:#111;text-align:center}#init-screen>div{display:none;position:relative;margin:0 auto;max-width:1136px;top:25%}html[data-init=lacking] #init-screen,html[data-init=loading] #init-screen,html[data-init=no-js] #init-screen{display:block}html[data-init=lacking] #init-lacking,html[data-init=no-js] #init-no-js{display:block;padding:0 1em}html[data-init=no-js] #init-no-js{color:red}html[data-init=loading] #init-loading{display:block;border:24px solid transparent;border-radius:50%;border-top-color:#7f7f7f;border-bottom-color:#7f7f7f;width:100px;height:100px;animation:init-loading-spin 2s linear infinite}html[data-init=loading] #init-loading>div{text-indent:9999em;overflow:hidden;white-space:nowrap}html[data-init=loading] #passages,html[data-init=loading] #ui-bar{display:none}</style>\n<style id=\"style-font\" type=\"text/css\">@font-face{font-family:tme-fa-icons;src:url('data:application/octet-stream;base64,d09GRgABAAAAADLAAA8AAAAAWHgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY+IEkIY21hcAAAAdgAAAG8AAAF3rob9jFjdnQgAAADlAAAABMAAAAgBtX/BGZwZ20AAAOoAAAFkAAAC3CKkZBZZ2FzcAAACTgAAAAIAAAACAAAABBnbHlmAAAJQAAAI6gAADv+gJOpzGhlYWQAACzoAAAAMwAAADYY1IZaaGhlYQAALRwAAAAgAAAAJAfCBClobXR4AAAtPAAAAJEAAAFMBfb/0WxvY2EAAC3QAAAAqAAAAKhjiHI5bWF4cAAALngAAAAgAAAAIAFjDA9uYW1lAAAumAAAAY0AAAL94+zEpHBvc3QAADAoAAACHAAAA11cG/YjcHJlcAAAMkQAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZNZgnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4vGF4EMgf9z2KIYg5imAYUZgTJAQDSIQumAHic7dTVbltRAETR7dpNCikzQ8rMzMxt/M39mHnsU1/TfZz5jFpaV7pXJunMDLAZmOqaZjD5y4Tx+uPTyeL5lG2L5zN+L94zG8+ztr7ulXH1fra4bvK9M79xiWW2sNXPbWeFHexkF7vZw172sZ8DHOQQhznCUY5xnBOc5BSnOcNZVjnHeS5wkUtc5gpX/f3r3OAmt7jNHe5yj/s84CGPeMwTnvKM57zgJa94zRve8o73fOAjn/jMF77yje/84Ce/WGPun1zi/2tlXKbp3Xyc44bFyZanSWokJDXOOjXSk/LUSXn+pEwCKTNBaqQqZU5IjX+XMjukTBEp80TKZJEyY6RMGylzR8oEkjKLpEwlKfNJyqSSMrOkTC8pc0zKRJMy26RMOSnzTsrkk7IDpGwDKXtByoaQsiukbA0p+0PKJpGyU6RsFyl7RmosQcrukbKFpOwjKZtJyo6Ssq2k7C0pG0zKLpOy1aTsNymbTsrOk7L9pNwBUi4CKbeBlCtByr0g5XKQckNIuSak3BVSLgwpt4aUq0PK/SHlEpFyk0i5TqTcKVIuFim3i5QrRso9I+WykXLjXOYNzP8BuAPUwHicY2BAAxIQyBz0PwuEARJsA90AeJytVml300YUHXlJnIQsJQstamHExGmwRiZswYAJQbJjIF2crZWgixQ76b7xid/gX/Nk2nPoN35a7xsvJJC053Cak6N3583VzNtlElqS2AvrkZSbL8XU1iaN7DwJ6YZNy1F8KDt7IWWKyd8FURCtltq3HYdERCJQta6wRBD7HlmaZHzoUUbLtqRXTcotPekuW+NBvVXffho6yrE7oaRmM3RoPbIlVRhVokimPVLSpmWo+itJK7y/wsxXzVDCiE4iabwZxtBI3htntMpoNbbjKIpsstwoUiSa4UEUeZTVEufkigkMygfNkPLKpxHlw/yIrNijnFawS7bT/L4vead3OT+xX29RtuRAH8iO7ODsdCVfhFtbYdy0k+0oVBF213dCbNnsVP9mj/KaRgO3KzK90IxgqXyFECs/ocz+IVktnE/5kkejWrKRE0HrZU7sSz6B1uOIKXHNGFnQ3dEJEdT9kjMM9pg+Hvzx3imWCxMCeBzLekclnAgTKWFzNEnaMHJgJWWLKqn1rpg45XVaxFvCfu3a0ZfOaONQd2I8Ww8dWzlRyfFoUqeZTJ3aSc2jKQ2ilHQmeMyvAyg/oklebWM1iZVH0zhmxoREIgIt3EtTQSw7saQpBM2jGb25G6a5di1apMkD9dyj9/TmVri501PaDvSzRn9Wp2I62AvT6WnkL/Fp2uUiRen66Rl+TOJB1gIykS02w5SDB2/9DtLL15YchdcG2O7t8yuofdZE8KQB+xvQHk/VKQlMhZhViFZAYq1rWZbJ1awWqcjUd0OaVr6s0wSKchwXx76Mcf1fMzOWmBK+34nTsyMuPXPtSwjTHHybdT2a16nFcgFxZnlOp1mW7+s0x/IDneZZntfpCEtbp6MsP9RpgeVHOh1jeUELmnTfwZCLMOQCDpAwhKUDQ1hegiEsFQxhuQhDWBZhCMslGMLyYxjCchmGsLysZdXUU0nj2plYBmxCYGKOHrnMReVqKrlUQrtoVGpDnhJulVQUz6p/ZaBePPKGObAWSJfIml8xzpWPRuX41hUtbxo7V8Cx6m8fjvY58VLWi4U/Bf/V1lQlvWLNw5Or8BuGnmwnqjapeHRNl89VPbr+X1RUWAv0G0iFWCjKsmxwZyKEjzqdhmqglUPMbMw8tOt1y5qfw/03MUIWUP34NxQaC9yDTllJWe3grNXX27LcO4NyOBMsSTE38/pW+CIjs9J+kVnKno98HnAFjEpl2GoDrRW82ScxD5neJM8EcVtRNkja2M4EiQ0c84B5850EJmHqqg3kTuGGDfgFYW7BeSdconqjLIfuRezzKKT8W6fiRPaoaIzAs9kbYa/vQspvcQwkNPmlfgxUFaGpGDUV0DRSbqgGX8bZum1Cxg70Iyp2w7Ks4sPHFveVkm0ZhHykiNWjo5/WXqJOqtx+ZhSX752+BcEgNTF/e990cZDKu1rJMkdtA1O3GpVT15pD41WH6uZR9b3j7BM5a5puuiceel/TqtvBxVwssPZtDtJSJhfU9WGFDaLLxaVQ6mU0Se+4BxgWGNDvUIqN/6v62HyeK1WF0XEk307Ut9HnYAz8D9h/R/UD0Pdj6HINLs/3mhOfbvThbJmuohfrp+g3MGutuVm6BtzQdAPiIUetjrjKDXynBnF6pLkc6SHgY90V4gHAJoDF4BPdtYzmUwCj+Yw5PsDnzGHQZA6DLeYw2GbOGsAOcxjsMofBHnMYfMGcdYAvmcMgZA6DiDkMnjAnAHjKHAZfMYfB18xh8A1z7gN8yxwGMXMYJMxhsK/p1jDMLV7QXaC2QVWgA1NPWNzD4lBTZcj+jheG/b1BzP7BIKb+qOn2kPoTLwz1Z4OY+otBTP1V050h9TdeGOrvBjH1D4OY+ky/GMtlBr+MfJcKB5RdbD7n74n3D9vFQLkAAQAB//8AD3icrXsLcFzlleZ//v+++nb37dfte/VotVrdrW5JltuKpO6WJVluPyXbsmOEbGRjO4KVjWPZlsM4QIU4IYGlgCE2yxqKIQkJg2GreKQCTCZb1CZkiswjzOwOmSTATNVWTZLdDUwSMrVDsomD23vOf69assFAqgbk+773P4//nPOdc/5mwNjFl8WjosbaWblmxiOmIlTGYXzb11M7Z2ohAMbZCcZ5iG9prZl4whfwGju05xtttitUdwXYEUgkbQtWga5lC+XBaqJI285qpb8dVEc8Gnm5L5QM/f58yAlB399a7dD0mWAmdAqaMvBmKPKX9TdDwSjod9yhx03FAPcvI6Gk2lV33XoXUtKgL8C6Wa0WSzXbVjhg6JoqIPShCK0FOvOuE48K1V4B1VUQAVevugmP7Fz2CmTzW5/8+ZGP/+Kp7h/8oI4MuOZ7M5B9IvujH2Wf+PnCAjzn8ZK6AieMKRcvXnxWWSWCzGARlPcqtqs21WZzEBFgYIVDAYWzVJIrXBlH+hXGlWNM00GAJmYZ8sKBzTJFVZVppijqDFMVdTIWLa0o5JrdaHusPZGIG1IjFhQGK2mAZEe56kJnR1bTY7ZT7eivFGODBTdma3pHtlCNDVbwmgMHx/aO4R8ffeet5/ZCG6TfuV03IaSJU3oIzKsGO9+5PV+BwU5xqnOQx1aO8fW71yvD9fPn55/fA22PmsaFvfSgwZ8wzPiFvZ2DUMnzJ2hHVDMmHucPsSRrq7UQo4DMAV/AW7CANw/Zru3NIx20bBEpXwukArlxxOPReibaG63/SyQyiftzcBy3k1HuOHgjEgFHnkYfh4VodDJC4138Ff8hv5PlWbrWmm2O6grNEgGNCWGnbFtRm1Z04gzQPPWvkqMWF4eWU8DB267Df+gNe84bBvfRpfNI5Ny5yAmHDh5/PPLuByMlekDS9DsRR73nWHetwBShSO5PqCBQONO4E2wGlSvYZG6gMzeQ09SWFZC0tWION3oOVVXGTbGM+hrAzQj0O25yoN8R8YzzRsaZdzLwhpsGPEm783hAJ9+kq286eDX5pn/VydDjvk7i8EuchU21JJ3DNOqFzeABmywPcNXxhu/wB+3whrqwVw7Cn1j8vPfdDH6O7PR3fDV/Cb85wua/waSit309grZJHHOhHEQ9CA7zTGVCUb0ZvXzc1lrRe5Af+4An0aSL9op0IU9y6vRFtAYGKy7KJGFbQrdg2dXqGAwWilld0zUy9xLqd6A/zeFuy7gzYFmBOwOhZ6NNhZakm8YTI7S1pyM1mM032V26qevXGlzZ8+TKvROlB/BBkO9ACDalB7OZuBnuC5tRcAItpalENNOfhajVH1A2a1HjbHZ4N4r54oWLz4qPoe4jrMo2sonapm5QRQBQ3XycKVxwRRxjQuVCnWc6mrzOZ5FvBiraOmia5FubYRpok8n0ioRTKOQMNbWiszxYWAFZrQ1sB+dDJTFYghzyiBN3oB857ndIAha4Se/+YGUtjAkXXUO2xPE2eoe3TWPeMOXmzNi+j9w1HghvVbSAmu4c6nFac6MgbzXFU2baDr1241+98TfHtU/9t7df+MzU4msmfPYj06Wbw8Gqohda0/FkSyiyvtPGG/FsMKq1pLqmPvndkye/+y+08eYIHEJZpFmJra2Nop/VWuKcCwPvgRhnGlOFps6iIdAEmFVAKh53jblZyBU6nAFdbfX03tGwioZ9oGnEyDSWTQCyFzhoR+s/jdjgWLmc3L2K21zEmXCsM5aDm4g9Ny5v0PZVb+dY9Rcd/sl5eTiPj0nTaeiU+BhhW2qbuzJcUy2Nc2gCrjBkxWCqZiArGgOuwSzjAlDb5L91XfpvfYbpij6ZRIUWYoVcLqC2+UqNLddsMrekY3GZztVl2uQjpl4xjedIM+Uybc/r5viShuHgcgXuwQtpuoMHz8utCe/s8S+Y/7xMaYu2DX1yDrez3lp3cyyKdop+HLcLi878Uh9SKOSlj73cOIUFRVKVKHhaSS9JP452RCcYoJ3w85bz8Ckp9VN4xeZj9atpH4FnPCV4OtiDNIVYCrWwsbauK81VxUlaQnA+riFBisoUsiU0LbQpASCmmRAwg1MNJoH19uQ6WpriUV1jIQjphA5QjosiTfiy1tF+kPJKMTFYpAu6lkx40odnTv7VjYtC/QtTJyGH9HmMnKamGrcaqmaagRsMUwR9WeLmwsQREvIRevSvYa8uVFXo9Sc0w5A8/Rp5+jcxhXLuYAOIx/pbY+ggFp0FV8lNoLNAEQvyDkwBZR9T1ZC6xR0qFgsybix3DJcR7iIGwCsCHHQM0nYKVSBXQZPnqG7KDZiqrn8K524gpN9ghAx42k4GsvF3nohnA0kbnglkC9mrl7h4Db2TommKcVE1QOPRd97K5WJxsKO5nIjHbHtx/og3kK8iWys1he/EkKlqCbFOB6iKQp5Q5Yp6DB0AsjmPvHEFSGsoFraPaVpI2zLc2lmudErjJ/eeQwbKPoRBZulcwhwXYc6i1SdiEpiCF+KrFOIrAzKaHdhQ79tw4MAGuJv4rt8sQQu80jloGnnDfNVJBa+vn1WjSg1d8NHrg44FbTgdJ5+T77yy/gDI5wY7633yTbI7+CdyMDyEL2paDd0BvZjyfIYXH2/H+aqjDfXUisgnk3rFYMePoyZBegWanQpM5hKdlUSU1JnoQH2iG1d90IYADi0JPV2/oxMEeB7apm+aBngFw/ObMjzHzv7dgzyOh48fHZnmO9c8Wv+2RAGwHiP20UNnzx46mvYxyaMixDpZX22lQqQgRDqG4kYcMo92cpypAOo0Ti+iSYXJRGc5l8wvQhPfqpE0SYa7nDwkeQyh26OOlbecqVumoCwJ8+mDm+9/5T4eOyOt+4wk8WjavYTIG+7nD5Li2cWv8zGkMYoz51q2u3Y1JQSwfcumSn9JUxW0CZIWQ5isqKCo8zoGFPybx/lyHD2w4AaCBw7Ap1HIxAaHyZlr1tXG1owMt7h5Ox5QmxF4Iv6vDhaQoTFAYADuYIlnLa7b7RwtiOBDtVK1dbyCMXXxn5azOIIKfLFKaQP9K3HKIMYEQosvhkIWH23TQ9wIpCq9M4WxycnJsQIUYrEJ/bPGuOZohfHVzdmMaAmHm418c7DU3xdoyYPebFktPJtpHu7fefjw4R0VHiNTa06ZUTPe09a1sdTUVNrYtbo3nth11VW7tBa1d/U1a1t71rdG2u1IJNkWDYdbUs0pnnFT+OloWzISsdsjqVpvy9prqrNjed41POfPx2+J7TIXaWP5Wgf5bvToBEvpppQYOXPOJoda4gTQE6TsNK8sAvUSSHBFygfnfM9wL+8aK/Bddv0tZ8SufyKZ7ml7s20iCWdsPpPu4YVaXuur/2M6WX8riReTE21vtPUAnn4iyTxdf0vJ+/QM0pwsUL4D5BmUBQEeXpaU4W6RtExzN1In7eT9qHPpIoUdqAzSrdyHIPo1JNRps1uioCWJyIm2U/JG8oO4aZMXozF8b4RupRd5JJv7Nn8ZeUyxjlrakhJHcwO2gHMUDgGLR0MmS0GrIoMRWos0K81LUnPZYgmkw6sM8HtCoQTaT9y0Wu3f/MZuCYfijhMPhUVQNdL2hY8kMroS/8UvEqqeSfC/xzPV07k3vsqyrL+2ykYnhJjEz45OLIdbu4ncrbrWhImzltU7oqqaXAEdMWiHxPsSdvuF70K6/xf6FejjL13YBvFVP+UXrkwnyelZjBcltoLypQIoEmsoiDUw4C2QFS/I/J6yx5ybWOOqaMad0kJlKo+ElAdLqvRTMqOsgucuM64j3hgHU1H1mIkQ084Oje3eXT1lZwL1nwaD0BZMNfFTcHpv+sf7v6LEo4oZMlRbFNqH9tb60nEN0UkQ0mYawZNpR878eFuD1lWsl/Jb9J5iMbPlDKnkh3raBmS66U1M9Jm5rKUmMel1dKLOcxrVSgf5dJqU4o0g0pJyTlV37x4bytpCATOG8VUT4+m9cPoURiakE34ZMes/wbB0Roun+2p7h9oLSlwzQqZq2eIr+xe2/Rhp5QF8hHn5Hh/FfM9ibs32UrNG+l22ZbrnJ8N+fERAcD6YCp6nuPc2Aq/vWXiMfzKaye/BDfzTLPwe33MT8ns4P/y0uiLBdyZw3qRvNvGZegjF6H+escXvreOnkD7zm7IkADTbJEkU4sdw1jmwzpTj42smHLB82ijenjfx9YsXkccR+B5+I1azGtQk+4maTpnLlsBL75E7O1IPea+mzfPmUwQt00FJoG+nPxN/zruZzZprTljyx2GpXiHdYWBZtcINeB+2xVP16/GT9euDwf00TbqgK5gK7QvCmfp/wPn15WDa3BcM1l/Hy8F9wZQ31nf4Q2IjjrXyG+BnzXnMmqXiTuB5CLa01gINjvb8mesSTwHuSAEtzm8anp+uvwbdprkfhUs0wCNIxH6TP1l/vf6aPDThK0TXI5I+tjj+SX/8wIcaPxWX4y+CqsCiEIiAIzhsKrgfh+6qv+4L4RETPl6/zqMKukki9AA96OseZb3Zk7UKVKxZKt65tpR1J9p1sTGgP5Z4ah+KEzl73R/xEfr+I8H5fchlN/Jr0n0c3fSGkrz+vbhd5m2ZWltThDeKUaKh3WTZXWauS+WomBdMkjGvOCRuT9YfcIZxk0x24/5cT3q8redxe8TpTsLn03b9LIaFo/I0eQ7uxtjQm6rffI4elnTcJfbwX/qRFyG+Vw+SaJdyFIpugk0WXCcnaZFo1323viNAWHZPvk1+ugfjTf2sbcPR5LDT442bhwPj6Z5z9qi9wr8B85Ji51yXb3tISxlpSUtaZEYnFX8ZbHI6C8vk4ll2h5/YdRQbM0CUbSmXHsd5rH5zWz7fBnc/5iA1NLANwyQZ2+5JjiYfQ4mle+BxJA1prT9g+770dv4zTz9RnTPp+JlY4DJKoroOucmyT4fnsGIeFC3H9EtmB+qnGyP6413tPvs4BhIwipskDKakeIg+KKTgbl92JBkkHn1J3c8t+9ia2vBKhMFkGBJtEjrGDIzKE1SeAgTJiDAVRYpKmSGwMlksJor5gUWgjKlXYS0gurS4neaYflXJnaWBUjDKNAVhkWoF1WhHz7uJ2PapE8NHJkulySPD62/qVmLapMq10a997JqvnphQarc8dO3UQ2smYr38pfOWszK6fTs+eBKfHy4j8t2uWNrWnbDx5CNfe+TkxrHVE/EEW4ynxM9H2FhtpAeE2tnGFUH1J4xXChxD5hACLNXbLgOA3WU353rI37Y44SipbwdxwED/mEC0rOmuIzmlGkw7SBzNxZ6NN3519+zXRhV1Uosp3TdtGD68s4eXJo8uzHVtjyXc85gC9MYmRh+euuaRk+vhAG43Tm3RLGW7Clp52Oesq3N7dKVjnW9KxCdWjyFvi/nUs+Ja5CnPxtn+2t4NnVwLrELw76JqDMz1MacMGJoR0I5RVsA1lR/DLEdonLJLQWnOMcSamKlrszLnWWZ3mzcVOjsrnYWynTfVNmQ6aQFxrWtL9SQtgjqsojbxf5lp+qquSF1rVGyk02qZZEEKRkPdlv9ff3LVQ6MTFMas8xSft3fNVbd+vqg1KaF5w7RwBsirUye24UVXDS3oIcj/nz+56mF6qQlUAQ++gGoNytcxFG7P98DWMXMoHIL/6l/Z7p1riv8ko2oiyiru129WsSrmUjO1XdtWc0Pr7miOoWOV9YUQ07WQPmsCisWYDge5puAUAI3NIk6EQACmaQ+BGRaAwOSemV1TH90+vnlDrZBNFOi/nEUlLL96lYx5VZLqB5zDQLFQzGm6KuUX89L6YqxRuaPsCwXYTlJE1EVJt9ycWTo8bereoW7Wv38ewfOzmgI/N42Kn53LatjTxUCv85zbEyg+Y5hTcDddq99M2ysc8/51lABfjZ++8KvSxvUlnpCj7U+mIG3vR8yhXSbXEbaB3cDmatdds4lrhi9Z8hskNo2hkI+RQHWN6fMIUwKGFZiNhDmCNq6BoR1gejCoTzNdD86woB6cPDh33YFr91w99dHJLePr1tp525NylKZkzJtthLplN+ADzhOxjpiN1trRPwb/vhKfqIcMg8Mr3DDqd38o4cM36y9KWa+Tsn7v4/ocj134Vcg2TZsf/ABFKH4tYwrtObZYYxoF3QiQC+PjATwUho5+W8MkQlOOqUDxnlMNjZpsfB8zjJCxZe2afKeTjXeuboqT2XcOlsACB6XROFhWch7AeNy/VsZfx4fO5Aj8EjTVRPjLdtrmTS1NX7Azce6kmjZnnHf+1iuBiG0duzsmQTiZPzfjEoTGAqZ7xqt/nmmai8gXOWb0/sG9z8vyyPNOZjKDf9DlRgmQR93keVlHOU/9RTkfH8W8ieTQzWpsc21DGRM0Xw4soAUWDEDPtMB0oS9I5qeXC0PhMySPyTWjuYFctn9JEgWLp6FSXdz71TeSgzuQBmnXVHPXGqWhIhXkF+H2lQXxVqiSO5OthN9CQQSazmBOhdycwSgoZRJvQ28Yz8SVltDiwd3PUxMLN9De1dWehinH5783RvA9xhpyoHgnWAfGvE3sqtqOFT25rGIoMB4GBa0NAaepg2KYyiwVijQqFKGtopEeUFFYgQCboj0jZ8cCk7U1Q2W3MBBLjMRi0SCKxO0od6gD6Muon6Q35JGLDZS9DEpfLNZTA4aqrmrD0rwHCAO8Cs/Ur4a3J0Lql9WU4RfBJiYySfg+cviqaczLvipt59LuhbjXflPdSuRLUUd/9VV422jRv6SF/NbehYrcQ1p2AZ6jd80L5+kSRwE3WV+OVGTs9GvnU6yLDbJsrZ2aE+iijskqPtuHgTAktgz0r+xtaUaslZRRH6FKlRJrBwO9bK+lef8YXipg7j8GSJjM+GRPmSApRv6n//T4VrH3qqbRaNxoqoxSNMfwD6MV18yPulftrX+xZ7gXeka7vMCPgf2aQ8+N4bPuaKz7lg2LIGjjTT3x4T4jvubPYKL+cFtPTxscwm0DA+yVNaMjbFNt/cE9k+sUpoxgas8Gu1qjhG7GqUu+oAFel8B2gTDcgt+54If2XXv1VVsmVvRkM4m4TnnrYCGLtt5foc4F2rWO/NrIbxENvBHUy0WJBYqEg8hbyklAxoATvupfHMCZ3wAHaASEAFz/Y7pUPh+ZumWK7z65G1KGftgMJro0NbIzrOvbm1sCuhL9tBGKtrof1aLaZkdRjS4zYhzSDTDVw4bldnrPGtubWgKGiH0adR1JuR9VI/qErSgB72HMk0emp2+anr6F7kfTydZ+zdKSO0EdDRuTqaip3xAIjapaLa1aWqg/kmqNQEiXzza3ZFbqId3euezR4Iiqbkj5j7ZEIeTX7X4n9vLvLmKL2mAXILVUp0WPoyLCVJVGQ+/yNlGhjP8PNLq4y9vNy9rPrn+eW36OaPmdX0nTF7EIpu9XPlvW1XMgOiHbSHIL1ji1nsbpBdbAyXtlTRwjSHuCqyJvkjfAVEiMe317oeLEURlNKa/CI7tfVLxLp5qb4tFwUFVYJ3R6/STHqy1Xi1R9RLvvd6lSPIba14rZoo6zwa3w/7L18OGzRwC+N7B52+HD2zYPfA8OP3iIH9kyjkd4Fdwj9x85skUPzfXhQd9cSN96mB+97yjgoYUXvZ7kxYu/UW7mL7Eo+rwKK9byTKWsSWWz6N8VBaZxB5ShgDJZHerscm0J6L1at2fNGPH4CqQNZ+gAGTeaPZVNBB52IJ7nt/uI3N/B0707Do+8vmEH37rpdTLX8eEDd47Xr564Y3aIj+67azM8Q4dwYHjpHbJoOu1/8OkH++lk4s59Y2Lo+tsevG1ukA/N3uHb9f9TbkFebNRET61I/GEuOEtdCkxKcdfISpPptmSn01kdVNF4Y4NjHF1rWnh0cxWZKImsJdKcKPPIkZR5RIoYkcJ7dh665dDOHqV/4jgc2ILXkYz77zgwypGsH1zKst/L+ir6nJVsPdtR2zaC4aQTZC9CR4p0jigDQ6gmexJcUeeXdbS0xY7WslzDdpPF8uryAPX0L+tqoVNFD5QrFi7rbKGXwYnkJGCpwra4XMZe1th6JZcOCL0VgV445HepqL+l5jVdKMHP1VeH89a/WtYaK2/9Z/g4noyFYduzjf6WpSS0FIKDRovrC4aaQ9ZArQ9b1r/K58P0Yhi/4Msl4WPhFbUuzCTBb1OitsjmCVsAn+Qs3eokTJ1FeEQlI1nGXNlfnbS8tcc/sYz4wU8vsbd+lr/UII5u7mncOYBJ+WKc+5jsETe/L03AXCfmN4IlTVnCOYiVSxyWr5h45up7d/Lpu568c7ey4zRcu6yjzk9P3Xvu3im5qb9yaf98ab2AwZIsy0Zrq6nXxkG22zi121ScGiC71IoiZwcZqlAmzUCmvaU5GgkkzaQfoNCjlKimWnxvGhtR5b4r0roYFX59BZLFsvVB5NMRIVAGQ65bJoBsRuaFbLJM/0n3nZCLlZaWYKj+efWy88WezKv+yiG5dKnN23mX2uUJbi5bY+Rc4XgxBrHXGnlYb637gwLPEuXVBmD1ViiIyzgRfl5f9NddvfoB9NDxw0clWD9KV0FbdhMMjzfc+H7uJXEG8fo6Ns4O1q5fU+KCCq16PhXG3JuJcczFw6GwEaLSBXkQwNwF4DgLs1AgHDqA2FToAXEgCDpj+jTudDaDgUmnGsaG9bWx1UOVctJGzBlDf2HJWgZyh1HHkeV53RK5WC6Gc8fr45AzKSByxwlWHShTsxydSgfVLhALUZsXOiS8w0TlVOdJ006bC4ZayA43j7cN9WCqeCgYDTvGJzKnKG0Jn7ou6KSC18Frs8FUk2Jch1frv65/kWLdMMbf2fWfDKac4HFdaYpb8HY9ZDXZhnEylEgHP7t2L6YMcO46M22b111HA113zoFBDJQUpy/WLx6B36K+MxQdmlHBKerm0BIJKqUu68GgoLY0VSpexdChJiDC1WpC9qwK1cQYpS7U0BW0JAzeMrX6P+hRI2Dy4z/hqqmb4gS3jG8GLT77P1Ue5E4wfOFTFoioAS8NYVYZhv9umJapaPV6hct6wHdkHiowcqVYnvUivt5Qa+3vK/X2dBXy2Uy6pclBE4pR4XkwxWHTtq93vH+tv0l2U6pFvbNRePWrv51uBFbBWmgHbw/upXv+0LnRc1AxL/RjLrVgmvx/yP0Fq1KJxarV2A+PHct2HDvWwbvxJIYX60/THfzHrcdGH7shQm/iC2l6E/fXRumtaPU/ybeyx+p34UkVL0LJv9PAUHOomzL1w8q9uZaYoV3SIOoujHBKKii60eKMxhJHXUMgTQW0InVqqErq22AbYN6BHOMkFCMtlpWLDDc/0NM23tYLZ1uGMX5ZrWfPtkQj+chQ61lZiH+gZSiai0Sbz4JhDbeswXd2PSVr8E/twqtr8KXdu690Q2KpI6jHMMuhBjdRdbG9iQslEae6YVhDV7gBdOiHgK4iKtSERkv4yOpAP8ZMpimmNqtSRuUFG50FDD2AeaYRNrasGS0P2LTwuGDncpRJNtZ5Fpev85SVhMY6T3ewBJrtjAFIs8XZi95eSXOXLJkW75wKaXmE7afkst1TsjBDJxP3v3I//kG6Z9R+ce7WnfcfrvHRo6fPnT46CpteTMJZ7yXKMb2XTlHieMpspgUYLz+k3UsJV/LFTWNH7vvT08eHlfWHHtx+69yLSbZMRhHWhDn2SG0oYCC3qE/B0qAKuZqPg+b5XkErlwWmYkKlMkNY2eLmUAqF3OJinmKjrPIhuK1/W/IJ6z8kh5K1D2aK+/UTWqOzkz1fC4xVOgKKKqgjZqKV9nhTGGOgUGnZjiK4Mq8jJFKOMwJ0UxSLdlO/Ymvrtq8H3/UG+nBNcG0e7Vh79xt/yOf37KklDMPYaeyc3LZ1y8hwT671KoP8BApooL9agOqYUm2FATeRptTcdeQGxexmC3pWyw2u5ZSr4l9xsLCKW+DaaeqxVskXZql+XdTggY9NDrcHk331MoTzqZSj3fGlCe3GxJQT6IsGjeBkQOGQO53v+VKSb9E1EVMQ5vKs2/R7axiimWAmiVCh4/MZ1eYrecvvMWx9oa71KppmNkVhBs6G6m+veHkw8amOFi0QFY4pTI7RrikRxSd1jgBaCeytDEHmYSsUN/HTEEyqQVQ6ppY4937ER/nPmMXaWK6W8TvQy1cj+s28wcIlS70LHqQsSoS5rB18abP70ubwv0VMqrRhJALnb2SJXZ76vg7pAPc9++oF2+s8XzLyZUMt/3ajhy35encPGy4n+lIy4Xvvou1JERMJFmTa8zqHldSwlaBa9k6VC63heDzM/3cYttfndDMiKlbIwCN7eV2F8FS61toUNZhCzHltUoKChwg/yah6WVnr8jIXJer+ultoizj14CWn/GfvvEU5uIjTdtnx8nw86K1TlzWF5QsXBhYXGlw+3rLk/5IB/G8+gzZuYUagPa8ByoUaWfiRIuA35I4CrJOMVariLtOCaKD+Ryq3gvWTwSDci1AAfVtQi7zzsmWE4F5Vq/+RPKDe8714vX5SVSVGuXjxa2K/iCyN42qyOkbLkXwt6FIjmt5sRsHC11VB2yANZQl1HL+GWjFC9Em4Vx7Q2oKTeB2+oKkeL3xEkBU015zWlri4VEBrpICIlwZ7Eso2mgSVKs8GLeJN5YsLnmn7Lh7/45KS6ncSg5I/Por8NcaWi7UW27Te2JeyTGPqPg3VS9j2CzJyeznjn1qaGXCrpsq8ro655n7+1zi3WwkBRkGuRl5e3eMyi6L0TvDJcnYwTnM14fWG5Xyh5nXVLya56BmNJRUi25oYoiGRJBGXdaO+Rb1Y9R861mlZYzodsf21K8/wZ1mC8I75Hr9viTsF+fsW5BzxTSO1IFQNz6DJvnC/lPv9L6Ab4KcvfJU6gC94y9NfMP31s7i5XY5RIn6LJqKRxjAKDuOVppiQA65ycUhaEvVeQya8dVuF6uCYKClVFADVGd5FyGt9RTWAAgg50ahiNFm2YkcCarHv3QTW/6Jna0TY0VA0FEpnMkbciKJ0RGSrrMN/XzzKfy7p3saOsq21cUl7FVQ2Dboqxg8D38S4hnxooL2bGRU1qurqAtP1Q1M7xzd3Sd4MKlx9aN7cxtWq/1OQAi25ohrK0s0ilVHwbgmKVNGWD1T/IMmcmd2u68h5MhPsLpW6Mf7ZEUPfceC+0zfhdXy9uTm5cQffujnZrMQFzmZdv+n0HyDOnl33Z4RjOcFoIL338N50IIpBxBEd9+2+7fV+vGGHQ5Y18NCTDw1EwkITYRu/JwZe9fPMI+IfxFUsyjbSqvKhAcwt168pdedsTBbTzZxTnRzRxQyV/if8uggP8y2VcpqWw7iyTmgJOy3GuEu5oK35P5xC0L6GZFag308hopD9/6r3KyoE7rKG5Tqi3D9z8s6TM/3+7mEeeCxiPDanxdWDjxmRxwKIeebmVFVePajGtTl5VaWLcGDdLdMVpbTvxD0n9pWUyvQtew1RfioQFOU/1vU/Lotg4KmyMEz9nnuM2OINTVu8ETPuuUeXPuNZUcFYEmd9rFRbYSxfVUjLiN9dFerqyvd2yKWFBEEB548Fup3m1PWnBQHUERnjyKYur0O1v1pBfvl30u2Hnj4EwydOw/CBOyd23vd4+YefpuUbvHb84elmO9HXD1P3Tq1f48YM5VZ17msH5/d1fPtmWQndeOwTd1EnZNeXbtwsoBRbcbJ29T3T0GbGDO+3J95aen6KxViWDVCHL8i5wsPAxPLfE1FDb55RmQnmCYgrEoijOyX+6KeDoE66Tt5ONjkSgheKBA9LqL6qpqchU0E7QaSYtJ3+irSVimrrmpLJU3ej0gsK6vTRXbdlEXtnb9u17Z9B+Un9m9Hg5rmoE93YF4zCPwZ31H9b/6f6b3cEgzvAgAIYO4IwfMe64Q03nOX3fXzD8Lo7brzrLtiCz85tCkajwb6N0b9LJD738MOfSxTs2x7mj3yGsEgjzzBYB9Xw2hGCYAZOzYWG2uR6nFlvxlJeEZfO732ziNsX84be4ffMGz7/gRmQb1dyTX8Q/dtArU8Hb8Wybmgod53NBlQOilxbg9mPCIstK3sTAzE7O5BMJuTKkvJgwfulBskXM0CBMymXLQrpkSoDMVmJ6aA2QjGG4SJkRk38g5sd61dtYGoQ4St+jHY+U23r4aVWOEjtseoMnDgvfwCEm2+hp6r/X91AK4zYkU3HMVEaxnR3qBfqPzn+/wHPnsOreJxjYGRgYABi1vIsoXh+m68M3MwvgCIMt5YoxkDp2P9f/2exVDAHAbkcDEwgUQAz1Qu/AHicY2BkYGAO+p/FwMBS9v/r/68sFQxAERQQDACh8QbyeJxdT0sVwzAMy49AkAxAkbT3UQiAITGAISmAYQiA9th4ttUs7Q568UeSlVidiwSkB3PUPg+ESd6ZD/+8v7HyrtzwghY89ZB6BcyrYqc6RZhw48YhaA1Wc/v1PQtdeXJ/HppUmFM597nvBVK7D+Z+E8/uQZLBgDyaz3Llvxx02S3c/Hv813JrznryZP4F+6lSfQAAAAAAAAAAUAC2ATABaAGyAfoCJAKwAzYDmgQSBFwExgUyBbQF/AZOBvwHRAe2B/YISgigCPIJGglCCWQJignACgAKQAp2CroLAAtGC4oL8gxcDPINng5iDuYPag/6EF4RIBGGEeQSShKYEyQTbhOyFAoUYhS+FVoVphYoFooXHBeGGFoYnhjGGOwZChlOGXgZrBneGhwaWhqgGtIbLhvyHHQc2B1QHZ4d/wABAAAAUwBtAAYAAAAAAAIAIAAwAHMAAAB2C3AAAAAAeJx1kN9q2zAUh39q0441YxcbjN3tXJWWEcc1lEGvWkLbXZeSu8JUV/6T2VKQlY48w95ifYa9zt6jd/vFESUUYiP5O5/O8ZEE4AP+QWH9nHKsWeEdozXv4A0uIu/Sf488IN9G3sMQPyLv0/+MfICv+BV5iI/4wz+owVtGM/yNrPBZfYm8g/fqW+Rd+svIA/Jd5D18UovI+/S/Ix9gqp4iD3GoniduvvR1WQU5mhxLlmap3C/FUdVWN6IXoXK+k3MpnA2maVySuza0ZlToUZ07292YctFov6k2eWp8VzsrJ0m6qa+NNV4H87Dq1j2WWQiFFN61chX7yNy7mclDUoUwPxuPN/tjAoc5lvCoUaJCgOCI9pjfDGk/BPfMEGaus2pYaDQ0GgtWVP1Kx/ico2BkaQ0zGnKCnHNL09KNuK451721rLqhLfmfht5vzdrmp7Sr3nUfC07YL92afU1r+wrd7/Dh5WwdHrmLjDawanUK3+9acPXqPML7Wq3NaHL6pL+1QHuGMd8t5/8PvPGO3QAAAHicbZLnlpswEIV9DRiwvZtseu89Ib333vvmBWRZYMVC0pHEEufpg8BO/kTncOfTaLgMOtPr97o17P1/baKPACEiDBAjQYohRhhjDevYhu3YwA7sxC7sxh7sxT7sxwEcxCEcxhEcxTEcxwmcxCmcxhmcxTmcxwVcxCVkuIwruIpruI4buIlbuI07uIt7uI8HeIhHeIwneIpneI4XeIlXeI03eIt3eI8P+IhP+Iwv+Ipv+I5N/OiF1hEz9JKxUrtFrDl1lWF9NR9QIikToRaVjUouKxvOmNBjLxnlhgo2DbnM1djLKrNGnGPScSUzItzGv93yPP2bSQSX84z9cqFQdJ56yZRmMhW8mLlJJSaBI0XYPDaZKDUviZmvr6DrNjJMi0WcK1MTM02mqpbZlJtEsNx5SI238jSodJtoS7qv+BpPw67IY9xU+dg5TXjROTWwdGrIOzWhT+uA0jolxqjaZrSOnCF2Nmq16651EYpMm1fakAul9SJQeR5QVYQlk1VkZ8SwoVNFIVjWnKQrlBGdMToftdoZjrs77DajqXKrS02YEFxbbtdWkG0x44JJVUS5aBqKSlJwmhDrmOF2Hv9Wqsy4TNqoKhfmSrrQKuNSL5nvPG6p0s0AkEWkSWVZMy1Kx3ljk03qLuZ14lTmB8gNGmByGrGfjLrhlhJV2f7SaIneNF1ypQNbybBUSgZswQaWEUNngeay1/sD4l/60HicY/DewXAiKGIjI2Nf5AbGnRwMHAzJBRsZWJ02MTAyaIEYm7mYGDkgLD4GMIvNaRfTAaA0J5DN7rSLwQHCZmZw2ajC2BEYscGhI2Ijc4rLRjUQbxdHAwMji0NHckgESEkkEGzmYWLk0drB+L91A0vvRiYGFwAMdiP0AAA=') format('woff')}</style>\n<style id=\"style-core\" type=\"text/css\">html{font:16px/1 Helmet,Freesans,sans-serif}#store-area,tw-storydata{display:none!important;z-index:0}.no-transition{transition:none!important}:fullscreen{height:100%;width:100%}body::-ms-backdrop{background:0 0}:focus{outline:thin dotted}:disabled{cursor:not-allowed!important}body{color:#eee;background-color:#111;overflow:auto}a{cursor:pointer;color:#68d;text-decoration:none;transition-duration:.2s}a:hover{color:#8af;text-decoration:underline}a.link-broken{color:#c22}a.link-broken:hover{color:#e44}a[disabled],span.link-disabled{color:#aaa;cursor:not-allowed!important;text-decoration:none}area{cursor:pointer}button{cursor:pointer;color:#eee;background-color:#35a;border:1px solid #57c;line-height:normal;padding:.4em;transition-duration:.2s;user-select:none}button:hover{background-color:#57c;border-color:#79e}button:disabled{background-color:#444;border:1px solid #666}input,select,textarea{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}select{padding:.34em .4em}input[type=text]{min-width:18em}textarea{min-width:30em;resize:vertical}input[type=checkbox],input[type=file],input[type=radio],select{cursor:pointer}input[type=range]{-webkit-appearance:none;min-height:1.2em}input[type=range]:focus{outline:0}input[type=range]::-webkit-slider-runnable-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;margin-top:-5px;width:33px}input[type=range]:focus::-webkit-slider-runnable-track{background:#222}input[type=range]::-moz-range-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-moz-range-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;width:33px}input[type=range]::-ms-track{background:0 0;border-color:transparent;color:transparent;cursor:pointer;height:10px;width:calc(100% - 1px)}input[type=range]::-ms-fill-lower{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-fill-upper{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:16px;width:33px}input:not(:disabled):focus,input:not(:disabled):hover,select:not(:disabled):focus,select:not(:disabled):hover,textarea:not(:disabled):focus,textarea:not(:disabled):hover{background-color:#333;border-color:#eee}hr{display:block;height:1px;border:none;border-top:1px solid #eee;margin:1em 0;padding:0}audio,canvas,progress,video{max-width:100%;vertical-align:middle}.error-view{background-color:#511;border-left:.5em solid #c22;display:inline-block;margin:.1em;max-width:100%;padding:0 .25em;position:relative}.error-view>.error-toggle{background-color:transparent;border:none;line-height:inherit;left:0;padding:0;position:absolute;top:0;width:1.75em}.error-view>.error{display:inline-block;margin-left:.25em}.error-view>.error-toggle+.error{margin-left:1.5em}.error-view>.error-source[hidden]{display:none}.error-view>.error-source:not([hidden]){background-color:rgba(0,0,0,.2);display:block;margin:0 0 .25em;overflow-x:auto;padding:.25em}.highlight,.marked{color:#ff0;font-weight:700;font-style:italic}.nobr{white-space:nowrap}.error-view>.error-toggle:before,.error-view>.error:before,[data-icon-after]:after,[data-icon-before]:before,[data-icon]:before,a.link-external:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-icon]:before{content:attr(data-icon)}[data-icon-before]:before{content:attr(data-icon-before) \"\\00a0\\00a0\"}[data-icon-after]:after{content:\"\\00a0\\00a0\" attr(data-icon-after)}.error-view>.error-toggle:before{content:\"\\e81a\"}.error-view>.error-toggle.enabled:before{content:\"\\e818\"}.error-view>.error:before{content:\"\\e80d\\00a0\\00a0\"}a.link-external:after{content:\"\\00a0\\e80e\"}</style>\n<style id=\"style-core-display\" type=\"text/css\">#story{z-index:10;margin:2.5em}@media screen and (max-width:1136px){#story{margin-right:1.5em}}#passages{max-width:54em;margin:0 auto}</style>\n<style id=\"style-core-passage\" type=\"text/css\">.passage{line-height:1.75;text-align:left;transition:opacity .4s ease-in}.passage-in{opacity:0}.passage ol,.passage ul{margin-left:.5em;padding-left:1.5em}.passage table{margin:1em 0;border-collapse:collapse;font-size:100%}.passage caption,.passage td,.passage th,.passage tr{padding:3px}@media (prefers-reduced-motion:reduce){.passage{transition:opacity 0s}}</style>\n<style id=\"style-core-macro\" type=\"text/css\">@keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}.macro-append-insert,.macro-linkappend-insert,.macro-linkprepend-insert,.macro-linkreplace-insert,.macro-prepend-insert,.macro-repeat-insert,.macro-replace-insert,.macro-timed-insert{transition:opacity .4s ease-in}.macro-append-in,.macro-linkappend-in,.macro-linkprepend-in,.macro-linkreplace-in,.macro-prepend-in,.macro-repeat-in,.macro-replace-in,.macro-timed-in{opacity:0}.macro-type-cursor:after{animation:cursor-blink 1s infinite;content:\"\\2590\";opacity:1}</style>\n<style id=\"style-ui-dialog\" type=\"text/css\">html[data-dialog] body{overflow:hidden}#ui-overlay.open{visibility:visible;transition:opacity .2s ease-in}#ui-overlay:not(.open){transition:visibility .2s step-end,opacity .2s ease-in}#ui-overlay{visibility:hidden;opacity:0;z-index:100000;position:fixed;top:-50%;left:-50%;height:200%;width:200%}#ui-dialog.open{display:block;transition:opacity .2s ease-in}#ui-dialog{display:none;opacity:0;z-index:100100;position:fixed;top:50px;margin:0;padding:0}#ui-dialog>*{box-sizing:border-box}#ui-dialog-titlebar{position:relative}#ui-dialog-close{display:block;position:absolute;right:0;top:0;white-space:nowrap}#ui-dialog-body{overflow:auto;min-width:280px;height:92%;height:calc(100% - 2.1em)}@media (prefers-reduced-motion:reduce){#ui-overlay.open{transition:opacity 0s}#ui-overlay:not(.open){transition:opacity 0s}#ui-dialog.open{transition:opacity 0s}}#ui-overlay{background-color:#000}#ui-overlay.open{opacity:.8}#ui-dialog{max-width:66em}#ui-dialog.open{opacity:1}#ui-dialog-titlebar{background-color:#444;min-height:24px}#ui-dialog-title{margin:0;padding:.2em 3.5em .2em .5em;font-size:1.5em;text-align:center;text-transform:uppercase}#ui-dialog-close{cursor:pointer;font-size:120%;margin:0;padding:0;width:3.6em;height:92%;background-color:transparent;border:1px solid transparent;transition-duration:.2s}#ui-dialog-close:hover{background-color:#b44;border-color:#d66}#ui-dialog-body{background-color:#111;border:1px solid #444;text-align:left;line-height:1.5;padding:1em}#ui-dialog-body>:first-child{margin-top:0}#ui-dialog-body hr{background-color:#444}#ui-dialog-body ul.buttons{margin:0;padding:0;list-style:none}#ui-dialog-body ul.buttons li{display:inline-block;margin:0;padding:.4em .4em 0 0}#ui-dialog-body ul.buttons>li+li>button{margin-left:1em}#ui-dialog-close{user-select:none}#ui-dialog-close{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}</style>\n<style id=\"style-ui\" type=\"text/css\">#ui-dialog-body.settings [id|=setting-body]>div:first-child{display:table;width:100%}#ui-dialog-body.settings [id|=setting-label]{display:table-cell;padding:.4em 2em .4em 0}#ui-dialog-body.settings [id|=setting-label]+div{display:table-cell;min-width:8em;text-align:right;vertical-align:middle;white-space:nowrap}#ui-dialog-body.list{padding:0}#ui-dialog-body.list ul{margin:0;padding:0;list-style:none;border:1px solid transparent}#ui-dialog-body.list li{margin:0}#ui-dialog-body.list li:not(:first-child){border-top:1px solid #444}#ui-dialog-body.list li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-decoration:none}#ui-dialog-body.list li a:hover{background-color:#333;border-color:#eee}#ui-dialog-body.saves{padding:0 0 1px}#ui-dialog-body.saves>:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves table{border-spacing:0;width:100%}#ui-dialog-body.saves tr:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves td{padding:.33em .33em}#ui-dialog-body.saves td:first-child{min-width:1.5em;text-align:center}#ui-dialog-body.saves td:nth-child(3){line-height:1.2}#ui-dialog-body.saves td:last-child{text-align:right}#ui-dialog-body.saves .empty{color:#999;speak:none;text-align:center;user-select:none}#ui-dialog-body.saves .datestamp{font-size:75%;margin-left:1em}#ui-dialog-body.saves ul.buttons li{padding:.4em}#ui-dialog-body.saves ul.buttons>li+li>button{margin-left:.2em}#ui-dialog-body.saves ul.buttons li:last-child{float:right}#ui-dialog-body.settings div[id|=header-body]{margin:1em 0}#ui-dialog-body.settings div[id|=header-body]:first-child{margin-top:0}#ui-dialog-body.settings div[id|=header-body]:not(:first-child){border-top:1px solid #444;padding-top:1em}#ui-dialog-body.settings div[id|=header-body]>*{margin:0}#ui-dialog-body.settings h2[id|=header-heading]{font-size:1.375em}#ui-dialog-body.settings p[id|=header-desc],#ui-dialog-body.settings p[id|=setting-desc]{font-size:87.5%;margin:0 0 0 .5em}#ui-dialog-body.settings div[id|=setting-body]+div[id|=setting-body]{margin:1em 0}#ui-dialog-body.settings [id|=setting-control]{white-space:nowrap}#ui-dialog-body.settings button[id|=setting-control]{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}#ui-dialog-body.settings button[id|=setting-control]:hover{background-color:#333;border-color:#eee}#ui-dialog-body.settings button[id|=setting-control].enabled{background-color:#282;border-color:#4a4}#ui-dialog-body.settings button[id|=setting-control].enabled:hover{background-color:#4a4;border-color:#6c6}#ui-dialog-body.settings input[type=range][id|=setting-control]{max-width:35vw}#ui-dialog-body.list a,#ui-dialog-body.settings span[id|=setting-input]{user-select:none}#ui-dialog-body.saves button[id=saves-clear]:before,#ui-dialog-body.saves button[id=saves-export]:before,#ui-dialog-body.saves button[id=saves-import]:before,#ui-dialog-body.settings button[id|=setting-control].enabled:after,#ui-dialog-body.settings button[id|=setting-control]:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-dialog-body.saves button[id=saves-export]:before{content:\"\\e829\\00a0\"}#ui-dialog-body.saves button[id=saves-import]:before{content:\"\\e82a\\00a0\"}#ui-dialog-body.saves button[id=saves-clear]:before{content:\"\\e827\\00a0\"}#ui-dialog-body.settings button[id|=setting-control]:after{content:\"\\00a0\\00a0\\e830\"}#ui-dialog-body.settings button[id|=setting-control].enabled:after{content:\"\\00a0\\00a0\\e831\"}</style>\n<style id=\"style-ui-bar\" type=\"text/css\">#story{margin-left:20em;transition:margin-left .2s ease-in}#ui-bar.stowed~#story{margin-left:4.5em}@media screen and (max-width:1136px){#story{margin-left:19em}#ui-bar.stowed~#story{margin-left:3.5em}}@media screen and (max-width:768px){#story{margin-left:3.5em}}#ui-bar{position:fixed;z-index:50;top:0;left:0;width:17.5em;height:100%;margin:0;padding:0;transition:left .2s ease-in}#ui-bar.stowed{left:-15.5em}#ui-bar-tray{position:absolute;top:.2em;left:0;right:0}#ui-bar-body{height:90%;height:calc(100% - 2.5em);margin:2.5em 0;padding:0 1.5em}#ui-bar.stowed #ui-bar-body,#ui-bar.stowed #ui-bar-history{visibility:hidden;transition:visibility .2s step-end}@media (prefers-reduced-motion:reduce){#story{transition:margin-left 0s}#ui-bar{transition:left 0s}}#ui-bar{background-color:#222;border-right:1px solid #444;text-align:center}#ui-bar a{text-decoration:none}#ui-bar hr{border-color:#444}#ui-bar-history [id|=history],#ui-bar-toggle{font-size:1.2em;line-height:inherit;color:#eee;background-color:transparent;border:1px solid #444}#ui-bar-toggle{display:block;position:absolute;top:0;right:0;border-right:none;padding:.3em .45em .25em}#ui-bar.stowed #ui-bar-toggle{padding:.3em .35em .25em .55em}#ui-bar-toggle:hover{background-color:#444;border-color:#eee}#ui-bar-history{margin:0 auto}#ui-bar-history [id|=history]{padding:.2em .45em .35em}#ui-bar-history #history-jumpto{padding:.2em .665em .35em}#ui-bar-history [id|=history]:not(:first-child){margin-left:1.2em}#ui-bar-history [id|=history]:hover{background-color:#444;border-color:#eee}#ui-bar-history [id|=history]:disabled{color:#444;background-color:transparent;border-color:#444}#ui-bar-body{line-height:1.5;overflow:auto}#ui-bar-body>:not(:first-child){margin-top:2em}#story-title{margin:0;font-size:162.5%}#story-author{margin-top:2em;font-weight:700}#menu ul{margin:1em 0 0;padding:0;list-style:none;border:1px solid #444}#menu ul:empty{display:none}#menu li{margin:0}#menu li:not(:first-child){border-top:1px solid #444}#menu li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-transform:uppercase}#menu li a:hover{background-color:#444;border-color:#eee}#menu a,#ui-bar-history [id|=history],#ui-bar-toggle{user-select:none}#menu-core li[id|=menu-item] a:before,#ui-bar-history [id|=history],#ui-bar-toggle:before{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-bar-toggle:before{content:\"\\e81d\"}#ui-bar.stowed #ui-bar-toggle:before{content:\"\\e81e\"}#menu-item-saves a:before{content:\"\\e82b\\00a0\"}#menu-item-settings a:before{content:\"\\e82d\\00a0\"}#menu-item-restart a:before{content:\"\\e82c\\00a0\"}#menu-item-share a:before{content:\"\\e82f\\00a0\"}</style>\n<style id=\"style-idb-backend\" type=\"text/css\">:root{--000:#eee;--100:#ddd;--150:#ccc;--200:#bbb;--300:#aaa;--400:#999;--500:#888;--600:#777;--700:#666;--750:#444;--800:#333;--850:#222;--900:#111;--red:#ec3535;--pink:#e40081;--pink-secondary:#d67caf;--purple:#80f;--purple-secondary:#aa4bc8;--blue:#4372ff;--blue-secondary:#559bc0;--teal:#08c1c1;--green:#38b20a;--green-secondary:#7caf7c;--lime:#44e342;--orange:#f28500;--brown:#4c2217;--black:#929292;--yellow:#ffd700;--gold:gold;--silver:silver;--link:#5888dd;--link-hover:#8af;--tooltip-background:#1a1919;--tooltip-border:#b0b0b4}.saveList input{width:auto}#savesListContainer{display:flex;flex-direction:column;border:1px solid var(--400);max-width:800px}#savesListContainer .savesListRow{display:flex;flex-flow:row nowrap;align-items:center;border:1px solid var(--400);padding:4px}#savesListContainer .savesListRow .saveGroup{display:flex;flex-flow:row wrap;align-items:center;flex-grow:1;flex-shrink:1;min-width:0}#savesListContainer .savesListRow .saveGroup>div{display:flex;justify-content:center;margin:0 10px;flex-grow:0;flex-shrink:0}#savesListContainer .savesListRow .saveGroup .saveId{min-width:2em;margin-left:4px;margin-right:-6px}.jumpToSaveTransition{background-color:var(--750);transition-duration:1s}#savesListContainer .savesListRow .saveGroup .saveButton{display:flex;justify-content:center;min-width:110px;margin:0 10px}#savesListContainer .savesListRow .saveGroup .saveName{width:60px}#savesListContainer .savesListRow .saveGroup .saveButton input{margin:3px 0}#savesListContainer .savesListRow .saveGroup>.saveDetails{display:flex;flex:1 1 0;flex-direction:column;align-items:stretch;justify-content:stretch;min-width:100px}#savesListContainer .savesListRow .saveGroup>.saveDetails span{max-height:80px;white-space:nowrap;overflow-x:clip}#savesListFooter{justify-content:space-between;padding:0!important;line-height:normal}#savesListFooter div{display:flex;justify-content:stretch}#savesListFooter #exportButton{background-color:var(--blue);border:1px solid var(--500)}#savesListFooter #exportButton:before{font-family:tme-fa-icons;content:\"\\e829\\00a0\"}#savesListFooter #importButton{border:1px solid var(--500);padding:.4em;cursor:pointer}#savesListFooter #importButton:before{font-family:tme-fa-icons;content:\"\\e82a\\00a0\"}#savesListFooter #clearButton{border:1px solid var(--500)}#savesListFooter #clearButton:before{font-family:tme-fa-icons;content:\"\\e827\\00a0\"}.datestamp{font-size:.8em}.listMargin{display:inline-block;margin:1px 0}.right{float:right}.saveMenuButton{background-color:var(--blue)!important}.saveMenuButton:hover{background-color:var(--blue)!important}.saveMenuConfirm{margin-top:20px;margin-left:5em}.saveBorder{max-width:700px;margin:10px 2px;padding:5px 2px 30px;border:1px solid var(--200)}.green{color:var(--green)}.gold,.gold button,.goldLink a{color:var(--gold)}.red{color:var(--red)}</style>\n<style id=\"style-ui-debug\" type=\"text/css\">#debug-bar{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:0;margin:0;max-height:75%;padding:.5em;position:fixed;right:0;z-index:99900}#debug-bar>div:not([id])+div{margin-top:.5em}#debug-bar>div>label{margin-right:.5em}#debug-bar>div>input[type=text]{min-width:0;width:8em}#debug-bar>div>select{width:15em}#debug-bar-toggle{color:#eee;background-color:#222;border:1px solid #444;height:101%;height:calc(100% + 1px);left:-2em;left:calc(-2em - 1px);position:absolute;top:-1px;width:2em}#debug-bar-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-hint{bottom:.175em;font-size:4.5em;opacity:.33;pointer-events:none;position:fixed;right:.6em;user-select:none;white-space:nowrap}#debug-bar-watch{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:102%;bottom:calc(100% + 1px);font-size:.9em;left:-1px;max-height:650%;max-height:65vh;position:absolute;overflow-x:hidden;overflow-y:scroll;right:0;z-index:99800}#debug-bar-watch[hidden]{display:none}#debug-bar-watch div{color:#999;font-style:italic;margin:1em auto;text-align:center}#debug-bar-watch table{width:100%}#debug-bar-watch tr:nth-child(2n){background-color:rgba(127,127,127,.15)}#debug-bar-watch td{padding:.2em 0}#debug-bar-watch td:first-child+td{padding:.2em .3em .2em .1em}#debug-bar-watch .watch-delete{background-color:transparent;border:none;color:#c00}#debug-bar-watch-all,#debug-bar-watch-none{margin-left:.5em}#debug-bar-views-toggle,#debug-bar-watch-toggle{color:#eee;background-color:transparent;border:1px solid #444;margin-right:1em;padding:.4em}#debug-bar-views-toggle:hover,#debug-bar-watch-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle,html[data-debug-view] #debug-bar-views-toggle{background-color:#282;border-color:#4a4}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:hover,html[data-debug-view] #debug-bar-views-toggle:hover{background-color:#4a4;border-color:#6c6}#debug-bar-hint:after,#debug-bar-toggle:before,#debug-bar-views-toggle:after,#debug-bar-watch .watch-delete:before,#debug-bar-watch-add:before,#debug-bar-watch-all:before,#debug-bar-watch-none:before,#debug-bar-watch-toggle:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#debug-bar-toggle:before{content:\"\\e838\"}#debug-bar-hint:after{content:\"\\e838\\202f\\e822\"}#debug-bar-watch .watch-delete:before{content:\"\\e804\"}#debug-bar-watch-add:before{content:\"\\e805\"}#debug-bar-watch-all:before{content:\"\\e83a\"}#debug-bar-watch-none:before{content:\"\\e827\"}#debug-bar-views-toggle:after,#debug-bar-watch-toggle:after{content:\"\\00a0\\00a0\\e830\"}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:after,html[data-debug-view] #debug-bar-views-toggle:after{content:\"\\00a0\\00a0\\e831\"}html[data-debug-view] .debug{padding:.25em;background-color:#234}html[data-debug-view] .debug[title]{cursor:help}html[data-debug-view] .debug.block{display:inline-block;vertical-align:middle}html[data-debug-view] .debug.invalid{text-decoration:line-through}html[data-debug-view] .debug.hidden,html[data-debug-view] .debug.hidden .debug{background-color:#555}html:not([data-debug-view]) .debug.hidden{display:none}html[data-debug-view] .debug[data-name][data-type].nonvoid:after,html[data-debug-view] .debug[data-name][data-type]:before{background-color:rgba(0,0,0,.25);font-family:monospace,monospace;white-space:pre}html[data-debug-view] .debug[data-name][data-type]:before{content:attr(data-name)}html[data-debug-view] .debug[data-name][data-type|=macro]:before{content:\"<<\" attr(data-name) \">>\"}html[data-debug-view] .debug[data-name][data-type|=macro].nonvoid:after{content:\"<</\" attr(data-name) \">>\"}html[data-debug-view] .debug[data-name][data-type|=html]:before{content:\"<\" attr(data-name) \">\"}html[data-debug-view] .debug[data-name][data-type|=html].nonvoid:after{content:\"</\" attr(data-name) \">\"}html[data-debug-view] .debug[data-name][data-type]:not(:empty):before{margin-right:.25em}html[data-debug-view] .debug[data-name][data-type].nonvoid:not(:empty):after{margin-left:.25em}html[data-debug-view] .debug[data-name][data-type|=special],html[data-debug-view] .debug[data-name][data-type|=special]:before{display:block}</style>\n</head>\n<body>\n\t<div id=\"init-screen\">\n\t\t<div id=\"init-no-js\"><noscript>JavaScript must be enabled to play.</noscript></div>\n\t\t<div id=\"init-lacking\"><p>Browser lacks capabilities required to play.</p><p>Upgrade or switch to another browser.</p></div>\n\t\t<div id=\"init-loading\"><div>Loading&hellip;</div></div>\n\t</div>\n\t{{STORY_DATA}}\n\t<script id=\"script-sugarcube\" type=\"text/javascript\">\n\t/*! SugarCube JS */\n\tif(document.documentElement.getAttribute(\"data-init\")===\"loading\"){(function(window,document,jQuery,undefined){\"use strict\";var errorPrologRegExp=/^(?:(?:uncaught\\s+(?:exception:\\s+)?)?\\w*(?:error|exception|_err):\\s+)+/i,Alert=(()=>{function mesg(where,error,isFatal,isUncaught){let mesg=\"Error\",nice=`A${isFatal?\" fatal\":\"n\"} error has occurred.`;nice+=isFatal?\" Aborting.\":\" You may be able to continue, but some parts may not work properly.\";const isObject=null!==error&&\"object\"==typeof error;null!=where&&(mesg+=` [${where}]`),mesg+=`: ${(isObject&&\"message\"in error?String(error.message).replace(errorPrologRegExp,\"\"):String(error)).trim()||\"unknown error\"}.`,isObject&&\"stack\"in error&&(mesg+=`\\n\\nStack Trace:\\n${error.stack}`),mesg&&(nice+=`\\n\\n${mesg}`),isUncaught||console[isFatal?\"error\":\"warn\"](mesg),window.alert(nice)}var origOnError;return origOnError=window.onerror,window.onerror=function(what,source,lineNum,colNum,error){\"complete\"===document.readyState?mesg(null,null!=error?error:what,!1,!0):(mesg(null,null!=error?error:what,!0,!0),window.onerror=origOnError,\"function\"==typeof window.onerror&&window.onerror.apply(this,arguments))},Object.freeze(Object.defineProperties({},{error:{value:function(where,error){mesg(where,error)}},fatal:{value:function(where,error){mesg(where,error,!0)}}}))})(),Patterns=(()=>{const space=(()=>{const wsMap=new Map([[\" \",\"\\\\u0020\"],[\"\\f\",\"\\\\f\"],[\"\\n\",\"\\\\n\"],[\"\\r\",\"\\\\r\"],[\"\\t\",\"\\\\t\"],[\"\\v\",\"\\\\v\"],[\" \",\"\\\\u00a0\"],[\" \",\"\\\\u1680\"],[\"᠎\",\"\\\\u180e\"],[\" \",\"\\\\u2000\"],[\" \",\"\\\\u2001\"],[\" \",\"\\\\u2002\"],[\" \",\"\\\\u2003\"],[\" \",\"\\\\u2004\"],[\" \",\"\\\\u2005\"],[\" \",\"\\\\u2006\"],[\" \",\"\\\\u2007\"],[\" \",\"\\\\u2008\"],[\" \",\"\\\\u2009\"],[\" \",\"\\\\u200a\"],[\"\\u2028\",\"\\\\u2028\"],[\"\\u2029\",\"\\\\u2029\"],[\" \",\"\\\\u202f\"],[\" \",\"\\\\u205f\"],[\"　\",\"\\\\u3000\"],[\"\\ufeff\",\"\\\\ufeff\"]]),wsRe=/^\\s$/;let missing=\"\";return wsMap.forEach(((pat,char)=>{wsRe.test(char)||(missing+=pat)})),missing?`[\\\\s${missing}]`:\"\\\\s\"})(),spaceNoTerminator=\"[\\\\u0020\\\\f\\\\t\\\\v\\\\u00a0\\\\u1680\\\\u180e\\\\u2000-\\\\u200a\\\\u202f\\\\u205f\\\\u3000\\\\ufeff]\",notSpace=\"\\\\s\"===space?\"\\\\S\":space.replace(/^\\[/,\"[^\"),anyLetter=\"[0-9A-Z_a-z\\\\-\\\\u00c0-\\\\u00d6\\\\u00d8-\\\\u00f6\\\\u00f8-\\\\u00ff\\\\u0150\\\\u0170\\\\u0151\\\\u0171]\",anyLetterStrict=anyLetter.replace(\"\\\\-\",\"\"),htmlTagName=(()=>{const cENChar=\"(?:[\\\\x2D.0-9A-Z_a-z\\\\xB7\\\\xC0-\\\\xD6\\\\xD8-\\\\xF6\\\\xF8-\\\\u037D\\\\u037F-\\\\u1FFF\\\\u200C\\\\u200D\\\\u203F\\\\u2040\\\\u2070-\\\\u218F\\\\u2C00-\\\\u2FEF\\\\u3001-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFFD]|[\\\\uD800-\\\\uDB7F][\\\\uDC00-\\\\uDFFF])\";return`[A-Za-z](?:${cENChar}*-${cENChar}*|[0-9A-Za-z]*)`})(),inlineCss=`(${anyLetter}+)\\\\(([^\\\\)\\\\|\\\\n]+)\\\\):|${spaceNoTerminator}*(${anyLetter}+)${spaceNoTerminator}*:([^;\\\\|\\\\n]+);|${spaceNoTerminator}*((?:[#.]${anyLetter}+${spaceNoTerminator}*)+);`;return Object.freeze({space:space,spaceNoTerminator:spaceNoTerminator,lineTerminator:\"[\\\\n\\\\r\\\\u2028\\\\u2029]\",notSpace:notSpace,anyChar:\"(?:.|[\\\\n\\\\r\\\\u2028\\\\u2029])\",anyLetter:anyLetter,anyLetterStrict:anyLetterStrict,identifierFirstChar:\"[$A-Z_a-z]\",identifierNextChar:\"[$0-9A-Z_a-z]\",identifier:\"[$A-Z_a-z][$0-9A-Z_a-z]*\",variableSigil:\"[$_]\",variable:\"[$_][$A-Z_a-z][$0-9A-Z_a-z]*\",macroName:\"[A-Za-z][\\\\w-]*|[=-]\",templateName:\"[A-Za-z][\\\\w-]*\",htmlTagName:htmlTagName,cssIdOrClassSigil:\"[#.]\",cssImage:\"\\\\[[<>]?[Ii][Mm][Gg]\\\\[(?:\\\\s|\\\\S)*?\\\\]\\\\]+\",inlineCss:inlineCss,url:\"(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\\\s'\\\"]+\"})})();(()=>{const _trimString=(()=>{const startWSRe=new RegExp(`^${Patterns.space}${Patterns.space}*`),endWSRe=new RegExp(`${Patterns.space}${Patterns.space}*$`);return function(str,where){const val=String(str);if(!val)return val;switch(where){case\"start\":return startWSRe.test(val)?val.replace(startWSRe,\"\"):val;case\"end\":return endWSRe.test(val)?val.replace(endWSRe,\"\"):val;default:throw new Error(`_trimString called with incorrect where parameter value: \"${where}\"`)}}})();function _createPadString(length,padding){const targetLength=Number.parseInt(length,10)||0;if(targetLength<1)return\"\";let padString=void 0===padding?\"\":String(padding);for(\"\"===padString&&(padString=\" \");padString.length<targetLength;){const curPadLength=padString.length,remainingLength=targetLength-curPadLength;padString+=curPadLength>remainingLength?padString.slice(0,remainingLength):padString}return padString.length>targetLength&&(padString=padString.slice(0,targetLength)),padString}Array.prototype.flat||Object.defineProperty(Array.prototype,\"flat\",{configurable:!0,writable:!0,value:function flat(){if(null==this)throw new TypeError(\"Array.prototype.flat called on null or undefined\");const depth=0===arguments.length?1:Number(arguments[0])||0;return depth<1?Array.prototype.slice.call(this):Array.prototype.reduce.call(this,((acc,cur)=>(cur instanceof Array?acc.push(...flat.call(cur,depth-1)):acc.push(cur),acc)),[])}}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,\"flatMap\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.flatMap called on null or undefined\");return Array.prototype.map.apply(this,arguments).flat()}}),Array.prototype.includes||Object.defineProperty(Array.prototype,\"includes\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.includes called on null or undefined\");if(0===arguments.length)return!1;const length=this.length>>>0;if(0===length)return!1;const needle=arguments[0];let i=Number(arguments[1])||0;for(i<0&&(i=Math.max(0,length+i));i<length;++i){const value=this[i];if(value===needle||value!=value&&needle!=needle)return!0}return!1}}),Object.entries||Object.defineProperty(Object,\"entries\",{configurable:!0,writable:!0,value(obj){if(\"object\"!=typeof obj||null===obj)throw new TypeError(\"Object.entries object parameter must be an object\");return Object.keys(obj).map((key=>[key,obj[key]]))}}),Object.fromEntries||Object.defineProperty(Object,\"fromEntries\",{configurable:!0,writable:!0,value:iter=>Array.from(iter).reduce(((acc,pair)=>{if(Object(pair)!==pair)throw new TypeError(\"Object.fromEntries iterable parameter must yield objects\");return pair[0]in acc?Object.defineProperty(acc,pair[0],{configurable:!0,enumerable:!0,writable:!0,value:pair[1]}):acc[pair[0]]=pair[1],acc}),{})}),Object.getOwnPropertyDescriptors||Object.defineProperty(Object,\"getOwnPropertyDescriptors\",{configurable:!0,writable:!0,value(obj){if(null==obj)throw new TypeError(\"Object.getOwnPropertyDescriptors object parameter is null or undefined\");const O=Object(obj);return Reflect.ownKeys(O).reduce(((acc,key)=>{const desc=Object.getOwnPropertyDescriptor(O,key);return void 0!==desc&&(key in acc?Object.defineProperty(acc,key,{configurable:!0,enumerable:!0,writable:!0,value:desc}):acc[key]=desc),acc}),{})}}),Object.values||Object.defineProperty(Object,\"values\",{configurable:!0,writable:!0,value(obj){if(\"object\"!=typeof obj||null===obj)throw new TypeError(\"Object.values object parameter must be an object\");return Object.keys(obj).map((key=>obj[key]))}}),String.prototype.padStart||Object.defineProperty(String.prototype,\"padStart\",{configurable:!0,writable:!0,value(length,padding){if(null==this)throw new TypeError(\"String.prototype.padStart called on null or undefined\");const baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:_createPadString(targetLength-baseLength,padding)+baseString}}),String.prototype.padEnd||Object.defineProperty(String.prototype,\"padEnd\",{configurable:!0,writable:!0,value(length,padding){if(null==this)throw new TypeError(\"String.prototype.padEnd called on null or undefined\");const baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:baseString+_createPadString(targetLength-baseLength,padding)}}),String.prototype.trimStart||Object.defineProperty(String.prototype,\"trimStart\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.trimStart called on null or undefined\");return _trimString(this,\"start\")}}),String.prototype.trimLeft||Object.defineProperty(String.prototype,\"trimLeft\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.trimLeft called on null or undefined\");return _trimString(this,\"start\")}}),String.prototype.trimEnd||Object.defineProperty(String.prototype,\"trimEnd\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.trimEnd called on null or undefined\");return _trimString(this,\"end\")}}),String.prototype.trimRight||Object.defineProperty(String.prototype,\"trimRight\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.trimRight called on null or undefined\");return _trimString(this,\"end\")}})})(),(()=>{function _nativeMathRandom(useMath){return useMath||!State.prng.isEnabled()?Math.random():window.SugarCube.State.random()}function _random(){let max,min=0,useMath=!1;switch(arguments.length){case 0:throw new Error(\"_random called with insufficient parameters\");case 1:max=arguments[0];break;case 2:!0===arguments[1]?(max=arguments[0],useMath=arguments[1]):(min=arguments[0],max=arguments[1]);break;default:min=arguments[0],max=arguments[1],useMath=arguments[2]}return min>max&&([min,max]=[max,min]),Math.floor(_nativeMathRandom(useMath)*(max-min+1))+min}function _randomIndex(length,boundsArgs){let min,max;switch(boundsArgs.length){case 1:min=0,max=length-1;break;case 2:min=0,max=Math.trunc(boundsArgs[1]);break;default:min=Math.trunc(boundsArgs[1]),max=Math.trunc(boundsArgs[2])}return Number.isNaN(min)?min=0:!Number.isFinite(min)||min>=length?min=length-1:min<0&&(min=length+min,min<0&&(min=0)),Number.isNaN(max)?max=0:!Number.isFinite(max)||max>=length?max=length-1:max<0&&(max=length+max,max<0&&(max=length-1)),_random(min,max)}function _getCodePointStartAndEnd(str,pos){const code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:\"\",start:-1,end:-1};if(code<55296||code>57343)return{char:str.charAt(pos),start:pos,end:pos};if(code>=55296&&code<=56319){const nextPos=pos+1;if(nextPos>=str.length)throw new Error(\"high surrogate without trailing low surrogate\");const nextCode=str.charCodeAt(nextPos);if(nextCode<56320||nextCode>57343)throw new Error(\"high surrogate without trailing low surrogate\");return{char:str.charAt(pos)+str.charAt(nextPos),start:pos,end:nextPos}}if(0===pos)throw new Error(\"low surrogate without leading high surrogate\");const prevPos=pos-1,prevCode=str.charCodeAt(prevPos);if(prevCode<55296||prevCode>56319)throw new Error(\"low surrogate without leading high surrogate\");return{char:str.charAt(prevPos)+str.charAt(pos),start:prevPos,end:pos}}Object.defineProperty(Array,\"random\",{configurable:!0,writable:!0,value(array,useMath){if(\"object\"!=typeof array||null===array||!Object.prototype.hasOwnProperty.call(array,\"length\"))throw new TypeError(\"Array.random array parameter must be an array or array-lke object\");const length=array.length>>>0;if(0===length)return;return array[_random(0,length-1,useMath)]}}),Object.defineProperty(Array.prototype,\"concatUnique\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.concatUnique called on null or undefined\");const result=Array.from(this);if(0===arguments.length)return result;const items=Array.prototype.reduce.call(arguments,((prev,cur)=>prev.concat(cur)),[]),addSize=items.length;if(0===addSize)return result;const indexOf=Array.prototype.indexOf,push=Array.prototype.push;for(let i=0;i<addSize;++i){const value=items[i];-1===indexOf.call(result,value)&&push.call(result,value)}return result}}),Object.defineProperty(Array.prototype,\"count\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.count called on null or undefined\");const indexOf=Array.prototype.indexOf,needle=arguments[0];let pos=Number(arguments[1])||0,count=0;for(;-1!==(pos=indexOf.call(this,needle,pos));)++count,++pos;return count}}),Object.defineProperty(Array.prototype,\"countWith\",{configurable:!0,writable:!0,value(predicate,thisArg){if(null==this)throw new TypeError(\"Array.prototype.countWith called on null or undefined\");if(\"function\"!=typeof predicate)throw new Error(\"Array.prototype.countWith predicate parameter must be a function\");const length=this.length>>>0;if(0===length)return 0;let count=0;for(let i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&++count;return count}}),Object.defineProperty(Array.prototype,\"delete\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.delete called on null or undefined\");if(0===arguments.length)return[];const length=this.length>>>0;if(0===length)return[];const needles=Array.prototype.concat.apply([],arguments),needlesLength=needles.length,indices=[];for(let i=0;i<length;++i){const value=this[i];for(let j=0;j<needlesLength;++j){const needle=needles[j];if(value===needle||value!=value&&needle!=needle){indices.push(i);break}}}const result=[];for(let i=0,iend=indices.length;i<iend;++i)result[i]=this[indices[i]];const splice=Array.prototype.splice;for(let i=indices.length-1;i>=0;--i)splice.call(this,indices[i],1);return result}}),Object.defineProperty(Array.prototype,\"deleteAt\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.deleteAt called on null or undefined\");if(0===arguments.length)return[];const length=this.length>>>0;if(0===length)return[];const splice=Array.prototype.splice,cpyIndices=[...new Set(Array.prototype.concat.apply([],arguments).map((x=>x<0?Math.max(0,length+x):x))).values()],delIndices=[...cpyIndices].sort(((a,b)=>b-a)),result=[];for(let i=0,iend=cpyIndices.length;i<iend;++i)result[i]=this[cpyIndices[i]];for(let i=0,iend=delIndices.length;i<iend;++i)splice.call(this,delIndices[i],1);return result}}),Object.defineProperty(Array.prototype,\"deleteWith\",{configurable:!0,writable:!0,value(predicate,thisArg){if(null==this)throw new TypeError(\"Array.prototype.deleteWith called on null or undefined\");if(\"function\"!=typeof predicate)throw new Error(\"Array.prototype.deleteWith predicate parameter must be a function\");const length=this.length>>>0;if(0===length)return[];const splice=Array.prototype.splice,indices=[],result=[];for(let i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&(result.push(this[i]),indices.push(i));for(let i=indices.length-1;i>=0;--i)splice.call(this,indices[i],1);return result}}),Object.defineProperty(Array.prototype,\"first\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.first called on null or undefined\");if(0!==this.length>>>0)return this[0]}}),Object.defineProperty(Array.prototype,\"includesAll\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.includesAll called on null or undefined\");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAll.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(let i=0,iend=arguments.length;i<iend;++i)if(!Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!1;return!0}}),Object.defineProperty(Array.prototype,\"includesAny\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.includesAny called on null or undefined\");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAny.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(let i=0,iend=arguments.length;i<iend;++i)if(Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!0;return!1}}),Object.defineProperty(Array.prototype,\"last\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.last called on null or undefined\");const length=this.length>>>0;if(0!==length)return this[length-1]}}),Object.defineProperty(Array.prototype,\"pluck\",{configurable:!0,writable:!0,value(useMath){if(null==this)throw new TypeError(\"Array.prototype.pluck called on null or undefined\");const length=this.length>>>0;if(0===length)return;const index=_random(0,length-1,useMath);return Array.prototype.splice.call(this,index,1)[0]}}),Object.defineProperty(Array.prototype,\"pluckMany\",{configurable:!0,writable:!0,value(wantSize){if(null==this)throw new TypeError(\"Array.prototype.pluckMany called on null or undefined\");const length=this.length>>>0;if(0===length)return[];let want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error(\"Array.prototype.pluckMany want parameter must be an integer\");if(want<1)return[];want>length&&(want=length);const splice=Array.prototype.splice,result=[];let max=length-1;do{result.push(splice.call(this,_random(0,max--),1)[0])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,\"pushUnique\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.pushUnique called on null or undefined\");const addSize=arguments.length;if(0===addSize)return this.length>>>0;const indexOf=Array.prototype.indexOf,push=Array.prototype.push;for(let i=0;i<addSize;++i){const value=arguments[i];-1===indexOf.call(this,value)&&push.call(this,value)}return this.length>>>0}}),Object.defineProperty(Array.prototype,\"random\",{configurable:!0,writable:!0,value(useMath){if(null==this)throw new TypeError(\"Array.prototype.random called on null or undefined\");const length=this.length>>>0;if(0===length)return;return this[_random(0,length-1,useMath)]}}),Object.defineProperty(Array.prototype,\"randomMany\",{configurable:!0,writable:!0,value(wantSize){if(null==this)throw new TypeError(\"Array.prototype.randomMany called on null or undefined\");const length=this.length>>>0;if(0===length)return[];let want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error(\"Array.prototype.randomMany want parameter must be an integer\");if(want<1)return[];want>length&&(want=length);const picked=new Map,result=[],max=length-1;do{let i;do{i=_random(0,max)}while(picked.has(i));picked.set(i,!0),result.push(this[i])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,\"shuffle\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.shuffle called on null or undefined\");const length=this.length>>>0;if(0===length)return this;for(let i=length-1;i>0;--i){const j=Math.floor(_nativeMathRandom()*(i+1));if(i===j)continue;const swap=this[i];this[i]=this[j],this[j]=swap}return this}}),Object.defineProperty(Array.prototype,\"unshiftUnique\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.unshiftUnique called on null or undefined\");const addSize=arguments.length;if(0===addSize)return this.length>>>0;const indexOf=Array.prototype.indexOf,unshift=Array.prototype.unshift;for(let i=0;i<addSize;++i){const value=arguments[i];-1===indexOf.call(this,value)&&unshift.call(this,value)}return this.length>>>0}}),Object.defineProperty(Function.prototype,\"partial\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Function.prototype.partial called on null or undefined\");const slice=Array.prototype.slice,fn=this,bound=slice.call(arguments,0);return function(){const applied=[];let argc=0;for(let i=0;i<bound.length;++i)applied.push(bound[i]===undefined?arguments[argc++]:bound[i]);return fn.apply(this,applied.concat(slice.call(arguments,argc)))}}}),Object.defineProperty(Math,\"clamp\",{configurable:!0,writable:!0,value(num,min,max){const value=Number(num);return Number.isNaN(value)?NaN:value.clamp(min,max)}}),Object.defineProperty(Math,\"easeInOut\",{configurable:!0,writable:!0,value:num=>1-(Math.cos(Number(num)*Math.PI)+1)/2}),Object.defineProperty(Number.prototype,\"clamp\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Number.prototype.clamp called on null or undefined\");if(2!==arguments.length)throw new Error(\"Number.prototype.clamp called with an incorrect number of parameters\");let min=Number(arguments[0]),max=Number(arguments[1]);return min>max&&([min,max]=[max,min]),Math.min(Math.max(this,min),max)}}),RegExp.escape||(()=>{const _regExpMetaCharsRe=/[\\\\^$*+?.()|[\\]{}]/g,_hasRegExpMetaCharsRe=new RegExp(_regExpMetaCharsRe.source);Object.defineProperty(RegExp,\"escape\",{configurable:!0,writable:!0,value(str){const val=String(str);return val&&_hasRegExpMetaCharsRe.test(val)?val.replace(_regExpMetaCharsRe,\"\\\\$&\"):val}})})(),(()=>{const _formatRegExp=/{(\\d+)(?:,([+-]?\\d+))?}/g,_hasFormatRegExp=new RegExp(_formatRegExp.source);Object.defineProperty(String,\"format\",{configurable:!0,writable:!0,value(format){if(arguments.length<2)return 0===arguments.length?\"\":format;const args=2===arguments.length&&Array.isArray(arguments[1])?[...arguments[1]]:Array.prototype.slice.call(arguments,1);return 0===args.length?format:_hasFormatRegExp.test(format)?(_formatRegExp.lastIndex=0,format.replace(_formatRegExp,((match,index,align)=>{let retval=args[index];if(null==retval)return\"\";for(;\"function\"==typeof retval;)retval=retval();switch(typeof retval){case\"string\":break;case\"object\":retval=JSON.stringify(retval);break;default:retval=String(retval)}return function(str,align,pad){if(!align)return str;const plen=Math.abs(align)-str.length;if(plen<1)return str;const padding=String(pad).repeat(plen);return align<0?str+padding:padding+str}(retval,align?Number.parseInt(align,10):0,\" \")}))):format}})})(),Object.defineProperty(String.prototype,\"contains\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.contains called on null or undefined\");return-1!==String.prototype.indexOf.apply(this,arguments)}}),Object.defineProperty(String.prototype,\"count\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.count called on null or undefined\");const needle=String(arguments[0]||\"\");if(\"\"===needle)return 0;const indexOf=String.prototype.indexOf,step=needle.length;let pos=Number(arguments[1])||0,count=0;for(;-1!==(pos=indexOf.call(this,needle,pos));)++count,pos+=step;return count}}),Object.defineProperty(String.prototype,\"first\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.first called on null or undefined\");const str=String(this),{char:char}=_getCodePointStartAndEnd(str,0);return char}}),Object.defineProperty(String.prototype,\"last\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.last called on null or undefined\");const str=String(this),{char:char}=_getCodePointStartAndEnd(str,str.length-1);return char}}),Object.defineProperty(String.prototype,\"splice\",{configurable:!0,writable:!0,value(startAt,delCount,replacement){if(null==this)throw new TypeError(\"String.prototype.splice called on null or undefined\");const length=this.length>>>0;if(0===length)return\"\";let start=Number(startAt);Number.isSafeInteger(start)?start<0&&(start+=length,start<0&&(start=0)):start=0,start>length&&(start=length);let count=Number(delCount);(!Number.isSafeInteger(count)||count<0)&&(count=0);let res=this.slice(0,start);return void 0!==replacement&&(res+=replacement),start+count<length&&(res+=this.slice(start+count)),res}}),Object.defineProperty(String.prototype,\"splitOrEmpty\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.splitOrEmpty called on null or undefined\");return\"\"===String(this)?[]:String.prototype.split.apply(this,arguments)}}),Object.defineProperty(String.prototype,\"toLocaleUpperFirst\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.toLocaleUpperFirst called on null or undefined\");const str=String(this),{char:char,end:end}=_getCodePointStartAndEnd(str,0);return-1===end?\"\":char.toLocaleUpperCase()+str.slice(end+1)}}),Object.defineProperty(String.prototype,\"toUpperFirst\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.toUpperFirst called on null or undefined\");const str=String(this),{char:char,end:end}=_getCodePointStartAndEnd(str,0);return-1===end?\"\":char.toUpperCase()+str.slice(end+1)}}),Object.defineProperty(Date.prototype,\"toJSON\",{configurable:!0,writable:!0,value(){return[\"(revive:date)\",this.toISOString()]}}),Object.defineProperty(Function.prototype,\"toJSON\",{configurable:!0,writable:!0,value(){return[\"(revive:eval)\",`(${this.toString()})`]}}),Object.defineProperty(Map.prototype,\"toJSON\",{configurable:!0,writable:!0,value(){return[\"(revive:map)\",[...this]]}}),Object.defineProperty(RegExp.prototype,\"toJSON\",{configurable:!0,writable:!0,value(){return[\"(revive:eval)\",this.toString()]}}),Object.defineProperty(Set.prototype,\"toJSON\",{configurable:!0,writable:!0,value(){return[\"(revive:set)\",[...this]]}}),Object.defineProperty(JSON,\"reviveWrapper\",{configurable:!0,writable:!0,value(code,data){if(\"string\"!=typeof code)throw new TypeError(\"JSON.reviveWrapper code parameter must be a string\");return[\"(revive:eval)\",[code,data]]}}),Object.defineProperty(JSON,\"_real_stringify\",{value:JSON.stringify}),Object.defineProperty(JSON,\"stringify\",{configurable:!0,writable:!0,value:(value,replacer,space)=>JSON._real_stringify(value,((key,val)=>{let value=val;if(\"function\"==typeof replacer)try{value=replacer(key,value)}catch(ex){}return void 0===value?value=[\"(revive:eval)\",\"undefined\"]:value===1/0?value=[\"(revive:eval)\",\"Infinity\"]:value===-1/0?value=[\"(revive:eval)\",\"-Infinity\"]:Number.isNaN(value)&&(value=[\"(revive:eval)\",\"NaN\"]),value}),space)}),Object.defineProperty(JSON,\"_real_parse\",{value:JSON.parse}),Object.defineProperty(JSON,\"parse\",{configurable:!0,writable:!0,value(text,reviver){return JSON._real_parse(text,((key,val)=>{let value=val;if(Array.isArray(value)&&2===value.length)switch(value[0]){case\"(revive:set)\":value=new Set(value[1]);break;case\"(revive:map)\":value=new Map(value[1]);break;case\"(revive:date)\":value=new Date(value[1]);break;case\"(revive:eval)\":try{if(Array.isArray(value[1])){const $ReviveData$=value[1][1];value=eval(value[1][0])}else value=eval(value[1])}catch(ex){}}else if(\"string\"==typeof value&&\"@@revive@@\"===value.slice(0,10))try{value=eval(value.slice(10))}catch(ex){}if(\"function\"==typeof reviver)try{value=reviver(key,value)}catch(ex){}return value}))}}),Object.defineProperty(Array.prototype,\"contains\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.contains called on null or undefined\");return Array.prototype.includes.apply(this,arguments)}}),Object.defineProperty(Array.prototype,\"containsAll\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.containsAll called on null or undefined\");return Array.prototype.includesAll.apply(this,arguments)}}),Object.defineProperty(Array.prototype,\"containsAny\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.containsAny called on null or undefined\");return Array.prototype.includesAny.apply(this,arguments)}}),Object.defineProperty(Array.prototype,\"flatten\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"Array.prototype.flatten called on null or undefined\");return Array.prototype.flat.call(this,1/0)}}),Object.defineProperty(String.prototype,\"readBracketedList\",{configurable:!0,writable:!0,value(){if(null==this)throw new TypeError(\"String.prototype.readBracketedList called on null or undefined\");const re=new RegExp(\"(?:\\\\[\\\\[((?:\\\\s|\\\\S)*?)\\\\]\\\\])|([^\\\"'\\\\s]\\\\S*)\",\"gm\"),names=[];let match;for(;null!==(match=re.exec(this));)match[1]?names.push(match[1]):match[2]&&names.push(match[2]);return names}})})();var Browser=(()=>{const userAgent=navigator.userAgent.toLowerCase(),winPhone=userAgent.includes(\"windows phone\"),isMobile=Object.freeze({Android:!winPhone&&userAgent.includes(\"android\"),BlackBerry:/blackberry|bb10/.test(userAgent),iOS:!winPhone&&/ip(?:hone|ad|od)/.test(userAgent),Opera:!winPhone&&(\"object\"==typeof window.operamini||userAgent.includes(\"opera mini\")),Windows:winPhone||/iemobile|wpdesktop/.test(userAgent),any:()=>isMobile.Android||isMobile.BlackBerry||isMobile.iOS||isMobile.Opera||isMobile.Windows}),isGecko=!isMobile.Windows&&!/khtml|trident|edge/.test(userAgent)&&userAgent.includes(\"gecko\"),isIE=!userAgent.includes(\"opera\")&&/msie|trident/.test(userAgent),ieVersion=isIE?(()=>{const ver=/(?:msie\\s+|rv:)(\\d+\\.\\d)/.exec(userAgent);return ver?Number(ver[1]):0})():null,isOpera=userAgent.includes(\"opera\")||userAgent.includes(\" opr/\"),operaVersion=isOpera?(()=>{const ver=new RegExp((/khtml|chrome/.test(userAgent)?\"opr\":\"version\")+\"\\\\/(\\\\d+\\\\.\\\\d+)\").exec(userAgent);return ver?Number(ver[1]):0})():null,isVivaldi=userAgent.includes(\"vivaldi\");return Object.freeze({userAgent:userAgent,isMobile:isMobile,isGecko:isGecko,isIE:isIE,ieVersion:ieVersion,isOpera:isOpera,operaVersion:operaVersion,isVivaldi:isVivaldi})})(),Has=(()=>{const hasAudioElement=(()=>{try{return\"function\"==typeof document.createElement(\"audio\").canPlayType}catch(ex){}return!1})(),hasFile=(()=>{try{return\"Blob\"in window&&\"File\"in window&&\"FileList\"in window&&\"FileReader\"in window&&(!Browser.isOpera||Browser.operaVersion>=15)}catch(ex){}return!1})(),hasGeolocation=(()=>{try{return\"geolocation\"in navigator&&\"function\"==typeof navigator.geolocation.getCurrentPosition&&\"function\"==typeof navigator.geolocation.watchPosition}catch(ex){}return!1})(),hasMutationObserver=(()=>{try{return\"MutationObserver\"in window&&\"function\"==typeof window.MutationObserver}catch(ex){}return!1})(),hasPerformance=(()=>{try{return\"performance\"in window&&\"function\"==typeof window.performance.now}catch(ex){}return!1})(),hasTouch=(()=>{try{return\"ontouchstart\"in window||!!window.DocumentTouch&&document instanceof window.DocumentTouch||!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints}catch(ex){}return!1})(),hasTransitionEndEvent=(()=>{try{const teMap=new Map([[\"transition\",\"transitionend\"],[\"MSTransition\",\"msTransitionEnd\"],[\"WebkitTransition\",\"webkitTransitionEnd\"],[\"MozTransition\",\"transitionend\"]]),teKeys=[...teMap.keys()],el=document.createElement(\"div\");for(let i=0;i<teKeys.length;++i)if(el.style[teKeys[i]]!==undefined)return teMap.get(teKeys[i])}catch(ex){}return!1})();return Object.freeze({audio:hasAudioElement,fileAPI:hasFile,geolocation:hasGeolocation,mutationObserver:hasMutationObserver,performance:hasPerformance,touch:hasTouch,transitionEndEvent:hasTransitionEndEvent})})(),Visibility=(()=>{const vendor=(()=>{try{return Object.freeze([{hiddenProperty:\"hidden\",stateProperty:\"visibilityState\",changeEvent:\"visibilitychange\"},{hiddenProperty:\"webkitHidden\",stateProperty:\"webkitVisibilityState\",changeEvent:\"webkitvisibilitychange\"},{hiddenProperty:\"mozHidden\",stateProperty:\"mozVisibilityState\",changeEvent:\"mozvisibilitychange\"},{hiddenProperty:\"msHidden\",stateProperty:\"msVisibilityState\",changeEvent:\"msvisibilitychange\"}].find((vnd=>vnd.hiddenProperty in document)))}catch(ex){}return undefined})();return Object.freeze(Object.defineProperties({},{vendor:{get:function(){return vendor}},state:{get:function(){return vendor&&document[vendor.stateProperty]||\"visible\"}},isEnabled:{value:function(){return Boolean(vendor)}},isHidden:{value:function(){return Boolean(vendor&&document[vendor.hiddenProperty])}},hiddenProperty:{value:vendor&&vendor.hiddenProperty},stateProperty:{value:vendor&&vendor.stateProperty},changeEvent:{value:vendor&&vendor.changeEvent}}))})(),Fullscreen=(()=>{const vendor=(()=>{try{return Object.freeze([{isEnabled:\"fullscreenEnabled\",element:\"fullscreenElement\",requestFn:\"requestFullscreen\",exitFn:\"exitFullscreen\",changeEvent:\"fullscreenchange\",errorEvent:\"fullscreenerror\"},{isEnabled:\"webkitFullscreenEnabled\",element:\"webkitFullscreenElement\",requestFn:\"webkitRequestFullscreen\",exitFn:\"webkitExitFullscreen\",changeEvent:\"webkitfullscreenchange\",errorEvent:\"webkitfullscreenerror\"},{isEnabled:\"mozFullScreenEnabled\",element:\"mozFullScreenElement\",requestFn:\"mozRequestFullScreen\",exitFn:\"mozCancelFullScreen\",changeEvent:\"mozfullscreenchange\",errorEvent:\"mozfullscreenerror\"},{isEnabled:\"msFullscreenEnabled\",element:\"msFullscreenElement\",requestFn:\"msRequestFullscreen\",exitFn:\"msExitFullscreen\",changeEvent:\"MSFullscreenChange\",errorEvent:\"MSFullscreenError\"}].find((vnd=>vnd.isEnabled in document)))}catch(ex){}return undefined})(),_returnsPromise=function(){let _hasPromise=null;return function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,vendor)try{const value=document.exitFullscreen();value.catch((()=>{})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise}}();function _selectElement(requestedEl){let selectedEl=requestedEl||document.documentElement;return selectedEl===document.documentElement&&(\"msRequestFullscreen\"===vendor.requestFn||Browser.isOpera&&Browser.operaVersion<15)&&(selectedEl=document.body),selectedEl}function isFullscreen(){return Boolean(vendor&&document[vendor.element])}function requestFullscreen(options,requestedEl){if(!vendor)return Promise.reject(new Error(\"fullscreen not supported\"));const element=_selectElement(requestedEl);if(\"function\"!=typeof element[vendor.requestFn])return Promise.reject(new Error(\"fullscreen not supported\"));if(isFullscreen())return Promise.resolve();if(_returnsPromise())return element[vendor.requestFn](options);{const namespace=\".Fullscreen_requestFullscreen\";return new Promise(((resolve,reject)=>{jQuery(element).off(namespace).one(`${vendor.errorEvent}${namespace} ${vendor.changeEvent}${namespace}`,(ev=>{jQuery(this).off(namespace),ev.type===vendor.errorEvent?reject(new Error(\"unknown fullscreen request error\")):resolve()})),element[vendor.requestFn](options)}))}}function exitFullscreen(){if(!vendor||\"function\"!=typeof document[vendor.exitFn])return Promise.reject(new TypeError(\"fullscreen not supported\"));if(!isFullscreen())return Promise.reject(new TypeError(\"fullscreen mode not active\"));if(_returnsPromise())return document[vendor.exitFn]();{const namespace=\".Fullscreen_exitFullscreen\";return new Promise(((resolve,reject)=>{jQuery(document).off(namespace).one(`${vendor.errorEvent}${namespace} ${vendor.changeEvent}${namespace}`,(ev=>{jQuery(this).off(namespace),ev.type===vendor.errorEvent?reject(new Error(\"unknown fullscreen exit error\")):resolve()})),document[vendor.exitFn]()}))}}return Object.freeze(Object.defineProperties({},{vendor:{get:function(){return vendor}},element:{get:function(){return vendor?document[vendor.element]:null}},isEnabled:{value:function(){return Boolean(vendor&&document[vendor.isEnabled])}},isFullscreen:{value:isFullscreen},request:{value:requestFullscreen},exit:{value:exitFullscreen},toggle:{value:function(options,requestedEl){return isFullscreen()?exitFullscreen():requestFullscreen(options,requestedEl)}},onChange:{value:function(handlerFn,requestedEl){if(!vendor)return;const element=_selectElement(requestedEl);$(element).on(vendor.changeEvent,handlerFn)}},offChange:{value:function(handlerFn,requestedEl){if(!vendor)return;const element=_selectElement(requestedEl);handlerFn?$(element).off(vendor.changeEvent,handlerFn):$(element).off(vendor.changeEvent)}},onError:{value:function(handlerFn,requestedEl){if(!vendor)return;const element=_selectElement(requestedEl);$(element).on(vendor.errorEvent,handlerFn)}},offError:{value:function(handlerFn,requestedEl){if(!vendor)return;const element=_selectElement(requestedEl);handlerFn?$(element).off(vendor.errorEvent,handlerFn):$(element).off(vendor.errorEvent)}}}))})(),{clone:clone,convertBreaks:convertBreaks,safeActiveElement:safeActiveElement,setDisplayTitle:setDisplayTitle,setPageElement:setPageElement,throwError:throwError,stringFrom:stringFrom}=Object.freeze(Object.defineProperties({},{clone:{value:function clone(orig){if(\"object\"!=typeof orig||null===orig)return orig;if(orig instanceof String)return String(orig);if(orig instanceof Number)return Number(orig);if(orig instanceof Boolean)return Boolean(orig);if(\"function\"==typeof orig.clone)return orig.clone(!0);if(orig.nodeType&&\"function\"==typeof orig.cloneNode)return orig.cloneNode(!0);let copy;return orig instanceof Array?copy=new Array(orig.length):orig instanceof Date?copy=new Date(orig.getTime()):orig instanceof Map?(copy=new Map,orig.forEach(((val,key)=>copy.set(key,clone(val))))):orig instanceof RegExp?copy=new RegExp(orig):orig instanceof Set?(copy=new Set,orig.forEach((val=>copy.add(clone(val))))):copy=Object.create(Object.getPrototypeOf(orig)),Object.keys(orig).forEach((name=>copy[name]=clone(orig[name]))),copy}},convertBreaks:{value:function(source){const output=document.createDocumentFragment();let node,para=document.createElement(\"p\");for(;null!==(node=source.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case\"BR\":if(null!==node.nextSibling&&node.nextSibling.nodeType===Node.ELEMENT_NODE&&\"BR\"===node.nextSibling.nodeName.toUpperCase()){source.removeChild(node.nextSibling),source.removeChild(node),output.appendChild(para),para=document.createElement(\"p\");continue}if(!para.hasChildNodes()){source.removeChild(node);continue}break;case\"ADDRESS\":case\"ARTICLE\":case\"ASIDE\":case\"BLOCKQUOTE\":case\"CENTER\":case\"DIV\":case\"DL\":case\"FIGURE\":case\"FOOTER\":case\"FORM\":case\"H1\":case\"H2\":case\"H3\":case\"H4\":case\"H5\":case\"H6\":case\"HEADER\":case\"HR\":case\"MAIN\":case\"NAV\":case\"OL\":case\"P\":case\"PRE\":case\"SECTION\":case\"TABLE\":case\"UL\":para.hasChildNodes()&&(output.appendChild(para),para=document.createElement(\"p\")),output.appendChild(node);continue}para.appendChild(node)}para.hasChildNodes()&&output.appendChild(para),source.appendChild(output)}},safeActiveElement:{value:function(){try{return document.activeElement||null}catch(ex){return null}}},setDisplayTitle:{value:function(title){if(\"string\"!=typeof title)throw new TypeError(`story display title must be a string (received: ${Util.getType(title)})`);const render=document.createDocumentFragment();new Wikifier(render,title);const text=function(source){const copy=source.cloneNode(!0),frag=document.createDocumentFragment();let node;for(;null!==(node=copy.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case\"BR\":case\"DIV\":case\"P\":frag.appendChild(document.createTextNode(\" \"))}frag.appendChild(node)}return frag.textContent}(render).trim();document.title=Config.passages.displayTitles&&\"\"!==State.passage&&State.passage!==Config.passages.start?`${State.passage} | ${text}`:text;const storyTitle=document.getElementById(\"story-title\");null!==storyTitle&&jQuery(storyTitle).empty().append(render)}},setPageElement:{value:function(idOrElement,titles,defaultText){const el=\"object\"==typeof idOrElement?idOrElement:document.getElementById(idOrElement);if(null==el)return null;const ids=Array.isArray(titles)?titles:[titles];jQuery(el).empty();for(let i=0,iend=ids.length;i<iend;++i)if(Story.has(ids[i]))return el.append(Story.get(ids[i]).render()),el;if(null!=defaultText){const text=String(defaultText).trim();\"\"!==text&&new Wikifier(el,text)}return el}},throwError:{value:function(place,message,source,stack){const $wrapper=jQuery(document.createElement(\"div\")),$toggle=jQuery(document.createElement(\"button\")),$source=jQuery(document.createElement(\"pre\")),mesg=`${L10n.get(\"errorTitle\")}: ${message||\"unknown error\"} ${Config.saves.version}`;if($toggle.addClass(\"error-toggle\").ariaClick({label:L10n.get(\"errorToggle\")},(()=>{$toggle.hasClass(\"enabled\")?($toggle.removeClass(\"enabled\"),$source.attr({\"aria-hidden\":!0,hidden:\"hidden\"})):($toggle.addClass(\"enabled\"),$source.removeAttr(\"aria-hidden hidden\"))})).appendTo($wrapper),jQuery(document.createElement(\"span\")).addClass(\"error\").text(mesg).appendTo($wrapper),jQuery(document.createElement(\"code\")).text(source).appendTo($source),$source.addClass(\"error-source\").attr({\"aria-hidden\":!0,hidden:\"hidden\"}).appendTo($wrapper),stack){const lines=stack.split(\"\\n\");for(const ll of lines){const div=document.createElement(\"div\");div.append(ll.replace(/file:.*\\//,\"<path>/\")),$source.append(div)}}return $wrapper.addClass(\"error-view\").appendTo(place),console.warn(`${mesg}\\n\\t${source.replace(/\\n/g,\"\\n\\t\")}`),!1}},stringFrom:{value:function stringFrom(value){switch(typeof value){case\"function\":return\"[function]\";case\"number\":if(Number.isNaN(value))return\"[number NaN]\";break;case\"object\":if(null===value)return\"[null]\";if(value instanceof Array)return value.map((val=>stringFrom(val))).join(\", \");if(value instanceof Set)return Array.from(value).map((val=>stringFrom(val))).join(\", \");if(value instanceof Map)return`{ ${Array.from(value).map((([key,val])=>`${stringFrom(key)} → ${stringFrom(val)}`)).join(\", \")} }`;if(value instanceof Date)return value.toLocaleString();if(value instanceof Element){if(value===document.documentElement||value===document.head||value===document.body)throw new Error(\"illegal operation; attempting to convert the <html>, <head>, or <body> tags to string is not allowed\");return value.outerHTML}return value instanceof Node?value.textContent:\"function\"==typeof value.toString?value.toString():Object.prototype.toString.call(value);case\"symbol\":return`[symbol${void 0!==value.description?` \"${value.description}\"`:\"\"}]`;case\"undefined\":return\"[undefined]\"}return String(value)}}}));(()=>{function onKeypressFn(ev){13!==ev.which&&32!==ev.which||(ev.preventDefault(),jQuery(safeActiveElement()||this).trigger(\"click\"))}function onClickFnWrapper(fn){return function(){const $this=jQuery(this),dataPassage=$this.attr(\"data-passage\"),initialDataPassage=window&&window.SugarCube&&window.SugarCube.State&&window.SugarCube.State.passage,savedYOffset=window.pageYOffset;$this.is(\"[aria-pressed]\")&&$this.attr(\"aria-pressed\",\"true\"===$this.attr(\"aria-pressed\")?\"false\":\"true\"),fn.apply(this,arguments);!dataPassage||window.lastDataPassageLink!==dataPassage&&initialDataPassage!==dataPassage||Config.navigation.rememberYPos&&(!V.options||V.options&&!1!==V.options.scrollRemember)&&window.scrollTo(0,savedYOffset),window.lastDataPassageLink=dataPassage}}jQuery.fn.extend({ariaClick(options,handler){if(0===this.length||0===arguments.length)return this;let opts=options,fn=handler;return null==fn&&(fn=opts,opts=undefined),opts=jQuery.extend({namespace:undefined,one:!1,selector:undefined,data:undefined,role:undefined,controls:undefined,pressed:undefined,label:undefined},opts),\"string\"!=typeof opts.namespace?opts.namespace=\"\":\".\"!==opts.namespace[0]&&(opts.namespace=`.${opts.namespace}`),\"boolean\"==typeof opts.pressed&&(opts.pressed=opts.pressed?\"true\":\"false\"),this.filter(\"button\").prop(\"type\",\"button\"),null!=opts.role?this.attr(\"role\",opts.role):this.not(\"[role]\").filter(\"a,[data-passage]\").attr(\"role\",\"link\").end().not(\"a\").not(\"[data-passage]\").attr(\"role\",\"button\").end().end().end(),this.attr(\"tabindex\",0),null!=opts.controls&&this.attr(\"aria-controls\",opts.controls),null!=opts.pressed&&this.attr(\"aria-pressed\",opts.pressed),null!=opts.label&&this.attr({\"aria-label\":opts.label,title:opts.label}),this.not(\"button\").on(`keypress.aria-clickable${opts.namespace}`,opts.selector,onKeypressFn),this.on(`click.aria-clickable${opts.namespace}`,opts.selector,opts.data,opts.one?function(fn){return onClickFnWrapper((function(){jQuery(this).off(\".aria-clickable\").removeAttr(\"role tabindex aria-controls aria-pressed\").filter(\"button\").prop(\"disabled\",!0),fn.apply(this,arguments)}))}(fn):onClickFnWrapper(fn)),this},ariaDisabled(disable){if(0===this.length||0===arguments.length)return this;const $nonDisableable=this.not(\"button,fieldset,input,menuitem,optgroup,option,select,textarea\"),$disableable=this.filter(\"button,fieldset,input,menuitem,optgroup,option,select,textarea\");return disable?($nonDisableable.each((function(){this.setAttribute(\"disabled\",\"\"),this.setAttribute(\"aria-disabled\",\"true\")})),$disableable.each((function(){this.disabled=!0,this.setAttribute(\"aria-disabled\",\"true\")}))):($nonDisableable.each((function(){this.removeAttribute(\"disabled\"),this.removeAttribute(\"aria-disabled\")})),$disableable.each((function(){this.disabled=!1,this.removeAttribute(\"aria-disabled\")}))),this},ariaIsDisabled(){return this.is(\"[disabled]\")}})})(),jQuery.extend({wikiWithOptions(options,...sources){if(0===sources.length)return;const frag=document.createDocumentFragment();sources.forEach((content=>new Wikifier(frag,content,options)));const errors=[...frag.querySelectorAll(\".error\")].map((errEl=>errEl.textContent.replace(errorPrologRegExp,\"\")));if(errors.length>0)throw new Error(errors.join(\"; \"))},wiki(...sources){this.wikiWithOptions(undefined,...sources)}}),jQuery.fn.extend({wikiWithOptions(options,...sources){if(0===this.length||0===sources.length)return this;const frag=document.createDocumentFragment();return sources.forEach((content=>new Wikifier(frag,content,options))),this.append(frag),this},wiki(...sources){return this.wikiWithOptions(undefined,...sources)}});var Util=(()=>{const utilGetType=(()=>{const toString=Object.prototype.toString;return\"[object Object]\"===toString.call(new Map)?function(O){if(null===O)return\"null\";if(O instanceof Map)return\"Map\";if(O instanceof Set)return\"Set\";const baseType=typeof O;return\"object\"===baseType?toString.call(O).slice(8,-1):baseType}:function(O){if(null===O)return\"null\";const baseType=typeof O;return\"object\"===baseType?toString.call(O).slice(8,-1):baseType}})();function utilToEnum(obj){const pEnum=Object.create(null);if(obj instanceof Array)obj.forEach(((val,i)=>pEnum[String(val)]=i));else if(obj instanceof Set)Array.from(obj).forEach(((val,i)=>pEnum[String(val)]=i));else if(obj instanceof Map)obj.forEach(((val,key)=>pEnum[String(key)]=val));else{if(\"object\"!=typeof obj||null===obj||Object.getPrototypeOf(obj)!==Object.prototype)throw new TypeError(\"Util.toEnum obj parameter must be an Array, Map, Set, or generic object\");Object.assign(pEnum,obj)}return Object.freeze(pEnum)}function utilToStringTag(obj){return Object.prototype.toString.call(obj).slice(8,-1)}const _illegalSlugCharsRe=/[\\x00-\\x20!-/:-@[-^`{-\\x9f]+/g,_isInvalidSlugRe=/^-*$/;const _illegalFilenameCharsRE=/[\\x00-\\x1f\"#$%&'*+,/:;<=>?\\\\^`|\\x7f-\\x9f]+/g;const _markupCharsRe=/[!\"#$&'*\\-/<=>?@[\\\\\\]^_`{|}~]/g,_hasMarkupCharsRe=new RegExp(_markupCharsRe.source),_markupCharsMap=utilToEnum({\"!\":\"&#33;\",'\"':\"&quot;\",\"#\":\"&#35;\",$:\"&#36;\",\"&\":\"&amp;\",\"'\":\"&#39;\",\"*\":\"&#42;\",\"-\":\"&#45;\",\"/\":\"&#47;\",\"<\":\"&lt;\",\"=\":\"&#61;\",\">\":\"&gt;\",\"?\":\"&#63;\",\"@\":\"&#64;\",\"[\":\"&#91;\",\"\\\\\":\"&#92;\",\"]\":\"&#93;\",\"^\":\"&#94;\",_:\"&#95;\",\"`\":\"&#96;\",\"{\":\"&#123;\",\"|\":\"&#124;\",\"}\":\"&#125;\",\"~\":\"&#126;\"});const _htmlCharsRe=/[&<>\"'`]/g,_hasHtmlCharsRe=new RegExp(_htmlCharsRe.source),_htmlCharsMap=utilToEnum({\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\",\"`\":\"&#96;\"});function utilEscape(str){if(null==str)return\"\";const val=String(str);return val&&_hasHtmlCharsRe.test(val)?val.replace(_htmlCharsRe,(ch=>_htmlCharsMap[ch])):val}const _escapedHtmlRe=/&(?:amp|#38|#x26|lt|#60|#x3c|gt|#62|#x3e|quot|#34|#x22|apos|#39|#x27|#96|#x60);/gi,_hasEscapedHtmlRe=new RegExp(_escapedHtmlRe.source,\"i\"),_escapedHtmlMap=utilToEnum({\"&amp;\":\"&\",\"&#38;\":\"&\",\"&#x26;\":\"&\",\"&lt;\":\"<\",\"&#60;\":\"<\",\"&#x3c;\":\"<\",\"&gt;\":\">\",\"&#62;\":\">\",\"&#x3e;\":\">\",\"&quot;\":'\"',\"&#34;\":'\"',\"&#x22;\":'\"',\"&apos;\":\"'\",\"&#39;\":\"'\",\"&#x27;\":\"'\",\"&#96;\":\"`\",\"&#x60;\":\"`\"});function utilUnescape(str){if(null==str)return\"\";const val=String(str);return val&&_hasEscapedHtmlRe.test(val)?val.replace(_escapedHtmlRe,(entity=>_escapedHtmlMap[entity.toLowerCase()])):val}const _nowSource=Has.performance?performance:Date;const _cssTimeRe=/^([+-]?(?:\\d*\\.)?\\d+)([Mm]?[Ss])$/;const utilScrubEventKey=(()=>{let separatorKey,decimalKey;if(\"undefined\"!=typeof Intl&&\"function\"==typeof Intl.NumberFormat){const match=(new Intl.NumberFormat).format(111111.5).match(/(\\D*)\\d+(\\D*)/);match&&(separatorKey=match[1],decimalKey=match[2])}return separatorKey||decimalKey||(separatorKey=\",\",decimalKey=\".\"),function(key){switch(key){case\"Scroll\":return\"ScrollLock\";case\"Spacebar\":return\" \";case\"Left\":return\"ArrowLeft\";case\"Right\":return\"ArrowRight\";case\"Up\":return\"ArrowUp\";case\"Down\":return\"ArrowDown\";case\"Del\":return\"Delete\";case\"Crsel\":return\"CrSel\";case\"Exsel\":return\"ExSel\";case\"Esc\":return\"Escape\";case\"Apps\":return\"ContextMenu\";case\"Nonconvert\":return\"NonConvert\";case\"MediaNextTrack\":return\"MediaTrackNext\";case\"MediaPreviousTrack\":return\"MediaTrackPrevious\";case\"VolumeUp\":return\"AudioVolumeUp\";case\"VolumeDown\":return\"AudioVolumeDown\";case\"VolumeMute\":return\"AudioVolumeMute\";case\"Zoom\":return\"ZoomToggle\";case\"SelectMedia\":case\"MediaSelect\":return\"LaunchMediaPlayer\";case\"Add\":return\"+\";case\"Divide\":return\"/\";case\"Multiply\":return\"*\";case\"Subtract\":return\"-\";case\"Decimal\":return decimalKey;case\"Separator\":return separatorKey}return key}})(),utilHasMediaQuery=\"function\"!=typeof window.matchMedia?function(){return!1}:function(mediaQuery){return window.matchMedia(mediaQuery).matches};return Object.freeze(Object.defineProperties({},{getType:{value:utilGetType},isBoolean:{value:function(obj){return\"boolean\"==typeof obj||\"string\"==typeof obj&&(\"true\"===obj||\"false\"===obj)}},isIterable:{value:function(obj){return null!=obj&&\"function\"==typeof obj[Symbol.iterator]}},isNumeric:{value:function(obj){let num;switch(typeof obj){case\"number\":num=obj;break;case\"string\":num=Number(obj);break;default:return!1}return!Number.isNaN(num)&&Number.isFinite(num)}},sameValueZero:{value:function(a,b){return a===b||a!=a&&b!=b}},toEnum:{value:utilToEnum},toStringTag:{value:utilToStringTag},slugify:{value:function(str){const base=String(str).trim(),_legacy=base.replace(/[^\\w\\s\\u2013\\u2014-]+/g,\"\").replace(/[_\\s\\u2013\\u2014-]+/g,\"-\").toLocaleLowerCase();return _isInvalidSlugRe.test(_legacy)?base.replace(_illegalSlugCharsRe,\"\").replace(/[_\\s\\u2013\\u2014-]+/g,\"-\"):_legacy}},sanitizeFilename:{value:function(str){return String(str).trim().replace(_illegalFilenameCharsRE,\"\")}},escapeMarkup:{value:function(str){if(null==str)return\"\";const val=String(str);return val&&_hasMarkupCharsRe.test(val)?val.replace(_markupCharsRe,(ch=>_markupCharsMap[ch])):val}},escape:{value:utilEscape},unescape:{value:utilUnescape},charAndPosAt:{value:function(text,position){const str=String(text),pos=Math.trunc(position),code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:\"\",start:-1,end:-1};const retval={char:str.charAt(pos),start:pos,end:pos};if(code<55296||code>57343)return retval;if(code>=55296&&code<=56319){const nextPos=pos+1;if(nextPos>=str.length)return retval;const nextCode=str.charCodeAt(nextPos);return nextCode<56320||nextCode>57343||(retval.char=retval.char+str.charAt(nextPos),retval.end=nextPos),retval}if(0===pos)return retval;const prevPos=pos-1,prevCode=str.charCodeAt(prevPos);return prevCode<55296||prevCode>56319||(retval.char=str.charAt(prevPos)+retval.char,retval.start=prevPos),retval}},now:{value:function(){return _nowSource.now()}},fromCssTime:{value:function(cssTime){const match=_cssTimeRe.exec(String(cssTime));if(null===match)throw new SyntaxError(`invalid time value syntax: \"${cssTime}\"`);let msec=Number(match[1]);if(1===match[2].length&&(msec*=1e3),Number.isNaN(msec)||!Number.isFinite(msec))throw new RangeError(`invalid time value: \"${cssTime}\"`);return msec}},toCssTime:{value:function(msec){if(\"number\"!=typeof msec||Number.isNaN(msec)||!Number.isFinite(msec)){let what;switch(typeof msec){case\"string\":what=`\"${msec}\"`;break;case\"number\":what=String(msec);break;default:what=utilToStringTag(msec)}throw new Error(`invalid milliseconds: ${what}`)}return`${msec}ms`}},fromCssProperty:{value:function(cssName){if(!cssName.includes(\"-\"))switch(cssName){case\"bgcolor\":return\"backgroundColor\";case\"float\":return\"cssFloat\";default:return cssName}return(\"-ms-\"===cssName.slice(0,4)?cssName.slice(1):cssName).split(\"-\").map(((part,i)=>0===i?part:part.toUpperFirst())).join(\"\")}},parseUrl:{value:function(url){const el=document.createElement(\"a\"),queryObj=Object.create(null);el.href=url,el.search&&el.search.replace(/^\\?/,\"\").splitOrEmpty(/(?:&(?:amp;)?|;)/).forEach((query=>{const[key,value]=query.split(\"=\");queryObj[key]=value}));const pathname=el.host&&\"/\"!==el.pathname[0]?`/${el.pathname}`:el.pathname;return{href:el.href,protocol:el.protocol,host:el.host,hostname:el.hostname,port:el.port,path:`${pathname}${el.search}`,pathname:pathname,query:el.search,search:el.search,queries:queryObj,searches:queryObj,hash:el.hash}}},newExceptionFrom:{value:function(original,exceptionType,override){if(\"object\"!=typeof original||null===original)throw new Error(\"Util.newExceptionFrom original parameter must be an object\");if(\"function\"!=typeof exceptionType)throw new Error(\"Util.newExceptionFrom exceptionType parameter must be an error type constructor\");const ex=new exceptionType(original.message);void 0!==original.name&&(ex.name=original.name),void 0!==original.code&&(ex.code=original.code),void 0!==original.columnNumber&&(ex.columnNumber=original.columnNumber),void 0!==original.description&&(ex.description=original.description),void 0!==original.fileName&&(ex.fileName=original.fileName),void 0!==original.lineNumber&&(ex.lineNumber=original.lineNumber),void 0!==original.number&&(ex.number=original.number),void 0!==original.stack&&(ex.stack=original.stack);const overrideType=typeof override;if(\"undefined\"!==overrideType)if(\"object\"===overrideType&&null!==override)Object.assign(ex,override);else{if(\"string\"!==overrideType)throw new Error(\"Util.newExceptionFrom override parameter must be an object or string\");ex.message=override}return ex}},scrubEventKey:{value:utilScrubEventKey},hasMediaQuery:{value:utilHasMediaQuery},random:{value:Math.random},entityEncode:{value:utilEscape},entityDecode:{value:utilUnescape},evalExpression:{value:(...args)=>Scripting.evalJavaScript(...args)},evalStatements:{value:(...args)=>Scripting.evalJavaScript(...args)}}))})(),SimpleStore=(()=>{const _adapters=[];let _initialized=null;return Object.freeze(Object.defineProperties({},{adapters:{value:_adapters},create:{value:function(storageId,persistent){if(_initialized)return _initialized.create(storageId,persistent);for(let i=0;i<_adapters.length;++i)if(_adapters[i].init(storageId,persistent))return _initialized=_adapters[i],_initialized.create(storageId,persistent);throw new Error(\"no valid storage adapters found\")}}}))})();SimpleStore.adapters.push((()=>{let _ok=!1;class _WebStorageAdapter{constructor(storageId,persistent){const prefix=`${storageId}.`;let engine=null,name=null;persistent?(engine=window.localStorage,name=\"localStorage\"):(engine=window.sessionStorage,name=\"sessionStorage\"),Object.defineProperties(this,{_engine:{value:engine},_prefix:{value:prefix},_prefixRe:{value:new RegExp(`^${RegExp.escape(prefix)}`)},name:{value:name},id:{value:storageId},persistent:{value:!!persistent}})}get length(){return this.keys().length}size(){return this.keys().length}keys(){const keys=[];for(let i=0;i<this._engine.length;++i){const key=this._engine.key(i);this._prefixRe.test(key)&&keys.push(key.replace(this._prefixRe,\"\"))}return keys}has(key){return!(\"string\"!=typeof key||!key)&&this._engine.hasOwnProperty(this._prefix+key)}get(key){if(\"string\"!=typeof key||!key)return null;const value=this._engine.getItem(this._prefix+key);return null==value?null:_WebStorageAdapter._deserialize(value)}set(key,value){if(\"string\"!=typeof key||!key)return!1;try{this._engine.setItem(this._prefix+key,_WebStorageAdapter._serialize(value))}catch(ex){if(/quota.?(?:exceeded|reached)/i.test(ex.name+ex.message))throw Util.newExceptionFrom(ex,Error,`${this.name} quota exceeded`);throw ex}return!0}delete(key){return!(\"string\"!=typeof key||!key)&&(this._engine.removeItem(this._prefix+key),!0)}clear(){const keys=this.keys();for(let i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}static _serialize(obj){return 1===Config.saves.useLZString?LZString.compressToUTF16(JSON.stringify(obj)):JSON.stringify(obj)}static _deserialize(str){let parsedObj=null;try{parsedObj=JSON.parse(str),-1===Config.saves.useLZString&&(Config.saves.useLZString=0)}catch(ex){parsedObj=JSON.parse(LZString.decompressFromUTF16(str)),-1===Config.saves.useLZString&&(Config.saves.useLZString=1)}return parsedObj}}return Object.freeze(Object.defineProperties({},{init:{value:function(){function hasWebStorage(storeId){try{const store=window[storeId],tid=`_sc_${String(Date.now())}`;store.setItem(tid,tid);const result=store.getItem(tid)===tid;return store.removeItem(tid),result}catch(ex){}return!1}return _ok=hasWebStorage(\"localStorage\")&&hasWebStorage(\"sessionStorage\"),_ok}},create:{value:function(storageId,persistent){if(!_ok)throw new Error(\"adapter not initialized\");return new _WebStorageAdapter(storageId,persistent)}}}))})()),SimpleStore.adapters.push((()=>{const _MAX_EXPIRY=\"Tue, 19 Jan 2038 03:14:07 GMT\",_MIN_EXPIRY=\"Thu, 01 Jan 1970 00:00:00 GMT\";let _ok=!1;class _CookieAdapter{constructor(storageId,persistent){const prefix=`${storageId}${persistent?\"!\":\"*\"}.`;Object.defineProperties(this,{_prefix:{value:prefix},_prefixRe:{value:new RegExp(`^${RegExp.escape(prefix)}`)},name:{value:\"cookie\"},id:{value:storageId},persistent:{value:!!persistent}})}get length(){return this.keys().length}size(){return this.keys().length}keys(){if(\"\"===document.cookie)return[];const cookies=document.cookie.split(/;\\s*/),keys=[];for(let i=0;i<cookies.length;++i){const kvPair=cookies[i].split(\"=\"),key=decodeURIComponent(kvPair[0]);if(this._prefixRe.test(key)){\"\"!==decodeURIComponent(kvPair[1])&&keys.push(key.replace(this._prefixRe,\"\"))}}return keys}has(key){return!(\"string\"!=typeof key||!key)&&null!==_CookieAdapter._getCookie(this._prefix+key)}get(key){if(\"string\"!=typeof key||!key)return null;const value=_CookieAdapter._getCookie(this._prefix+key);return null===value?null:_CookieAdapter._deserialize(value)}set(key,value){if(\"string\"!=typeof key||!key)return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,_CookieAdapter._serialize(value),this.persistent?_MAX_EXPIRY:undefined),!this.has(key))throw new Error(\"unknown validation error during set\")}catch(ex){throw Util.newExceptionFrom(ex,Error,`cookie error: ${ex.message}`)}return!0}delete(key){if(\"string\"!=typeof key||!key||!this.has(key))return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,undefined,_MIN_EXPIRY),this.has(key))throw new Error(\"unknown validation error during delete\")}catch(ex){throw Util.newExceptionFrom(ex,Error,`cookie error: ${ex.message}`)}return!0}clear(){const keys=this.keys();for(let i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}static _getCookie(prefixedKey){if(!prefixedKey||\"\"===document.cookie)return null;const cookies=document.cookie.split(/;\\s*/);for(let i=0;i<cookies.length;++i){const kvPair=cookies[i].split(\"=\");if(prefixedKey===decodeURIComponent(kvPair[0])){return decodeURIComponent(kvPair[1])||null}}return null}static _setCookie(prefixedKey,value,expiry){if(!prefixedKey)return;let payload=`${encodeURIComponent(prefixedKey)}=`;null!=value&&(payload+=encodeURIComponent(value)),null!=expiry&&(payload+=`; expires=${expiry}`),payload+=\"; path=/\",document.cookie=payload}static _serialize(obj){return JSON.stringify(obj)}static _deserialize(str){return JSON.parse(str)}}return Object.freeze(Object.defineProperties({},{init:{value:function(storageId){try{const tid=`_sc_${String(Date.now())}`;_CookieAdapter._setCookie(tid,_CookieAdapter._serialize(tid),undefined),_ok=_CookieAdapter._deserialize(_CookieAdapter._getCookie(tid))===tid,_CookieAdapter._setCookie(tid,undefined,_MIN_EXPIRY)}catch(ex){_ok=!1}return _ok&&function(storageId){if(\"\"===document.cookie)return;const oldPrefix=`${storageId}.`,oldPrefixRe=new RegExp(`^${RegExp.escape(oldPrefix)}`),persistPrefix=`${storageId}!.`,sessionPrefix=`${storageId}*.`,sessionTestRe=/\\.(?:state|rcWarn)$/,cookies=document.cookie.split(/;\\s*/);for(let i=0;i<cookies.length;++i){const kvPair=cookies[i].split(\"=\"),key=decodeURIComponent(kvPair[0]);if(oldPrefixRe.test(key)){const value=decodeURIComponent(kvPair[1]);if(\"\"!==value){const persist=!sessionTestRe.test(key);_CookieAdapter._setCookie(key,undefined,_MIN_EXPIRY),_CookieAdapter._setCookie(key.replace(oldPrefixRe,(()=>persist?persistPrefix:sessionPrefix)),value,persist?_MAX_EXPIRY:undefined)}}}}(storageId),_ok}},create:{value:function(storageId,persistent){if(!_ok)throw new Error(\"adapter not initialized\");return new _CookieAdapter(storageId,persistent)}}}))})());var DebugView=(()=>{class DebugView{constructor(parent,type,name,title){Object.defineProperties(this,{parent:{value:parent},view:{value:document.createElement(\"span\")},break:{value:document.createElement(\"wbr\")}}),jQuery(this.view).attr({title:title,\"aria-label\":title,\"data-type\":null!=type?type:\"\",\"data-name\":null!=name?name:\"\"}).addClass(\"debug\"),jQuery(this.break).addClass(\"debug hidden\"),this.parent.appendChild(this.view),this.parent.appendChild(this.break)}get output(){return this.view}get type(){return this.view.getAttribute(\"data-type\")}set type(type){this.view.setAttribute(\"data-type\",null!=type?type:\"\")}get name(){return this.view.getAttribute(\"data-name\")}set name(name){this.view.setAttribute(\"data-name\",null!=name?name:\"\")}get title(){return this.view.title}set title(title){this.view.title=title}append(el){return jQuery(this.view).append(el),this}modes(options){if(null==options){const current={};return this.view.className.splitOrEmpty(/\\s+/).forEach((name=>{\"debug\"!==name&&(current[name]=!0)})),current}if(\"object\"==typeof options)return Object.keys(options).forEach((function(name){this[options[name]?\"addClass\":\"removeClass\"](name)}),jQuery(this.view)),this;throw new Error(\"DebugView.prototype.modes options parameter must be an object or null/undefined\")}remove(){const $view=jQuery(this.view);this.view.hasChildNodes()&&$view.contents().appendTo(this.parent),$view.remove(),jQuery(this.break).remove()}static isEnabled(){return\"enabled\"===jQuery(document.documentElement).attr(\"data-debug-view\")}static enable(){jQuery(document.documentElement).attr(\"data-debug-view\",\"enabled\"),jQuery.event.trigger(\":debugviewupdate\")}static disable(){jQuery(document.documentElement).removeAttr(\"data-debug-view\"),jQuery.event.trigger(\":debugviewupdate\")}static toggle(){\"enabled\"===jQuery(document.documentElement).attr(\"data-debug-view\")?DebugView.disable():DebugView.enable()}}return DebugView})(),NodeTyper=(()=>{class NodeTyper{constructor(config){if(\"object\"!=typeof config||null===config)throw new Error(`config parameter must be an object (received: ${Util.getType(config)})`);if(!(config.hasOwnProperty(\"targetNode\")&&config.targetNode instanceof Node))throw new Error('config parameter object \"targetNode\" property must be a node');Object.defineProperties(this,{node:{value:config.targetNode},childNodes:{value:[]},nodeValue:{writable:!0,value:\"\"},appendTo:{writable:!0,value:config.parentNode||null},classNames:{writable:!0,value:config.classNames||null},finished:{writable:!0,value:!1}});const node=this.node;let childNode;for(node.nodeValue&&(this.nodeValue=node.nodeValue,node.nodeValue=\"\");null!==(childNode=node.firstChild);)this.childNodes.push(new NodeTyper({targetNode:childNode,parentNode:node,classNames:this.classNames})),node.removeChild(childNode)}finish(){for(;this.type(!0););return!1}type(flush){if(this.finished)return!1;if(this.appendTo){if(this.appendTo.appendChild(this.node),this.appendTo=null,this.node.nodeType!==Node.ELEMENT_NODE&&this.node.nodeType!==Node.TEXT_NODE||\"none\"===jQuery(this.node.parentNode).css(\"display\"))return this.finish();this.node.parentNode&&this.classNames&&jQuery(this.node.parentNode).addClass(this.classNames)}if(this.nodeValue){if(flush)this.node.nodeValue+=this.nodeValue,this.nodeValue=\"\";else{const{char:char,start:start,end:end}=Util.charAndPosAt(this.nodeValue,0);this.node.nodeValue+=char,this.nodeValue=this.nodeValue.slice(1+end-start)}return!0}this.classNames&&(jQuery(this.node.parentNode).removeClass(this.classNames),this.classNames=null);const childNodes=this.childNodes;for(;childNodes.length>0;){if(childNodes[0].type())return!0;childNodes.shift()}return this.finished=!0,!1}}return NodeTyper})(),PRNGWrapper=(()=>{class PRNGWrapper{constructor(seed,options){const seeder=new Math.seedrandom(seed,{state:!1},((_,seed)=>({seed:seed}))),prngObj=new Math.seedrandom(seeder.seed,options);Object.defineProperties(this,{_prng:{value:prngObj},seed:{writable:!0,value:seeder.seed},pull:{writable:!0,value:0},state:{value:prngObj.state},random:{value(){return++this.pull,this._prng()}}})}static marshal(prng){if(!prng||!prng.hasOwnProperty(\"state\"))throw new Error(\"PRNG is missing required data\");return{prng:prng.state(),seed:prng.seed,pull:prng.pull}}static unmarshal(prngObj){if(!prngObj||!prngObj.hasOwnProperty(\"state\"))throw new Error(\"PRNG object is missing required state data\");const prng=new PRNGWrapper(prngObj.seed,{state:prngObj.state});return prng.pull=prngObj.pull,prng}}return PRNGWrapper})(),StyleWrapper=(()=>{const _imageMarkupRe=new RegExp(Patterns.cssImage,\"g\"),_hasImageMarkupRe=new RegExp(Patterns.cssImage);return class{constructor(style){if(null==style)throw new TypeError(\"StyleWrapper style parameter must be an HTMLStyleElement object\");Object.defineProperties(this,{style:{value:style}})}isEmpty(){return 0===this.style.cssRules.length}set(rawCss){this.clear(),this.add(rawCss)}add(rawCss){let css=rawCss;_hasImageMarkupRe.test(css)&&(_imageMarkupRe.lastIndex=0,css=css.replace(_imageMarkupRe,(wikiImage=>{const markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty(\"error\")||markup.pos<wikiImage.length)return wikiImage;let source=markup.source;if(\"data:\"!==source.slice(0,5)&&Story.has(source)){const passage=Story.get(source);passage.tags.includes(\"Twine.image\")&&(source=passage.text.trim())}return`url(\"${source.replace(/\"/g,\"%22\")}\")`}))),this.style.styleSheet?this.style.styleSheet.cssText+=css:this.style.appendChild(document.createTextNode(css))}clear(){this.style.styleSheet?this.style.styleSheet.cssText=\"\":jQuery(this.style).empty()}}})();function enumFrom(O){const pEnum=Object.create(null);if(O instanceof Array)O.forEach(((val,i)=>pEnum[String(val)]=i));else if(O instanceof Set)Array.from(O).forEach(((val,i)=>pEnum[String(val)]=i));else if(O instanceof Map)O.forEach(((val,key)=>pEnum[String(key)]=val));else{if(null===O||\"object\"!=typeof O||Object.getPrototypeOf(O)!==Object.prototype)throw new TypeError(\"enumFrom object parameter must be an Array, Map, Set, or generic object\");Object.assign(pEnum,O)}return Object.freeze(Object.defineProperties(pEnum,{nameFrom:{value(needle){const entry=Object.entries(this).find((entry=>entry[1]===needle));return entry?entry[0]:undefined}}}))}var Diff=(()=>{const Op=enumFrom({Delete:0,SpliceArray:1,Copy:2,CopyDate:3});function isNumeric(O){let num;switch(typeof O){case\"number\":num=O;break;case\"string\":num=Number(O);break;default:return!1}return!Number.isNaN(num)&&Number.isFinite(num)}return Object.preventExtensions(Object.create(null,{Op:{value:Op},diff:{value:function diff(a,b){const toString=Object.prototype.toString,aIsArray=a instanceof Array,delta=Object.create(null),keys=[...Object.keys(a),...Object.keys(b)].sort().filter(((val,i,arr)=>0===i||arr[i-1]!==val));let aOpKey;const isAOpKey=key=>key===aOpKey;for(let i=0,klen=keys.length;i<klen;++i){const key=keys[i],aVal=a[key],bVal=b[key];if(Object.hasOwn(a,key))if(Object.hasOwn(b,key)){if(aVal===bVal)continue;if(typeof aVal==typeof bVal)if(\"function\"==typeof aVal)aVal.toString()!==bVal.toString()&&(delta[key]=[Op.Copy,bVal]);else if(\"object\"!=typeof aVal||null===aVal)delta[key]=[Op.Copy,bVal];else{const aValType=toString.call(aVal);if(aValType===toString.call(bVal))if(aVal instanceof Date)aVal.getTime()!==bVal.getTime()&&(delta[key]=[Op.Copy,clone(bVal)]);else if(aVal instanceof Map)delta[key]=[Op.Copy,clone(bVal)];else if(aVal instanceof RegExp)aVal.toString()!==bVal.toString()&&(delta[key]=[Op.Copy,clone(bVal)]);else if(aVal instanceof Set)delta[key]=[Op.Copy,clone(bVal)];else if(aVal instanceof Array||\"[object Object]\"===aValType){const subDelta=diff(aVal,bVal);null!==subDelta&&(delta[key]=subDelta)}else delta[key]=[Op.Copy,clone(bVal)];else delta[key]=[Op.Copy,clone(bVal)]}else delta[key]=[Op.Copy,\"object\"!=typeof bVal||null===bVal?bVal:clone(bVal)]}else if(aIsArray&&isNumeric(key)){const index=Number(key);if(!aOpKey){aOpKey=\"\";do{aOpKey+=\"~\"}while(keys.some(isAOpKey));delta[aOpKey]=[Op.SpliceArray,index,index]}index<delta[aOpKey][1]&&(delta[aOpKey][1]=index),index>delta[aOpKey][2]&&(delta[aOpKey][2]=index)}else delta[key]=Op.Delete;else delta[key]=[Op.Copy,\"object\"!=typeof bVal||null===bVal?bVal:clone(bVal)]}return Object.keys(delta).length>0?delta:null}},patch:{value:function patch(orig,delta){const keys=delta?Object.keys(delta):[],patched=clone(orig);for(let i=0,klen=keys.length;i<klen;++i){const key=keys[i],value=delta[key];if(value===Op.Delete)delete patched[key];else if(value instanceof Array)switch(value[0]){case Op.SpliceArray:patched.splice(value[1],value[2]-value[1]+1);break;case Op.Copy:patched[key]=clone(value[1]);break;case Op.CopyDate:patched[key]=new Date(value[1])}else patched[key]=patch(patched[key],value)}return patched}}}))})(),L10n=(()=>{const _patternRe=/\\{\\w+\\}/g,_hasPatternRe=new RegExp(_patternRe.source);return Object.freeze(Object.defineProperties({},{init:{value:function(){strings&&Object.keys(strings).length>0&&Object.keys(l10nStrings).forEach((id=>{try{let value;switch(id){case\"identity\":value=strings.identity;break;case\"aborting\":value=strings.aborting;break;case\"cancel\":value=strings.cancel;break;case\"close\":value=strings.close;break;case\"ok\":value=strings.ok;break;case\"errorTitle\":value=strings.errors.title;break;case\"errorNonexistentPassage\":value=strings.errors.nonexistentPassage;break;case\"errorSaveMissingData\":value=strings.errors.saveMissingData;break;case\"errorSaveIdMismatch\":value=strings.errors.saveIdMismatch;break;case\"warningDegraded\":value=strings.warnings.degraded;break;case\"debugViewTitle\":value=strings.debugView.title;break;case\"debugViewToggle\":value=strings.debugView.toggle;break;case\"uiBarToggle\":value=strings.uiBar.toggle;break;case\"uiBarBackward\":value=strings.uiBar.backward;break;case\"uiBarForward\":value=strings.uiBar.forward;break;case\"uiBarJumpto\":value=strings.uiBar.jumpto;break;case\"jumptoTitle\":value=strings.jumpto.title;break;case\"jumptoTurn\":value=strings.jumpto.turn;break;case\"jumptoUnavailable\":value=strings.jumpto.unavailable;break;case\"savesTitle\":value=strings.saves.title;break;case\"savesDisallowed\":value=strings.saves.disallowed;break;case\"savesIncapable\":value=strings.saves.incapable;break;case\"savesLabelAuto\":value=strings.saves.labelAuto;break;case\"savesLabelDelete\":value=strings.saves.labelDelete;break;case\"savesLabelExport\":value=strings.saves.labelExport;break;case\"savesLabelImport\":value=strings.saves.labelImport;break;case\"savesLabelLoad\":value=strings.saves.labelLoad;break;case\"savesLabelClear\":value=strings.saves.labelClear;break;case\"savesLabelSave\":value=strings.saves.labelSave;break;case\"savesLabelSlot\":value=strings.saves.labelSlot;break;case\"savesUnavailable\":value=strings.saves.unavailable;break;case\"savesUnknownDate\":value=strings.saves.unknownDate;break;case\"settingsTitle\":value=strings.settings.title;break;case\"settingsOff\":value=strings.settings.off;break;case\"settingsOn\":value=strings.settings.on;break;case\"settingsReset\":value=strings.settings.reset;break;case\"restartTitle\":value=strings.restart.title;break;case\"restartPrompt\":value=strings.restart.prompt;break;case\"shareTitle\":value=strings.share.title;break;case\"alertTitle\":break;case\"autoloadTitle\":value=strings.autoload.title;break;case\"autoloadCancel\":value=strings.autoload.cancel;break;case\"autoloadOk\":value=strings.autoload.ok;break;case\"autoloadPrompt\":value=strings.autoload.prompt;break;case\"macroBackText\":value=strings.macros.back.text;break;case\"macroReturnText\":value=strings.macros.return.text}value&&(l10nStrings[id]=value.replace(/%\\w+%/g,(pat=>`{${pat.slice(1,-1)}}`)))}catch(ex){}}))}},get:{value:function(ids,overrides){if(!ids)return\"\";const id=(idList=>{let selectedId;return idList.some((id=>!!l10nStrings.hasOwnProperty(id)&&(selectedId=id,!0))),selectedId})(Array.isArray(ids)?ids:[ids]);if(!id)return\"\";let processed=l10nStrings[id],iteration=0;for(;_hasPatternRe.test(processed);){if(++iteration>50)throw new Error(\"L10n.get exceeded maximum replacement iterations, probable infinite loop\");_patternRe.lastIndex=0,processed=processed.replace(_patternRe,(pat=>{const subId=pat.slice(1,-1);return overrides&&overrides.hasOwnProperty(subId)?overrides[subId]:l10nStrings.hasOwnProperty(subId)?l10nStrings[subId]:void 0}))}return processed}}}))})(),strings={errors:{},warnings:{},debugView:{},uiBar:{},jumpto:{},saves:{},settings:{},restart:{},share:{},autoload:{},macros:{back:{},return:{}}},l10nStrings={identity:\"game\",aborting:\"Aborting\",cancel:\"Cancel\",close:\"Close\",ok:\"OK\",errorTitle:\"Error\",errorToggle:\"Toggle the error view\",errorNonexistentPassage:'the passage \"{passage}\" does not exist',errorSaveDiskLoadFailed:\"failed to load save file from disk\",errorSaveMissingData:\"save is missing required data. Either the loaded file is not a save or the save has become corrupted\",errorSaveIdMismatch:\"save is from the wrong {identity}\",_warningIntroLacking:\"Your browser either lacks or has disabled\",_warningOutroDegraded:\", so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.\",warningNoWebStorage:\"{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}\",warningDegraded:\"{_warningIntroLacking} some of the capabilities required by this {identity}{_warningOutroDegraded}\",debugBarToggle:\"Toggle the debug bar\",debugBarNoWatches:\"— no watches set —\",debugBarAddWatch:\"Add watch\",debugBarDeleteWatch:\"Delete watch\",debugBarWatchAll:\"Watch all\",debugBarWatchNone:\"Delete all\",debugBarLabelAdd:\"Add\",debugBarLabelWatch:\"Watch\",debugBarLabelTurn:\"Turn\",debugBarLabelViews:\"Views\",debugBarViewsToggle:\"Toggle the debug views\",debugBarWatchToggle:\"Toggle the watch panel\",uiBarToggle:\"Toggle the UI bar\",uiBarBackward:\"Go backward within the {identity} history\",uiBarForward:\"Go forward within the {identity} history\",uiBarJumpto:\"Jump to a specific point within the {identity} history\",jumptoTitle:\"Jump To\",jumptoTurn:\"Turn\",jumptoUnavailable:\"No jump points currently available…\",savesTitle:\"Saves\",savesDisallowed:\"Saving has been disallowed on this passage.\",savesIncapable:\"{_warningIntroLacking} the capabilities required to support saves, so saves have been disabled for this session.\",savesLabelAuto:\"Autosave\",savesLabelDelete:\"Delete\",savesLabelExport:\"Save to Disk…\",savesLabelImport:\"Load from Disk…\",savesLabelLoad:\"Load\",savesLabelClear:\"Delete All\",savesLabelSave:\"Save\",savesLabelSlot:\"Slot\",savesUnavailable:\"No save slots found…\",savesUnknownDate:\"unknown\",savesDisallowedReplay:\"The scene viewer is currently in use, preventing the use of the save system.\",savesExportReminder:\"Saves here will be lost if your browser cache is cleared. Exporting is recommended to prevent the loss of saves from occurring.\",savesHeaderSaveLoad:\"Save/Load\",savesHeaderIDName:\"ID/Name\",savesHeaderDetails:\"Details\",savesDescTitle:\"Title: \",savesDescName:\"Save Name: \",savesDescId:\"Save Id: \",savesDescDate:\", Date: \",savesPagerJump:\" Jump to most recent manual save \",savesPagerPage:\"Page: \",savesPagerSavesPerPage:\" Saves per page: \",savesOptionsConfirmOn:\" Require confirmation on: \",savesOptionsUseLegacy:\" Use old legacy save storage: \",savesWarningSaveOnSlot:\"Save on slot \",savesWarningOverwriteSlot:\"Overwrite save in slot \",savesWarningOverwriteID:\"Save ID does not match, continue with overwrite?\",savesWarningDeleteInSlot:\"Delete save in slot \",savesWarningLoad:\"Load slot \",savesWarningDeleteAll:\"WARNING - DO YOU REALLY WANT TO DELETE ALL SAVES?\",settingsTitle:\"Settings\",settingsOff:\"Off\",settingsOn:\"On\",settingsReset:\"Reset to Defaults\",restartTitle:\"Restart\",restartPrompt:\"Are you sure that you want to restart? Unsaved progress will be lost.\",shareTitle:\"Share\",alertTitle:\"Alert\",autoloadTitle:\"Autoload\",autoloadCancel:\"Go to start\",autoloadOk:\"Load autosave\",autoloadPrompt:\"An autosave exists. Load it now or go to the start?\",macroBackText:\"Back\",macroReturnText:\"Return\"},Config=(()=>{let _navigationOverride,_navigationRememberYPos,_passagesDescriptions,_passagesStart,_passagesOnProcess,_passagesTransitionOut,_savesAutoload,_savesAutosave,_savesIsAllowed,_savesVersion,_debug=!1,_addVisitedLinkClass=!1,_cleanupWikifierOutput=!1,_loadDelay=0,_audioPauseOnFadeToZero=!0,_audioPreloadMetadata=!0,_historyControls=!0,_historyMaxStates=40,_sessionMaxStates=40,_expiredMaxStates=100,_macrosIfAssignmentError=!0,_macrosMaxLoopIterations=1e3,_macrosTypeSkipKey=\" \",_macrosTypeVisitedPassages=!0,_passagesDisplayTitles=!1,_passagesNobr=!1,_savesId=\"untitled-story\",_savesSlots=8,_savesTryDiskOnMobile=!0,_savesUseLZString=-1,_uiStowBarInitially=800,_uiUpdateStoryElements=!0;const _errHistoryModeDeprecated=\"Config.history.mode has been deprecated and is no longer used by SugarCube, please remove it from your code\";return Object.freeze({get debug(){return _debug},set debug(value){_debug=Boolean(value)},get addVisitedLinkClass(){return _addVisitedLinkClass},set addVisitedLinkClass(value){_addVisitedLinkClass=Boolean(value)},get cleanupWikifierOutput(){return _cleanupWikifierOutput},set cleanupWikifierOutput(value){_cleanupWikifierOutput=Boolean(value)},get loadDelay(){return _loadDelay},set loadDelay(value){if(!Number.isSafeInteger(value)||value<0)throw new RangeError(\"Config.loadDelay must be a non-negative integer\");_loadDelay=value},audio:Object.freeze({get pauseOnFadeToZero(){return _audioPauseOnFadeToZero},set pauseOnFadeToZero(value){_audioPauseOnFadeToZero=Boolean(value)},get preloadMetadata(){return _audioPreloadMetadata},set preloadMetadata(value){_audioPreloadMetadata=Boolean(value)}}),history:Object.freeze({get controls(){return _historyControls},set controls(value){const controls=Boolean(value);if(1===_historyMaxStates&&controls)throw new Error(\"Config.history.controls must be false when Config.history.maxStates is 1\");_historyControls=controls},get maxStates(){return _historyMaxStates},set maxStates(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError(\"Config.history.maxStates must be a positive integer\");_historyMaxStates=value,_historyControls&&1===value&&(_historyControls=!1)},get maxSessionStates(){return _sessionMaxStates},set maxSessionStates(value){if(!Number.isSafeInteger(value)||value<0)throw new RangeError(\"Config.history.maxSessionStates must be a non-negative integer\");_sessionMaxStates=value},get maxExpired(){return _expiredMaxStates},set maxExpired(value){_expiredMaxStates=value},get mode(){throw new Error(_errHistoryModeDeprecated)},set mode(_){throw new Error(_errHistoryModeDeprecated)},get tracking(){throw new Error(\"Config.history.tracking has been deprecated, use Config.history.maxStates instead\")},set tracking(_){throw new Error(\"Config.history.tracking has been deprecated, use Config.history.maxStates instead\")}}),macros:Object.freeze({get ifAssignmentError(){return _macrosIfAssignmentError},set ifAssignmentError(value){_macrosIfAssignmentError=Boolean(value)},get maxLoopIterations(){return _macrosMaxLoopIterations},set maxLoopIterations(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError(\"Config.macros.maxLoopIterations must be a positive integer\");_macrosMaxLoopIterations=value},get typeSkipKey(){return _macrosTypeSkipKey},set typeSkipKey(value){_macrosTypeSkipKey=String(value)},get typeVisitedPassages(){return _macrosTypeVisitedPassages},set typeVisitedPassages(value){_macrosTypeVisitedPassages=Boolean(value)}}),navigation:Object.freeze({get override(){return _navigationOverride},set override(value){if(!(null==value||value instanceof Function))throw new TypeError(`Config.navigation.override must be a function or null/undefined (received: ${Util.getType(value)})`);_navigationOverride=value},get rememberYPos(){return _navigationRememberYPos},set rememberYPos(value){_navigationRememberYPos=value}}),passages:Object.freeze({get descriptions(){return _passagesDescriptions},set descriptions(value){if(null!=value){const valueType=Util.getType(value);if(\"boolean\"!==valueType&&\"Object\"!==valueType&&\"function\"!==valueType)throw new TypeError(`Config.passages.descriptions must be a boolean, object, function, or null/undefined (received: ${valueType})`)}_passagesDescriptions=value},get displayTitles(){return _passagesDisplayTitles},set displayTitles(value){_passagesDisplayTitles=Boolean(value)},get nobr(){return _passagesNobr},set nobr(value){_passagesNobr=Boolean(value)},get onProcess(){return _passagesOnProcess},set onProcess(value){if(null!=value){const valueType=Util.getType(value);if(\"function\"!==valueType)throw new TypeError(`Config.passages.onProcess must be a function or null/undefined (received: ${valueType})`)}_passagesOnProcess=value},get start(){return _passagesStart},set start(value){if(null!=value){const valueType=Util.getType(value);if(\"string\"!==valueType)throw new TypeError(`Config.passages.start must be a string or null/undefined (received: ${valueType})`)}_passagesStart=value},get transitionOut(){return _passagesTransitionOut},set transitionOut(value){if(null!=value){const valueType=Util.getType(value);if(\"string\"!==valueType&&(\"number\"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError(`Config.passages.transitionOut must be a string, non-negative integer, or null/undefined (received: ${valueType})`)}_passagesTransitionOut=value}}),saves:Object.freeze({get autoload(){return _savesAutoload},set autoload(value){if(null!=value){const valueType=Util.getType(value);if(\"boolean\"!==valueType&&\"string\"!==valueType&&\"function\"!==valueType)throw new TypeError(`Config.saves.autoload must be a boolean, string, function, or null/undefined (received: ${valueType})`)}_savesAutoload=value},get autosave(){return _savesAutosave},set autosave(value){if(null!=value){const valueType=Util.getType(value);if(\"string\"===valueType)return void(_savesAutosave=[value]);if(\"boolean\"!==valueType&&(\"Array\"!==valueType||!value.every((item=>\"string\"==typeof item)))&&\"function\"!==valueType)throw new TypeError(`Config.saves.autosave must be a boolean, Array<string>, function, or null/undefined (received: ${valueType}${\"Array\"===valueType?\"<any>\":\"\"})`)}_savesAutosave=value},get id(){return _savesId},set id(value){if(\"string\"!=typeof value||\"\"===value)throw new TypeError(`Config.saves.id must be a non-empty string (received: ${Util.getType(value)})`);_savesId=value},get isAllowed(){return _savesIsAllowed},set isAllowed(value){if(!(null==value||value instanceof Function))throw new TypeError(`Config.saves.isAllowed must be a function or null/undefined (received: ${Util.getType(value)})`);_savesIsAllowed=value},get slots(){return _savesSlots},set slots(value){if(!Number.isSafeInteger(value)||value<0)throw new TypeError(`Config.saves.slots must be a non-negative integer (received: ${Util.getType(value)})`);_savesSlots=value},get tryDiskOnMobile(){return _savesTryDiskOnMobile},set tryDiskOnMobile(value){_savesTryDiskOnMobile=Boolean(value)},get version(){return _savesVersion},set version(value){_savesVersion=value},get useLZString(){return _savesUseLZString},set useLZString(value){return _savesUseLZString=value},get onLoad(){throw new Error(\"Config.saves.onLoad has been deprecated, use the Save.onLoad API instead\")},set onLoad(value){console.warn(\"Config.saves.onLoad has been deprecated, use the Save.onLoad API instead\"),Save.onLoad.add(value)},get onSave(){throw new Error(\"Config.saves.onSave has been deprecated, use the Save.onSave API instead\")},set onSave(value){console.warn(\"Config.saves.onSave has been deprecated, use the Save.onSave API instead\"),Save.onSave.add(value)}}),ui:Object.freeze({get stowBarInitially(){return _uiStowBarInitially},set stowBarInitially(value){const valueType=Util.getType(value);if(\"boolean\"!==valueType&&(\"number\"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError(`Config.ui.stowBarInitially must be a boolean or non-negative integer (received: ${valueType})`);_uiStowBarInitially=value},get updateStoryElements(){return _uiUpdateStoryElements},set updateStoryElements(value){_uiUpdateStoryElements=Boolean(value)}})})})(),SimpleAudio=(()=>{const _gestureEventNames=Object.freeze([\"click\",\"contextmenu\",\"dblclick\",\"keyup\",\"mouseup\",\"pointerup\",\"touchend\"]),_specialIds=Object.freeze([\":not\",\":all\",\":looped\",\":muted\",\":paused\",\":playing\"]),_formatSpecRe=/^([\\w-]+)\\s*\\|\\s*(\\S.*)$/,_badIdRe=/[:\\s]/,_tracks=new Map,_groups=new Map,_lists=new Map,_subscribers=new Map;let _masterRate=1,_masterVolume=1,_masterMute=!1,_masterMuteOnHidden=!1;const _playReturnsPromise=function(){let _hasPromise=null;return function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,Has.audio)try{const audio=document.createElement(\"audio\");audio.muted=!0;const value=audio.play();value.catch((()=>{})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise}}();class AudioTrack{constructor(obj){if(obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioTrack))throw new Error(\"sources parameter must be either an array, of URIs or source objects, or an AudioTrack instance\");this._copy(obj)}}_create(sourceList){const dataUriRe=/^data:\\s*audio\\/(?:x-)?([^;,]+)\\s*[;,]/i,extRe=/\\.([^./\\\\]+)$/,formats=AudioTrack.formats,usedSources=[],audio=document.createElement(\"audio\");audio.preload=\"none\",sourceList.forEach((src=>{let srcUri=null;switch(typeof src){case\"string\":{let match;if(\"data:\"===src.slice(0,5)){if(match=dataUriRe.exec(src),null===match)throw new Error(\"source data URI missing media type\")}else if(match=extRe.exec(Util.parseUrl(src).pathname),null===match)throw new Error(\"source URL missing file extension\");formats[match[1]]&&(srcUri=src)}break;case\"object\":if(null===src)throw new Error(\"source object cannot be null\");if(!src.hasOwnProperty(\"src\"))throw new Error('source object missing required \"src\" property');if(!src.hasOwnProperty(\"format\"))throw new Error('source object missing required \"format\" property');formats[src.format]&&(srcUri=src.src);break;default:throw new Error(`invalid source value (type: ${typeof src})`)}if(null!==srcUri){const source=document.createElement(\"source\");source.src=srcUri,audio.appendChild(source),usedSources.push(srcUri)}})),audio.hasChildNodes()&&Config.audio.preloadMetadata&&(audio.preload=\"metadata\"),this._finalize(audio,usedSources,clone(sourceList))}_copy(obj){this._finalize(obj.audio.cloneNode(!0),clone(obj.sources),clone(obj.originals))}_finalize(audio,sources,originals){Object.defineProperties(this,{audio:{configurable:!0,value:audio},sources:{value:Object.freeze(sources)},originals:{value:Object.freeze(originals)},_error:{writable:!0,value:!1},_faderId:{writable:!0,value:null},_mute:{writable:!0,value:!1},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1}}),jQuery(this.audio).on(\"loadstart.AudioTrack\",(()=>this._error=!1)).on(\"error.AudioTrack\",(()=>this._error=!0)).find(\"source:last-of-type\").on(\"error.AudioTrack\",(()=>this._trigger(\"error\"))),function(id,callback){if(\"function\"!=typeof callback)throw new Error(\"callback parameter must be a function\");_subscribers.set(id,callback)}(this,(mesg=>{if(this.audio)switch(mesg){case\"loadwithscreen\":if(this.hasSource()){const lockId=LoadScreen.lock();this.one(\"canplaythrough.AudioTrack_loadwithscreen error.AudioTrack_loadwithscreen\",(function(){jQuery(this).off(\".AudioTrack_loadwithscreen\"),LoadScreen.unlock(lockId)})).load()}break;case\"load\":this.load();break;case\"mute\":this._updateAudioMute();break;case\"rate\":this._updateAudioRate();break;case\"stop\":this.stop();break;case\"volume\":this._updateAudioVolume();break;case\"unload\":this.unload()}else unsubscribe(this)})),this._updateAudioMute(),this._updateAudioRate(),this._updateAudioVolume()}_trigger(eventName){jQuery(this.audio).triggerHandler(eventName)}_destroy(){unsubscribe(this),this.audio&&(jQuery(this.audio).off(),this.unload(),this._error=!0,delete this.audio)}clone(){return new AudioTrack(this)}load(){if(this.fadeStop(),this.audio.pause(),!this.audio.hasChildNodes()){if(0===this.sources.length)return;this.sources.forEach((srcUri=>{const source=document.createElement(\"source\");source.src=srcUri,this.audio.appendChild(source)}))}\"auto\"!==this.audio.preload&&(this.audio.preload=\"auto\"),this.isLoading()||this.audio.load()}unload(){this.fadeStop(),this.stop();const audio=this.audio;for(audio.preload=\"none\";audio.hasChildNodes();)audio.removeChild(audio.firstChild);audio.load()}play(){if(!this.hasSource())return Promise.reject(new Error(\"none of the candidate sources were acceptable\"));if(this.isUnloaded())return Promise.reject(new Error(\"no sources are loaded\"));if(this.isFailed())return Promise.reject(new Error(\"failed to load any of the sources\"));\"auto\"!==this.audio.preload&&(this.audio.preload=\"auto\");const namespace=\".AudioTrack_play\";return _playReturnsPromise()?this.audio.play():new Promise(((resolve,reject)=>{this.isPlaying()?resolve():(jQuery(this.audio).off(namespace).one(`error${namespace} playing${namespace} timeupdate${namespace}`,(ev=>{jQuery(this).off(namespace),\"error\"===ev.type?reject(new Error(\"unknown audio play error\")):resolve()})),this.audio.play())}))}playWhenAllowed(){this.play().catch((()=>{const gestures=_gestureEventNames.map((name=>`${name}.AudioTrack_playWhenAllowed`)).join(\" \");jQuery(document).one(gestures,(()=>{jQuery(document).off(\".AudioTrack_playWhenAllowed\"),this.audio.play()}))}))}pause(){this.audio.pause()}stop(){this.audio.pause(),this.time(0),this._trigger(\":stopped\")}fade(duration,toVol,fromVol){if(\"number\"!=typeof duration)throw new TypeError(\"duration parameter must be a number\");if(\"number\"!=typeof toVol)throw new TypeError(\"toVolume parameter must be a number\");if(null!=fromVol&&\"number\"!=typeof fromVol)throw new TypeError(\"fromVolume parameter must be a number\");if(!this.hasSource())return Promise.reject(new Error(\"none of the candidate sources were acceptable\"));if(this.isUnloaded())return Promise.reject(new Error(\"no sources are loaded\"));if(this.isFailed())return Promise.reject(new Error(\"failed to load any of the sources\"));this.fadeStop();const from=Math.clamp(null==fromVol?this.volume():fromVol,0,1),to=Math.clamp(toVol,0,1);return from!==to?(this.volume(from),jQuery(this.audio).off(\"timeupdate.AudioTrack_fade\").one(\"timeupdate.AudioTrack_fade\",(()=>{let min,max;from<to?(min=from,max=to):(min=to,max=from);const time=Math.max(duration,1),delta=(to-from)/(time/.025);this._trigger(\":fading\"),this._faderId=setInterval((()=>{this.isPlaying()?(this.volume(Math.clamp(this.volume()+delta,min,max)),Config.audio.pauseOnFadeToZero&&0===this.volume()&&this.pause(),this.volume()===to&&(this.fadeStop(),this._trigger(\":faded\"))):this.fadeStop()}),25)})),this.play()):void 0}fadeIn(duration,fromVol){return this.fade(duration,1,fromVol)}fadeOut(duration,fromVol){return this.fade(duration,0,fromVol)}fadeStop(){null!==this._faderId&&(clearInterval(this._faderId),this._faderId=null)}loop(loop){return null==loop?this.audio.loop:(this.audio.loop=!!loop,this)}mute(mute){return null==mute?this._mute:(this._mute=!!mute,this._updateAudioMute(),this)}_updateAudioMute(){this.audio.muted=this._mute||_masterMute}rate(rate){if(null==rate)return this._rate;if(\"number\"!=typeof rate)throw new TypeError(\"rate parameter must be a number\");return this._rate=Math.clamp(rate,.2,5),this._updateAudioRate(),this}_updateAudioRate(){this.audio.playbackRate=Math.clamp(this._rate*_masterRate,.2,5)}time(time){if(null==time)return this.audio.currentTime;if(\"number\"!=typeof time)throw new TypeError(\"time parameter must be a number\");return this.hasMetadata()?this.audio.currentTime=time:jQuery(this.audio).off(\"loadedmetadata.AudioTrack_time\").one(\"loadedmetadata.AudioTrack_time\",(()=>this.audio.currentTime=time)),this}volume(volume){if(null==volume)return this._volume;if(\"number\"!=typeof volume)throw new TypeError(\"volume parameter must be a number\");return this._volume=Math.clamp(volume,0,1),this._updateAudioVolume(),this}_updateAudioVolume(){this.audio.volume=Math.clamp(this._volume*_masterVolume,0,1)}duration(){return this.audio.duration}remaining(){return this.audio.duration-this.audio.currentTime}isFailed(){return this._error}isLoading(){return this.audio.networkState===HTMLMediaElement.NETWORK_LOADING}isUnloaded(){return!this.audio.hasChildNodes()}isUnavailable(){return!this.hasSource()||this.isUnloaded()||this.isFailed()}isPlaying(){return!this.audio.paused&&this.hasSomeData()}isPaused(){return this.audio.paused&&(this.audio.duration===1/0||this.audio.currentTime>0)&&!this.audio.ended}isStopped(){return this.audio.paused&&0===this.audio.currentTime}isEnded(){return this.audio.ended}isFading(){return null!==this._faderId}isSeeking(){return this.audio.seeking}hasSource(){return this.sources.length>0}hasNoData(){return this.audio.readyState===HTMLMediaElement.HAVE_NOTHING}hasMetadata(){return this.audio.readyState>=HTMLMediaElement.HAVE_METADATA}hasSomeData(){return this.audio.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA}hasData(){return this.audio.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA}on(...args){return jQuery.fn.on.apply(jQuery(this.audio),args),this}one(...args){return jQuery.fn.one.apply(jQuery(this.audio),args),this}off(...args){return jQuery.fn.off.apply(jQuery(this.audio),args),this}}Object.defineProperties(AudioTrack,{formats:{value:(()=>{const audio=document.createElement(\"audio\"),types=new Map;function canPlay(mimeType){return types.has(mimeType)||types.set(mimeType,\"\"!==audio.canPlayType(mimeType).replace(/^no$/i,\"\")),types.get(mimeType)}return Object.assign(Object.create(null),{aac:canPlay(\"audio/aac\"),caf:canPlay(\"audio/x-caf\")||canPlay(\"audio/caf\"),flac:canPlay(\"audio/x-flac\")||canPlay(\"audio/flac\"),mp3:canPlay('audio/mpeg; codecs=\"mp3\"')||canPlay(\"audio/mpeg\")||canPlay(\"audio/mp3\")||canPlay(\"audio/mpa\"),mpeg:canPlay(\"audio/mpeg\"),m4a:canPlay(\"audio/x-m4a\")||canPlay(\"audio/m4a\")||canPlay(\"audio/aac\"),mp4:canPlay(\"audio/x-mp4\")||canPlay(\"audio/mp4\")||canPlay(\"audio/aac\"),ogg:canPlay(\"audio/ogg\"),oga:canPlay(\"audio/ogg\"),opus:canPlay('audio/ogg; codecs=\"opus\"')||canPlay(\"audio/opus\"),wav:canPlay('audio/wave; codecs=\"1\"')||canPlay('audio/wav; codecs=\"1\"')||canPlay(\"audio/wave\")||canPlay(\"audio/wav\"),wave:canPlay('audio/wave; codecs=\"1\"')||canPlay('audio/wav; codecs=\"1\"')||canPlay(\"audio/wave\")||canPlay(\"audio/wav\"),weba:canPlay(\"audio/webm\"),webm:canPlay(\"audio/webm\")})})()}});class AudioList{constructor(obj){if(obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioList))throw new Error(\"tracks parameter must be either an array, of track objects, or an AudioTrack instance\");this._copy(obj)}}_create(trackList){this._finalize(trackList.map((trackObj=>{if(\"object\"!=typeof trackObj)throw new Error(\"tracks parameter array members must be objects\");let own,rate,track,volume;if(trackObj instanceof AudioTrack)own=!0,rate=trackObj.rate(),track=trackObj.clone(),volume=trackObj.volume();else{if(!trackObj.hasOwnProperty(\"track\"))throw new Error('track object missing required \"track\" property');if(!(trackObj.track instanceof AudioTrack))throw new Error('track object\\'s \"track\" property must be an AudioTrack object');own=trackObj.hasOwnProperty(\"own\")&&trackObj.own,rate=trackObj.hasOwnProperty(\"rate\")?trackObj.rate:trackObj.track.rate(),track=trackObj.track,volume=trackObj.hasOwnProperty(\"volume\")?trackObj.volume:trackObj.track.volume()}return track.stop(),track.loop(!1),track.mute(!1),track.rate(rate),track.volume(volume),track.on(\"ended.AudioList\",(()=>this._onEnd())),{own:own,track:track,volume:volume,rate:rate}})))}_copy(obj){this._finalize(clone(obj.tracks))}_finalize(tracks){Object.defineProperties(this,{tracks:{configurable:!0,value:Object.freeze(tracks)},queue:{configurable:!0,value:[]},current:{writable:!0,value:null},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1},_mute:{writable:!0,value:!1},_loop:{writable:!0,value:!1},_shuffle:{writable:!0,value:!1}})}_destroy(){this.stop(),this.tracks.filter((trackObj=>trackObj.own)).forEach((trackObj=>trackObj.track._destroy())),delete this.tracks,delete this.queue}load(){this.tracks.forEach((trackObj=>trackObj.track.load()))}unload(){this.stop(),this.tracks.forEach((trackObj=>trackObj.track.unload()))}play(){return null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||(0===this.queue.length&&this._fillQueue(),this._next())?this.current.track.play():Promise.reject(new Error(\"no tracks were available\"))}playWhenAllowed(){this.play().catch((()=>{const gestures=_gestureEventNames.map((name=>`${name}.AudioList_playWhenAllowed`)).join(\" \");jQuery(document).one(gestures,(()=>{jQuery(document).off(\".AudioList_playWhenAllowed\"),this.play()}))}))}pause(){null!==this.current&&this.current.track.pause()}stop(){null!==this.current&&(this.current.track.stop(),this.current=null),this._drainQueue()}skip(){this._next()?this.current.track.play():this._loop&&this.play()}fade(duration,toVol,fromVol){if(\"number\"!=typeof duration)throw new TypeError(\"duration parameter must be a number\");if(\"number\"!=typeof toVol)throw new TypeError(\"toVolume parameter must be a number\");if(null!=fromVol&&\"number\"!=typeof fromVol)throw new TypeError(\"fromVolume parameter must be a number\");if(0===this.queue.length&&this._fillQueue(),(null===this.current||this.current.track.isUnavailable()||this.current.track.isEnded())&&!this._next())return;const adjToVol=Math.clamp(toVol,0,1)*this.current.volume;let adjFromVol;return null!=fromVol&&(adjFromVol=Math.clamp(fromVol,0,1)*this.current.volume),this._volume=toVol,this.current.track.fade(duration,adjToVol,adjFromVol)}fadeIn(duration,fromVol){return this.fade(duration,1,fromVol)}fadeOut(duration,fromVol){return this.fade(duration,0,fromVol)}fadeStop(){null!==this.current&&this.current.track.fadeStop()}loop(loop){return null==loop?this._loop:(this._loop=!!loop,this)}mute(mute){return null==mute?this._mute:(this._mute=!!mute,null!==this.current&&this.current.track.mute(this._mute),this)}rate(rate){if(null==rate)return this._rate;if(\"number\"!=typeof rate)throw new TypeError(\"rate parameter must be a number\");return this._rate=Math.clamp(rate,.2,5),null!==this.current&&this.current.track.rate(this._rate*this.current.rate),this}shuffle(shuffle){if(null==shuffle)return this._shuffle;if(this._shuffle=!!shuffle,this.queue.length>0&&(this._fillQueue(),!this._shuffle&&null!==this.current&&this.queue.length>1)){const firstIdx=this.queue.findIndex((trackObj=>trackObj===this.current));-1!==firstIdx&&this.queue.push(...this.queue.splice(0,firstIdx+1))}return this}volume(volume){if(null==volume)return this._volume;if(\"number\"!=typeof volume)throw new TypeError(\"volume parameter must be a number\");return this._volume=Math.clamp(volume,0,1),null!==this.current&&this.current.track.volume(this._volume*this.current.volume),this}duration(){if(arguments.length>0)throw new Error(\"duration takes no parameters\");return this.tracks.map((trackObj=>trackObj.track.duration())).reduce(((prev,cur)=>prev+cur),0)}remaining(){if(arguments.length>0)throw new Error(\"remaining takes no parameters\");let remainingTime=this.queue.map((trackObj=>trackObj.track.duration())).reduce(((prev,cur)=>prev+cur),0);return null!==this.current&&(remainingTime+=this.current.track.remaining()),remainingTime}time(){if(arguments.length>0)throw new Error(\"time takes no parameters\");return this.duration()-this.remaining()}isPlaying(){return null!==this.current&&this.current.track.isPlaying()}isPaused(){return null===this.current||this.current.track.isPaused()}isStopped(){return 0===this.queue.length&&null===this.current}isEnded(){return 0===this.queue.length&&(null===this.current||this.current.track.isEnded())}isFading(){return null!==this.current&&this.current.track.isFading()}_next(){let nextTrack;for(null!==this.current&&(this.current.track.stop(),this.current=null);nextTrack=this.queue.shift();)if(!nextTrack.track.isUnavailable()){this.current=nextTrack;break}return null!==this.current&&(this.current.track.mute(this._mute),this.current.track.rate(this._rate*this.current.rate),this.current.track.volume(this._volume*this.current.volume),this.current.track.loop(!1),!0)}_onEnd(){if(0===this.queue.length){if(!this._loop)return;this._fillQueue()}this._next()&&this.current.track.play()}_drainQueue(){this.queue.splice(0)}_fillQueue(){this._drainQueue(),this.queue.push(...this.tracks.filter((trackObj=>!trackObj.track.isUnavailable()))),0!==this.queue.length&&this._shuffle&&(this.queue.shuffle(),this.queue.length>1&&this.queue[0]===this.current&&this.queue.push(this.queue.shift()))}}class AudioRunner{constructor(list){if(!(list instanceof Set||list instanceof AudioRunner))throw new TypeError(\"list parameter must be a Set or a AudioRunner instance\");Object.defineProperties(this,{trackIds:{value:new Set(list instanceof AudioRunner?list.trackIds:list)}})}load(){AudioRunner._run(this.trackIds,AudioTrack.prototype.load)}unload(){AudioRunner._run(this.trackIds,AudioTrack.prototype.unload)}play(){AudioRunner._run(this.trackIds,AudioTrack.prototype.play)}playWhenAllowed(){AudioRunner._run(this.trackIds,AudioTrack.prototype.playWhenAllowed)}pause(){AudioRunner._run(this.trackIds,AudioTrack.prototype.pause)}stop(){AudioRunner._run(this.trackIds,AudioTrack.prototype.stop)}fade(duration,toVol,fromVol){if(null==duration||null==toVol)throw new Error(\"fade requires parameters\");AudioRunner._run(this.trackIds,AudioTrack.prototype.fade,duration,toVol,fromVol)}fadeIn(duration,fromVol){if(null==duration)throw new Error(\"fadeIn requires a parameter\");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeIn,duration,fromVol)}fadeOut(duration,fromVol){if(null==duration)throw new Error(\"fadeOut requires a parameter\");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeOut,duration,fromVol)}fadeStop(){AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeStop)}loop(loop){if(null==loop)throw new Error(\"loop requires a parameter\");return AudioRunner._run(this.trackIds,AudioTrack.prototype.loop,loop),this}mute(mute){if(null==mute)throw new Error(\"mute requires a parameter\");return AudioRunner._run(this.trackIds,AudioTrack.prototype.mute,mute),this}rate(rate){if(null==rate)throw new Error(\"rate requires a parameter\");return AudioRunner._run(this.trackIds,AudioTrack.prototype.rate,rate),this}time(time){if(null==time)throw new Error(\"time requires a parameter\");return AudioRunner._run(this.trackIds,AudioTrack.prototype.time,time),this}volume(volume){if(null==volume)throw new Error(\"volume requires a parameter\");return AudioRunner._run(this.trackIds,AudioTrack.prototype.volume,volume),this}on(...args){return AudioRunner._run(this.trackIds,AudioTrack.prototype.on,...args),this}one(...args){return AudioRunner._run(this.trackIds,AudioTrack.prototype.one,...args),this}off(...args){return AudioRunner._run(this.trackIds,AudioTrack.prototype.off,...args),this}static _run(ids,fn,...args){ids.forEach((id=>{const track=_tracks.get(id);track&&fn.apply(track,args)}))}}const _runnerParseSelector=(()=>{const notWsRe=/\\S/g,parenRe=/[()]/g;function processNegation(str,startPos){let match;if(notWsRe.lastIndex=startPos,match=notWsRe.exec(str),null===match||\"(\"!==match[0])throw new Error('invalid \":not()\" syntax: missing parentheticals');parenRe.lastIndex=notWsRe.lastIndex;const start=notWsRe.lastIndex,result={str:\"\",nextMatch:-1};let depth=1;for(;null!==(match=parenRe.exec(str));)if(\"(\"===match[0]?++depth:--depth,depth<1){result.nextMatch=parenRe.lastIndex,result.str=str.slice(start,result.nextMatch-1);break}return result}return function parseSelector(idArg){const ids=[],idRe=/:?[^\\s:()]+/g;let match;for(;null!==(match=idRe.exec(idArg));){const id=match[0];if(\":not\"===id){if(0===ids.length)throw new Error('invalid negation: no group ID preceded \":not()\"');const parent=ids[ids.length-1];if(\":\"!==parent.id[0])throw new Error(`invalid negation of track \"${parent.id}\": only groups may be negated with \":not()\"`);const negation=processNegation(idArg,idRe.lastIndex);if(-1===negation.nextMatch)throw new Error('unknown error parsing \":not()\"');idRe.lastIndex=negation.nextMatch,parent.not=parseSelector(negation.str)}else ids.push({id:id})}return ids}})();function masterMute(mute){if(null==mute)return _masterMute;_masterMute=!!mute,publish(\"mute\",_masterMute)}function unsubscribe(id){_subscribers.delete(id)}function publish(mesg,data){_subscribers.forEach((fn=>fn(mesg,data)))}function _newTrack(sources){return new AudioTrack(sources.map((source=>{if(\"data:\"!==source.slice(0,5)&&Story.has(source)){const passage=Story.get(source);if(passage.tags.includes(\"Twine.audio\"))return passage.text.trim()}const match=_formatSpecRe.exec(source);return null===match?source:{format:match[1],src:match[2]}})))}return Object.freeze(Object.defineProperties({},{tracks:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){const errors=[];throw arguments.length<1&&errors.push(\"track ID\"),arguments.length<2&&errors.push(\"sources\"),new Error(`no ${errors.join(\" or \")} specified`)}const id=String(arguments[0]).trim(),what=`track ID \"${id}\"`;if(_badIdRe.test(id))throw new Error(`invalid ${what}: track IDs must not contain colons or whitespace`);const sources=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);let track;try{track=_newTrack(sources)}catch(ex){throw new Error(`${what}: error during track initialization: ${ex.message}`)}if(Config.debug&&!track.hasSource())throw new Error(`${what}: no supported audio sources found`);_tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.set(id,track)}},delete:{value:function(id){return _tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.delete(id)}},clear:{value:function(){_tracks.forEach((track=>track._destroy())),_tracks.clear()}},has:{value:function(id){return _tracks.has(id)}},get:{value:function(id){return _tracks.get(id)||null}}}))},groups:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){const errors=[];throw arguments.length<1&&errors.push(\"group ID\"),arguments.length<2&&errors.push(\"track IDs\"),new Error(`no ${errors.join(\" or \")} specified`)}const id=String(arguments[0]).trim(),what=`group ID \"${id}\"`;if(\":\"!==id[0]||_badIdRe.test(id.slice(1)))throw new Error(`invalid ${what}: group IDs must start with a colon and must not contain colons or whitespace`);if(_specialIds.includes(id))throw new Error(`cannot clobber special ${what}`);const trackIds=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);let group;try{group=new Set(trackIds.map((trackId=>{if(!_tracks.has(trackId))throw new Error(`track \"${trackId}\" does not exist`);return trackId})))}catch(ex){throw new Error(`${what}: error during group initialization: ${ex.message}`)}_groups.set(id,Object.freeze(Array.from(group)))}},delete:{value:function(id){return _groups.delete(id)}},clear:{value:function(){_groups.clear()}},has:{value:function(id){return _groups.has(id)}},get:{value:function(id){return _groups.get(id)||null}}}))},lists:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){const errors=[];throw arguments.length<1&&errors.push(\"list ID\"),arguments.length<2&&errors.push(\"track IDs\"),new Error(`no ${errors.join(\" or \")} specified`)}const id=String(arguments[0]).trim(),what=`list ID \"${id}\"`;if(_badIdRe.test(id))return this.error(`invalid ${what}: list IDs must not contain colons or whitespace`);const descriptors=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);let list;try{list=new AudioList(descriptors.map((desc=>{if(null===desc)throw new Error(\"track descriptor must be a string or object (type: null)\");switch(typeof desc){case\"string\":desc={id:desc};break;case\"object\":if(!desc.hasOwnProperty(\"id\")&&!desc.hasOwnProperty(\"sources\"))throw new Error('track descriptor must contain one of either an \"id\" or a \"sources\" property');if(desc.hasOwnProperty(\"id\")&&desc.hasOwnProperty(\"sources\"))throw new Error('track descriptor must contain either an \"id\" or a \"sources\" property, not both');break;default:throw new Error(`track descriptor must be a string or object (type: ${typeof desc})`)}let own,track,volume;if(desc.hasOwnProperty(\"id\")){if(\"string\"!=typeof desc.id)throw new Error('\"id\" property must be a string');if(!_tracks.has(desc.id))throw new Error(`track \"${desc.id}\" does not exist`);track=_tracks.get(desc.id)}else if(desc.hasOwnProperty(\"sources\")){if(!Array.isArray(desc.sources)||0===desc.sources.length)throw new Error('\"sources\" property must be a non-empty array');if(desc.hasOwnProperty(\"own\"))throw new Error('\"own\" property is not allowed with the \"sources\" property');try{track=_newTrack(desc.sources),own=!0}catch(ex){throw new Error(`error during track initialization: ${ex.message}`)}if(Config.debug&&!track.hasSource())throw new Error(\"no supported audio sources found\")}if(desc.hasOwnProperty(\"own\")){if(\"boolean\"!=typeof desc.own)throw new Error('\"own\" property must be a boolean');own=desc.own,own&&(track=track.clone())}if(desc.hasOwnProperty(\"volume\")){if(\"number\"!=typeof desc.volume||Number.isNaN(desc.volume)||!Number.isFinite(desc.volume)||desc.volume<0)throw new Error('\"volume\" property must be a non-negative finite number');volume=desc.volume}return{own:null!=own&&own,track:track,volume:null!=volume?volume:track.volume()}})))}catch(ex){throw new Error(`${what}: error during playlist initialization: ${ex.message}`)}_lists.has(id)&&_lists.get(id)._destroy(),_lists.set(id,list)}},delete:{value:function(id){return _lists.has(id)&&_lists.get(id)._destroy(),_lists.delete(id)}},clear:{value:function(){_lists.forEach((list=>list._destroy())),_lists.clear()}},has:{value:function(id){return _lists.has(id)}},get:{value:function(id){return _lists.get(id)||null}}}))},select:{value:function(){if(0===arguments.length)throw new Error(\"no track selector specified\");const selector=String(arguments[0]).trim(),trackIds=new Set;try{const allIds=Array.from(_tracks.keys());function renderIds(idObj){const id=idObj.id;let ids;switch(id){case\":all\":ids=allIds;break;case\":looped\":ids=allIds.filter((id=>_tracks.get(id).loop()));break;case\":muted\":ids=allIds.filter((id=>_tracks.get(id).mute()));break;case\":paused\":ids=allIds.filter((id=>_tracks.get(id).isPaused()));break;case\":playing\":ids=allIds.filter((id=>_tracks.get(id).isPlaying()));break;default:ids=\":\"===id[0]?_groups.get(id):[id]}if(idObj.hasOwnProperty(\"not\")){const negated=idObj.not.map((idObj=>renderIds(idObj))).flat(1/0);ids=ids.filter((id=>!negated.includes(id)))}return ids}_runnerParseSelector(selector).forEach((idObj=>renderIds(idObj).forEach((id=>{if(!_tracks.has(id))throw new Error(`track \"${id}\" does not exist`);trackIds.add(id)}))))}catch(ex){throw new Error(`error during runner initialization: ${ex.message}`)}return new AudioRunner(trackIds)}},load:{value:function(){publish(\"load\")}},loadWithScreen:{value:function(){publish(\"loadwithscreen\")}},mute:{value:masterMute},muteOnHidden:{value:function(mute){if(!Visibility.isEnabled())return!1;if(null==mute)return _masterMuteOnHidden;_masterMuteOnHidden=!!mute;const namespace=\".SimpleAudio_masterMuteOnHidden\";if(_masterMuteOnHidden){const visibilityChange=`${Visibility.changeEvent}${namespace}`;jQuery(document).off(namespace).on(visibilityChange,(()=>masterMute(Visibility.isHidden()))),Visibility.isHidden()&&masterMute(!0)}else jQuery(document).off(namespace)}},rate:{value:function(rate){if(null==rate)return _masterRate;if(\"number\"!=typeof rate||Number.isNaN(rate)||!Number.isFinite(rate))throw new Error(\"rate must be a finite number\");_masterRate=Math.clamp(rate,.2,5),publish(\"rate\",_masterRate)}},stop:{value:function(){publish(\"stop\")}},unload:{value:function(){publish(\"unload\")}},volume:{value:function(volume){if(null==volume)return _masterVolume;if(\"number\"!=typeof volume||Number.isNaN(volume)||!Number.isFinite(volume))throw new Error(\"volume must be a finite number\");_masterVolume=Math.clamp(volume,0,1),publish(\"volume\",_masterVolume)}}}))})(),State=(()=>{let _history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null,_tempVariables={};function reduceHistorySize(stateObj,targetSize){if(!targetSize)return;const currentIndex=stateObj.index,currentHistoryLength=stateObj.history.length;targetSize=Math.min(currentHistoryLength,targetSize);const invertedIndex=currentHistoryLength-1-currentIndex;let startingIndex=0;const radius=Math.floor(targetSize/2);return startingIndex=currentIndex<invertedIndex?radius>=currentIndex?0:currentIndex-radius:radius>=invertedIndex?currentHistoryLength-targetSize:currentIndex-radius,stateObj.index-=startingIndex,stateObj.history=stateObj.history.slice(startingIndex,startingIndex+targetSize),stateObj}function stateMarshal(noDelta=!0,depth=Config.history.maxSessionStates,useClone=!1){if(0===depth)return null;const stateObj={index:_activeIndex,history:useClone?clone(_history):_history};return _history.length>depth&&reduceHistorySize(stateObj,depth),noDelta||(stateObj.delta=historyDeltaEncode(stateObj.history),delete stateObj.history),_expired.length>0&&(stateObj.expired=[..._expired]),null!==_prng&&_prng.hasOwnProperty(\"seed\")&&(stateObj.seed=_prng.seed),stateObj}function stateUnmarshal(stateObj,noDeltaFlag=!0){let noDelta=noDeltaFlag;if(null==stateObj)throw new Error(\"state object is null or undefined\");if(!stateObj.hasOwnProperty(noDelta?\"history\":\"delta\")||0===stateObj[noDelta?\"history\":\"delta\"].length)if(stateObj.hasOwnProperty(\"delta\"))console.log(\"warning: stateObj is delta-encoded when it shouldn't be\"),noDelta=!1;else{if(!stateObj.hasOwnProperty(\"history\"))throw new Error(\"state object has no history or history is empty\");console.log(\"warning: stateObj is not delta-encoded when it should be\"),noDelta=!0}if(!stateObj.hasOwnProperty(\"index\"))throw new Error(\"state object has no index\");_history=noDelta?clone(stateObj.history):historyDeltaDecode(stateObj.delta),_activeIndex=stateObj.index,_expired=stateObj.hasOwnProperty(\"expired\")?[...stateObj.expired]:[],stateObj.hasOwnProperty(\"seed\")&&null!==_prng&&(_prng.seed=stateObj.seed),momentActivate(_activeIndex)}function momentCreate(title,variables){return{title:null==title?\"\":String(title),variables:null==variables?{}:clone(variables)}}function momentActivate(moment){if(null==moment)throw new Error(\"moment activation attempted with null or undefined\");switch(typeof moment){case\"object\":_active=clone(moment);break;case\"number\":if(historyIsEmpty())throw new Error(\"moment activation attempted with index on empty history\");if(moment<0||moment>=historySize())throw new RangeError(`moment activation attempted with out-of-bounds index; need [0, ${historySize()-1}], got ${moment}`);_active=clone(_history[moment]);break;default:throw new TypeError(`moment activation attempted with a \"${typeof moment}\"; must be an object or valid history stack index`)}null!==_prng&&(_prng=PRNGWrapper.unmarshal({seed:_prng.seed,pull:_active.pull,state:_active.prng||!0}));let pass=!1;for(;Config.history.maxSessionStates>0&&!pass;)try{session.set(\"state\",stateMarshal()),pass=!0}catch{console.log(\"session.set error, reducing maxSessionStates\"),Config.history.maxSessionStates>State.history.length&&(Config.history.maxSessionStates=State.history.length),Config.history.maxSessionStates--,window.Errors&&window.Errors.report(`Save data is too big for current history depth setting. It's value was auto-adjusted to ${Config.history.maxSessionStates}`)}return jQuery.event.trigger(\":historyupdate\"),_active}function historyLength(){return _activeIndex+1}function historySize(){return _history.length}function historyIsEmpty(){return 0===_history.length}function historyTop(){return _history.length>0?_history[_history.length-1]:null}function historyGoTo(index){return!(null==index||index<0||index>=historySize()||index===_activeIndex)&&(_activeIndex=index,momentActivate(_activeIndex),!0)}function historyDeltaEncode(historyArr){if(!Array.isArray(historyArr))return null;if(0===historyArr.length)return[];const delta=[historyArr[0]];for(let i=1,iend=historyArr.length;i<iend;++i)delta.push(Diff.diff(historyArr[i-1],historyArr[i]));return delta}function historyDeltaDecode(delta){if(!Array.isArray(delta))return null;if(0===delta.length)return[];const historyArr=[clone(delta[0])];for(let i=1,iend=delta.length;i<iend;++i)historyArr.push(Diff.patch(historyArr[i-1],delta[i]));return historyArr}function prngInit(seed,useEntropy){if(!historyIsEmpty()){let scriptSection;throw scriptSection=\"the Story JavaScript\",new Error(`State.prng.init must be called during initialization, within either ${scriptSection} or the StoryInit special passage`)}_prng=new PRNGWrapper(seed,{state:!0,entropy:useEntropy}),_active.prng=_prng.state(),_active.pull=_prng.pull}const _METADATA_STORE=\"metadata\";function metadataDelete(key){if(\"string\"!=typeof key)throw new TypeError(`State.metadata.delete key parameter must be a string (received: ${typeof key})`);const store=storage.get(_METADATA_STORE);store&&store.hasOwnProperty(key)&&(1===Object.keys(store).length?storage.delete(_METADATA_STORE):(delete store[key],storage.set(_METADATA_STORE,store)))}return Object.defineProperties(window,{V:{get:()=>_active.variables,configurable:!0},T:{get:()=>_tempVariables,configurable:!0}}),Object.freeze(Object.defineProperties({},{reset:{value:function(){session.delete(\"state\"),_history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null===_prng?null:new PRNGWrapper(_prng.seed,{state:!0})}},restore:{value:function(soft){if(session.has(\"state\")&&!soft){const stateObj=session.get(\"state\");return null!=stateObj&&(stateUnmarshal(stateObj),!0)}if(soft){const frame=_history[_activeIndex];if(!frame)return!1;const states=Config.history.maxSessionStates;return Config.history.maxSessionStates=0,momentActivate(frame),Config.history.maxSessionStates=states,!0}return!1}},marshalForSave:{value:function(depth=100,noDelta=!0){return stateMarshal(noDelta,depth,!0)}},unmarshalForSave:{value:function(stateObj){return stateUnmarshal(stateObj,!0)}},expired:{get:function(){return _expired}},turns:{get:function(){return _expired.length+historyLength()}},passages:{get:function(){return _expired.concat(_history.slice(0,historyLength()).map((moment=>moment.title)))}},hasPlayed:{value:function(title){return null!=title&&\"\"!==title&&(!!_expired.includes(title)||!!_history.slice(0,historyLength()).some((moment=>moment.title===title)))}},getSessionState:{value:function(){if(0===Config.history.maxSessionStates)return;const sessionState=session.get(\"state\");return sessionState.hasOwnProperty(\"delta\")&&(sessionState.history=State.deltaDecode(sessionState.delta),delete sessionState.delta),sessionState}},setSessionState:{value:function(sessionState){if(!sessionState||!sessionState.history)throw new Error(\"setSessionState error: not a valid sessionState object\");let pass=!1,sstates=Config.history.maxSessionStates;if(0===sstates)return pass;try{sessionState.history.length>sstates&&reduceHistorySize(sessionState,sstates),sstates&&session.set(\"state\",sessionState),pass=!0}catch(ex){for(console.log(\"session.set failed, recovering\"),sstates>sessionState.history.length&&(sstates=sessionState.length);sstates&&!pass;)try{sstates--,reduceHistorySize(sessionState,sstates),session.set(\"state\",sessionState),pass=!0}catch(ex){continue}Config.history.maxSessionStates=sstates,V.options&&(V.options.maxSessionStates=sstates),Errors&&Errors.report(\"Save data is too big for current History depth setting. It's value was automatically adjusted to \"+sstates)}return pass}},active:{get:function(){return _active}},activeIndex:{get:function(){return _activeIndex}},passage:{get:function(){return _active.title}},variables:{get:function(){return _active.variables}},history:{get:function(){return _history}},length:{get:historyLength},size:{get:historySize},isEmpty:{value:historyIsEmpty},current:{get:function(){return _history.length>0?_history[_activeIndex]:null}},top:{get:historyTop},bottom:{get:function(){return _history.length>0?_history[0]:null}},index:{value:function(index){return historyIsEmpty()||index<0||index>_activeIndex?null:_history[index]}},peek:{value:function(offset){if(historyIsEmpty())return null;const lengthOffset=1+(offset?Math.abs(offset):0);return lengthOffset>historyLength()?null:_history[historyLength()-lengthOffset]}},has:{value:function(title){if(historyIsEmpty()||null==title||\"\"===title)return!1;for(let i=_activeIndex;i>=0;--i)if(_history[i].title===title)return!0;return!1}},create:{value:function(title){if(historyLength()<historySize()&&_history.splice(historyLength(),historySize()-historyLength()),_history.push(momentCreate(title,_active.variables)),_prng){const top=historyTop();top.pull=_prng.pull,top.prng=_prng.state()}for(;historySize()>Config.history.maxStates;)for(0===Config.history.maxExpired?_history.shift():_expired.push(_history.shift().title);_expired.length>Config.history.maxExpired;)_expired.shift();return _activeIndex=historySize()-1,momentActivate(_activeIndex),historyLength()}},goTo:{value:historyGoTo},go:{value:function(offset){return null!=offset&&0!==offset&&historyGoTo(_activeIndex+offset)}},deltaEncode:{value:historyDeltaEncode},deltaDecode:{value:historyDeltaDecode},prng:{value:Object.freeze(Object.defineProperties({},{init:{value:prngInit},isEnabled:{value:function(){return null!==_prng}},pull:{get:function(){return _prng?_prng.pull:NaN}},seed:{get:function(){return _prng?_prng.seed:null}},state:{get:function(){return _prng?_prng.state():null}},peek:{value:function(count,callback=undefined){const values=[];if(_prng){const state=_prng.state();for(let i=0;i<count;i++)\"function\"==typeof callback?values.push(callback(_prng.random())):values.push(_prng.random());_prng=new PRNGWrapper(_prng.seed,{state:state})}return values}}}))},random:{value:function(){return _prng?_prng.random():Math.random()}},clearTemporary:{value:function(){_tempVariables={},TempVariables=_tempVariables}},temporary:{get:function(){return _tempVariables}},getVar:{value:function(varExpression){try{return Scripting.evalTwineScript(varExpression)}catch(ex){}}},setVar:{value:function(varExpression,value){try{return Scripting.evalTwineScript(`${varExpression} = evalTwineScript$Data$`,null,value),!0}catch(ex){}return!1}},metadata:{value:Object.freeze(Object.defineProperties({},{clear:{value:function(){storage.delete(_METADATA_STORE)}},delete:{value:metadataDelete},entries:{value:function(){const store=storage.get(_METADATA_STORE);return store&&Object.entries(store)}},get:{value:function(key){if(\"string\"!=typeof key)throw new TypeError(`State.metadata.get key parameter must be a string (received: ${typeof key})`);const store=storage.get(_METADATA_STORE);return store&&store.hasOwnProperty(key)?store[key]:undefined}},has:{value:function(key){if(\"string\"!=typeof key)throw new TypeError(`State.metadata.has key parameter must be a string (received: ${typeof key})`);const store=storage.get(_METADATA_STORE);return store&&store.hasOwnProperty(key)}},keys:{value:function(){const store=storage.get(_METADATA_STORE);return store&&Object.keys(store)}},set:{value:function(key,value){if(\"string\"!=typeof key)throw new TypeError(`State.metadata.set key parameter must be a string (received: ${typeof key})`);if(void 0===value)metadataDelete(key);else{const store=storage.get(_METADATA_STORE)||{};store[key]=value,storage.set(_METADATA_STORE,store)}}},size:{get:function(){const store=storage.get(_METADATA_STORE);return store?Object.keys(store).length:0}}}))},initPRNG:{value:prngInit},restart:{value:()=>Engine.restart()},backward:{value:()=>Engine.backward()},forward:{value:()=>Engine.forward()},display:{value:(...args)=>Engine.display(...args)},show:{value:(...args)=>Engine.show(...args)},play:{value:(...args)=>Engine.play(...args)}}))})(),Scripting=(()=>{function addAccessibleClickHandler(targets,selector,handler,one,namespace){if(arguments.length<2)throw new Error(\"addAccessibleClickHandler insufficient number of parameters\");let fn,opts;if(\"function\"==typeof selector?(fn=selector,opts={namespace:one,one:!!handler}):(fn=handler,opts={namespace:namespace,one:!!one,selector:selector}),\"function\"!=typeof fn)throw new TypeError(\"addAccessibleClickHandler handler parameter must be a function\");return jQuery(targets).ariaClick(opts,fn)}function insertElement(place,type,id,classNames,text,title){const $el=jQuery(document.createElement(type));return id&&$el.attr(\"id\",id),classNames&&$el.addClass(classNames),title&&$el.attr(\"title\",title),text&&$el.text(text),place&&$el.appendTo(place),$el[0]}function insertText(place,text){jQuery(place).append(document.createTextNode(text))}function removeChildren(node){jQuery(node).empty()}function removeElement(node){jQuery(node).remove()}function fade(el,options){const direction=\"in\"===options.fade?1:-1;let current,intervalId,proxy=el.cloneNode(!0);function setOpacity(el,opacity){el.style.zoom=1,el.style.filter=`alpha(opacity=${Math.floor(100*opacity)})`,el.style.opacity=opacity}el.parentNode.replaceChild(proxy,el),\"in\"===options.fade?(current=0,proxy.style.visibility=\"visible\"):current=1,setOpacity(proxy,current),intervalId=window.setInterval((function(){current+=.05*direction,setOpacity(proxy,Math.easeInOut(current)),(1===direction&&current>=1||-1===direction&&current<=0)&&(el.style.visibility=\"in\"===options.fade?\"visible\":\"hidden\",proxy.parentNode.replaceChild(el,proxy),proxy=null,window.clearInterval(intervalId),options.onComplete&&options.onComplete())}),25)}function scrollWindowTo(el,incrementBy){let increment=null!=incrementBy?Number(incrementBy):.1;Number.isNaN(increment)||!Number.isFinite(increment)||increment<0?increment=.1:increment>1&&(increment=1);const start=window.scrollY?window.scrollY:document.body.scrollTop,end=function(el){const posTop=function(el){let curtop=0;for(;el.offsetParent;)curtop+=el.offsetTop,el=el.offsetParent;return curtop}(el),posBottom=posTop+el.offsetHeight,winTop=window.scrollY?window.scrollY:document.body.scrollTop,winHeight=window.innerHeight?window.innerHeight:document.body.clientHeight,winBottom=winTop+winHeight;return posTop>=winTop&&posBottom>winBottom&&el.offsetHeight<winHeight?posTop-(winHeight-el.offsetHeight)+20:posTop}(el),distance=Math.abs(start-end),direction=start>end?-1:1;let intervalId,progress=0;intervalId=window.setInterval((function(){progress+=increment,window.scroll(0,start+direction*(distance*Math.easeInOut(progress))),progress>=1&&window.clearInterval(intervalId)}),25)}function toStringOrDefault(value){return stringFrom(value)}function either(){if(0!==arguments.length)return Array.prototype.concat.apply([],arguments).random()}function forget(key){if(\"string\"!=typeof key)throw new TypeError(`forget key parameter must be a string (received: ${Util.getType(key)})`);State.metadata.delete(key)}function hasVisited(){if(0===arguments.length)throw new Error(\"hasVisited called with insufficient parameters\");if(State.isEmpty())return!1;const needles=Array.prototype.concat.apply([],arguments),played=State.passages;for(let i=0,iend=needles.length;i<iend;++i)if(!played.includes(needles[i]))return!1;return!0}function lastVisited(){if(0===arguments.length)throw new Error(\"lastVisited called with insufficient parameters\");if(State.isEmpty())return-1;const needles=Array.prototype.concat.apply([],arguments),played=State.passages,uBound=played.length-1;let turns=State.turns;for(let i=0,iend=needles.length;i<iend&&turns>-1;++i){const lastIndex=played.lastIndexOf(needles[i]);turns=Math.min(turns,-1===lastIndex?-1:uBound-lastIndex)}return turns}function memorize(key,value){if(\"string\"!=typeof key)throw new TypeError(`memorize key parameter must be a string (received: ${Util.getType(key)})`);State.metadata.set(key,value)}function passage(){return State.passage}function previous(){const passages=State.passages;if(arguments.length>0){const offset=Number(arguments[0]);if(!Number.isSafeInteger(offset)||offset<1)throw new RangeError(\"previous offset parameter must be a positive integer greater than zero\");return passages.length>offset?passages[passages.length-1-offset]:\"\"}for(let i=passages.length-2;i>=0;--i)if(passages[i]!==State.passage)return passages[i];return\"\"}function random(){let min,max;switch(arguments.length){case 0:throw new Error(\"random called with insufficient parameters\");case 1:min=0,max=Math.trunc(arguments[0]);break;default:min=Math.trunc(arguments[0]),max=Math.trunc(arguments[1])}if(!Number.isInteger(min))throw new Error(\"random min parameter must be an integer\");if(!Number.isInteger(max))throw new Error(\"random max parameter must be an integer\");return min>max&&([min,max]=[max,min]),Math.floor(State.random()*(max-min+1))+min}function randomFloat(){let min,max;switch(arguments.length){case 0:throw new Error(\"randomFloat called with insufficient parameters\");case 1:min=0,max=Number(arguments[0]);break;default:min=Number(arguments[0]),max=Number(arguments[1])}if(Number.isNaN(min)||!Number.isFinite(min))throw new Error(\"randomFloat min parameter must be a number\");if(Number.isNaN(max)||!Number.isFinite(max))throw new Error(\"randomFloat max parameter must be a number\");return min>max&&([min,max]=[max,min]),State.random()*(max-min)+min}function recall(key,defaultValue){if(\"string\"!=typeof key)throw new TypeError(`recall key parameter must be a string (received: ${Util.getType(key)})`);return State.metadata.has(key)?State.metadata.get(key):defaultValue}function tags(){if(0===arguments.length)return Story.get(State.passage).tags.slice(0);const passages=Array.prototype.concat.apply([],arguments);let tags=[];for(let i=0,iend=passages.length;i<iend;++i)tags=tags.concat(Story.get(passages[i]).tags);return tags}function temporary(){return State.temporary}function time(){return null===Engine.lastPlay?0:Util.now()-Engine.lastPlay}function turns(){return State.turns}function variables(){return State.variables}function visited(){if(State.isEmpty())return 0;const needles=Array.prototype.concat.apply([],0===arguments.length?[State.passage]:arguments),played=State.passages;let count=State.turns;for(let i=0,iend=needles.length;i<iend&&count>0;++i)count=Math.min(count,played.count(needles[i]));return count}function visitedTags(){if(0===arguments.length)throw new Error(\"visitedTags called with insufficient parameters\");if(State.isEmpty())return 0;const needles=Array.prototype.concat.apply([],arguments),nLength=needles.length,played=State.passages,seen=new Map;let count=0;for(let i=0,iend=played.length;i<iend;++i){const title=played[i];if(seen.has(title))seen.get(title)&&++count;else{const tags=Story.get(title).tags;if(tags.length>0){let found=0;for(let j=0;j<nLength;++j)tags.includes(needles[j])&&++found;found===nLength?(++count,seen.set(title,!0)):seen.set(title,!1)}}}return count}var{importScripts:importScripts,importStyles:importStyles}=(()=>{function slugifyUrl(url){return Util.parseUrl(url).path.replace(/^[^\\w]+|[^\\w]+$/g,\"\").replace(/[^\\w]+/g,\"-\").toLocaleLowerCase()}function addScript(url){return new Promise(((resolve,reject)=>{jQuery(document.createElement(\"script\")).one(\"load abort error\",(ev=>{jQuery(ev.target).off(),\"load\"===ev.type?resolve(ev.target):reject(new Error(`importScripts failed to load the script \"${url}\".`))})).appendTo(document.head).attr({id:`script-imported-${slugifyUrl(url)}`,type:\"text/javascript\",src:url})}))}function addStyle(url){return new Promise(((resolve,reject)=>{jQuery(document.createElement(\"link\")).one(\"load abort error\",(ev=>{jQuery(ev.target).off(),\"load\"===ev.type?resolve(ev.target):reject(new Error(`importStyles failed to load the stylesheet \"${url}\".`))})).appendTo(document.head).attr({id:`style-imported-${slugifyUrl(url)}`,rel:\"stylesheet\",href:url})}))}function sequence(callbacks){return callbacks.reduce(((seq,fn)=>seq.then(fn)),Promise.resolve())}return{importScripts:function(...urls){return Promise.all(urls.map((oneOrSeries=>Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((url=>()=>addScript(url)))):addScript(oneOrSeries))))},importStyles:function(...urls){return Promise.all(urls.map((oneOrSeries=>Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((url=>()=>addStyle(url)))):addStyle(oneOrSeries))))}}})();const parse=(()=>{const tokenTable=Util.toEnum({$:\"State.variables.\",_:\"State.temporary.\",to:\"=\",eq:\"==\",neq:\"!=\",is:\"===\",isnot:\"!==\",gt:\">\",gte:\">=\",lt:\"<\",lte:\"<=\",and:\"&&\",or:\"||\",not:\"!\",def:'\"undefined\" !== typeof',ndef:'\"undefined\" === typeof'}),parseRe=new RegExp([\"(?:\\\"\\\"|''|``)\",'(?:\"(?:\\\\\\\\.|[^\"\\\\\\\\])+\")',\"(?:'(?:\\\\\\\\.|[^'\\\\\\\\])+')\",\"(`(?:\\\\\\\\.|[^`\\\\\\\\])+`)\",\"(?:[=+\\\\-*\\\\/%<>&\\\\|\\\\^~!?:,;\\\\(\\\\)\\\\[\\\\]{}]+)\",\"([^\\\"'=+\\\\-*\\\\/%<>&\\\\|\\\\^~!?:,;\\\\(\\\\)\\\\[\\\\]{}\\\\s]+)\"].join(\"|\"),\"g\"),notSpaceRe=/\\S/,varTest=new RegExp(`^${Patterns.variable}`),withColonTestRe=/^\\s*:/,withNotTestRe=/^\\s+not\\b/;function parse(rawCodeString){if(0!==parseRe.lastIndex)throw new RangeError(\"Scripting.parse last index is non-zero at start\");let match,code=rawCodeString;for(;null!==(match=parseRe.exec(code));)if(match[1]){const rawTemplate=match[1],parsedTemplate=parseTemplate(rawTemplate);parsedTemplate!==rawTemplate&&(code=code.splice(match.index,rawTemplate.length,parsedTemplate),parseRe.lastIndex+=parsedTemplate.length-rawTemplate.length)}else if(match[2]){let token=match[2];if(\"$\"===token||\"_\"===token)continue;if(varTest.test(token))token=token[0];else if(\"is\"===token){const start=parseRe.lastIndex,ahead=code.slice(start);withNotTestRe.test(ahead)&&(code=code.splice(start,ahead.search(notSpaceRe)),token=\"isnot\")}else{const ahead=code.slice(parseRe.lastIndex);if(withColonTestRe.test(ahead))continue}tokenTable[token]&&(code=code.splice(match.index,token.length,tokenTable[token]),parseRe.lastIndex+=tokenTable[token].length-token.length)}return code}const templateGroupStartRe=/\\$\\{/g,templateGroupParseRe=new RegExp([\"(?:\\\"\\\"|'')\",'(?:\"(?:\\\\\\\\.|[^\"\\\\\\\\])+\")',\"(?:'(?:\\\\\\\\.|[^'\\\\\\\\])+')\",\"(\\\\{)\",\"(\\\\})\"].join(\"|\"),\"g\");function parseTemplate(rawTemplateLiteral){if(0!==templateGroupStartRe.lastIndex)throw new RangeError(\"Scripting.parse last index is non-zero at start of template literal\");let startMatch,template=rawTemplateLiteral;for(;null!==(startMatch=templateGroupStartRe.exec(template));){const startIdx=startMatch.index+2;let endMatch,endIdx=startIdx,depth=1;for(templateGroupParseRe.lastIndex=startIdx;null!==(endMatch=templateGroupParseRe.exec(template));)if(endMatch[1]?++depth:endMatch[2]&&--depth,0===depth){endIdx=endMatch.index;break}if(endIdx>startIdx){const parseIndex=parseRe.lastIndex,rawGroup=template.slice(startIdx,endIdx);parseRe.lastIndex=0;const parsedGroup=parse(rawGroup);parseRe.lastIndex=parseIndex,template=template.splice(startIdx,rawGroup.length,parsedGroup),templateGroupStartRe.lastIndex+=parsedGroup.length-rawGroup.length}}return template}return parse})();function evalJavaScript(code,output,data){return function(code,output,evalJavaScript$Data$){return eval(code)}.call(output?{output:output}:null,String(code),output,data)}function evalTwineScript(code,output,data){return function(code,output,evalTwineScript$Data$){return eval(code)}.call(output?{output:output}:null,parse(String(code)),output,data)}return Object.freeze(Object.defineProperties({},{parse:{value:parse},evalJavaScript:{value:evalJavaScript},evalTwineScript:{value:evalTwineScript}}))})(),{EOF:EOF,Lexer:Lexer}={EOF:-1,Lexer:class{constructor(source,initialState){if(arguments.length<2)throw new Error(\"Lexer constructor called with too few parameters (source:string , initialState:function)\");Object.defineProperties(this,{source:{value:source},initial:{value:initialState},state:{writable:!0,value:initialState},start:{writable:!0,value:0},pos:{writable:!0,value:0},depth:{writable:!0,value:0},items:{writable:!0,value:[]},data:{writable:!0,value:{}}})}reset(){this.state=this.initial,this.start=0,this.pos=0,this.depth=0,this.items=[],this.data={}}run(){for(;null!==this.state;)this.state=this.state(this);return this.items}nextItem(){for(;0===this.items.length&&null!==this.state;)this.state=this.state(this);return this.items.shift()}next(){return this.pos>=this.source.length?-1:this.source[this.pos++]}peek(){return this.pos>=this.source.length?-1:this.source[this.pos]}backup(num){this.pos-=num||1}forward(num){this.pos+=num||1}ignore(){this.start=this.pos}accept(valid){const ch=this.next();return!(-1===ch||!valid.includes(ch)&&(this.backup(),1))}acceptRe(validRe){const ch=this.next();return!(-1===ch||!validRe.test(ch)&&(this.backup(),1))}acceptRun(valid){for(;;){const ch=this.next();if(-1===ch)return;if(!valid.includes(ch))break}this.backup()}acceptRunRe(validRe){for(;;){const ch=this.next();if(-1===ch)return;if(!validRe.test(ch))break}this.backup()}emit(type){this.items.push({type:type,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),this.start=this.pos}error(type,message){if(arguments.length<2)throw new Error(\"Lexer.prototype.error called with too few parameters (type:number , message:string)\");return this.items.push({type:type,message:message,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),null}static enumFromNames(names){const obj=names.reduce(((obj,name,i)=>(obj[name]=i,obj)),{});return Object.freeze(Object.assign(Object.create(null),obj))}}},Wikifier=(()=>{let _callDepth=0;class Wikifier{constructor(destination,source,options){Wikifier.Parser.Profile.isEmpty()&&Wikifier.Parser.Profile.compile(),Object.defineProperties(this,{source:{value:String(source)},options:{writable:!0,value:Object.assign({profile:\"all\"},options)},nextMatch:{writable:!0,value:0},output:{writable:!0,value:null},_rawArgs:{writable:!0,value:\"\"}}),null==destination?this.output=document.createDocumentFragment():destination.jquery?this.output=destination[0]:this.output=destination;try{++_callDepth,this.subWikify(this.output),1===_callDepth&&Config.cleanupWikifierOutput&&convertBreaks(this.output)}finally{--_callDepth}}subWikify(output,terminator,options){if(Wikifier.stopWikify)return;const oldOutput=this.output;let newOptions,oldOptions;this.output=output,Wikifier.Option.length>0&&(newOptions=Object.assign(newOptions||{},Wikifier.Option.options)),null!==options&&\"object\"==typeof options&&(newOptions=Object.assign(newOptions||{},options)),newOptions&&(oldOptions=this.options,this.options=Object.assign({},this.options,newOptions));const parsersProfile=Wikifier.Parser.Profile.get(this.options.profile),terminatorRegExp=terminator?new RegExp(`(?:${terminator})`,this.options.ignoreTerminatorCase?\"gim\":\"gm\"):null;let terminatorMatch,parserMatch;do{if(parsersProfile.parserRegExp.lastIndex=this.nextMatch,terminatorRegExp&&(terminatorRegExp.lastIndex=this.nextMatch),parserMatch=parsersProfile.parserRegExp.exec(this.source),terminatorMatch=terminatorRegExp?terminatorRegExp.exec(this.source):null,terminatorMatch&&(!parserMatch||terminatorMatch.index<=parserMatch.index))return terminatorMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,terminatorMatch.index),this.matchStart=terminatorMatch.index,this.matchLength=terminatorMatch[0].length,this.matchText=terminatorMatch[0],this.nextMatch=terminatorRegExp.lastIndex,this.output=oldOutput,void(oldOptions&&(this.options=oldOptions));if(parserMatch){let matchingParser;parserMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,parserMatch.index),this.matchStart=parserMatch.index,this.matchLength=parserMatch[0].length,this.matchText=parserMatch[0],this.nextMatch=parsersProfile.parserRegExp.lastIndex;for(let i=1,iend=parserMatch.length;i<iend;++i)if(parserMatch[i]){matchingParser=i-1;break}if(parsersProfile.parsers[matchingParser].handler(this),Wikifier.stopWikify)return;if(null!=TempState.break)break}}while(terminatorMatch||parserMatch);null==TempState.break?this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length):this.output.lastChild&&this.output.lastChild.nodeType===Node.ELEMENT_NODE&&\"BR\"===this.output.lastChild.nodeName.toUpperCase()&&jQuery(this.output.lastChild).remove(),this.output=oldOutput,oldOptions&&(this.options=oldOptions)}outputText(destination,startPos,endPos){destination.appendChild(document.createTextNode(this.source.substring(startPos,endPos)))}rawArgs(){return this._rawArgs}fullArgs(){return Scripting.parse(this._rawArgs)}static wikifyEval(text){const output=document.createDocumentFragment();new Wikifier(output,text);const errors=output.querySelector(\".error\");if(null!==errors)throw new Error(errors.textContent.replace(errorPrologRegExp,\"\"));return output}static createInternalLink(destination,passage,text,callback){const $link=jQuery(document.createElement(\"a\"));return null!=passage&&($link.attr(\"data-passage\",passage),Story.has(passage)?($link.addClass(\"link-internal\"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass(\"link-visited\")):$link.addClass(\"link-broken\"),$link.ariaClick({one:!0},(()=>{\"function\"==typeof callback&&callback(),Engine.play(passage)}))),text&&$link.append(document.createTextNode(text)),destination&&$link.appendTo(destination),$link[0]}static createExternalLink(destination,url,text){const $link=jQuery(document.createElement(\"a\")).attr(\"target\",\"_blank\").addClass(\"link-external\").text(text).appendTo(destination);return null!=url&&$link.attr({href:url,tabindex:0}),$link[0]}static isExternalLink(link){if(Story.has(link))return!1;return new RegExp(`^${Patterns.url}`,\"gim\").test(link)||/[/.?#]/.test(link)}}return Object.defineProperty(Wikifier,\"Option\",{value:(()=>{let _optionsStack=[];return Object.freeze(Object.defineProperties({},{length:{get:function(){return _optionsStack.length}},options:{get:function(){return Object.assign({},..._optionsStack)}},clear:{value:function(){_optionsStack=[]}},get:{value:function(idx){return _optionsStack[idx]}},pop:{value:function(){return _optionsStack.pop()}},push:{value:function(options){if(\"object\"!=typeof options||null===options)throw new TypeError(`Wikifier.Option.push options parameter must be an object (received: ${Util.getType(options)})`);return _optionsStack.push(options)}}}))})()}),Object.defineProperty(Wikifier,\"Parser\",{value:(()=>{const _parsers=[];let _profiles;function parsersHas(name){return!!_parsers.find((parser=>parser.name===name))}return Object.freeze(Object.defineProperties({},{parsers:{get:function(){return _parsers}},add:{value:function(parser){if(\"object\"!=typeof parser)throw new Error(\"Wikifier.Parser.add parser parameter must be an object\");if(!parser.hasOwnProperty(\"name\"))throw new Error('parser object missing required \"name\" property');if(\"string\"!=typeof parser.name)throw new Error('parser object \"name\" property must be a string');if(!parser.hasOwnProperty(\"match\"))throw new Error('parser object missing required \"match\" property');if(\"string\"!=typeof parser.match)throw new Error('parser object \"match\" property must be a string');if(!parser.hasOwnProperty(\"handler\"))throw new Error('parser object missing required \"handler\" property');if(\"function\"!=typeof parser.handler)throw new Error('parser object \"handler\" property must be a function');if(parser.hasOwnProperty(\"profiles\")&&!Array.isArray(parser.profiles))throw new Error('parser object \"profiles\" property must be an array');if(parsersHas(parser.name))throw new Error(`cannot clobber existing parser \"${parser.name}\"`);_parsers.push(parser)}},delete:{value:function(name){const parser=_parsers.find((parser=>parser.name===name));parser&&_parsers.delete(parser)}},isEmpty:{value:function(){return 0===_parsers.length}},has:{value:parsersHas},get:{value:function(name){return _parsers.find((parser=>parser.name===name))||null}},Profile:{value:Object.freeze(Object.defineProperties({},{profiles:{get:function(){return _profiles}},compile:{value:function(){const all=_parsers,core=all.filter((parser=>!Array.isArray(parser.profiles)||parser.profiles.includes(\"core\")));return _profiles=Object.freeze({all:{parsers:all,parserRegExp:new RegExp(all.map((parser=>`(${parser.match})`)).join(\"|\"),\"gm\")},core:{parsers:core,parserRegExp:new RegExp(core.map((parser=>`(${parser.match})`)).join(\"|\"),\"gm\")}}),_profiles}},isEmpty:{value:function(){return\"object\"!=typeof _profiles||0===Object.keys(_profiles).length}},has:{value:function(profile){return\"object\"==typeof _profiles&&_profiles.hasOwnProperty(profile)}},get:{value:function(profile){if(\"object\"!=typeof _profiles||!_profiles.hasOwnProperty(profile))throw new Error(`nonexistent parser profile \"${profile}\"`);return _profiles[profile]}}}))}}))})()}),Object.defineProperties(Wikifier,{helpers:{value:{}},stopWikify:{value:!1,writable:!0},getValue:{value:State.getVar},setValue:{value:State.setVar},parse:{value:Scripting.parse},evalExpression:{value:Scripting.evalTwineScript},evalStatements:{value:Scripting.evalTwineScript},textPrimitives:{value:Patterns}}),Object.defineProperties(Wikifier.helpers,{inlineCss:{value:(()=>{const lookaheadRe=new RegExp(Patterns.inlineCss,\"gm\"),idOrClassRe=new RegExp(`(${Patterns.cssIdOrClassSigil})(${Patterns.anyLetter}+)`,\"g\");return function(w){const css={classes:[],id:\"\",styles:{}};let matched;do{lookaheadRe.lastIndex=w.nextMatch;const match=lookaheadRe.exec(w.source);if(matched=match&&match.index===w.nextMatch,matched){if(match[1])css.styles[Util.fromCssProperty(match[1])]=match[2].trim();else if(match[3])css.styles[Util.fromCssProperty(match[3])]=match[4].trim();else if(match[5]){let subMatch;for(idOrClassRe.lastIndex=0;null!==(subMatch=idOrClassRe.exec(match[5]));)\".\"===subMatch[1]?css.classes.push(subMatch[2]):css.id=subMatch[2]}w.nextMatch=lookaheadRe.lastIndex}}while(matched);return css}})()},evalText:{value(text){let result;try{switch(result=Scripting.evalTwineScript(text),typeof result){case\"string\":\"\"===result.trim()&&(result=text);break;case\"number\":result=String(result);break;default:result=text}}catch(ex){result=text}return result}},evalPassageId:{value:passage=>null==passage||Story.has(passage)?passage:Wikifier.helpers.evalText(passage)},hasBlockContext:{value(nodes){const hasGCS=\"function\"==typeof window.getComputedStyle;for(let i=nodes.length-1;i>=0;--i){const node=nodes[i];switch(node.nodeType){case Node.ELEMENT_NODE:{const tagName=node.nodeName.toUpperCase();if(\"BR\"===tagName)return!0;const styles=hasGCS?window.getComputedStyle(node,null):node.currentStyle;if(styles&&styles.display){if(\"none\"===styles.display)continue;return\"block\"===styles.display}switch(tagName){case\"ADDRESS\":case\"ARTICLE\":case\"ASIDE\":case\"BLOCKQUOTE\":case\"CENTER\":case\"DIV\":case\"DL\":case\"FIGURE\":case\"FOOTER\":case\"FORM\":case\"H1\":case\"H2\":case\"H3\":case\"H4\":case\"H5\":case\"H6\":case\"HEADER\":case\"HR\":case\"MAIN\":case\"NAV\":case\"OL\":case\"P\":case\"PRE\":case\"SECTION\":case\"TABLE\":case\"UL\":return!0}}return!1;case Node.COMMENT_NODE:continue;default:return!1}}return!0}},createShadowSetterCallback:{value:(()=>{let macroParser=null;function getMacroContextShadowView(){const macro=macroParser||function(){if(!macroParser&&(macroParser=Wikifier.Parser.get(\"macro\"),!macroParser))throw new Error('cannot find \"macro\" parser');return macroParser}(),view=new Set;for(let context=macro.context;null!==context;context=context.parent)context._shadows&&context._shadows.forEach((name=>view.add(name)));return[...view]}return function(code){const shadowStore={};return getMacroContextShadowView().forEach((varName=>{const varKey=varName.slice(1),store=\"$\"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]})),function(){const shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null;try{return shadowNames.forEach((varName=>{const varKey=varName.slice(1),store=\"$\"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),Scripting.evalJavaScript(code)}finally{shadowNames.forEach((varName=>{const varKey=varName.slice(1),store=\"$\"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}})()},parseSquareBracketedMarkup:{value:(()=>{const Item=Lexer.enumFromNames([\"Error\",\"DelimLTR\",\"DelimRTL\",\"InnerMeta\",\"ImageMeta\",\"LinkMeta\",\"Link\",\"RightMeta\",\"Setter\",\"Source\",\"Text\"]),Delim=Lexer.enumFromNames([\"None\",\"LTR\",\"RTL\"]);function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case\"\\\\\":{const ch=lexer.next();if(ch!==EOF&&\"\\n\"!==ch)break}case EOF:case\"\\n\":return EOF;case endQuote:break loop}return lexer.pos}function lexLeftMeta(lexer){if(!lexer.accept(\"[\"))return lexer.error(Item.Error,\"malformed square-bracketed markup\");if(lexer.accept(\"[\"))lexer.data.isLink=!0,lexer.emit(Item.LinkMeta);else{if(lexer.accept(\"<>\"),!(lexer.accept(\"Ii\")&&lexer.accept(\"Mm\")&&lexer.accept(\"Gg\")&&lexer.accept(\"[\")))return lexer.error(Item.Error,\"malformed square-bracketed markup\");lexer.data.isLink=!1,lexer.emit(Item.ImageMeta)}return lexer.depth=2,lexCoreComponents}function lexCoreComponents(lexer){const what=lexer.data.isLink?\"link\":\"image\";let delim=Delim.None;for(;;)switch(lexer.next()){case EOF:case\"\\n\":return lexer.error(Item.Error,`unterminated ${what} markup`);case'\"':if(slurpQuote(lexer,'\"')===EOF)return lexer.error(Item.Error,`unterminated double quoted string in ${what} markup`);break;case\"|\":delim===Delim.None&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(),lexer.emit(Item.DelimLTR));break;case\"-\":delim===Delim.None&&\">\"===lexer.peek()&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(2),lexer.emit(Item.DelimLTR));break;case\"<\":delim===Delim.None&&\"-\"===lexer.peek()&&(delim=Delim.RTL,lexer.backup(),lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.DelimRTL));break;case\"[\":++lexer.depth;break;case\"]\":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case\"[\":return++lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.InnerMeta),lexer.data.isLink?lexSetter:lexImageLink;case\"]\":return--lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,`malformed ${what} markup`)}}}function lexImageLink(lexer){const what=lexer.data.isLink?\"link\":\"image\";for(;;)switch(lexer.next()){case EOF:case\"\\n\":return lexer.error(Item.Error,`unterminated ${what} markup`);case'\"':if(slurpQuote(lexer,'\"')===EOF)return lexer.error(Item.Error,`unterminated double quoted string in ${what} markup link component`);break;case\"[\":++lexer.depth;break;case\"]\":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case\"[\":return++lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.InnerMeta),lexSetter;case\"]\":return--lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,`malformed ${what} markup`)}}}function lexSetter(lexer){const what=lexer.data.isLink?\"link\":\"image\";for(;;)switch(lexer.next()){case EOF:case\"\\n\":return lexer.error(Item.Error,`unterminated ${what} markup`);case'\"':if(slurpQuote(lexer,'\"')===EOF)return lexer.error(Item.Error,`unterminated double quoted string in ${what} markup setter component`);break;case\"'\":if(slurpQuote(lexer,\"'\")===EOF)return lexer.error(Item.Error,`unterminated single quoted string in ${what} markup setter component`);break;case\"[\":++lexer.depth;break;case\"]\":if(--lexer.depth,1===lexer.depth)return\"]\"!==lexer.peek()?lexer.error(Item.Error,`malformed ${what} markup`):(--lexer.depth,lexer.backup(),lexer.emit(Item.Setter),lexer.forward(2),lexer.emit(Item.RightMeta),null)}}return function(w){const lexer=new Lexer(w.source,lexLeftMeta);lexer.start=lexer.pos=w.matchStart;const markup={},items=lexer.run(),last=items.last();return last&&last.type===Item.Error?markup.error=last.message:items.forEach((item=>{const text=item.text.trim();switch(item.type){case Item.ImageMeta:markup.isImage=!0,\"<\"===text[1]?markup.align=\"left\":\">\"===text[1]&&(markup.align=\"right\");break;case Item.LinkMeta:markup.isLink=!0;break;case Item.Link:\"~\"===text[0]?(markup.forceInternal=!0,markup.link=text.slice(1)):markup.link=text;break;case Item.Setter:markup.setter=text;break;case Item.Source:markup.source=text;break;case Item.Text:markup.text=text}})),markup.pos=lexer.pos,markup}})()}}),Wikifier})();(()=>{function _verbatimTagHandler(w){this.lookahead.lastIndex=w.matchStart;const match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createDocumentFragment()).append(match[1]).appendTo(w.output))}Wikifier.Parser.add({name:\"quoteByBlock\",profiles:[\"block\"],match:\"^<<<\\\\n\",terminator:\"^<<<\\\\n\",handler(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement(\"blockquote\")).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:\"quoteByLine\",profiles:[\"block\"],match:\"^>+\",lookahead:/^>+/gm,terminator:\"\\\\n\",handler(w){if(!Wikifier.helpers.hasBlockContext(w.output.childNodes))return void jQuery(w.output).append(document.createTextNode(w.matchText));const destStack=[w.output];let matched,i,curLevel=0,newLevel=w.matchLength;do{if(newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement(\"blockquote\")).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();curLevel=newLevel,w.subWikify(destStack[destStack.length-1],this.terminator),jQuery(document.createElement(\"br\")).appendTo(destStack[destStack.length-1]),this.lookahead.lastIndex=w.nextMatch;const match=this.lookahead.exec(w.source);matched=match&&match.index===w.nextMatch,matched&&(newLevel=match[0].length,w.nextMatch+=match[0].length)}while(matched)}}),Wikifier.Parser.add({name:\"macro\",profiles:[\"core\"],match:\"<<\",lookahead:new RegExp(`<<(/?${Patterns.macroName})(?:\\\\s*)((?:(?:/\\\\*[^*]*\\\\*+(?:[^/*][^*]*\\\\*+)*/)|(?://.*\\\\n)|(?:\\`(?:\\\\\\\\.|[^\\`\\\\\\\\])*\\`)|(?:\"(?:\\\\\\\\.|[^\"\\\\\\\\])*\")|(?:'(?:\\\\\\\\.|[^'\\\\\\\\])*')|(?:\\\\[(?:[<>]?[Ii][Mm][Gg])?\\\\[[^\\\\r\\\\n]*?\\\\]\\\\]+)|[^>]|(?:>(?!>)))*)>>`,\"gm\"),working:{source:\"\",name:\"\",arguments:\"\",index:0},context:null,handler(w){const matchStart=this.lookahead.lastIndex=w.matchStart;if(this.parseTag(w)){const nextMatch=w.nextMatch,name=this.working.name,rawArgs=this.working.arguments;let macro;try{if(macro=Macro.get(name),!macro){if(Macro.tags.has(name)){const tags=Macro.tags.get(name);return throwError(w.output,`child tag <<${name}>> was found outside of a call to its parent macro${1===tags.length?\"\":\"s\"} <<${tags.join(\">>, <<\")}>>`,w.source.slice(matchStart,w.nextMatch))}return throwError(w.output,`macro <<${name}>> does not exist`,w.source.slice(matchStart,w.nextMatch))}{let payload=null;if(void 0!==macro.tags&&(payload=this.parseBody(w,macro),!payload))return w.nextMatch=nextMatch,throwError(w.output,`cannot find a closing tag for macro <<${name}>>`,`${w.source.slice(matchStart,w.nextMatch)}…`);if(\"function\"!=typeof macro.handler)return throwError(w.output,`macro <<${name}>> handler function ${void 0===macro.handler?\"does not exist\":\"is not a function\"}`,w.source.slice(matchStart,w.nextMatch));{const args=payload?payload[0].args:this.createArgs(rawArgs,this.skipArgs(macro,macro.name));if(void 0!==macro._MACRO_API){this.context=new MacroContext({macro:macro,name:name,args:args,payload:payload,source:w.source.slice(matchStart,w.nextMatch),parent:this.context,parser:w});try{macro.handler.call(this.context)}finally{macro.isWidget&&1===Wikifier.stopWikify&&(Wikifier.stopWikify=0),this.context=this.context.parent}}else{const prevRawArgs=w._rawArgs;w._rawArgs=rawArgs;try{macro.handler(w.output,name,args,w,payload)}finally{w._rawArgs=prevRawArgs}}}}}catch(ex){return throwError(w.output,`cannot execute ${macro&&macro.isWidget?\"widget\":\"macro\"} <<${name}>>: ${ex.message}`,w.source.slice(matchStart,w.nextMatch))}finally{this.working.source=\"\",this.working.name=\"\",this.working.arguments=\"\",this.working.index=0}}else w.outputText(w.output,w.matchStart,w.nextMatch)},parseTag(w){const match=this.lookahead.exec(w.source);return!(!match||match.index!==w.matchStart||!match[1])&&(w.nextMatch=this.lookahead.lastIndex,this.working.source=w.source.slice(match.index,this.lookahead.lastIndex),this.working.name=match[1],this.working.arguments=match[2],this.working.index=match.index,!0)},parseBody(w,macro){const openTag=this.working.name,closeTag=`/${openTag}`,closeAlt=`end${openTag}`,bodyTags=!!Array.isArray(macro.tags)&&macro.tags,payload=[];let end=-1,opened=1,curSource=this.working.source,curTag=this.working.name,curArgument=this.working.arguments,contentStart=w.nextMatch;for(;-1!==(w.matchStart=w.source.indexOf(this.match,w.nextMatch));){if(!this.parseTag(w)){this.lookahead.lastIndex=w.nextMatch=w.matchStart+this.match.length;continue}const tagSource=this.working.source,tagName=this.working.name,tagArgs=this.working.arguments,tagBegin=this.working.index,tagEnd=w.nextMatch,hasArgs=\"\"!==tagArgs.trim();switch(tagName){case openTag:++opened;break;case closeAlt:case closeTag:if(hasArgs)throw w.nextMatch=tagBegin+2+tagName.length,new Error(`malformed closing tag: \"${tagSource}\"`);--opened;break;default:if(hasArgs&&tagName.startsWith(\"/\")){this.lookahead.lastIndex=w.nextMatch=tagBegin+2+tagName.length;continue}if(1===opened&&bodyTags)for(let i=0,iend=bodyTags.length;i<iend;++i)tagName===bodyTags[i]&&(payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),curSource=tagSource,curTag=tagName,curArgument=tagArgs,contentStart=tagEnd)}if(0===opened){payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),end=tagEnd;break}}return-1!==end?(w.nextMatch=end,payload):null},createArgs(rawArgsString,skipArgs){const args=skipArgs?[]:this.parseArgs(rawArgsString);return Object.defineProperties(args,{raw:{value:rawArgsString},full:{value:Scripting.parse(rawArgsString)}}),args},skipArgs(macro,tagName){if(void 0!==macro.skipArgs){const sa=macro.skipArgs;return\"boolean\"==typeof sa&&sa||Array.isArray(sa)&&sa.includes(tagName)}return void 0!==macro.skipArg0&&(macro.skipArg0&&macro.name===tagName)},parseArgs:(()=>{const Item=Lexer.enumFromNames([\"Error\",\"Bareword\",\"Expression\",\"String\",\"SquareBracket\",\"ObjectLiteral\",\"FunctionCall\"]),spaceRe=new RegExp(Patterns.space),notSpaceRe=new RegExp(Patterns.notSpace),varTest=new RegExp(`^${Patterns.variable}`);function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case\"\\\\\":{const ch=lexer.next();if(ch!==EOF&&\"\\n\"!==ch)break}case EOF:case\"\\n\":return EOF;case endQuote:break loop}return lexer.pos}function genericSlurp(lexer,openChar,closeChar,initCount){let count=initCount;loop:for(;;){switch(lexer.next()){case openChar:count++;break;case closeChar:if(count--,0===count)break loop;break;case EOF:case\"\\n\":return!1}}return lexer.pos}function lexSpace(lexer){const offset=lexer.source.slice(lexer.pos).search(notSpaceRe);let remainingStr=lexer.source.slice(lexer.pos);if(offset===EOF)return null;if(0!==offset&&(lexer.pos+=offset,lexer.ignore(),remainingStr=lexer.source.slice(lexer.pos)),/^[a-zA-Z_$][0-9a-zA-Z_$]*\\s*\\(/.test(remainingStr))return lexer.next(),lexFunctionCall;switch(lexer.next()){case\"`\":return lexExpression;case'\"':return lexDoubleQuote;case\"'\":return lexSingleQuote;case\"[\":return lexSquareBracket;case\"{\":return lexObjectLiteral;default:return lexBareword}}function lexExpression(lexer){return slurpQuote(lexer,\"`\")===EOF?lexer.error(Item.Error,\"unterminated backquote expression\"):(lexer.emit(Item.Expression),lexSpace)}function lexDoubleQuote(lexer){return slurpQuote(lexer,'\"')===EOF?lexer.error(Item.Error,\"unterminated double quoted string\"):(lexer.emit(Item.String),lexSpace)}function lexSingleQuote(lexer){return slurpQuote(lexer,\"'\")===EOF?lexer.error(Item.Error,\"unterminated single quoted string\"):(lexer.emit(Item.String),lexSpace)}function lexSquareBracket(lexer){let what;return lexer.accept(\"<>IiMmGg\")?(what=\"image\",lexer.acceptRun(\"<>IiMmGg\")):what=\"link\",lexer.accept(\"[\")?genericSlurp(lexer,\"[\",\"]\",2)===EOF?lexer.error(Item.Error,`unterminated ${what} markup`):(lexer.emit(Item.SquareBracket),lexSpace):lexer.error(Item.Error,`malformed ${what} markup`)}function lexObjectLiteral(lexer){return genericSlurp(lexer,\"{\",\"}\",1)===EOF?lexer.error(Item.Error,\"unterminated object literal\"):(lexer.emit(Item.ObjectLiteral),lexSpace)}function lexFunctionCall(lexer){return genericSlurp(lexer,\"(\",\")\",0)===EOF?lexer.error(Item.Error,\"unterminated function call\"):(lexer.emit(Item.FunctionCall),lexSpace)}function lexBareword(lexer){const offset=lexer.source.slice(lexer.pos).search(spaceRe);return lexer.pos=offset===EOF?lexer.source.length:lexer.pos+offset,lexer.emit(Item.Bareword),offset===EOF?null:lexSpace}return function(rawArgsString){const lexer=new Lexer(rawArgsString,lexSpace),args=[];return lexer.run().forEach((item=>{let arg=item.text;switch(item.type){case Item.Error:throw new Error(`unable to parse macro argument \"${arg}\": ${item.message}`);case Item.Bareword:if(varTest.test(arg))arg=State.getVar(arg);else if(/^(?:settings|setup)[.[]/.test(arg))try{arg=Scripting.evalTwineScript(arg)}catch(ex){throw new Error(`unable to parse macro argument \"${arg}\": ${ex.message}`)}else if(\"null\"===arg)arg=null;else if(\"undefined\"===arg)arg=undefined;else if(\"true\"===arg)arg=!0;else if(\"false\"===arg)arg=!1;else if(\"NaN\"===arg)arg=NaN;else{const argAsNum=Number(arg);Number.isNaN(argAsNum)||(arg=argAsNum)}break;case Item.Expression:if(arg=arg.slice(1,-1).trim(),\"\"===arg)arg=undefined;else try{arg=Scripting.evalTwineScript(`(${arg})`)}catch(ex){throw new Error(`unable to parse macro argument expression \"${arg}\": ${ex.message}`)}break;case Item.String:try{arg=Scripting.evalJavaScript(arg)}catch(ex){throw new Error(`unable to parse macro argument string \"${arg}\": ${ex.message}`)}break;case Item.SquareBracket:{const markup=Wikifier.helpers.parseSquareBracketedMarkup({source:arg,matchStart:0});if(markup.hasOwnProperty(\"error\"))throw new Error(`unable to parse macro argument \"${arg}\": ${markup.error}`);if(markup.pos<arg.length)throw new Error(`unable to parse macro argument \"${arg}\": unexpected character(s) \"${arg.slice(markup.pos)}\" (pos: ${markup.pos})`);markup.isLink?(arg={isLink:!0},arg.count=markup.hasOwnProperty(\"text\")?2:1,arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.text=markup.hasOwnProperty(\"text\")?Wikifier.helpers.evalText(markup.text):arg.link,arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link),arg.setFn=markup.hasOwnProperty(\"setter\")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null):markup.isImage&&(arg=(source=>{const imgObj={source:source,isImage:!0};if(\"data:\"!==source.slice(0,5)&&Story.has(source)){const passage=Story.get(source);passage.tags.includes(\"Twine.image\")&&(imgObj.source=passage.text,imgObj.passage=passage.title)}return imgObj})(Wikifier.helpers.evalPassageId(markup.source)),markup.hasOwnProperty(\"align\")&&(arg.align=markup.align),markup.hasOwnProperty(\"text\")&&(arg.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty(\"link\")&&(arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link)),arg.setFn=markup.hasOwnProperty(\"setter\")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null)}break;case Item.ObjectLiteral:try{arg=Scripting.evalTwineScript(`(${arg})`)}catch(ex){throw new Error(`unable to parse macro argument object literal \"${arg}\": ${ex.message}`)}break;case Item.FunctionCall:try{arg=Scripting.evalTwineScript(arg)}catch(ex){throw new Error(`unable to parse macro argument \"${arg}\": ${ex.message}`)}}args.push(arg)})),args}})()}),Wikifier.Parser.add({name:\"link\",profiles:[\"core\"],match:\"\\\\[\\\\[[^[]\",handler(w){const markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty(\"error\"))return void w.outputText(w.output,w.matchStart,w.nextMatch);w.nextMatch=markup.pos;const link=Wikifier.helpers.evalPassageId(markup.link),text=markup.hasOwnProperty(\"text\")?Wikifier.helpers.evalText(markup.text):link,setFn=markup.hasOwnProperty(\"setter\")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null,output=(Config.debug?new DebugView(w.output,\"link-markup\",\"[[link]]\",w.source.slice(w.matchStart,w.nextMatch)):w).output;markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(output,link,text,setFn):Wikifier.createExternalLink(output,link,text)}}),Wikifier.Parser.add({name:\"urlLink\",profiles:[\"core\"],match:Patterns.url,handler(w){w.outputText(Wikifier.createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch)}}),Wikifier.Parser.add({name:\"image\",profiles:[\"core\"],match:\"\\\\[[<>]?[Ii][Mm][Gg]\\\\[\",handler(w){const markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty(\"error\"))return void w.outputText(w.output,w.matchStart,w.nextMatch);let debugView;w.nextMatch=markup.pos,Config.debug&&(debugView=new DebugView(w.output,\"image-markup\",markup.hasOwnProperty(\"link\")?\"[img[][link]]\":\"[img[]]\",w.source.slice(w.matchStart,w.nextMatch)),debugView.modes({block:!0}));const setFn=markup.hasOwnProperty(\"setter\")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null;let source,el=(Config.debug?debugView:w).output;if(markup.hasOwnProperty(\"link\")){const link=Wikifier.helpers.evalPassageId(markup.link);el=markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(el,link,null,setFn):Wikifier.createExternalLink(el,link),el.classList.add(\"link-image\")}if(el=jQuery(document.createElement(\"img\")).appendTo(el).get(0),source=Wikifier.helpers.evalPassageId(markup.source),\"data:\"!==source.slice(0,5)&&Story.has(source)){const passage=Story.get(source);passage.tags.includes(\"Twine.image\")&&(el.setAttribute(\"data-passage\",passage.title),source=passage.text.trim())}el.src=source,markup.hasOwnProperty(\"text\")&&(el.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty(\"align\")&&(el.align=markup.align)}}),Wikifier.Parser.add({name:\"monospacedByBlock\",profiles:[\"block\"],match:\"^\\\\{\\\\{\\\\{\\\\n\",lookahead:/^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)/gm,handler(w){this.lookahead.lastIndex=w.matchStart;const match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){const pre=jQuery(document.createElement(\"pre\"));jQuery(document.createElement(\"code\")).text(match[1]).appendTo(pre),pre.appendTo(w.output),w.nextMatch=this.lookahead.lastIndex}}}),Wikifier.Parser.add({name:\"formatByChar\",profiles:[\"core\"],match:\"''|//|__|\\\\^\\\\^|~~|==|\\\\{\\\\{\\\\{\",handler(w){switch(w.matchText){case\"''\":w.subWikify(jQuery(document.createElement(\"strong\")).appendTo(w.output).get(0),\"''\");break;case\"//\":w.subWikify(jQuery(document.createElement(\"em\")).appendTo(w.output).get(0),\"//\");break;case\"__\":w.subWikify(jQuery(document.createElement(\"u\")).appendTo(w.output).get(0),\"__\");break;case\"^^\":w.subWikify(jQuery(document.createElement(\"sup\")).appendTo(w.output).get(0),\"\\\\^\\\\^\");break;case\"~~\":w.subWikify(jQuery(document.createElement(\"sub\")).appendTo(w.output).get(0),\"~~\");break;case\"==\":w.subWikify(jQuery(document.createElement(\"s\")).appendTo(w.output).get(0),\"==\");break;case\"{{{\":{const lookahead=/\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}/gm;lookahead.lastIndex=w.matchStart;const match=lookahead.exec(w.source);match&&match.index===w.matchStart&&(jQuery(document.createElement(\"code\")).text(match[1]).appendTo(w.output),w.nextMatch=lookahead.lastIndex)}}}}),Wikifier.Parser.add({name:\"customStyle\",profiles:[\"core\"],match:\"@@\",terminator:\"@@\",blockRe:/\\s*\\n/gm,handler(w){const css=Wikifier.helpers.inlineCss(w);this.blockRe.lastIndex=w.nextMatch;const blockMatch=this.blockRe.exec(w.source),blockLevel=blockMatch&&blockMatch.index===w.nextMatch,$el=jQuery(document.createElement(blockLevel?\"div\":\"span\")).appendTo(w.output);0===css.classes.length&&\"\"===css.id&&0===Object.keys(css.styles).length?$el.addClass(\"marked\"):(css.classes.forEach((className=>$el.addClass(className))),\"\"!==css.id&&$el.attr(\"id\",css.id),$el.css(css.styles)),blockLevel?(w.nextMatch+=blockMatch[0].length,w.subWikify($el[0],`\\\\n?${this.terminator}`)):w.subWikify($el[0],this.terminator)}}),Wikifier.Parser.add({name:\"verbatimText\",profiles:[\"core\"],match:'\"{3}|<[Nn][Oo][Ww][Ii][Kk][Ii]>',lookahead:/(?:\"{3}((?:.|\\n)*?)\"{3})|(?:<[Nn][Oo][Ww][Ii][Kk][Ii]>((?:.|\\n)*?)<\\/[Nn][Oo][Ww][Ii][Kk][Ii]>)/gm,handler(w){this.lookahead.lastIndex=w.matchStart;const match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createElement(\"span\")).addClass(\"verbatim\").text(match[1]||match[2]).appendTo(w.output))}}),Wikifier.Parser.add({name:\"horizontalRule\",profiles:[\"core\"],match:\"^----+$\\\\n?|<[Hh][Rr]\\\\s*/?>\\\\n?\",handler(w){jQuery(document.createElement(\"hr\")).appendTo(w.output)}}),Wikifier.Parser.add({name:\"emdash\",profiles:[\"core\"],match:\"--\",handler(w){jQuery(document.createTextNode(\"—\")).appendTo(w.output)}}),Wikifier.Parser.add({name:\"doubleDollarSign\",profiles:[\"core\"],match:\"\\\\${2}\",handler(w){jQuery(document.createTextNode(\"$\")).appendTo(w.output)}}),Wikifier.Parser.add({name:\"nakedVariable\",profiles:[\"core\"],match:`${Patterns.variable}(?:(?:\\\\.${Patterns.identifier})|(?:\\\\[\\\\d+\\\\])|(?:\\\\[\"(?:\\\\\\\\.|[^\"\\\\\\\\])+\"\\\\])|(?:\\\\['(?:\\\\\\\\.|[^'\\\\\\\\])+'\\\\])|(?:\\\\[${Patterns.variable}\\\\]))*`,handler(w){const result=State.getVar(w.matchText);null==result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,\"variable\",w.matchText,w.matchText):w).output,stringFrom(result))}}),Wikifier.Parser.add({name:\"template\",profiles:[\"core\"],match:`\\\\?${Patterns.templateName}`,handler(w){const name=w.matchText.slice(1);let template=Template.get(name),result=null;switch(template instanceof Array&&(template=template.random()),typeof template){case\"function\":try{result=stringFrom(template.call({name:name}))}catch(ex){return throwError(w.output,`cannot execute function template ?${name}: ${ex.message}`,w.source.slice(w.matchStart,w.nextMatch))}break;case\"string\":result=template}null===result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,\"template\",w.matchText,w.matchText):w).output,result)}}),Wikifier.Parser.add({name:\"heading\",profiles:[\"block\"],match:\"^!{1,6}\",terminator:\"\\\\n\",handler(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement(`h${w.matchLength}`)).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:\"table\",profiles:[\"block\"],match:\"^\\\\|(?:[^\\\\n]*)\\\\|(?:[fhck]?)$\",lookahead:/^\\|([^\\n]*)\\|([fhck]?)$/gm,rowTerminator:\"\\\\|(?:[cfhk]?)$\\\\n?\",cellPattern:\"(?:\\\\|([^\\\\n\\\\|]*)\\\\|)|(\\\\|[cfhk]?$\\\\n?)\",cellTerminator:\"(?:\\\\u0020*)\\\\|\",rowTypes:{c:\"caption\",f:\"tfoot\",h:\"thead\",\"\":\"tbody\"},handler(w){if(!Wikifier.helpers.hasBlockContext(w.output.childNodes))return void jQuery(w.output).append(document.createTextNode(w.matchText));const table=jQuery(document.createElement(\"table\")).appendTo(w.output).get(0),prevColumns=[];let matched,curRowType=null,$rowContainer=null,rowCount=0;w.nextMatch=w.matchStart;do{this.lookahead.lastIndex=w.nextMatch;const match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch,matched){const nextRowType=match[2];\"k\"===nextRowType?(table.className=match[1],w.nextMatch+=match[0].length+1):(nextRowType!==curRowType&&(curRowType=nextRowType,$rowContainer=jQuery(document.createElement(this.rowTypes[nextRowType])).appendTo(table)),\"c\"===curRowType?($rowContainer.css(\"caption-side\",0===rowCount?\"top\":\"bottom\"),w.nextMatch+=1,w.subWikify($rowContainer[0],this.rowTerminator)):this.rowHandler(w,jQuery(document.createElement(\"tr\")).appendTo($rowContainer).get(0),prevColumns),++rowCount)}}while(matched)},rowHandler(w,rowEl,prevColumns){const cellRe=new RegExp(this.cellPattern,\"gm\");let matched,col=0,curColCount=1;do{cellRe.lastIndex=w.nextMatch;const cellMatch=cellRe.exec(w.source);if(matched=cellMatch&&cellMatch.index===w.nextMatch,matched){if(\"~\"===cellMatch[1]){const last=prevColumns[col];last&&(++last.rowCount,last.$element.attr(\"rowspan\",last.rowCount).css(\"vertical-align\",\"middle\")),w.nextMatch=cellMatch.index+cellMatch[0].length-1}else if(\">\"===cellMatch[1])++curColCount,w.nextMatch=cellMatch.index+cellMatch[0].length-1;else{if(cellMatch[2]){w.nextMatch=cellMatch.index+cellMatch[0].length;break}{++w.nextMatch;const css=Wikifier.helpers.inlineCss(w);let $cell,spaceLeft=!1,spaceRight=!1;for(;\" \"===w.source.substr(w.nextMatch,1);)spaceLeft=!0,++w.nextMatch;\"!\"===w.source.substr(w.nextMatch,1)?($cell=jQuery(document.createElement(\"th\")).appendTo(rowEl),++w.nextMatch):$cell=jQuery(document.createElement(\"td\")).appendTo(rowEl),prevColumns[col]={rowCount:1,$element:$cell},curColCount>1&&($cell.attr(\"colspan\",curColCount),curColCount=1),w.subWikify($cell[0],this.cellTerminator),\" \"===w.matchText.substr(w.matchText.length-2,1)&&(spaceRight=!0),css.classes.forEach((className=>$cell.addClass(className))),\"\"!==css.id&&$cell.attr(\"id\",css.id),spaceLeft&&spaceRight?css.styles[\"text-align\"]=\"center\":spaceLeft?css.styles[\"text-align\"]=\"right\":spaceRight&&(css.styles[\"text-align\"]=\"left\"),$cell.css(css.styles),w.nextMatch=w.nextMatch-1}}++col}}while(matched)}}),Wikifier.Parser.add({name:\"list\",profiles:[\"block\"],match:\"^(?:(?:\\\\*+)|(?:#+))\",lookahead:/^(?:(\\*+)|(#+))/gm,terminator:\"\\\\n\",handler(w){if(!Wikifier.helpers.hasBlockContext(w.output.childNodes))return void jQuery(w.output).append(document.createTextNode(w.matchText));w.nextMatch=w.matchStart;const destStack=[w.output];let matched,i,curType=null,curLevel=0;do{this.lookahead.lastIndex=w.nextMatch;const match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch,matched){const newType=match[2]?\"ol\":\"ul\",newLevel=match[0].length;if(w.nextMatch+=match[0].length,newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();else newLevel===curLevel&&newType!==curType&&(destStack.pop(),destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0)));curLevel=newLevel,curType=newType,w.subWikify(jQuery(document.createElement(\"li\")).appendTo(destStack[destStack.length-1]).get(0),this.terminator)}}while(matched)}}),Wikifier.Parser.add({name:\"commentByBlock\",profiles:[\"core\"],match:\"(?:/(?:%|\\\\*))|(?:\\x3c!--)\",lookahead:/(?:\\/(%|\\*)(?:(?:.|\\n)*?)\\1\\/)|(?:<!--(?:(?:.|\\n)*?)-->)/gm,handler(w){this.lookahead.lastIndex=w.matchStart;const match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex)}}),Wikifier.Parser.add({name:\"lineContinuation\",profiles:[\"core\"],match:`\\\\\\\\${Patterns.spaceNoTerminator}*\\\\n|\\\\n${Patterns.spaceNoTerminator}*\\\\\\\\|\\\\n?\\\\\\\\${Patterns.spaceNoTerminator}*$|^${Patterns.spaceNoTerminator}*\\\\\\\\\\\\n?`,handler(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:\"lineBreak\",profiles:[\"core\"],match:\"\\\\n|<[Bb][Rr]\\\\s*/?>\",handler(w){w.options.nobr||jQuery(document.createElement(\"br\")).appendTo(w.output)}}),Wikifier.Parser.add({name:\"htmlCharacterReference\",profiles:[\"core\"],match:\"(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)\",handler(w){jQuery(document.createDocumentFragment()).append(w.matchText).appendTo(w.output)}}),Wikifier.Parser.add({name:\"xmlProlog\",profiles:[\"core\"],match:\"<\\\\?[Xx][Mm][Ll][^>]*\\\\?>\",handler(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:\"verbatimHtml\",profiles:[\"core\"],match:\"<[Hh][Tt][Mm][Ll]>\",lookahead:/<[Hh][Tt][Mm][Ll]>((?:.|\\n)*?)<\\/[Hh][Tt][Mm][Ll]>/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:\"verbatimScriptTag\",profiles:[\"core\"],match:\"<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>\",lookahead:/(<[Ss][Cc][Rr][Ii][Pp][Tt]*>(?:.|\\n)*?<\\/[Ss][Cc][Rr][Ii][Pp][Tt]>)/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:\"styleTag\",profiles:[\"core\"],match:\"<[Ss][Tt][Yy][Ll][Ee][^>]*>\",lookahead:/(<[Ss][Tt][Yy][Ll][Ee]*>)((?:.|\\n)*?)(<\\/[Ss][Tt][Yy][Ll][Ee]>)/gm,imageMarkup:new RegExp(Patterns.cssImage,\"g\"),hasImageMarkup:new RegExp(Patterns.cssImage),handler(w){this.lookahead.lastIndex=w.matchStart;const match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){w.nextMatch=this.lookahead.lastIndex;let css=match[2];this.hasImageMarkup.test(css)&&(this.imageMarkup.lastIndex=0,css=css.replace(this.imageMarkup,(wikiImage=>{const markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty(\"error\")||markup.pos<wikiImage.length)return wikiImage;let source=markup.source;if(\"data:\"!==source.slice(0,5)&&Story.has(source)){const passage=Story.get(source);passage.tags.includes(\"Twine.image\")&&(source=passage.text)}return`url(\"${source.replace(/\"/g,\"%22\")}\")`}))),jQuery(document.createDocumentFragment()).append(match[1]+css+match[3]).appendTo(w.output)}}}),Wikifier.Parser.add({name:\"svgTag\",profiles:[\"core\"],match:\"<[Ss][Vv][Gg][^>]*>\",lookahead:/<(\\/?)[Ss][Vv][Gg][^>]*>/gm,namespace:\"http://www.w3.org/2000/svg\",handler(w){this.lookahead.lastIndex=w.nextMatch;let match,depth=1;for(;depth>0&&null!==(match=this.lookahead.exec(w.source));)depth+=\"/\"===match[1]?-1:1;if(0===depth){w.nextMatch=this.lookahead.lastIndex;const svgTag=w.source.slice(w.matchStart,this.lookahead.lastIndex),$frag=jQuery(document.createDocumentFragment()).append(svgTag);$frag.find(\"a[data-passage],image[data-passage]\").each(((_,el)=>{const tagName=el.tagName.toLowerCase();try{this.processAttributeDirectives(el)}catch(ex){return throwError(w.output,`svg|<${tagName}>: ${ex.message}`,`${w.matchText}…`)}el.hasAttribute(\"data-passage\")&&this.processDataAttributes(el,tagName)})),$frag.appendTo(w.output)}},processAttributeDirectives(el){[...el.attributes].forEach((({name:name,value:value})=>{const evalShorthand=\"@\"===name[0];if(evalShorthand||name.startsWith(\"sc-eval:\")){const newName=name.slice(evalShorthand?1:8);if(\"data-setter\"===newName)throw new Error(`evaluation directive is not allowed on the data-setter attribute: \"${name}\"`);let result;try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error(`bad evaluation from attribute directive \"${name}\": ${ex.message}`)}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error(`cannot transform attribute directive \"${name}\" into attribute \"${newName}\"`)}}}))},processDataAttributes(el,tagName){let passage=el.getAttribute(\"data-passage\");if(null==passage)return;const evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute(\"data-passage\",evaluated)),\"\"!==passage)if(\"image\"===tagName)\"data:\"!==passage.slice(0,5)&&Story.has(passage)&&(passage=Story.get(passage),passage.tags.includes(\"Twine.image\")&&el.setAttribute(\"href\",passage.text.trim()));else{let setFn,setter=el.getAttribute(\"data-setter\");null!=setter&&(setter=String(setter).trim(),\"\"!==setter&&(setFn=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(setter)))),Story.has(passage)?(el.classList.add(\"link-internal\"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add(\"link-visited\")):el.classList.add(\"link-broken\"),jQuery(el).ariaClick({one:!0},(function(){\"function\"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}),Wikifier.Parser.add({name:\"htmlTag\",profiles:[\"core\"],match:`<${Patterns.htmlTagName}(?:\\\\s+[^\\\\u0000-\\\\u001F\\\\u007F-\\\\u009F\\\\s\"'>\\\\/=]+(?:\\\\s*=\\\\s*(?:\"[^\"]*?\"|'[^']*?'|[^\\\\s\"'=<>\\`]+))?)*\\\\s*\\\\/?>`,tagRe:new RegExp(`^<(${Patterns.htmlTagName})`),mediaTags:[\"audio\",\"img\",\"source\",\"track\",\"video\"],nobrTags:[\"audio\",\"colgroup\",\"datalist\",\"dl\",\"figure\",\"meter\",\"ol\",\"optgroup\",\"picture\",\"progress\",\"ruby\",\"select\",\"table\",\"tbody\",\"tfoot\",\"thead\",\"tr\",\"ul\",\"video\"],voidTags:[\"area\",\"base\",\"br\",\"col\",\"embed\",\"hr\",\"img\",\"input\",\"keygen\",\"link\",\"menuitem\",\"meta\",\"param\",\"source\",\"track\",\"wbr\"],handler(w){const tagMatch=this.tagRe.exec(w.matchText),tag=tagMatch&&tagMatch[1],tagName=tag&&tag.toLowerCase();if(tagName){const isVoid=this.voidTags.includes(tagName)||w.matchText.endsWith(\"/>\"),isNobr=this.nobrTags.includes(tagName);let terminator,terminatorMatch;if(!isVoid){terminator=`<\\\\/${tagName}\\\\s*>`;const terminatorRe=new RegExp(terminator,\"gim\");terminatorRe.lastIndex=w.matchStart,terminatorMatch=terminatorRe.exec(w.source)}if(!isVoid&&!terminatorMatch)return throwError(w.output,`cannot find a closing tag for HTML <${tag}>`,`${w.matchText}…`);{let debugView,output=w.output,el=document.createElement(w.output.tagName);for(el.innerHTML=w.matchText;el.firstChild;)el=el.firstChild;try{this.processAttributeDirectives(el)}catch(ex){return throwError(w.output,`<${tagName}>: ${ex.message}`,`${w.matchText}…`)}if(el.hasAttribute(\"data-passage\")&&(this.processDataAttributes(el,tagName),Config.debug&&(debugView=new DebugView(w.output,`html-${tagName}`,tagName,w.matchText),debugView.modes({block:\"img\"===tagName,nonvoid:terminatorMatch}),output=debugView.output)),terminatorMatch){try{Wikifier.Option.push({nobr:isNobr}),w.subWikify(el,terminator,{ignoreTerminatorCase:!0})}finally{Wikifier.Option.pop()}debugView&&jQuery(el).find(\".debug.block\").length>0&&debugView.modes({block:!0})}output.appendChild(\"track\"===tagName?el.cloneNode(!0):el)}}},processAttributeDirectives(el){[...el.attributes].forEach((({name:name,value:value})=>{const evalShorthand=\"@\"===name[0];if(evalShorthand||name.startsWith(\"sc-eval:\")){const newName=name.slice(evalShorthand?1:8);if(\"data-setter\"===newName)throw new Error(`evaluation directive is not allowed on the data-setter attribute: \"${name}\"`);let result;try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error(`bad evaluation from attribute directive \"${name}\": ${ex.message}`)}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error(`cannot transform attribute directive \"${name}\" into attribute \"${newName}\"`)}}}))},processDataAttributes(el,tagName){let passage=el.getAttribute(\"data-passage\");if(null==passage)return;const evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute(\"data-passage\",evaluated)),\"\"!==passage)if(this.mediaTags.includes(tagName)){if(\"data:\"!==passage.slice(0,5)&&Story.has(passage)){let parentName,twineTag;switch(passage=Story.get(passage),tagName){case\"audio\":case\"video\":twineTag=`Twine.${tagName}`;break;case\"img\":twineTag=\"Twine.image\";break;case\"track\":twineTag=\"Twine.vtt\";break;case\"source\":{const $parent=$(el).closest(\"audio,picture,video\");$parent.length&&(parentName=$parent.get(0).tagName.toLowerCase(),twineTag=`Twine.${\"picture\"===parentName?\"image\":parentName}`)}}passage.tags.includes(twineTag)&&(el[\"picture\"===parentName?\"srcset\":\"src\"]=passage.text.trim())}}else{let setFn,setter=el.getAttribute(\"data-setter\");null!=setter&&(setter=String(setter).trim(),\"\"!==setter&&(setFn=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(setter)))),Story.has(passage)?(el.classList.add(\"link-internal\"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add(\"link-visited\")):el.classList.add(\"link-broken\"),jQuery(el).ariaClick({one:!0},(function(){\"function\"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}})})();var Template=(()=>{const _templates=new Map,_validNameRe=new RegExp(`^(?:${Patterns.templateName})$`),_validType=template=>{const templateType=typeof template;return\"function\"===templateType||\"string\"===templateType};return Object.freeze(Object.defineProperties({},{add:{value:function(name,template){if(!(_validType(template)||template instanceof Array&&template.length>0&&template.every(_validType)))throw new TypeError(`invalid template type (${name}); templates must be: functions, strings, or an array of either`);(name instanceof Array?name:[name]).forEach((name=>{if(!_validNameRe.test(name))throw new Error(`invalid template name \"${name}\"`);if(_templates.has(name))throw new Error(`cannot clobber existing template ?${name}`);_templates.set(name,template)}))}},delete:{value:function(name){(name instanceof Array?name:[name]).forEach((name=>_templates.delete(name)))}},get:{value:function(name){return _templates.has(name)?_templates.get(name):null}},has:{value:function(name){return _templates.has(name)}},size:{get:function(){return _templates.size}}}))})(),Macro=(()=>{const _macros={},_tags={},_validNameRe=new RegExp(`^(?:${Patterns.macroName})$`);function macrosHas(name){return _macros.hasOwnProperty(name)}function tagsRegister(parent,bodyTags){if(!parent)throw new Error(\"no parent specified\");const allTags=[].concat([`/${parent}`,`end${parent}`],Array.isArray(bodyTags)?bodyTags:[]);for(let i=0;i<allTags.length;++i){const tag=allTags[i];if(macrosHas(tag))throw new Error(\"cannot register tag for an existing macro\");tagsHas(tag)?_tags[tag].includes(parent)||(_tags[tag].push(parent),_tags[tag].sort()):_tags[tag]=[parent]}}function tagsUnregister(parent){if(!parent)throw new Error(\"no parent specified\");Object.keys(_tags).forEach((tag=>{const i=_tags[tag].indexOf(parent);-1!==i&&(1===_tags[tag].length?delete _tags[tag]:_tags[tag].splice(i,1))}))}function tagsHas(name){return _tags.hasOwnProperty(name)}return Object.freeze(Object.defineProperties({},{add:{value:function macrosAdd(name,def){if(Array.isArray(name))name.forEach((name=>macrosAdd(name,def)));else{if(!_validNameRe.test(name))throw new Error(`invalid macro name \"${name}\"`);if(macrosHas(name))throw new Error(`cannot clobber existing macro <<${name}>>`);if(tagsHas(name))throw new Error(`cannot clobber child tag <<${name}>> of parent macro${1===_tags[name].length?\"\":\"s\"} <<${_tags[name].join(\">>, <<\")}>>`);try{if(\"object\"==typeof def)_macros[name]=Object.assign(Object.create(null),def,{_MACRO_API:!0});else{if(!macrosHas(def))throw new Error(`cannot create alias of nonexistent macro <<${def}>>`);_macros[name]=Object.create(_macros[def],{_ALIAS_OF:{enumerable:!0,value:def}})}Object.defineProperty(_macros,name,{writable:!1})}catch(ex){throw\"TypeError\"===ex.name?new Error(`cannot clobber protected macro <<${name}>>`):new Error(`unknown error when attempting to add macro <<${name}>>: [${ex.name}] ${ex.message}`)}if(void 0!==_macros[name].tags)if(null==_macros[name].tags)tagsRegister(name);else{if(!Array.isArray(_macros[name].tags))throw new Error(`bad value for \"tags\" property of macro <<${name}>>`);tagsRegister(name,_macros[name].tags)}}}},delete:{value:function macrosDelete(name){if(Array.isArray(name))name.forEach((name=>macrosDelete(name)));else if(macrosHas(name)){void 0!==_macros[name].tags&&tagsUnregister(name);try{Object.defineProperty(_macros,name,{writable:!0}),delete _macros[name]}catch(ex){throw new Error(`unknown error removing macro <<${name}>>: ${ex.message}`)}}else if(tagsHas(name))throw new Error(`cannot remove child tag <<${name}>> of parent macro <<${_tags[name]}>>`)}},isEmpty:{value:function(){return 0===Object.keys(_macros).length}},has:{value:macrosHas},get:{value:function(name){let macro=null;return macrosHas(name)&&\"function\"==typeof _macros[name].handler?macro=_macros[name]:macros.hasOwnProperty(name)&&\"function\"==typeof macros[name].handler&&(macro=macros[name]),macro}},init:{value:function(handler=\"init\"){Object.keys(_macros).forEach((name=>{\"function\"==typeof _macros[name][handler]&&_macros[name][handler](name)})),Object.keys(macros).forEach((name=>{\"function\"==typeof macros[name][handler]&&macros[name][handler](name)}))}},tags:{value:Object.freeze(Object.defineProperties({},{register:{value:tagsRegister},unregister:{value:tagsUnregister},has:{value:tagsHas},get:{value:function(name){return tagsHas(name)?_tags[name]:null}}}))},evalStatements:{value:(...args)=>Scripting.evalJavaScript(...args)}}))})(),MacroContext=class{constructor(contextData){const context=Object.assign({parent:null,macro:null,name:\"\",displayName:\"\",args:null,payload:null,parser:null,source:\"\"},contextData);if(null===context.macro||\"\"===context.name||null===context.parser)throw new TypeError(\"context object missing required properties\");Object.defineProperties(this,{self:{value:context.macro},name:{value:void 0===context.macro._ALIAS_OF?context.name:context.macro._ALIAS_OF},displayName:{value:context.name},args:{value:context.args},payload:{value:context.payload},source:{value:context.source},parent:{value:context.parent},parser:{value:context.parser},_output:{value:context.parser.output},_shadows:{writable:!0,value:null},_debugView:{writable:!0,value:null},_debugViewEnabled:{writable:!0,value:Config.debug}})}get output(){return this._debugViewEnabled?this.debugView.output:this._output}get shadows(){return[...this._shadows]}get shadowView(){const view=new Set;return this.contextSelectAll((ctx=>ctx._shadows)).forEach((ctx=>ctx._shadows.forEach((name=>view.add(name))))),[...view]}get debugView(){return this._debugViewEnabled?null!==this._debugView?this._debugView:this.createDebugView():null}contextHas(filter){let context=this;for(;null!==(context=context.parent);)if(filter(context))return!0;return!1}contextSelect(filter){let context=this;for(;null!==(context=context.parent);)if(filter(context))return context;return null}contextSelectAll(filter){const result=[];let context=this;for(;null!==(context=context.parent);)filter(context)&&result.push(context);return result}addShadow(...names){this._shadows||(this._shadows=new Set);const varRe=new RegExp(`^${Patterns.variable}$`);names.flat(1/0).forEach((name=>{if(\"string\"!=typeof name)throw new TypeError(\"variable name must be a string; type: \"+typeof name);if(!varRe.test(name))throw new Error(`invalid variable name \"${name}\"`);this._shadows.add(name)}))}createShadowWrapper(callback,doneCallback,startCallback){const shadowContext=this;let shadowStore;return\"function\"==typeof callback&&(shadowStore={},this.shadowView.forEach((varName=>{const varKey=varName.slice(1),store=\"$\"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]}))),function(...args){if(\"function\"==typeof startCallback&&startCallback.apply(this,args),\"function\"==typeof callback){const shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null,macroParser=Wikifier.Parser.get(\"macro\");let contextCache;try{shadowNames.forEach((varName=>{const varKey=varName.slice(1),store=\"$\"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),contextCache=macroParser.context,macroParser.context=shadowContext,callback.apply(this,args)}finally{contextCache!==undefined&&(macroParser.context=contextCache),shadowNames.forEach((varName=>{const varKey=varName.slice(1),store=\"$\"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}\"function\"==typeof doneCallback&&doneCallback.apply(this,args)}}createDebugView(name,title){return this._debugView=new DebugView(this._output,\"macro\",name||this.displayName,title||this.source),null!==this.payload&&this.payload.length>0&&this._debugView.modes({nonvoid:!0}),this._debugViewEnabled=!0,this._debugView}removeDebugView(){null!==this._debugView&&(this._debugView.remove(),this._debugView=null),this._debugViewEnabled=!1}error(message,source,stack){return throwError(this._output,`<<${this.displayName}>>: ${message}`,source||this.source,stack)}};(()=>{if(Macro.add(\"capture\",{skipArgs:!0,tags:null,tsVarRe:new RegExp(`(${Patterns.variable})`,\"g\"),handler(){if(0===this.args.raw.length)return this.error(\"no story/temporary variable list specified\");const valueCache={};try{const tsVarRe=this.self.tsVarRe;let match;for(;null!==(match=tsVarRe.exec(this.args.raw));){const varName=match[1],varKey=varName.slice(1),store=\"$\"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),this.addShadow(varName)}new Wikifier(this.output,this.payload[0].contents)}finally{this.shadows.forEach((varName=>{const varKey=varName.slice(1),store=\"$\"===varName[0]?State.variables:State.temporary;valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}),Macro.add(\"set\",{skipArgs:!0,handler(){if(0===this.args.full.length)return this.error(\"no expression specified\");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error(`bad evaluation: ${\"object\"==typeof ex?`${ex.name}: ${ex.message}`:ex}`,null,ex.stack)}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(\"unset\",{skipArgs:!0,handler(){if(0===this.args.full.length)return this.error(\"no story/temporary variable list specified\");const searchRe=/[,;\\s]*((?:State\\.(?:variables|temporary)|setup)\\.)/g,replacer=(_,p1)=>`; delete ${p1}`,cleanupRe=/^; /;try{const unsetExp=this.args.full.replace(searchRe,replacer).replace(cleanupRe,\"\");Scripting.evalJavaScript(unsetExp)}catch(ex){return this.error(`bad evaluation: ${getErrorMessage(ex)}`)}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(\"remember\",{skipArgs:!0,jsVarRe:new RegExp(`State\\\\.variables\\\\.(${Patterns.identifier})`,\"g\"),handler(){if(0===this.args.full.length)return this.error(\"no expression specified\");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error(`bad evaluation: ${\"object\"==typeof ex?ex.message:ex}`)}const remember=storage.get(\"remember\")||{},jsVarRe=this.self.jsVarRe;let match;for(;null!==(match=jsVarRe.exec(this.args.full));){const name=match[1];remember[name]=State.variables[name]}if(!storage.set(\"remember\",remember))return this.error(`unknown error, cannot remember: ${this.args.raw}`);Config.debug&&this.debugView.modes({hidden:!0})},init(){const remember=storage.get(\"remember\");remember&&Object.keys(remember).forEach((name=>State.variables[name]=remember[name]))}}),Macro.add(\"forget\",{skipArgs:!0,jsVarRe:new RegExp(`State\\\\.variables\\\\.(${Patterns.identifier})`,\"g\"),handler(){if(0===this.args.full.length)return this.error(\"no story variable list specified\");const remember=storage.get(\"remember\"),jsVarRe=this.self.jsVarRe;let match,needStore=!1;for(;null!==(match=jsVarRe.exec(this.args.full));){const name=match[1];State.variables.hasOwnProperty(name)&&delete State.variables[name],remember&&remember.hasOwnProperty(name)&&(needStore=!0,delete remember[name])}if(needStore)if(0===Object.keys(remember).length){if(!storage.delete(\"remember\"))return this.error(\"unknown error, cannot update remember store\")}else if(!storage.set(\"remember\",remember))return this.error(\"unknown error, cannot update remember store\");Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(\"run\",\"set\"),Macro.add(\"script\",{skipArgs:!0,tags:null,handler(){const output=document.createDocumentFragment();try{Scripting.evalJavaScript(this.payload[0].contents,output)}catch(ex){return this.error(`bad evaluation: ${\"object\"==typeof ex?ex.message:ex}`)}Config.debug&&this.createDebugView(),output.hasChildNodes()&&this.output.appendChild(output)}}),Macro.add(\"include\",{handler(){if(0===this.args.length)return this.error(\"no passage specified\");let passage,$el;if(passage=\"object\"==typeof this.args[0]?this.args[0].link:this.args[0],!Story.has(passage))return this.error(`passage \"${passage}\" does not exist`);Config.debug&&this.debugView.modes({block:!0}),passage=Story.get(passage),$el=this.args[1]?jQuery(document.createElement(this.args[1])).addClass(`${passage.domId} macro-${this.name}`).attr(\"data-passage\",passage.title).appendTo(this.output):jQuery(this.output),$el.wiki(passage.processText())}}),Macro.add(\"nobr\",{skipArgs:!0,tags:null,handler(){new Wikifier(this.output,this.payload[0].contents.replace(/^\\n+|\\n+$/g,\"\").replace(/\\n+/g,\" \"))}}),Macro.add([\"print\",\"=\",\"-\"],{skipArgs:!0,handler(){if(0===this.args.full.length)return this.error(\"no expression specified\");try{const result=stringFrom(Scripting.evalJavaScript(this.args.full));null!==result&&new Wikifier(this.output,\"-\"===this.name?Util.escape(result):result)}catch(ex){return this.error(`bad evaluation: ${\"object\"==typeof ex?`${ex.name}: ${ex.message}`:ex}`,null,ex.stack)}}}),Macro.add(\"silently\",{skipArgs:!0,tags:null,handler(){const frag=document.createDocumentFragment();if(new Wikifier(frag,this.payload[0].contents.trim()),Config.debug)this.debugView.modes({block:!0,hidden:!0}),this.output.appendChild(frag);else{const errList=[...frag.querySelectorAll(\".error\")].map((errEl=>errEl.textContent));if(errList.length>0)return this.error(`error${1===errList.length?\"\":\"s\"} within contents (${errList.join(\"; \")})`)}}}),Macro.add(\"type\",{isAsync:!0,tags:null,typeId:0,handler(){if(0===this.args.length)return this.error(\"no speed specified\");const speed=Util.fromCssTime(this.args[0]);if(speed<0)return this.error(`speed time value must be non-negative (received: ${this.args[0]})`);let cursor,elClass=\"\",elId=\"\",elTag=\"div\",skipKey=Config.macros.typeSkipKey,start=400;const options=this.args.slice(1);for(;options.length>0;){const option=options.shift();switch(option){case\"class\":if(0===options.length)return this.error(\"class option missing required class name(s)\");if(elClass=options.shift(),\"\"===elClass)throw new Error('class option class name(s) must be non-empty (received: \"\")');break;case\"element\":if(0===options.length)return this.error(\"element option missing required element tag name\");if(elTag=options.shift(),\"\"===elTag)throw new Error('element option tag name must be non-empty (received: \"\")');break;case\"id\":if(0===options.length)return this.error(\"id option missing required ID\");if(elId=options.shift(),\"\"===elId)throw new Error('id option ID must be non-empty (received: \"\")');break;case\"keep\":cursor=\"keep\";break;case\"none\":cursor=\"none\";break;case\"skipkey\":if(0===options.length)return this.error(\"skipkey option missing required key value\");if(skipKey=options.shift(),\"\"===skipKey)throw new Error('skipkey option key value must be non-empty (received: \"\")');break;case\"start\":{if(0===options.length)return this.error(\"start option missing required time value\");const value=options.shift();if(start=Util.fromCssTime(value),start<0)throw new Error(`start option time value must be non-negative (received: ${value})`);break}default:return this.error(`unknown option: ${option}`)}}const contents=this.payload[0].contents;if(\"\"===contents.trim())return;Config.debug&&this.debugView.modes({block:!0});const className=`macro-${this.name}`,namespace=`.${className}`,$target=jQuery(document.createElement(elTag)).addClass(`${className} ${className}-target`).appendTo(this.output);TempState.macroTypeQueue||(TempState.macroTypeQueue=[],$(document).off(namespace).one(`:passageinit${namespace}`,(()=>$(document).off(namespace))));const startTyping=0===TempState.macroTypeQueue.length,selfId=++this.self.typeId;TempState.macroTypeQueue.push({id:selfId,handler(){const $wrapper=jQuery(document.createElement(elTag)).addClass(className);elId&&$wrapper.attr(\"id\",elId),elClass&&$wrapper.addClass(elClass),new Wikifier($wrapper,contents);const passage=State.passage,turn=State.turns;if(!Config.macros.typeVisitedPassages&&State.passages.slice(0,-1).some((title=>title===passage))||$wrapper.find(\".error\").length>0)return $target.replaceWith($wrapper),TempState.macroTypeQueue.shift(),void(TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().handler());const typer=new NodeTyper({targetNode:$wrapper.get(0),classNames:\"none\"===cursor?null:`${className}-cursor`});$target.replaceWith($wrapper);const keydownAndNS=`keydown${namespace}`,typingStopAndNS=`:typingstop${namespace}`;$(document).off(keydownAndNS).on(keydownAndNS,(ev=>{Util.scrubEventKey(ev.key)!==skipKey||ev.target!==document.body&&ev.target!==document.documentElement||(ev.preventDefault(),$(document).off(keydownAndNS),typer.finish())})).one(typingStopAndNS,(()=>{TempState.macroTypeQueue&&(0===TempState.macroTypeQueue.length?jQuery.event.trigger(\":typingcomplete\"):TempState.macroTypeQueue.first().handler())}));const typeNode=function(){const typeNodeMember=function(typeIntervalId){State.passage===passage&&State.turns===turn&&typer.type()||(typeIntervalId&&clearInterval(typeIntervalId),TempState.macroTypeQueue&&TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().id===selfId&&TempState.macroTypeQueue.shift(),$wrapper.trigger(\":typingstop\"),$wrapper.addClass(`${className}-done`),\"keep\"===cursor&&$wrapper.addClass(`${className}-cursor`))};$wrapper.trigger(\":typingstart\"),typeNodeMember();const typeNodeMemberId=setInterval((()=>typeNodeMember(typeNodeMemberId)),speed)};start?setTimeout(typeNode,start):typeNode()}}),startTyping&&(Engine.isPlaying()?$(document).one(`:passageend${namespace}`,(()=>TempState.macroTypeQueue.first().handler())):TempState.macroTypeQueue.first().handler())}}),Macro.add(\"display\",\"include\"),Macro.add(\"if\",{skipArgs:!0,tags:[\"elseif\",\"else\"],elseifWsRe:/^\\s*if\\b/i,ifAssignRe:/[^!=&^|<>*/%+-]=[^=>]/,handler(){let i;try{const len=this.payload.length,elseifWsRe=this.self.elseifWsRe,ifAssignRe=this.self.ifAssignRe;for(i=0;i<len;++i)if(\"else\"===this.payload[i].name){if(this.payload[i].args.raw.length>0)return elseifWsRe.test(this.payload[i].args.raw)?this.error('whitespace is not allowed between the \"else\" and \"if\" in <<elseif>> clause'+(i>0?\" (#\"+i+\")\":\"\")):this.error(`<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>>), invalid: ${this.payload[i].args.raw}`);if(i+1!==len)return this.error(\"<<else>> must be the final clause\")}else{if(0===this.payload[i].args.full.length)return this.error(`no conditional expression specified for <<${this.payload[i].name}>> clause${i>0?\" (#\"+i+\")\":\"\"}`);if(Config.macros.ifAssignmentError&&ifAssignRe.test(this.payload[i].args.full))return this.error(`assignment operator found within <<${this.payload[i].name}>> clause${i>0?\" (#\"+i+\")\":\"\"} (perhaps you meant to use an equality operator: ==, ===, eq, is), invalid: ${this.payload[i].args.raw}`)}const evalJavaScript=Scripting.evalJavaScript;let success=!1;for(i=0;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),\"else\"===this.payload[i].name||evalJavaScript(this.payload[i].args.full)){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});this.createDebugView(`/${this.name}`,`<</${this.name}>>`).modes({nonvoid:!1,hidden:!success,invalid:!success})}}catch(ex){return this.error(`bad conditional expression in <<${0===i?\"if\":\"elseif\"}>> clause${i>0?\" (#\"+i+\")\":\"\"}: ${\"object\"==typeof ex?`${ex.name}: ${ex.message}`:ex}`,null,ex.stack)}}}),Macro.add(\"switch\",{skipArgs:[\"switch\"],tags:[\"case\",\"default\"],handler(){if(0===this.args.full.length)return this.error(\"no expression specified\");const len=this.payload.length;if(1===len)return this.error(\"no cases specified\");let i,result;for(i=1;i<len;++i)if(\"default\"===this.payload[i].name){if(this.payload[i].args.length>0)return this.error(`<<default>> does not accept values, invalid: ${this.payload[i].args.raw}`);if(i+1!==len)return this.error(\"<<default>> must be the final case\")}else if(0===this.payload[i].args.length)return this.error(`no value(s) specified for <<${this.payload[i].name}>> (#${i})`);try{result=Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error(`bad evaluation: ${\"object\"==typeof ex?ex.message:ex}`)}const debugView=this.debugView;let success=!1;for(Config.debug&&debugView.modes({nonvoid:!1,hidden:!0}),i=1;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),\"default\"===this.payload[i].name||this.payload[i].args.some((val=>val===result))){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});debugView.modes({nonvoid:!1,hidden:!0,invalid:!success}),this.createDebugView(`/${this.name}`,`<</${this.name}>>`).modes({nonvoid:!1,hidden:!0,invalid:!success})}}}),Macro.add(\"for\",{skipArgs:!0,tags:null,hasRangeRe:new RegExp(`^\\\\S${Patterns.anyChar}*?\\\\s+range\\\\s+\\\\S${Patterns.anyChar}*?$`),rangeRe:new RegExp(`^(?:State\\\\.(variables|temporary)\\\\.(${Patterns.identifier})\\\\s*,\\\\s*)?State\\\\.(variables|temporary)\\\\.(${Patterns.identifier})\\\\s+range\\\\s+(\\\\S${Patterns.anyChar}*?)$`),threePartRe:/^([^;]*?)\\s*;\\s*([^;]*?)\\s*;\\s*([^;]*?)$/,forInRe:/^\\S+\\s+in\\s+\\S+/i,forOfRe:/^\\S+\\s+of\\s+\\S+/i,handler(){const argsStr=this.args.full.trim(),payload=this.payload[0].contents.replace(/\\n$/,\"\");if(0===argsStr.length)this.self.handleFor.call(this,payload,null,!0,null);else if(this.self.hasRangeRe.test(argsStr)){const parts=argsStr.match(this.self.rangeRe);if(null===parts)return this.error(\"invalid range form syntax, format: [index ,] value range collection\");this.self.handleForRange.call(this,payload,{type:parts[1],name:parts[2]},{type:parts[3],name:parts[4]},parts[5])}else{let init,condition,post;if(-1===argsStr.indexOf(\";\")){if(this.self.forInRe.test(argsStr))return this.error(\"invalid syntax, for…in is not supported; see: for…range\");if(this.self.forOfRe.test(argsStr))return this.error(\"invalid syntax, for…of is not supported; see: for…range\");condition=argsStr}else{const parts=argsStr.match(this.self.threePartRe);if(null===parts)return this.error(\"invalid 3-part conditional form syntax, format: [init] ; [condition] ; [post]\");init=parts[1],condition=parts[2].trim(),post=parts[3],0===condition.length&&(condition=!0)}this.self.handleFor.call(this,payload,init,condition,post)}},handleFor(payload,init,condition,post){const evalJavaScript=Scripting.evalJavaScript;let first=!0,safety=Config.macros.maxLoopIterations;Config.debug&&this.debugView.modes({block:!0});try{if(TempState.break=null,init)try{evalJavaScript(init)}catch(ex){return this.error(`bad init expression: ${\"object\"==typeof ex?ex.message:ex}`)}for(;evalJavaScript(condition);){if(Wikifier.stopWikify)return;if(--safety<0)return this.error(`exceeded configured maximum loop iterations (${Config.macros.maxLoopIterations})`);if(new Wikifier(this.output,first?payload.replace(/^\\n/,\"\"):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}if(post)try{evalJavaScript(post)}catch(ex){return this.error(`bad post expression: ${\"object\"==typeof ex?ex.message:ex}`)}}}catch(ex){return this.error(`bad conditional expression: ${\"object\"==typeof ex?ex.message:ex}`)}finally{TempState.break=null}},handleForRange(payload,indexVar,valueVar,rangeExp){let rangeList,first=!0;try{rangeList=this.self.toRangeList(rangeExp)}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});try{TempState.break=null;for(let i=0;i<rangeList.length;++i)if(indexVar.name&&(State[indexVar.type][indexVar.name]=rangeList[i][0]),State[valueVar.type][valueVar.name]=rangeList[i][1],new Wikifier(this.output,first?payload.replace(/^\\n/,\"\"):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}}catch(ex){return this.error(\"object\"==typeof ex?ex.message:ex)}finally{TempState.break=null}},toRangeList(rangeExp){const evalJavaScript=Scripting.evalJavaScript;let value,list;try{value=evalJavaScript(\"{\"===rangeExp[0]?`(${rangeExp})`:rangeExp)}catch(ex){if(\"object\"!=typeof ex)throw new Error(`bad range expression: ${ex}`);throw ex.message=`bad range expression: ${ex.message}`,ex}switch(typeof value){case\"string\":list=[];for(let i=0;i<value.length;){const obj=Util.charAndPosAt(value,i);list.push([i,obj.char]),i=1+obj.end}break;case\"object\":if(Array.isArray(value))list=value.map(((val,i)=>[i,val]));else if(value instanceof Set)list=[...value].map(((val,i)=>[i,val]));else if(value instanceof Map)list=[...value.entries()];else{if(\"Object\"!==Util.toStringTag(value))throw new Error(`unsupported range expression type: ${Util.toStringTag(value)}`);list=Object.keys(value).map((key=>[key,value[key]]))}break;default:throw new Error(\"unsupported range expression type: \"+typeof value)}return list}}),Macro.add([\"break\",\"continue\"],{skipArgs:!0,handler(){if(!this.contextHas((ctx=>\"for\"===ctx.name)))return this.error(\"must only be used in conjunction with its parent macro <<for>>\");TempState.break=\"continue\"===this.name?1:2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add([\"button\",\"link\"],{isAsync:!0,tags:null,handler(){if(0===this.args.length)return this.error(`no ${\"button\"===this.name?\"button\":\"link\"} text specified`);const $link=jQuery(document.createElement(\"button\"===this.name?\"button\":\"a\"));let passage;if(\"object\"==typeof this.args[0])if(this.args[0].isImage){const $image=jQuery(document.createElement(\"img\")).attr(\"src\",this.args[0].source).appendTo($link);$link.addClass(\"link-image\"),this.args[0].hasOwnProperty(\"passage\")&&$image.attr(\"data-passage\",this.args[0].passage),this.args[0].hasOwnProperty(\"title\")&&$image.attr(\"title\",this.args[0].title),this.args[0].hasOwnProperty(\"align\")&&$image.attr(\"align\",this.args[0].align),passage=this.args[0].link}else $link.append(document.createTextNode(this.args[0].text)),passage=this.args[0].link;else $link.wikiWithOptions({profile:\"core\"},this.args[0]),passage=this.args.length>1?this.args[1]:undefined;null!=passage?($link.attr(\"data-passage\",passage),Story.has(passage)?($link.addClass(\"link-internal\"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass(\"link-visited\")):$link.addClass(\"link-broken\")):$link.addClass(\"link-internal\"),$link.addClass(`macro-${this.name}`).ariaClick({namespace:\".macros\",role:null!=passage?\"link\":\"button\",one:null!=passage},this.createShadowWrapper(\"\"!==this.payload[0].contents?()=>Wikifier.wikifyEval(this.payload[0].contents.trim()):null,null!=passage?()=>Engine.play(passage):null)).appendTo(this.output)}}),Macro.add(\"checkbox\",{isAsync:!0,handler(){if(this.args.length<3){const errors=[];return this.args.length<1&&errors.push(\"variable name\"),this.args.length<2&&errors.push(\"unchecked value\"),this.args.length<3&&errors.push(\"checked value\"),this.error(`no ${errors.join(\" or \")} specified`)}if(\"string\"!=typeof this.args[0])return this.error(\"variable name argument is not a string\");const varName=this.args[0].trim();if(\"$\"!==varName[0]&&\"_\"!==varName[0])return this.error(`variable name \"${this.args[0]}\" is missing its sigil ($ or _)`);const varId=Util.slugify(varName),uncheckValue=this.args[1],checkValue=this.args[2],el=document.createElement(\"input\");switch(jQuery(el).attr({id:`${this.name}-${varId}`,name:`${this.name}-${varId}`,type:\"checkbox\",tabindex:0}).addClass(`macro-${this.name}`).on(\"change.macros\",this.createShadowWrapper((function(){State.setVar(varName,this.checked?checkValue:uncheckValue)}))).appendTo(this.output),this.args[3]){case\"autocheck\":State.getVar(varName)===checkValue?el.checked=!0:State.setVar(varName,uncheckValue);break;case\"checked\":el.checked=!0,State.setVar(varName,checkValue);break;default:State.setVar(varName,uncheckValue)}}}),Macro.add([\"cycle\",\"listbox\"],{isAsync:!0,skipArgs:[\"optionsfrom\"],tags:[\"option\",\"optionsfrom\"],handler(){if(0===this.args.length)return this.error(\"no variable name specified\");if(\"string\"!=typeof this.args[0])return this.error(\"variable name argument is not a string\");const varName=this.args[0].trim();if(\"$\"!==varName[0]&&\"_\"!==varName[0])return this.error(`variable name \"${this.args[0]}\" is missing its sigil ($ or _)`);const varId=Util.slugify(varName),len=this.payload.length;if(1===len)return this.error(\"no options specified\");const config={autoselect:!1,once:!1};for(let i=1;i<this.args.length;++i){const arg=this.args[i];switch(arg){case\"once\":config.once=!0;break;case\"autoselect\":config.autoselect=!0;break;default:return this.error(`unknown argument: ${arg}`)}}const options=[],tagCount={option:0,optionsfrom:0};let selectedIdx=-1;for(let i=1;i<len;++i){const payload=this.payload[i];if(\"option\"===payload.name){if(++tagCount.option,0===payload.args.length)return this.error(`no arguments specified for <<${payload.name}>> (#${tagCount.option})`);const option={label:String(payload.args[0])};let isSelected=!1;switch(payload.args.length){case 1:option.value=payload.args[0];break;case 2:\"selected\"===payload.args[1]?(option.value=payload.args[0],isSelected=!0):option.value=payload.args[1];break;default:option.value=payload.args[1],\"selected\"===payload.args[2]&&(isSelected=!0)}if(options.push(option),isSelected){if(config.autoselect)return this.error(\"cannot specify both the autoselect and selected keywords\");if(-1!==selectedIdx)return this.error(`multiple selected keywords specified for <<${payload.name}>> (#${selectedIdx+1} & #${tagCount.option})`);selectedIdx=options.length-1}}else{if(++tagCount.optionsfrom,0===payload.args.full.length)return this.error(`no expression specified for <<${payload.name}>> (#${tagCount.optionsfrom})`);let result;try{const exp=payload.args.full;result=Scripting.evalJavaScript(\"{\"===exp[0]?`(${exp})`:exp)}catch(ex){return this.error(`bad evaluation: ${\"object\"==typeof ex?ex.message:ex}`)}if(\"object\"!=typeof result||null===result)return this.error(`expression must yield a supported collection or generic object (type: ${null===result?\"null\":typeof result})`);if(result instanceof Array||result instanceof Set)result.forEach((val=>options.push({label:String(val),value:val})));else if(result instanceof Map)result.forEach(((val,key)=>options.push({label:String(key),value:val})));else{const oType=Util.toStringTag(result);if(\"Object\"!==oType)return this.error(`expression must yield a supported collection or generic object (object type: ${oType})`);Object.keys(result).forEach((key=>options.push({label:key,value:result[key]})))}}}if(-1===selectedIdx)if(config.autoselect){const sameValueZero=Util.sameValueZero,curValue=State.getVar(varName),curValueIdx=options.findIndex((opt=>sameValueZero(opt.value,curValue)));selectedIdx=-1===curValueIdx?0:curValueIdx}else selectedIdx=0;if(\"cycle\"===this.name){const lastIdx=options.length-1;if(config.once&&selectedIdx===lastIdx)jQuery(this.output).wikiWithOptions({profile:\"core\"},options[selectedIdx].label);else{let cycleIdx=selectedIdx;jQuery(document.createElement(\"a\")).wikiWithOptions({profile:\"core\"},options[selectedIdx].label).attr(\"id\",`${this.name}-${varId}`).addClass(`macro-${this.name}`).ariaClick({namespace:\".macros\",role:\"button\"},this.createShadowWrapper((function(){const $this=$(this);cycleIdx=(cycleIdx+1)%options.length,State.setVar(varName,options[cycleIdx].value),$this.empty().wikiWithOptions({profile:\"core\"},options[cycleIdx].label),config.once&&cycleIdx===lastIdx&&$this.off().contents().unwrap()}))).appendTo(this.output)}}else{const $select=jQuery(document.createElement(\"select\"));options.forEach(((opt,i)=>{jQuery(document.createElement(\"option\")).val(i).text(opt.label).appendTo($select)})),$select.attr({id:`${this.name}-${varId}`,name:`${this.name}-${varId}`,tabindex:0}).addClass(`macro-${this.name}`).val(selectedIdx).on(\"change.macros\",this.createShadowWrapper((function(){State.setVar(varName,options[Number(this.value)].value)}))).appendTo(this.output)}State.setVar(varName,options[selectedIdx].value)}}),Macro.add([\"linkappend\",\"linkprepend\",\"linkreplace\"],{isAsync:!0,tags:null,t8nRe:/^(?:transition|t8n)$/,handler(){if(0===this.args.length)return this.error(\"no link text specified\");const $link=jQuery(document.createElement(\"a\")),$insert=jQuery(document.createElement(\"span\")),transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]);$link.wikiWithOptions({profile:\"core\"},this.args[0]).addClass(`link-internal macro-${this.name}`).ariaClick({namespace:\".macros\",one:!0},this.createShadowWrapper((()=>{if(\"linkreplace\"===this.name?$link.remove():$link.wrap(`<span class=\"macro-${this.name}\"></span>`).replaceWith((()=>$link.html())),\"\"!==this.payload[0].contents){const frag=document.createDocumentFragment();new Wikifier(frag,this.payload[0].contents),$insert.append(frag)}transition&&setTimeout((()=>$insert.removeClass(`macro-${this.name}-in`)),Engine.minDomActionDelay),Links.generate()}))).appendTo(this.output),$insert.addClass(`macro-${this.name}-insert`),transition&&$insert.addClass(`macro-${this.name}-in`),\"linkprepend\"===this.name?$insert.insertBefore($link):$insert.insertAfter($link)}}),Macro.add([\"numberbox\",\"textbox\"],{isAsync:!0,handler(){if(this.args.length<2){const errors=[];return this.args.length<1&&errors.push(\"variable name\"),this.args.length<2&&errors.push(\"default value\"),this.error(`no ${errors.join(\" or \")} specified`)}if(\"string\"!=typeof this.args[0])return this.error(\"variable name argument is not a string\");const varName=this.args[0].trim();if(\"$\"!==varName[0]&&\"_\"!==varName[0])return this.error(`variable name \"${this.args[0]}\" is missing its sigil ($ or _)`);Config.debug&&this.debugView.modes({block:!0});const asNumber=\"numberbox\"===this.name,defaultValue=asNumber?Number(this.args[1]):this.args[1];if(asNumber&&Number.isNaN(defaultValue))return this.error(`default value \"${this.args[1]}\" is neither a number nor can it be parsed into a number`);const varId=Util.slugify(varName),el=document.createElement(\"input\");let passage,autofocus=!1;this.args.length>3?(passage=this.args[2],autofocus=\"autofocus\"===this.args[3]):this.args.length>2&&(\"autofocus\"===this.args[2]?autofocus=!0:passage=this.args[2]),\"object\"==typeof passage&&(passage=passage.link),jQuery(el).attr({id:`${this.name}-${varId}`,name:`${this.name}-${varId}`,type:asNumber?\"number\":\"text\",inputmode:asNumber?\"decimal\":\"text\",tabindex:0}).addClass(`macro-${this.name}`).on(\"change.macros\",this.createShadowWrapper((function(){State.setVar(varName,asNumber?Number(this.value):this.value)}))).on(\"keypress.macros\",this.createShadowWrapper((function(ev){13===ev.which&&(ev.preventDefault(),State.setVar(varName,asNumber?Number(this.value):this.value),null!=passage&&Engine.play(passage))}))).appendTo(this.output),asNumber&&(el.step=\"any\"),State.setVar(varName,defaultValue),el.value=defaultValue,autofocus&&(el.setAttribute(\"autofocus\",\"autofocus\"),postdisplay[`#autofocus:${el.id}`]=task=>{delete postdisplay[task],setTimeout((()=>el.focus()),Engine.minDomActionDelay)})}}),Macro.add(\"radiobutton\",{isAsync:!0,handler(){if(this.args.length<2){const errors=[];return this.args.length<1&&errors.push(\"variable name\"),this.args.length<2&&errors.push(\"checked value\"),this.error(`no ${errors.join(\" or \")} specified`)}if(\"string\"!=typeof this.args[0])return this.error(\"variable name argument is not a string\");const varName=this.args[0].trim();if(\"$\"!==varName[0]&&\"_\"!==varName[0])return this.error(`variable name \"${this.args[0]}\" is missing its sigil ($ or _)`);const varId=Util.slugify(varName),checkValue=this.args[1],el=document.createElement(\"input\");switch(TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(varId)||(TempState[this.name][varId]=0),jQuery(el).attr({id:`${this.name}-${varId}-${TempState[this.name][varId]++}`,name:`${this.name}-${varId}`,type:\"radio\",tabindex:0}).addClass(`macro-${this.name}`).on(\"change.macros\",this.createShadowWrapper((function(){this.checked&&State.setVar(varName,checkValue)}))).appendTo(this.output),this.args[2]){case\"autocheck\":State.getVar(varName)===checkValue&&(el.checked=!0);break;case\"checked\":el.checked=!0,State.setVar(varName,checkValue)}}}),Macro.add(\"textarea\",{isAsync:!0,handler(){if(this.args.length<2){const errors=[];return this.args.length<1&&errors.push(\"variable name\"),this.args.length<2&&errors.push(\"default value\"),this.error(`no ${errors.join(\" or \")} specified`)}if(\"string\"!=typeof this.args[0])return this.error(\"variable name argument is not a string\");const varName=this.args[0].trim();if(\"$\"!==varName[0]&&\"_\"!==varName[0])return this.error(`variable name \"${this.args[0]}\" is missing its sigil ($ or _)`);Config.debug&&this.debugView.modes({block:!0});const varId=Util.slugify(varName),defaultValue=this.args[1],autofocus=\"autofocus\"===this.args[2],el=document.createElement(\"textarea\");jQuery(el).attr({id:`${this.name}-${varId}`,name:`${this.name}-${varId}`,rows:4,tabindex:0}).addClass(`macro-${this.name}`).on(\"change.macros\",this.createShadowWrapper((function(){State.setVar(varName,this.value)}))).appendTo(this.output),State.setVar(varName,defaultValue),el.textContent=defaultValue,autofocus&&(el.setAttribute(\"autofocus\",\"autofocus\"),postdisplay[`#autofocus:${el.id}`]=task=>{delete postdisplay[task],setTimeout((()=>el.focus()),Engine.minDomActionDelay)})}}),Macro.add(\"click\",\"link\"),Macro.add(\"actions\",{handler(){const $list=jQuery(document.createElement(\"ul\")).addClass(this.name).appendTo(this.output);for(let i=0;i<this.args.length;++i){let passage,text,$image,setFn;if(\"object\"==typeof this.args[i]?this.args[i].isImage?($image=jQuery(document.createElement(\"img\")).attr(\"src\",this.args[i].source),this.args[i].hasOwnProperty(\"passage\")&&$image.attr(\"data-passage\",this.args[i].passage),this.args[i].hasOwnProperty(\"title\")&&$image.attr(\"title\",this.args[i].title),this.args[i].hasOwnProperty(\"align\")&&$image.attr(\"align\",this.args[i].align),passage=this.args[i].link,setFn=this.args[i].setFn):(text=this.args[i].text,passage=this.args[i].link,setFn=this.args[i].setFn):text=passage=this.args[i],State.variables.hasOwnProperty(\"#actions\")&&State.variables[\"#actions\"].hasOwnProperty(passage)&&State.variables[\"#actions\"][passage])continue;const $link=jQuery(Wikifier.createInternalLink(jQuery(document.createElement(\"li\")).appendTo($list),passage,null,((passage,fn)=>()=>{State.variables.hasOwnProperty(\"#actions\")||(State.variables[\"#actions\"]={}),State.variables[\"#actions\"][passage]=!0,\"function\"==typeof fn&&fn()})(passage,setFn))).addClass(`macro-${this.name}`).append($image||document.createTextNode(text));$image&&$link.addClass(\"link-image\")}}}),Macro.add([\"back\",\"return\"],{handler(){if(this.args.length>1)return this.error(\"too many arguments specified, check the documentation for details\");let passage,text,$image,$link,momentIndex=-1;if(1===this.args.length&&(\"object\"==typeof this.args[0]?this.args[0].isImage?($image=jQuery(document.createElement(\"img\")).attr(\"src\",this.args[0].source),this.args[0].hasOwnProperty(\"passage\")&&$image.attr(\"data-passage\",this.args[0].passage),this.args[0].hasOwnProperty(\"title\")&&$image.attr(\"title\",this.args[0].title),this.args[0].hasOwnProperty(\"align\")&&$image.attr(\"align\",this.args[0].align),this.args[0].hasOwnProperty(\"link\")&&(passage=this.args[0].link)):(1===this.args[0].count||(text=this.args[0].text),passage=this.args[0].link):1===this.args.length&&(text=this.args[0])),null==passage){for(let i=State.length-2;i>=0;--i)if(State.history[i].title!==State.passage){momentIndex=i,passage=State.history[i].title;break}if(null==passage&&\"return\"===this.name)for(let i=State.expired.length-1;i>=0;--i)if(State.expired[i]!==State.passage){passage=State.expired[i];break}}else{if(!Story.has(passage))return this.error(`passage \"${passage}\" does not exist`);if(\"back\"===this.name){for(let i=State.length-2;i>=0;--i)if(State.history[i].title===passage){momentIndex=i;break}if(-1===momentIndex)return this.error(`cannot find passage \"${passage}\" in the current story history`)}}if(null==passage)return this.error(\"cannot find passage\");\"back\"!==this.name||-1!==momentIndex?($link=jQuery(document.createElement(\"a\")).addClass(\"link-internal\").ariaClick({one:!0},\"return\"===this.name?()=>Engine.play(passage):()=>Engine.goTo(momentIndex)),$image&&$link.addClass(\"link-image\")):$link=jQuery(document.createElement(\"span\")).addClass(\"link-disabled\"),$link.addClass(`macro-${this.name}`).append($image||document.createTextNode(text||L10n.get(`macro${this.name.toUpperFirst()}Text`))).appendTo(this.output)}}),Macro.add(\"choice\",{handler(){if(0===this.args.length)return this.error(\"no passage specified\");const choiceId=State.passage;let passage,text,$image,setFn,$link;if(1===this.args.length?\"object\"==typeof this.args[0]?this.args[0].isImage?($image=jQuery(document.createElement(\"img\")).attr(\"src\",this.args[0].source),this.args[0].hasOwnProperty(\"passage\")&&$image.attr(\"data-passage\",this.args[0].passage),this.args[0].hasOwnProperty(\"title\")&&$image.attr(\"title\",this.args[0].title),this.args[0].hasOwnProperty(\"align\")&&$image.attr(\"align\",this.args[0].align),passage=this.args[0].link,setFn=this.args[0].setFn):(text=this.args[0].text,passage=this.args[0].link,setFn=this.args[0].setFn):text=passage=this.args[0]:(passage=this.args[0],text=this.args[1]),State.variables.hasOwnProperty(\"#choice\")&&State.variables[\"#choice\"].hasOwnProperty(choiceId)&&State.variables[\"#choice\"][choiceId])return $link=jQuery(document.createElement(\"span\")).addClass(`link-disabled macro-${this.name}`).attr(\"tabindex\",-1).append($image||document.createTextNode(text)).appendTo(this.output),void($image&&$link.addClass(\"link-image\"));$link=jQuery(Wikifier.createInternalLink(this.output,passage,null,(()=>{State.variables.hasOwnProperty(\"#choice\")||(State.variables[\"#choice\"]={}),State.variables[\"#choice\"][choiceId]=!0,\"function\"==typeof setFn&&setFn()}))).addClass(`macro-${this.name}`).append($image||document.createTextNode(text)),$image&&$link.addClass(\"link-image\")}}),Macro.add([\"addclass\",\"toggleclass\"],{handler(){if(this.args.length<2){const errors=[];return this.args.length<1&&errors.push(\"selector\"),this.args.length<2&&errors.push(\"class names\"),this.error(`no ${errors.join(\" or \")} specified`)}const $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error(`no elements matched the selector \"${this.args[0]}\"`);switch(this.name){case\"addclass\":$targets.addClass(this.args[1].trim());break;case\"toggleclass\":$targets.toggleClass(this.args[1].trim())}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(\"removeclass\",{handler(){if(0===this.args.length)return this.error(\"no selector specified\");const $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error(`no elements matched the selector \"${this.args[0]}\"`);this.args.length>1?$targets.removeClass(this.args[1].trim()):$targets.removeClass(),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(\"copy\",{handler(){if(0===this.args.length)return this.error(\"no selector specified\");const $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error(`no elements matched the selector \"${this.args[0]}\"`);jQuery(this.output).append($targets.html()),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add([\"append\",\"prepend\",\"replace\"],{tags:null,t8nRe:/^(?:transition|t8n)$/,handler(){if(0===this.args.length)return this.error(\"no selector specified\");const $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error(`no elements matched the selector \"${this.args[0]}\"`);if(\"\"!==this.payload[0].contents){let $insert;switch(this.args.length>1&&this.self.t8nRe.test(this.args[1])?($insert=jQuery(document.createElement(\"span\")),$insert.addClass(`macro-${this.name}-insert macro-${this.name}-in`),setTimeout((()=>$insert.removeClass(`macro-${this.name}-in`)),Engine.minDomActionDelay)):$insert=jQuery(document.createDocumentFragment()),$insert.wiki(this.payload[0].contents),this.name){case\"replace\":$targets.empty();case\"append\":$targets.append($insert);break;case\"prepend\":$targets.prepend($insert)}}else\"replace\"===this.name&&$targets.empty();Config.debug&&this.debugView.modes({hidden:!0}),Links.generate()}}),Macro.add(\"remove\",{handler(){if(0===this.args.length)return this.error(\"no selector specified\");const $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error(`no elements matched the selector \"${this.args[0]}\"`);$targets.remove(),Config.debug&&this.debugView.modes({hidden:!0})}}),Has.audio){const errorOnePlaybackAction=(cur,prev)=>`only one playback action allowed per invocation, \"${cur}\" cannot be combined with \"${prev}\"`;Macro.add(\"audio\",{handler(){if(this.args.length<2){const errors=[];return this.args.length<1&&errors.push(\"track and/or group IDs\"),this.args.length<2&&errors.push(\"actions\"),this.error(`no ${errors.join(\" or \")} specified`)}let selected;try{selected=SimpleAudio.select(this.args[0])}catch(ex){return this.error(ex.message)}const args=this.args.slice(1);let action,fadeTo,loop,mute,passage,time,volume,fadeOver=5;for(;args.length>0;){const arg=args.shift();let raw;switch(arg){case\"load\":case\"pause\":case\"play\":case\"stop\":case\"unload\":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case\"fadein\":if(action)return this.error(errorOnePlaybackAction(arg,action));action=\"fade\",fadeTo=1;break;case\"fadeout\":if(action)return this.error(errorOnePlaybackAction(arg,action));action=\"fade\",fadeTo=0;break;case\"fadeto\":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error(\"fadeto missing required level value\");if(action=\"fade\",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error(`cannot parse fadeto: ${raw}`);break;case\"fadeoverto\":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){const errors=[];return args.length<1&&errors.push(\"seconds\"),args.length<2&&errors.push(\"level\"),this.error(`fadeoverto missing required ${errors.join(\" and \")} value${errors.length>1?\"s\":\"\"}`)}if(action=\"fade\",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error(`cannot parse fadeoverto: ${raw}`);if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error(`cannot parse fadeoverto: ${raw}`);break;case\"volume\":if(0===args.length)return this.error(\"volume missing required level value\");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error(`cannot parse volume: ${raw}`);break;case\"mute\":case\"unmute\":mute=\"mute\"===arg;break;case\"time\":if(0===args.length)return this.error(\"time missing required seconds value\");if(raw=args.shift(),time=Number.parseFloat(raw),Number.isNaN(time)||!Number.isFinite(time))return this.error(`cannot parse time: ${raw}`);break;case\"loop\":case\"unloop\":loop=\"loop\"===arg;break;case\"goto\":if(0===args.length)return this.error(\"goto missing required passage title\");if(raw=args.shift(),passage=\"object\"==typeof raw?raw.link:raw,!Story.has(passage))return this.error(`passage \"${passage}\" does not exist`);break;default:return this.error(`unknown action: ${arg}`)}}try{if(null!=volume&&selected.volume(volume),null!=time&&selected.time(time),null!=mute&&selected.mute(mute),null!=loop&&selected.loop(loop),null!=passage){const nsEnded=`ended.macros.macro-${this.name}_goto`;selected.off(nsEnded).one(nsEnded,(()=>{selected.off(nsEnded),Engine.play(passage)}))}switch(action){case\"fade\":selected.fade(fadeOver,fadeTo);break;case\"load\":selected.load();break;case\"pause\":selected.pause();break;case\"play\":selected.playWhenAllowed();break;case\"stop\":selected.stop();break;case\"unload\":selected.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error(`error executing action: ${ex.message}`)}}}),Macro.add(\"cacheaudio\",{handler(){if(this.args.length<2){const errors=[];return this.args.length<1&&errors.push(\"track ID\"),this.args.length<2&&errors.push(\"sources\"),this.error(`no ${errors.join(\" or \")} specified`)}const id=String(this.args[0]).trim(),oldFmtRe=/^format:\\s*([\\w-]+)\\s*;\\s*/i;try{SimpleAudio.tracks.add(id,this.args.slice(1).map((source=>{if(oldFmtRe.test(source)){if(Config.debug)return this.error(`track ID \"${id}\": format specifier migration required, \"format:formatId;\" → \"formatId|\"`);source=source.replace(oldFmtRe,\"$1|\")}return source})))}catch(ex){return this.error(ex.message)}if(Config.debug&&!SimpleAudio.tracks.get(id).hasSource())return this.error(`track ID \"${id}\": no supported audio sources found`);Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(\"createaudiogroup\",{tags:[\"track\"],handler(){if(0===this.args.length)return this.error(\"no group ID specified\");if(1===this.payload.length)return this.error(\"no tracks defined via <<track>>\");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});const groupId=String(this.args[0]).trim(),trackIds=[];for(let i=1,len=this.payload.length;i<len;++i){if(this.payload[i].args.length<1)return this.error(\"no track ID specified\");trackIds.push(String(this.payload[i].args[0]).trim()),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.groups.add(groupId,trackIds)}catch(ex){return this.error(ex.message)}Config.debug&&this.createDebugView(`/${this.name}`,`<</${this.name}>>`).modes({nonvoid:!1,hidden:!0})}}),Macro.add(\"createplaylist\",{tags:[\"track\"],handler(){if(0===this.args.length)return this.error(\"no list ID specified\");if(1===this.payload.length)return this.error(\"no tracks defined via <<track>>\");const playlist=Macro.get(\"playlist\");if(null!==playlist.from&&\"createplaylist\"!==playlist.from)return this.error(\"a playlist has already been defined with <<setplaylist>>\");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});const listId=String(this.args[0]).trim(),trackObjs=[];for(let i=1,len=this.payload.length;i<len;++i){if(0===this.payload[i].args.length)return this.error(\"no track ID specified\");const trackObj={id:String(this.payload[i].args[0]).trim()},args=this.payload[i].args.slice(1);for(;args.length>0;){const arg=args.shift();let raw,parsed;switch(arg){case\"copy\":case\"own\":trackObj.own=!0;break;case\"rate\":args.length>0&&args.shift();break;case\"volume\":if(0===args.length)return this.error(\"volume missing required level value\");if(raw=args.shift(),parsed=Number.parseFloat(raw),Number.isNaN(parsed)||!Number.isFinite(parsed))return this.error(`cannot parse volume: ${raw}`);trackObj.volume=parsed;break;default:return this.error(`unknown action: ${arg}`)}}trackObjs.push(trackObj),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.lists.add(listId,trackObjs)}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from=\"createplaylist\"),Config.debug&&this.createDebugView(`/${this.name}`,`<</${this.name}>>`).modes({nonvoid:!1,hidden:!0})}}),Macro.add(\"masteraudio\",{handler(){if(0===this.args.length)return this.error(\"no actions specified\");const args=this.args.slice(0);let action,mute,muteOnHide,volume;for(;args.length>0;){const arg=args.shift();let raw;switch(arg){case\"load\":case\"stop\":case\"unload\":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case\"mute\":case\"unmute\":mute=\"mute\"===arg;break;case\"muteonhide\":case\"nomuteonhide\":muteOnHide=\"muteonhide\"===arg;break;case\"volume\":if(0===args.length)return this.error(\"volume missing required level value\");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error(`cannot parse volume: ${raw}`);break;default:return this.error(`unknown action: ${arg}`)}}try{switch(null!=mute&&SimpleAudio.mute(mute),null!=muteOnHide&&SimpleAudio.muteOnHidden(muteOnHide),null!=volume&&SimpleAudio.volume(volume),action){case\"load\":SimpleAudio.load();break;case\"stop\":SimpleAudio.stop();break;case\"unload\":SimpleAudio.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error(`error executing action: ${ex.message}`)}}}),Macro.add(\"playlist\",{from:null,handler(){const from=this.self.from;if(null===from)return this.error(\"no playlists have been created\");let list,args,action;if(\"createplaylist\"===from){if(this.args.length<2){const errors=[];return this.args.length<1&&errors.push(\"list ID\"),this.args.length<2&&errors.push(\"actions\"),this.error(`no ${errors.join(\" or \")} specified`)}const id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error(`playlist \"${id}\" does not exist`);list=SimpleAudio.lists.get(id),args=this.args.slice(1)}else{if(0===this.args.length)return this.error(\"no actions specified\");list=SimpleAudio.lists.get(\"setplaylist\"),args=this.args.slice(0)}let fadeTo,loop,mute,shuffle,volume,fadeOver=5;for(;args.length>0;){const arg=args.shift();let raw;switch(arg){case\"load\":case\"pause\":case\"play\":case\"skip\":case\"stop\":case\"unload\":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case\"fadein\":if(action)return this.error(errorOnePlaybackAction(arg,action));action=\"fade\",fadeTo=1;break;case\"fadeout\":if(action)return this.error(errorOnePlaybackAction(arg,action));action=\"fade\",fadeTo=0;break;case\"fadeto\":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error(\"fadeto missing required level value\");if(action=\"fade\",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error(`cannot parse fadeto: ${raw}`);break;case\"fadeoverto\":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){const errors=[];return args.length<1&&errors.push(\"seconds\"),args.length<2&&errors.push(\"level\"),this.error(`fadeoverto missing required ${errors.join(\" and \")} value${errors.length>1?\"s\":\"\"}`)}if(action=\"fade\",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error(`cannot parse fadeoverto: ${raw}`);if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error(`cannot parse fadeoverto: ${raw}`);break;case\"volume\":if(0===args.length)return this.error(\"volume missing required level value\");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error(`cannot parse volume: ${raw}`);break;case\"mute\":case\"unmute\":mute=\"mute\"===arg;break;case\"loop\":case\"unloop\":loop=\"loop\"===arg;break;case\"shuffle\":case\"unshuffle\":shuffle=\"shuffle\"===arg;break;default:return this.error(`unknown action: ${arg}`)}}try{switch(null!=volume&&list.volume(volume),null!=mute&&list.mute(mute),null!=loop&&list.loop(loop),null!=shuffle&&list.shuffle(shuffle),action){case\"fade\":list.fade(fadeOver,fadeTo);break;case\"load\":list.load();break;case\"pause\":list.pause();break;case\"play\":list.playWhenAllowed();break;case\"skip\":list.skip();break;case\"stop\":list.stop();break;case\"unload\":list.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error(`error executing action: ${ex.message}`)}}}),Macro.add(\"removeaudiogroup\",{handler(){if(0===this.args.length)return this.error(\"no group ID specified\");const id=String(this.args[0]).trim();if(!SimpleAudio.groups.has(id))return this.error(`group \"${id}\" does not exist`);SimpleAudio.groups.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(\"removeplaylist\",{handler(){if(0===this.args.length)return this.error(\"no list ID specified\");const id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error(`playlist \"${id}\" does not exist`);SimpleAudio.lists.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(\"waitforaudio\",{skipArgs:!0,handler(){SimpleAudio.loadWithScreen()}}),Macro.add(\"setplaylist\",{handler(){if(0===this.args.length)return this.error(\"no track ID(s) specified\");const playlist=Macro.get(\"playlist\");if(null!==playlist.from&&\"setplaylist\"!==playlist.from)return this.error(\"playlists have already been defined with <<createplaylist>>\");try{SimpleAudio.lists.add(\"setplaylist\",this.args.slice(0))}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from=\"setplaylist\"),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(\"stopallaudio\",{skipArgs:!0,handler(){SimpleAudio.select(\":all\").stop(),Config.debug&&this.debugView.modes({hidden:!0})}})}else Macro.add([\"audio\",\"cacheaudio\",\"createaudiogroup\",\"createplaylist\",\"masteraudio\",\"playlist\",\"removeaudiogroup\",\"removeplaylist\",\"waitforaudio\",\"setplaylist\",\"stopallaudio\"],{skipArgs:!0,handler(){Config.debug&&this.debugView.modes({hidden:!0})}});Macro.add(\"done\",{skipArgs:!0,tags:null,handler(){const contents=this.payload[0].contents.trim();\"\"!==contents&&setTimeout(this.createShadowWrapper((()=>$.wiki(contents))),Engine.minDomActionDelay)}}),Macro.add(\"goto\",{handler(){if(0===this.args.length)return this.error(\"no passage specified\");let passage;if(passage=\"object\"==typeof this.args[0]?this.args[0].link:this.args[0],!Story.has(passage))return this.error(`passage \"${passage}\" does not exist`);Wikifier.stopWikify=2,setTimeout((()=>Engine.play(passage)),Engine.minDomActionDelay)}}),Macro.add(\"repeat\",{isAsync:!0,tags:null,timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler(){if(0===this.args.length)return this.error(\"no time value specified\");let delay;try{delay=Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0]))}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});const transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement(\"span\")).addClass(`macro-${this.name}`).appendTo(this.output);this.self.registerInterval(this.createShadowWrapper((()=>{const frag=document.createDocumentFragment();new Wikifier(frag,this.payload[0].contents);let $output=$wrapper;transition&&($output=jQuery(document.createElement(\"span\")).addClass(\"macro-repeat-insert macro-repeat-in\").appendTo($output)),$output.append(frag),transition&&setTimeout((()=>$output.removeClass(\"macro-repeat-in\")),Engine.minDomActionDelay)})),delay)},registerInterval(callback,delay){if(\"function\"!=typeof callback)throw new TypeError(\"callback parameter must be a function\");const passage=State.passage,turn=State.turns,timers=this.timers;let timerId=null;timerId=setInterval((()=>{if(State.passage!==passage||State.turns!==turn)return clearInterval(timerId),void timers.delete(timerId);let timerIdCache;try{TempState.break=null,TempState.hasOwnProperty(\"repeatTimerId\")&&(timerIdCache=TempState.repeatTimerId),TempState.repeatTimerId=timerId,callback.call(this)}finally{void 0!==timerIdCache?TempState.repeatTimerId=timerIdCache:delete TempState.repeatTimerId,TempState.break=null}}),delay),timers.add(timerId),prehistory.hasOwnProperty(\"#repeat-timers-cleanup\")||(prehistory[\"#repeat-timers-cleanup\"]=task=>{delete prehistory[task],timers.forEach((timerId=>clearInterval(timerId))),timers.clear()})}}),Macro.add(\"stop\",{skipArgs:!0,handler(){if(!TempState.hasOwnProperty(\"repeatTimerId\"))return this.error(\"must only be used in conjunction with its parent macro <<repeat>>\");const timers=Macro.get(\"repeat\").timers,timerId=TempState.repeatTimerId;clearInterval(timerId),timers.delete(timerId),TempState.break=2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(\"timed\",{isAsync:!0,tags:[\"next\"],timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler(){if(0===this.args.length)return this.error(\"no time value specified in <<timed>>\");const items=[];try{items.push({name:this.name,source:this.source,delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0])),content:this.payload[0].contents})}catch(ex){return this.error(`${ex.message} in <<timed>>`)}if(this.payload.length>1){let i;try{let len;for(i=1,len=this.payload.length;i<len;++i)items.push({name:this.payload[i].name,source:this.payload[i].source,delay:0===this.payload[i].args.length?items[items.length-1].delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.payload[i].args[0])),content:this.payload[i].contents})}catch(ex){return this.error(`${ex.message} in <<next>> (#${i})`)}}Config.debug&&this.debugView.modes({block:!0});const transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement(\"span\")).addClass(`macro-${this.name}`).appendTo(this.output);this.self.registerTimeout(this.createShadowWrapper((item=>{const frag=document.createDocumentFragment();new Wikifier(frag,item.content);let $output=$wrapper;Config.debug&&\"next\"===item.name&&($output=jQuery(new DebugView($output[0],\"macro\",item.name,item.source).output)),transition&&($output=jQuery(document.createElement(\"span\")).addClass(\"macro-timed-insert macro-timed-in\").appendTo($output)),$output.append(frag),transition&&setTimeout((()=>$output.removeClass(\"macro-timed-in\")),Engine.minDomActionDelay)})),items)},registerTimeout(callback,items){if(\"function\"!=typeof callback)throw new TypeError(\"callback parameter must be a function\");const passage=State.passage,turn=State.turns,timers=this.timers;let timerId=null,nextItem=items.shift();const worker=function(){if(timers.delete(timerId),State.passage!==passage||State.turns!==turn)return;const curItem=nextItem;null!=(nextItem=items.shift())&&(timerId=setTimeout(worker,nextItem.delay),timers.add(timerId)),callback.call(this,curItem)};timerId=setTimeout(worker,nextItem.delay),timers.add(timerId),prehistory.hasOwnProperty(\"#timed-timers-cleanup\")||(prehistory[\"#timed-timers-cleanup\"]=task=>{delete prehistory[task],timers.forEach((timerId=>clearTimeout(timerId))),timers.clear()})}}),Macro.add(\"widget\",{tags:null,handler(){if(0===this.args.length)return this.error(\"no widget name specified\");const widgetName=this.args[0],isNonVoid=this.args.length>1&&\"container\"===this.args[1];if(Macro.has(widgetName)){if(!Macro.get(widgetName).isWidget)return this.error(`cannot clobber existing macro \"${widgetName}\"`);Macro.delete(widgetName)}try{const widgetDef={isWidget:!0,handler:(widgetCode=this.payload[0].contents,function(){const shadowStore={};State.temporary.hasOwnProperty(\"args\")&&(shadowStore._args=State.temporary.args),State.temporary.args=[...this.args],State.temporary.args.raw=this.args.raw,State.temporary.args.full=this.args.full,this.addShadow(\"_args\"),isNonVoid&&(State.temporary.hasOwnProperty(\"contents\")&&(shadowStore._contents=State.temporary.contents),State.temporary.contents=this.payload[0].contents,this.addShadow(\"_contents\")),State.variables.hasOwnProperty(\"args\")&&(shadowStore.$args=State.variables.args),State.variables.args=State.temporary.args,this.addShadow(\"$args\");try{const resFrag=document.createDocumentFragment(),errList=[];if(new Wikifier(resFrag,widgetCode),Array.from(resFrag.querySelectorAll(\".error\")).forEach((errEl=>{errList.push(errEl.textContent)})),0!==errList.length)return this.error(`error${errList.length>1?\"s\":\"\"} within widget code (${errList.join(\"; \")})`);this.output.appendChild(resFrag)}catch(ex){return this.error(`cannot execute widget: ${ex.message}`)}finally{shadowStore.hasOwnProperty(\"_args\")?State.temporary.args=shadowStore._args:delete State.temporary.args,isNonVoid&&(shadowStore.hasOwnProperty(\"_contents\")?State.temporary.contents=shadowStore._contents:delete State.temporary.contents),shadowStore.hasOwnProperty(\"$args\")?State.variables.args=shadowStore.$args:delete State.variables.args}})};isNonVoid&&(widgetDef.tags=[]),Macro.add(widgetName,widgetDef),Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error(`cannot create widget macro \"${widgetName}\": ${ex.message}`)}var widgetCode}}),Macro.add([\"exit\",\"exitAll\"],{handler(){Wikifier.stopWikify=\"exit\"===this.name?1:2}})})();var getTypeOf=(()=>{const toString=Object.prototype.toString,slice=String.prototype.slice;return function(O){if(null===O)return\"null\";const baseType=typeof O;return\"object\"===baseType?slice.call(toString.call(O),8,-1):baseType}})(),Dialog=(()=>{const DEFAULT_TOP=50;let $overlay=null,$dialog=null,$title=null,$body=null,lastActive=null,observer=null,onCloseFn=null,scrollbarWidth=0;function calcInset(top){const $window=jQuery(window),inset={left:\"\",right:\"\",top:\"\",bottom:\"\"};$dialog.css(inset);let horzSpace=$window.width()-$dialog.outerWidth(!0)-1,vertSpace=$window.height()-$dialog.outerHeight(!0)-1;if(horzSpace<=20+scrollbarWidth&&(vertSpace-=scrollbarWidth),vertSpace<=20+scrollbarWidth&&(horzSpace-=scrollbarWidth),inset.left=inset.right=horzSpace<=20?\"10px\":(horzSpace/2>>0)+\"px\",vertSpace<=20)inset.top=inset.bottom=\"10px\";else{const vertPos=vertSpace/2>>0;inset.top=vertPos>top?top+\"px\":inset.bottom=vertPos+\"px\"}return inset}function onResize(top){\"block\"===$dialog.css(\"display\")&&$dialog.css(calcInset(null!=top?top:DEFAULT_TOP))}function close(ev){if($body.trigger(\":dialogclosing\"),jQuery(document).off(\".dialog-close\"),observer?(observer.disconnect(),observer=null):$body.off(\".dialog-resize\"),jQuery(window).off(\".dialog-resize\"),$dialog.removeClass(\"open\").css({left:\"\",right:\"\",top:\"\",bottom:\"\"}),jQuery(\"#ui-bar,#story\").find(\"[tabindex=-2]\").removeAttr(\"aria-hidden\").attr(\"tabindex\",0),jQuery(\"body>[tabindex=-3]\").removeAttr(\"aria-hidden\").removeAttr(\"tabindex\"),$overlay.removeClass(\"open\"),jQuery(document.documentElement).removeAttr(\"data-dialog\"),$title.empty(),$body.empty().removeClass(),lastActive&&(lastActive.focus(),lastActive=null),onCloseFn)try{onCloseFn(ev)}finally{onCloseFn=null}return $body.trigger(\":dialogclose\"),$body.trigger(\":dialogclosed\"),Dialog}function create(title,classNames){return $title.empty().append((null!=title?String(title):\"\")||\" \"),$body.empty().removeClass(),null!=classNames&&$body.addClass(classNames),Dialog}function getBody(){return $body.get(0)}function isOpen(classNames){return $dialog.hasClass(\"open\")&&(!classNames||classNames.splitOrEmpty(/\\s+/).every((cn=>$body.hasClass(cn))))}function wiki(...args){return $body.wiki(...args),Dialog}return Object.preventExtensions(Object.create(null,{append:{value:function(...args){return $body.append(...args),Dialog}},body:{value:getBody},close:{value:close},create:{value:create},empty:{value:function(){return $body.empty(),Dialog}},init:{value:function(){if(document.getElementById(\"ui-dialog\"))return;scrollbarWidth=(()=>{let calcWidth;try{const inner=document.createElement(\"p\");inner.style.width=\"100%\",inner.style.height=\"200px\";const outer=document.createElement(\"div\");outer.style.position=\"absolute\",outer.style.left=\"0\",outer.style.top=\"0\",outer.style.width=\"100px\",outer.style.height=\"100px\",outer.style.visibility=\"hidden\",outer.style.overflow=\"hidden\",outer.appendChild(inner),document.body.appendChild(outer);const w1=inner.offsetWidth;outer.style.overflow=\"auto\";let w2=inner.offsetWidth;w1===w2&&(w2=outer.clientWidth),document.body.removeChild(outer),calcWidth=w1-w2}catch(ex){}return calcWidth||17})();const $elems=jQuery(document.createDocumentFragment()).append(`<div id=\"ui-overlay\" class=\"ui-close\"></div><div id=\"ui-dialog\" tabindex=\"0\" role=\"dialog\" aria-labelledby=\"ui-dialog-title\" aria-modal=\"true\"><div id=\"ui-dialog-titlebar\"><h1 id=\"ui-dialog-title\"></h1><button id=\"ui-dialog-close\" class=\"ui-close\" tabindex=\"0\" aria-label=\"${L10n.get(\"textClose\")}\"></button></div><div id=\"ui-dialog-body\"></div></div>`);$overlay=jQuery($elems.find(\"#ui-overlay\").get(0)),$dialog=jQuery($elems.find(\"#ui-dialog\").get(0)),$title=jQuery($elems.find(\"#ui-dialog-title\").get(0)),$body=jQuery($elems.find(\"#ui-dialog-body\").get(0)),$elems.insertBefore(\"body>script#script-sugarcube\")}},isOpen:{value:isOpen},open:{value:function(options,onClose){const{top:top}=Object.assign({top:DEFAULT_TOP},options);if(null!=onClose){const closeType=getTypeOf(onClose);if(\"function\"!==closeType)throw new TypeError(`Dialog.open onClose parameter must be a function (received: ${closeType})`);onCloseFn=onClose}else onCloseFn=null;$body.trigger(\":dialogopening\"),isOpen()||(lastActive=document.activeElement||null),jQuery(document.documentElement).attr(\"data-dialog\",\"open\"),$overlay.addClass(\"open\"),jQuery(\"body>:not(script,#store-area,tw-storydata,#ui-bar,#ui-overlay,#ui-dialog)\").attr(\"tabindex\",-3).attr(\"aria-hidden\",!0),jQuery(\"#ui-bar,#story\").find(\"[tabindex]:not([tabindex^=-])\").attr(\"tabindex\",-2).attr(\"aria-hidden\",!0);const resizeHandler=jQuery.throttle(40,(()=>onResize(top)));return $body.imagesLoaded().always(resizeHandler),$dialog.css(calcInset(top)).addClass(\"open\").focus(),jQuery(window).off(\".dialog-resize\").on(\"resize.dialog-resize\",resizeHandler),Has.mutationObserver?(observer=new MutationObserver((mutations=>{for(let i=0;i<mutations.length;++i)if(\"childList\"===mutations[i].type){$body.imagesLoaded().always(resizeHandler),resizeHandler();break}})),observer.observe(getBody(),{childList:!0,subtree:!0})):$body.off(\".dialog-resize\").on(\"DOMNodeInserted.dialog-resize DOMNodeRemoved.dialog-resize\",(()=>{$body.imagesLoaded().always(resizeHandler),resizeHandler()})),jQuery(document).off(\".dialog-close\").one(\"click.dialog-close\",\".ui-close\",(ev=>{close(ev)})).one(\"keypress.dialog-close\",\".ui-close\",(function(ev){13!==ev.which&&32!==ev.which||jQuery(this).trigger(\"click\")})),$body.trigger(\":dialogopen\"),$body.trigger(\":dialogopened\"),Dialog}},resize:{value:function(options){return onResize(\"object\"==typeof options?options.top:undefined)}},wiki:{value:wiki},wikiPassage:{value:function(name){return wiki(Story.get(name).processText())}},setup:{value:function(title,classNames){return create(title,classNames),getBody()}}}))})(),Engine=(()=>{const States=Util.toEnum({Idle:\"idle\",Playing:\"playing\",Rendering:\"rendering\"}),minDomActionDelay=40,_initDebugViews=[];let _state=States.Idle,_lastPlay=null,_outlinePatch=null,_updating=null;function engineGo(offset){const succeded=State.go(offset);return succeded&&engineShow(),succeded}function engineShow(){return enginePlay(State.passage,!0)}function enginePlay(title,noHistory){let passageReadyOutput,passageDoneOutput,passageTitle=title;if(_state=States.Playing,TempState={},State.clearTemporary(),\"function\"==typeof Config.navigation.override)try{const overrideTitle=Config.navigation.override(passageTitle);overrideTitle&&(passageTitle=overrideTitle)}catch(ex){}const passage=Story.get(passageTitle);if(jQuery.event.trigger({type:\":passageinit\",passage:passage}),Object.keys(prehistory).forEach((task=>{\"function\"==typeof prehistory[task]&&prehistory[task].call(passage,task)})),noHistory||State.create(passage.title),document.body.className&&(document.body.className=\"\"),_lastPlay=Util.now(),Object.keys(predisplay).forEach((task=>{\"function\"==typeof predisplay[task]&&predisplay[task].call(passage,task)})),Story.has(\"PassageReady\"))try{passageReadyOutput=Wikifier.wikifyEval(Story.get(\"PassageReady\").text)}catch(ex){console.error(ex),Alert.error(\"PassageReady\",ex.message)}_state=States.Rendering;const dataTags=passage.tags.length>0?passage.tags.join(\" \"):null,passageEl=document.createElement(\"div\");jQuery(passageEl).attr({id:passage.domId,\"data-passage\":passage.title,\"data-tags\":dataTags}).addClass(`passage ${passage.className}`),jQuery(document.body).attr(\"data-tags\",dataTags).addClass(passage.className),jQuery(document.documentElement).attr(\"data-tags\",dataTags),jQuery.event.trigger({type:\":passagestart\",content:passageEl,passage:passage}),Object.keys(prerender).forEach((task=>{\"function\"==typeof prerender[task]&&prerender[task].call(passage,passageEl,task)})),Story.has(\"PassageHeader\")&&new Wikifier(passageEl,Story.get(\"PassageHeader\").processText()),passageEl.appendChild(passage.render()),Story.has(\"PassageFooter\")&&new Wikifier(passageEl,Story.get(\"PassageFooter\").processText()),jQuery.event.trigger({type:\":passagerender\",content:passageEl,passage:passage}),Object.keys(postrender).forEach((task=>{\"function\"==typeof postrender[task]&&postrender[task].call(passage,passageEl,task)}));const containerEl=document.getElementById(\"passages\");if(containerEl.hasChildNodes()&&(\"number\"==typeof Config.passages.transitionOut||\"string\"==typeof Config.passages.transitionOut&&\"\"!==Config.passages.transitionOut&&Has.transitionEndEvent?[...containerEl.childNodes].forEach((outgoing=>{const $outgoing=jQuery(outgoing);if(outgoing.nodeType===Node.ELEMENT_NODE&&$outgoing.hasClass(\"passage\")){if($outgoing.hasClass(\"passage-out\"))return;$outgoing.attr({id:`out-${$outgoing.attr(\"id\")}`,\"aria-live\":\"off\"}).addClass(\"passage-out\"),\"string\"==typeof Config.passages.transitionOut?$outgoing.on(Has.transitionEndEvent,(ev=>{ev.propertyName===Config.passages.transitionOut&&$outgoing.remove()})):setTimeout((()=>$outgoing.remove()),Math.max(minDomActionDelay,Config.passages.transitionOut))}else $outgoing.remove()})):jQuery(containerEl).empty()),jQuery(passageEl).addClass(\"passage-in\").appendTo(containerEl),setTimeout((()=>jQuery(passageEl).removeClass(\"passage-in\")),minDomActionDelay),Story.has(\"StoryDisplayTitle\")?null===_updating&&Config.ui.updateStoryElements||setDisplayTitle(Story.get(\"StoryDisplayTitle\").processText()):Config.passages.displayTitles&&passage.title!==Config.passages.start&&(document.title=`${passage.title} | ${Story.title}`),window.scroll(0,0),_state=States.Playing,Story.has(\"PassageDone\"))try{passageDoneOutput=Wikifier.wikifyEval(Story.get(\"PassageDone\").text)}catch(ex){console.error(ex),Alert.error(\"PassageDone\",ex.message)}if(jQuery.event.trigger({type:\":passagedisplay\",content:passageEl,passage:passage}),Object.keys(postdisplay).forEach((task=>{\"function\"==typeof postdisplay[task]&&postdisplay[task].call(passage,task)})),null!==_updating?_updating.forEach((pair=>{jQuery(pair.element).empty(),new Wikifier(pair.element,Story.get(pair.passage).processText().trim())})):Config.ui.updateStoryElements&&UIBar.update(),Config.debug){let debugView;null!=passageReadyOutput&&(debugView=new DebugView(document.createDocumentFragment(),\"special\",\"PassageReady\",\"PassageReady\"),debugView.modes({hidden:!0}),debugView.append(passageReadyOutput),jQuery(passageEl).prepend(debugView.output)),null!=passageDoneOutput&&(debugView=new DebugView(document.createDocumentFragment(),\"special\",\"PassageDone\",\"PassageDone\"),debugView.modes({hidden:!0}),debugView.append(passageDoneOutput),jQuery(passageEl).append(debugView.output)),1===State.turns&&_initDebugViews.length>0&&jQuery(passageEl).prepend(_initDebugViews)}switch(jQuery(\"#story\").find(\"a[href]:not(.link-external)\").addClass(\"link-external\").end().find(\"a,link,button,input,select,textarea\").not(\"[tabindex]\").attr(\"tabindex\",0),typeof Config.saves.autosave){case\"boolean\":Config.saves.autosave&&Save.autosave.save();break;case\"object\":passage.tags.some((tag=>Config.saves.autosave.includes(tag)))&&Save.autosave.save();break;case\"function\":Config.saves.autosave()&&Save.autosave.save()}return jQuery.event.trigger({type:\":passageend\",content:passageEl,passage:passage}),_state=States.Idle,_lastPlay=Util.now(),passageEl}function _hideOutlines(){_outlinePatch.set(\"*:focus{outline:none;}\")}return Object.freeze(Object.defineProperties({},{States:{value:States},minDomActionDelay:{value:minDomActionDelay},init:{value:function(){let _lastOutlineEvent;jQuery(\"#init-no-js,#init-lacking\").remove(),(()=>{const $elems=jQuery(document.createDocumentFragment()),markup=Story.has(\"StoryInterface\")&&Story.get(\"StoryInterface\").text.trim();if(markup){UIBar.destroy(),jQuery(document.head).find(\"#style-core-display\").remove(),$elems.append(markup);const $passages=$elems.find(\"#passages\");if(0===$passages.length)throw new Error('no element with ID \"passages\" found within \"StoryInterface\" special passage');$passages.empty().not(\"[aria-live]\").attr(\"aria-live\",\"polite\").end(),$elems.find(\"[data-init-passage]\").each(((i,el)=>{if(\"passages\"===el.id)throw new Error(`\"StoryInterface\" element <${el.nodeName.toLowerCase()} id=\"passages\"> must not contain a \"data-init-passage\" content attribute`);const passage=el.getAttribute(\"data-init-passage\").trim();if(el.hasAttribute(\"data-passage\"))throw new Error(`\"StoryInterface\" element <${el.nodeName.toLowerCase()} data-init-passage=\"${passage}\"> must not contain a \"data-passage\" content attribute`);if(null!==el.firstElementChild)throw new Error(`\"StoryInterface\" element <${el.nodeName.toLowerCase()} data-init-passage=\"${passage}\"> contains child elements`);Story.has(passage)&&jQuery(el).empty().wiki(Story.get(passage).processText().trim())}));const updating=[];$elems.find(\"[data-passage]\").each(((i,el)=>{if(\"passages\"===el.id)throw new Error(`\"StoryInterface\" element <${el.nodeName.toLowerCase()} id=\"passages\"> must not contain a \"data-passage\" content attribute`);const passage=el.getAttribute(\"data-passage\").trim();if(null!==el.firstElementChild)throw new Error(`\"StoryInterface\" element <${el.nodeName.toLowerCase()} data-passage=\"${passage}\"> contains child elements`);Story.has(passage)&&updating.push({passage:passage,element:el})})),updating.length>0&&(_updating=updating),Config.ui.updateStoryElements=!1}else $elems.append('<div id=\"story\" role=\"main\"><div id=\"passages\" aria-live=\"polite\"></div></div>');$elems.insertBefore(\"body>script#script-sugarcube\")})(),_outlinePatch=new StyleWrapper(jQuery(document.createElement(\"style\")).attr({id:\"style-aria-outlines\",type:\"text/css\"}).appendTo(document.head).get(0)),_hideOutlines(),jQuery(document).on(\"mousedown.aria-outlines keydown.aria-outlines\",(ev=>{ev.type!==_lastOutlineEvent&&(_lastOutlineEvent=ev.type,\"keydown\"===ev.type?_outlinePatch.clear():_hideOutlines())}))}},start:{value:function(){if(Story.getAllInit().forEach((passage=>{try{const debugBuffer=Wikifier.wikifyEval(passage.text);if(Config.debug){const debugView=new DebugView(document.createDocumentFragment(),\"special\",`${passage.title} [init-tagged]`,`${passage.title} [init-tagged]`);debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error(`${passage.title} [init-tagged]`,\"object\"==typeof ex?ex.message:ex)}})),Story.has(\"StoryInit\"))try{const debugBuffer=Wikifier.wikifyEval(Story.get(\"StoryInit\").text);if(Config.debug){const debugView=new DebugView(document.createDocumentFragment(),\"special\",\"StoryInit\",\"StoryInit\");debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}new Promise(((resolve,reject)=>{jQuery(document.createElement(\"script\")).one(\"load abort error\",(ev=>{jQuery(ev.target).off(),\"load\"===ev.type?resolve(ev.target):reject(new Error('importScripts failed to load the script \"usettings.js\".'))})).appendTo(document.head).attr({id:\"script-imported-usettings.js\",type:\"text/javascript\",src:\"usettings.js\"})})).then((()=>console.log(\"usettings.js is active\"))).catch((()=>console.log(\"usettings.js not active, this is normal\")))}catch(ex){console.error(ex),Alert.error(\"StoryInit\",\"object\"==typeof ex?ex.message:ex)}if(null==Config.passages.start)throw new Error(\"starting passage not selected\");if(!Story.has(Config.passages.start))throw new Error(`starting passage (\"${Config.passages.start}\") not found`);if(jQuery(document.documentElement).focus(),State.restore())engineShow();else{let loadStart=!0;switch(typeof Config.saves.autoload){case\"boolean\":Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!Save.autosave.load());break;case\"string\":\"prompt\"===Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!1,UI.buildAutoload(),Dialog.open());break;case\"function\":Save.autosave.ok()&&Save.autosave.has()&&Config.saves.autoload()&&(loadStart=!Save.autosave.load())}loadStart&&enginePlay(Config.passages.start)}}},restart:{value:function(){LoadScreen.show(),window.scroll(0,0),State.reset(),jQuery.event.trigger(\":enginerestart\"),window.location.reload()}},state:{get:function(){return _state}},isIdle:{value:function(){return _state===States.Idle}},isPlaying:{value:function(){return _state!==States.Idle}},isRendering:{value:function(){return _state===States.Rendering}},lastPlay:{get:function(){return _lastPlay}},goTo:{value:function(idx){const succeded=State.goTo(idx);return succeded&&engineShow(),succeded}},go:{value:engineGo},backward:{value:function(){return engineGo(-1)}},forward:{value:function(){return engineGo(1)}},show:{value:engineShow},play:{value:enginePlay},display:{value:function(title,link,option){let noHistory=!1;switch(option){case undefined:break;case\"replace\":case\"back\":noHistory=!0;break;default:throw new Error(`Engine.display option parameter called with obsolete value \"${option}\"; please notify the developer`)}enginePlay(title,noHistory)}}}))})(),Passage=(()=>{let _tagsToSkip;_tagsToSkip=/^(?:debug|nobr|passage|widget|twine\\..*)$/i;class Passage{constructor(title,el){Object.defineProperties(this,{title:{value:Util.unescape(title)},element:{value:el||null},tags:{value:Object.freeze(el&&el.hasAttribute(\"tags\")?Array.from(new Set(el.getAttribute(\"tags\").trim().splitOrEmpty(/\\s+/))):[])},_excerpt:{writable:!0,value:null}}),Object.defineProperties(this,{domId:{value:`passage-${Util.slugify(this.title)}`},classes:{value:Object.freeze(0===this.tags.length?[]:(()=>this.tags.filter((tag=>!_tagsToSkip.test(tag))).map((tag=>Util.slugify(tag))))())}})}get className(){return this.classes.join(\" \")}get text(){if(null==this.element){const passage=Util.escapeMarkup(this.title);return`<div class=\"error-view\"><span class=\"error\">${`${L10n.get(\"errorTitle\")}: ${L10n.get(\"errorNonexistentPassage\",{passage:passage})}`}</span></div>`}return this.element.textContent.replace(/\\r/g,\"\")}description(){const descriptions=Config.passages.descriptions;switch(typeof descriptions){case\"boolean\":if(descriptions)return this.title;break;case\"object\":if(descriptions.hasOwnProperty(this.title))return descriptions[this.title];break;case\"function\":{const result=descriptions.call(this);if(result)return result}}return null===this._excerpt&&(this._excerpt=Passage.getExcerptFromText(this.text)),this._excerpt}processText(){if(null==this.element)return this.text;if(this.tags.includes(\"Twine.image\"))return`[img[${this.text}]]`;let processed=this.text;return Config.passages.onProcess&&(processed=Config.passages.onProcess.call(null,{title:this.title,tags:this.tags,text:processed})),(Config.passages.nobr||this.tags.includes(\"nobr\"))&&(processed=processed.replace(/^\\n+|\\n+$/g,\"\").replace(/\\n+/g,\" \")),Wikifier.stopWikify=0,processed}render(options){const frag=document.createDocumentFragment();return new Wikifier(frag,this.processText(),options),null==Config.passages.descriptions&&(this._excerpt=Passage.getExcerptFromNode(frag)),frag}static getExcerptFromNode(node,count){if(!node.hasChildNodes())return\"\";let excerpt=node.textContent.trim();if(\"\"!==excerpt){const excerptRe=new RegExp(`(\\\\S+(?:\\\\s+\\\\S+){0,${count>0?count-1:7}})`);excerpt=excerpt.replace(/\\s+/g,\" \").match(excerptRe)}return excerpt?`${excerpt[1]}…`:\"…\"}static getExcerptFromText(text,count){if(\"\"===text)return\"\";const excerptRe=new RegExp(`(\\\\S+(?:\\\\s+\\\\S+){0,${count>0?count-1:7}})`),excerpt=text.replace(/<<.*?>>/g,\" \").replace(/<.*?>/g,\" \").trim().replace(/^\\s*\\|.*\\|.*?$/gm,\"\").replace(/\\[[<>]?img\\[[^\\]]*\\]\\]/g,\"\").replace(/\\[\\[([^|\\]]*?)(?:(?:\\||->|<-)[^\\]]*)?\\]\\]/g,\"$1\").replace(/^\\s*!+(.*?)$/gm,\"$1\").replace(/'{2}|\\/{2}|_{2}|@{2}/g,\"\").trim().replace(/\\s+/g,\" \").match(excerptRe);return excerpt?`${excerpt[1]}…`:\"…\"}}return Passage})(),Save=(()=>{const Type=Util.toEnum({Autosave:\"autosave\",Disk:\"disk\",Serialize:\"serialize\",Slot:\"slot\"});let _slotsUBound=-1;const _onLoadHandlers=new Set,_onSaveHandlers=new Set;function savesObjGet(){const saves=storage.get(\"saves\");return null===saves?{autosave:null,slots:_appendSlots([],Config.saves.slots)}:saves}function savesObjClear(){return storage.delete(\"saves\"),!0}function autosaveOk(){return\"cookie\"!==storage.name&&void 0!==Config.saves.autosave}function slotsOk(){return\"cookie\"!==storage.name&&-1!==_slotsUBound}function slotsCount(){if(!slotsOk())return 0;const saves=savesObjGet();let count=0;for(let i=0,iend=saves.slots.length;i<iend;++i)null!==saves.slots[i]&&++count;return count}function _appendSlots(array,num){for(let i=0;i<num;++i)array.push(null);return array}function _savesObjSave(saves){return function(saves){const slots=saves.slots;let isSlotsEmpty=!0;for(let i=0,iend=slots.length;i<iend;++i)if(null!==slots[i]){isSlotsEmpty=!1;break}return null===saves.autosave&&isSlotsEmpty}(saves)?(storage.delete(\"saves\"),!0):storage.set(\"saves\",saves)}function _marshal(supplemental,details){if(null!=supplemental&&\"object\"!=typeof supplemental)throw new Error(\"supplemental parameter must be an object\");const saveObj=Object.assign({},supplemental,{id:Config.saves.id,state:State.marshalForSave()});return Config.saves.version&&(saveObj.version=Config.saves.version),_onSaveHandlers.forEach((fn=>fn(saveObj,details))),saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history,saveObj}function _unmarshal(saveObj){try{if(!saveObj||!saveObj.hasOwnProperty(\"id\")||!saveObj.hasOwnProperty(\"state\"))throw new Error(L10n.get(\"errorSaveMissingData\"));if(saveObj.state.history||(saveObj.state.jdelta&&delete saveObj.state.jdelta,saveObj.state.delta&&(saveObj.state.history=State.deltaDecode(saveObj.state.delta)),delete saveObj.state.delta),_onLoadHandlers.forEach((fn=>fn(saveObj))),saveObj.id!==Config.saves.id)throw new Error(L10n.get(\"errorSaveIdMismatch\"));State.unmarshalForSave(saveObj.state),Engine.show()}catch(ex){return UI.alert(`${ex.message.toUpperFirst()}.</p><p>${L10n.get(\"aborting\")}.`),!1}return!0}return Object.freeze(Object.defineProperties({},{init:{value:function(){if(\"cookie\"===storage.name)return savesObjClear(),Config.saves.autoload=undefined,Config.saves.autosave=undefined,Config.saves.slots=0,!1;let saves=savesObjGet(),updated=!1;return Array.isArray(saves)&&(saves={autosave:null,slots:saves},updated=!0),Config.saves.slots!==saves.slots.length&&(Config.saves.slots<saves.slots.length?(saves.slots.reverse(),saves.slots=saves.slots.filter((function(val){return!(null===val&&this.count>0)||(--this.count,!1)}),{count:saves.slots.length-Config.saves.slots}),saves.slots.reverse()):Config.saves.slots>saves.slots.length&&_appendSlots(saves.slots,Config.saves.slots-saves.slots.length),updated=!0),updated&&_savesObjSave(saves),_slotsUBound=saves.slots.length-1,!0}},get:{value:savesObjGet},clear:{value:savesObjClear},ok:{value:function(){return autosaveOk()||slotsOk()}},autosave:{value:Object.freeze(Object.defineProperties({},{ok:{value:autosaveOk},has:{value:function(){return null!==savesObjGet().autosave}},get:{value:function(){return savesObjGet().autosave}},load:{value:function(){const saves=savesObjGet();return null!==saves.autosave&&_unmarshal(saves.autosave)}},save:{value:function(title,metadata){if(\"function\"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return!1;if(idb.active)return idb.saveState(0),!0;const saves=savesObjGet(),supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.autosave=_marshal(supplemental,{type:Type.Autosave}),_savesObjSave(saves)}},delete:{value:function(){const saves=savesObjGet();return saves.autosave=null,_savesObjSave(saves)}}}))},slots:{value:Object.freeze(Object.defineProperties({},{ok:{value:slotsOk},length:{get:function(){return _slotsUBound+1}},isEmpty:{value:function(){return 0===slotsCount()}},count:{value:slotsCount},has:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;const saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])}},get:{value:function(slot){if(slot<0||slot>_slotsUBound)return null;const saves=savesObjGet();return slot>=saves.slots.length?null:saves.slots[slot]}},load:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;const saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])&&_unmarshal(saves.slots[slot])}},save:{value:function(slot,title,metadata){if(\"function\"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(\":dialogclosed\",(()=>UI.alert(L10n.get(\"savesDisallowed\")))):UI.alert(L10n.get(\"savesDisallowed\")),!1;if(slot<0||slot>_slotsUBound)return!1;const saves=savesObjGet();if(slot>=saves.slots.length)return!1;const supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.slots[slot]=_marshal(supplemental,{type:Type.Slot}),_savesObjSave(saves)}},delete:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;const saves=savesObjGet();return!(slot>=saves.slots.length)&&(saves.slots[slot]=null,_savesObjSave(saves))}}}))},export:{value:function(filename,metadata){if(\"function\"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return void(Dialog.isOpen()?$(document).one(\":dialogclosed\",(()=>UI.alert(L10n.get(\"savesDisallowed\")))):UI.alert(L10n.get(\"savesDisallowed\")));var str;const saveName=`${null==filename?Story.domId:(str=filename,Util.sanitizeFilename(str).replace(/[_\\s\\u2013\\u2014-]+/g,\"-\"))}-${function(){const now=new Date;let MM=now.getMonth()+1,DD=now.getDate(),hh=now.getHours(),mm=now.getMinutes(),ss=now.getSeconds();return MM<10&&(MM=`0${MM}`),DD<10&&(DD=`0${DD}`),hh<10&&(hh=`0${hh}`),mm<10&&(mm=`0${mm}`),ss<10&&(ss=`0${ss}`),`${now.getFullYear()}${MM}${DD}-${hh}${mm}${ss}`}()}.save`,supplemental=null==metadata?{}:{metadata:metadata},saveObj=LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Disk})));saveAs(new Blob([saveObj],{type:\"text/plain;charset=UTF-8\"}),saveName)}},import:{value:function(event){const file=event.target.files[0],reader=new FileReader;jQuery(reader).one(\"loadend\",(()=>{if(reader.error){const ex=reader.error;return void UI.alert(`${L10n.get(\"errorSaveDiskLoadFailed\").toUpperFirst()} (${ex.name}: ${ex.message}).</p><p>${L10n.get(\"aborting\")}.`)}let saveObj;try{saveObj=JSON.parse(/\\.json$/i.test(file.name)||/^\\{/.test(reader.result)?reader.result:LZString.decompressFromBase64(reader.result))}catch(ex){}_unmarshal(saveObj)})),reader.readAsText(file)}},serialize:{value:function(metadata){if(\"function\"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(\":dialogclosed\",(()=>UI.alert(L10n.get(\"savesDisallowed\")))):UI.alert(L10n.get(\"savesDisallowed\")),null;const supplemental=null==metadata?{}:{metadata:metadata};return LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Serialize})))}},deserialize:{value:function(base64Str){let saveObj;try{saveObj=JSON.parse(LZString.decompressFromBase64(base64Str))}catch(ex){}return _unmarshal(saveObj)?saveObj.metadata:null}},onLoad:{value:Object.freeze(Object.defineProperties({},{add:{value:function(handler){const valueType=Util.getType(handler);if(\"function\"!==valueType)throw new TypeError(`Save.onLoad.add handler parameter must be a function (received: ${valueType})`);_onLoadHandlers.add(handler)}},clear:{value:function(){_onLoadHandlers.clear()}},delete:{value:function(handler){return _onLoadHandlers.delete(handler)}},size:{get:function(){return _onLoadHandlers.size}},handlers:{value:_onLoadHandlers}}))},onSave:{value:Object.freeze(Object.defineProperties({},{add:{value:function(handler){const valueType=Util.getType(handler);if(\"function\"!==valueType)throw new TypeError(`Save.onSave.add handler parameter must be a function (received: ${valueType})`);_onSaveHandlers.add(handler)}},clear:{value:function(){_onSaveHandlers.clear()}},delete:{value:function(handler){return _onSaveHandlers.delete(handler)}},size:{get:function(){return _onSaveHandlers.size}},handlers:{value:_onSaveHandlers}}))}}))})(),Setting=(()=>{const Types=Util.toEnum({Header:0,Toggle:1,List:2,Range:3}),_definitions=[];function settingsCreate(){return Object.create(null)}function settingsSave(){const savedSettings=settingsCreate();return Object.keys(settings).length>0&&_definitions.filter((def=>def.type!==Types.Header&&settings[def.name]!==def.default)).forEach((def=>savedSettings[def.name]=settings[def.name])),0===Object.keys(savedSettings).length?(storage.delete(\"settings\"),!0):storage.set(\"settings\",savedSettings)}function settingsLoad(){const defaultSettings=settingsCreate(),loadedSettings=storage.get(\"settings\")||settingsCreate();_definitions.filter((def=>def.type!==Types.Header)).forEach((def=>defaultSettings[def.name]=def.default)),window.SugarCube.settings=settings=Object.assign(defaultSettings,loadedSettings)}function settingsClear(){return window.SugarCube.settings=settings=settingsCreate(),storage.delete(\"settings\"),!0}function definitionsAdd(type,name,def){if(arguments.length<3){const errors=[];throw arguments.length<1&&errors.push(\"type\"),arguments.length<2&&errors.push(\"name\"),arguments.length<3&&errors.push(\"definition\"),new Error(`missing parameters, no ${errors.join(\" or \")} specified`)}if(\"object\"!=typeof def)throw new TypeError(\"definition parameter must be an object\");if(definitionsHas(name))throw new Error(`cannot clobber existing setting \"${name}\"`);const definition={type:type,name:name,label:\"string\"==typeof def.label?def.label.trim():\"\"};if(\"string\"==typeof def.desc){const desc=def.desc.trim();\"\"!==desc&&(definition.desc=desc)}switch(type){case Types.Header:break;case Types.Toggle:definition.default=!!def.default;break;case Types.List:if(!def.hasOwnProperty(\"list\"))throw new Error(\"no list specified\");if(!Array.isArray(def.list))throw new TypeError(\"list must be an array\");if(0===def.list.length)throw new Error(\"list must not be empty\");if(definition.list=Object.freeze(def.list),null==def.default)definition.default=def.list[0];else{const defaultIndex=def.list.indexOf(def.default);if(-1===defaultIndex)throw new Error(\"list does not contain default\");definition.default=def.list[defaultIndex]}break;case Types.Range:if(!def.hasOwnProperty(\"min\"))throw new Error(\"no min specified\");if(\"number\"!=typeof def.min||Number.isNaN(def.min)||!Number.isFinite(def.min))throw new TypeError(\"min must be a finite number\");if(!def.hasOwnProperty(\"max\"))throw new Error(\"no max specified\");if(\"number\"!=typeof def.max||Number.isNaN(def.max)||!Number.isFinite(def.max))throw new TypeError(\"max must be a finite number\");if(!def.hasOwnProperty(\"step\"))throw new Error(\"no step specified\");if(\"number\"!=typeof def.step||Number.isNaN(def.step)||!Number.isFinite(def.step)||def.step<=0)throw new TypeError(\"step must be a finite number greater than zero\");{const fracDigits=(()=>{const str=String(def.step),pos=str.lastIndexOf(\".\");return-1===pos?0:str.length-pos-1})();function stepValidate(value){if(fracDigits>0){const ma=Number(`${def.min}e${fracDigits}`),sa=Number(`${def.step}e${fracDigits}`),va=Number(`${value}e${fracDigits}`)-ma;return Number(`${va-va%sa+ma}e-${fracDigits}`)}const va=value-def.min;return va-va%def.step+def.min}if(stepValidate(def.max)!==def.max)throw new RangeError(`max (${def.max}) is not a multiple of the step (${def.step}) plus the min (${def.min})`)}if(definition.max=def.max,definition.min=def.min,definition.step=def.step,null==def.default)definition.default=def.max;else{if(\"number\"!=typeof def.default||Number.isNaN(def.default)||!Number.isFinite(def.default))throw new TypeError(\"default must be a finite number\");if(def.default<def.min)throw new RangeError(`default (${def.default}) is less than min (${def.min})`);if(def.default>def.max)throw new RangeError(`default (${def.default}) is greater than max (${def.max})`);definition.default=def.default}break;default:throw new Error(`unknown Setting type: ${type}`)}\"function\"==typeof def.onInit&&(definition.onInit=Object.freeze(def.onInit)),\"function\"==typeof def.onChange&&(definition.onChange=Object.freeze(def.onChange)),_definitions.push(Object.freeze(definition))}function definitionsHas(name){return _definitions.some((definition=>definition.name===name))}function definitionsGet(name){return _definitions.find((definition=>definition.name===name))}return Object.freeze(Object.defineProperties({},{Types:{value:Types},init:{value:function(){if(storage.has(\"options\")){const old=storage.get(\"options\");null!==old&&(window.SugarCube.settings=settings=Object.assign(settingsCreate(),old)),settingsSave(),storage.delete(\"options\")}settingsLoad(),_definitions.forEach((def=>{if(def.hasOwnProperty(\"onInit\")){const thisArg={name:def.name,value:settings[def.name],default:def.default};def.hasOwnProperty(\"list\")&&(thisArg.list=def.list),def.onInit.call(thisArg)}}))}},create:{value:settingsCreate},save:{value:settingsSave},load:{value:settingsLoad},clear:{value:settingsClear},reset:{value:function(name){if(0===arguments.length)settingsClear(),settingsLoad();else{if(null==name||!definitionsHas(name))throw new Error(`nonexistent setting \"${name}\"`);const def=definitionsGet(name);def.type!==Types.Header&&(settings[name]=def.default)}return settingsSave()}},forEach:{value:function(callback,thisArg){_definitions.forEach(callback,thisArg)}},add:{value:definitionsAdd},addHeader:{value:function(name,desc){definitionsAdd(Types.Header,name,{desc:desc})}},addToggle:{value:function(...args){definitionsAdd(Types.Toggle,...args)}},addList:{value:function(...args){definitionsAdd(Types.List,...args)}},addRange:{value:function(...args){definitionsAdd(Types.Range,...args)}},isEmpty:{value:function(){return 0===_definitions.length}},has:{value:definitionsHas},get:{value:definitionsGet},delete:{value:function definitionsDelete(name){definitionsHas(name)&&delete settings[name];for(let i=0;i<_definitions.length;++i)if(_definitions[i].name===name){_definitions.splice(i,1),definitionsDelete(name);break}}}}))})(),Story=(()=>{const _passages={},_inits=[],_scripts=[],_styles=[],_widgets=[];let _title=\"\",_ifId=\"\",_domId=\"\";function _storySetTitle(rawTitle){if(null==rawTitle)throw new Error(\"story title must not be null or undefined\");const title=Util.unescape(String(rawTitle)).trim();if(\"\"===title)throw new Error(\"story title must not be empty or consist solely of whitespace\");if(document.title=_title=title,_domId=Util.slugify(_title),\"\"===_domId)if(\"\"!==_ifId)_domId=_ifId;else for(let i=0,len=_title.length;i<len;++i){const{char:char,start:start,end:end}=Util.charAndPosAt(_title,i);_domId+=char.codePointAt(0).toString(16),i+=end-start}}return Object.freeze(Object.defineProperties({},{load:{value:function(){const validationCodeTags=[\"init\",\"widget\"],validationNoCodeTagPassages=[\"PassageDone\",\"PassageFooter\",\"PassageHeader\",\"PassageReady\",\"StoryAuthor\",\"StoryBanner\",\"StoryCaption\",\"StoryInit\",\"StoryMenu\",\"StoryShare\",\"StorySubtitle\"];function validateStartingPassage(passage){if(passage.tags.includesAny(validationCodeTags))throw new Error(`starting passage \"${passage.title}\" contains special tags; invalid: \"${passage.tags.filter((tag=>validationCodeTags.includes(tag))).sort().join('\", \"')}\"`)}function validateSpecialPassages(passage,...tags){if(validationNoCodeTagPassages.includes(passage.title))throw new Error(`special passage \"${passage.title}\" contains special tags; invalid: \"${tags.sort().join('\", \"')}\"`);const codeTags=[...validationCodeTags],foundTags=[];if(passage.tags.forEach((tag=>{codeTags.includes(tag)&&foundTags.push(...codeTags.delete(tag))})),foundTags.length>1)throw new Error(`passage \"${passage.title}\" contains multiple special tags; invalid: \"${foundTags.sort().join('\", \"')}\"`)}{const $storydata=jQuery(\"tw-storydata\"),startNode=$storydata.attr(\"startnode\")||\"\";Config.passages.start=null,Config.debug=/\\bdebug\\b/.test($storydata.attr(\"options\")),$storydata.children(\"style\").each((function(i){_styles.push(new Passage(`tw-user-style-${i}`,this))})),$storydata.children(\"script\").each((function(i){_scripts.push(new Passage(`tw-user-script-${i}`,this))})),$storydata.children('tw-passagedata:not([tags~=\"Twine.private\"],[tags~=\"annotation\"])').each((function(){const $this=jQuery(this),pid=$this.attr(\"pid\")||\"\",passage=new Passage($this.attr(\"name\"),this);pid===startNode&&\"\"!==startNode?(Config.passages.start=passage.title,validateStartingPassage(passage),_passages[passage.title]=passage):passage.tags.includes(\"init\")?(validateSpecialPassages(passage,\"init\"),_inits.push(passage)):passage.tags.includes(\"widget\")?(validateSpecialPassages(passage,\"widget\"),_widgets.push(passage)):_passages[passage.title]=passage})),_ifId=$storydata.attr(\"ifid\"),_storySetTitle(\"{{STORY_NAME}}\"),Config.saves.id=Story.domId}}},init:{value:function(){(()=>{const storyStyle=document.createElement(\"style\");new StyleWrapper(storyStyle).add(_styles.map((style=>style.text.trim())).join(\"\\n\")),jQuery(storyStyle).appendTo(document.head).attr({id:\"style-story\",type:\"text/css\"})})();for(let i=0;i<_scripts.length;++i)try{Scripting.evalJavaScript(_scripts[i].text)}catch(ex){console.error(ex),Alert.error(_scripts[i].title,\"object\"==typeof ex?ex.message:ex)}for(let i=0;i<_widgets.length;++i)try{Wikifier.wikifyEval(_widgets[i].processText())}catch(ex){console.error(ex),Alert.error(_widgets[i].title,\"object\"==typeof ex?ex.message:ex)}}},title:{get:function(){return _title}},domId:{get:function(){return _domId}},ifId:{get:function(){return _ifId}},add:{value:function(passage){if(!(passage instanceof Passage))throw new TypeError(\"Story.add passage parameter must be an instance of Passage\");const title=passage.title;return!_passages.hasOwnProperty(title)&&(_passages[title]=passage,!0)}},has:{value:function(title){let type=typeof title;switch(type){case\"number\":case\"string\":return _passages.hasOwnProperty(String(title));case\"undefined\":break;case\"object\":type=null===title?\"null\":\"an object\";break;default:type=`a ${type}`}throw new TypeError(`Story.has title parameter cannot be ${type}`)}},get:{value:function(title){let type=typeof title;switch(type){case\"number\":case\"string\":{const id=String(title);return _passages.hasOwnProperty(id)?_passages[id]:new Passage(id||\"(unknown)\")}case\"undefined\":break;case\"object\":type=null===title?\"null\":\"an object\";break;default:type=`a ${type}`}throw new TypeError(`Story.get title parameter cannot be ${type}`)}},getAllInit:{value:function(){return Object.freeze(Array.from(_inits))}},getAllRegular:{value:function(){return Object.freeze(Object.assign({},_passages))}},getAllScript:{value:function(){return Object.freeze(Array.from(_scripts))}},getAllStylesheet:{value:function(){return Object.freeze(Array.from(_styles))}},getAllWidget:{value:function(){return Object.freeze(Array.from(_widgets))}},lookup:{value:function(key,value,sortKey=\"title\"){const results=[];return Object.keys(_passages).forEach((name=>{const passage=_passages[name];\"object\"==typeof passage[key]&&null!==passage[key]?passage[key]instanceof Array&&passage[key].some((m=>Util.sameValueZero(m,value)))&&results.push(passage):Util.sameValueZero(passage[key],value)&&results.push(passage)})),results.sort(((a,b)=>a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1)),results}},lookupWith:{value:function(predicate,sortKey=\"title\"){if(\"function\"!=typeof predicate)throw new TypeError(\"Story.lookupWith predicate parameter must be a function\");const results=[];return Object.keys(_passages).forEach((name=>{const passage=_passages[name];predicate(passage)&&results.push(passage)})),results.sort(((a,b)=>a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1)),results}}}))})(),UI=(()=>{function uiAssembleLinkList(passage,listEl){let list=listEl;const debugState=Config.debug,cleanState=Config.cleanupWikifierOutput;Config.debug=!1,Config.cleanupWikifierOutput=!1;try{null==list&&(list=document.createElement(\"ul\"));const frag=document.createDocumentFragment();new Wikifier(frag,Story.get(passage).processText().trim());const errors=[...frag.querySelectorAll(\".error\")].map((errEl=>errEl.textContent.replace(errorPrologRegExp,\"\")));if(errors.length>0)throw new Error(errors.join(\"; \"));for(;frag.hasChildNodes();){const node=frag.firstChild;if(node.nodeType===Node.ELEMENT_NODE&&\"A\"===node.nodeName.toUpperCase()){const li=document.createElement(\"li\");list.appendChild(li),li.appendChild(node)}else frag.removeChild(node)}}finally{Config.cleanupWikifierOutput=cleanState,Config.debug=debugState}return list}function uiOpenAlert(message,...args){jQuery(Dialog.setup(L10n.get(\"alertTitle\"),\"alert\")).append(`<p>${message}</p><ul class=\"buttons\"><li><button id=\"alert-ok\" class=\"ui-close\">${L10n.get([\"alertOk\",\"ok\"])}</button></li></ul>`),Dialog.open(...args)}function uiBuildAutoload(){return jQuery(Dialog.setup(L10n.get(\"autoloadTitle\"),\"autoload\")).append(`<p>${L10n.get(\"autoloadPrompt\")}</p><ul class=\"buttons\"><li><button id=\"autoload-ok\" class=\"ui-close\">${L10n.get([\"autoloadOk\",\"ok\"])}</button></li><li><button id=\"autoload-cancel\" class=\"ui-close\">${L10n.get([\"autoloadCancel\",\"cancel\"])}</button></li></ul>`),jQuery(document).one(\"click.autoload\",\".ui-close\",(ev=>{const isAutoloadOk=\"autoload-ok\"===ev.target.id;jQuery(document).one(\":dialogclosed\",(()=>{isAutoloadOk&&Save.autosave.load()||Engine.play(Config.passages.start)}))})),!0}function uiBuildJumpto(){const list=document.createElement(\"ul\");jQuery(Dialog.setup(L10n.get(\"jumptoTitle\"),\"jumpto list\")).append(list);const expired=State.expired.length;for(let i=State.size-1;i>=0;--i){if(i===State.activeIndex)continue;const passage=Story.get(State.history[i].title);passage&&passage.tags.includes(\"bookmark\")&&jQuery(document.createElement(\"li\")).append(jQuery(document.createElement(\"a\")).ariaClick({one:!0},function(idx){return()=>jQuery(document).one(\":dialogclosed\",(()=>Engine.goTo(idx)))}(i)).addClass(\"ui-close\").text(`${L10n.get(\"jumptoTurn\")} ${expired+i+1}: ${passage.description()}`)).appendTo(list)}list.hasChildNodes()||jQuery(list).append(`<li><a><em>${L10n.get(\"jumptoUnavailable\")}</em></a></li>`)}function uiBuildRestart(){return jQuery(Dialog.setup(L10n.get(\"restartTitle\"),\"restart\")).append(`<p>${L10n.get(\"restartPrompt\")}</p><ul class=\"buttons\"><li><button id=\"restart-ok\">${L10n.get([\"restartOk\",\"ok\"])}</button></li><li><button id=\"restart-cancel\" class=\"ui-close\">${L10n.get([\"restartCancel\",\"cancel\"])}</button></li></ul>`).find(\"#restart-ok\").ariaClick({one:!0},(()=>{jQuery(document).one(\":dialogclosed\",(()=>Engine.restart())),Dialog.close()})),!0}function uiBuildSaves(){const savesAllowed=\"function\"!=typeof Config.saves.isAllowed||Config.saves.isAllowed();function createActionItem(bId,bClass,bText,bAction){const $btn=jQuery(document.createElement(\"button\")).attr(\"id\",`saves-${bId}`).html(bText);return bClass&&$btn.addClass(bClass),bAction?$btn.ariaClick(bAction):$btn.ariaDisabled(!0),jQuery(document.createElement(\"li\")).append($btn)}const $dialogBody=jQuery(Dialog.setup(L10n.get(\"savesTitle\"),\"saves\")),savesOk=Save.ok(),fileOk=Has.fileAPI&&(Config.saves.tryDiskOnMobile||!Browser.isMobile.any());if(savesOk&&$dialogBody.append(function(){function createButton(bId,bClass,bText,bSlot,bAction){const $btn=jQuery(document.createElement(\"button\")).attr(\"id\",`saves-${bId}-${bSlot}`).addClass(bId).html(bText);return bClass&&$btn.addClass(bClass),bAction?\"auto\"===bSlot?$btn.ariaClick({label:`${bText} ${L10n.get(\"savesLabelAuto\")}`},(()=>bAction())):$btn.ariaClick({label:`${bText} ${L10n.get(\"savesLabelSlot\")} ${bSlot+1}`},(()=>bAction(bSlot))):$btn.ariaDisabled(!0),$btn}const saves=Save.get(),$tbody=jQuery(document.createElement(\"tbody\"));if(Save.autosave.ok()){const $tdSlot=jQuery(document.createElement(\"td\")),$tdLoad=jQuery(document.createElement(\"td\")),$tdDesc=jQuery(document.createElement(\"td\")),$tdDele=jQuery(document.createElement(\"td\"));jQuery(document.createElement(\"b\")).attr({title:L10n.get(\"savesLabelAuto\"),\"aria-label\":L10n.get(\"savesLabelAuto\")}).text(\"A\").appendTo($tdSlot),saves.autosave?($tdLoad.append(createButton(\"load\",\"ui-close\",L10n.get(\"savesLabelLoad\"),\"auto\",(()=>{jQuery(document).one(\":dialogclosed\",(()=>Save.autosave.load()))}))),jQuery(document.createElement(\"div\")).text(saves.autosave.title).appendTo($tdDesc),jQuery(document.createElement(\"div\")).addClass(\"datestamp\").html(saves.autosave.date?`${new Date(saves.autosave.date).toLocaleString()}`:`<em>${L10n.get(\"savesUnknownDate\")}</em>`).appendTo($tdDesc),$tdDele.append(createButton(\"delete\",null,L10n.get(\"savesLabelDelete\"),\"auto\",(()=>{Save.autosave.delete(),uiBuildSaves()})))):($tdLoad.append(createButton(\"load\",null,L10n.get(\"savesLabelLoad\"),\"auto\")),$tdDesc.addClass(\"empty\").text(\"•  •  •\"),$tdDele.append(createButton(\"delete\",null,L10n.get(\"savesLabelDelete\"),\"auto\"))),jQuery(document.createElement(\"tr\")).append($tdSlot).append($tdLoad).append($tdDesc).append($tdDele).appendTo($tbody)}for(let i=0,iend=saves.slots.length;i<iend;++i){const $tdSlot=jQuery(document.createElement(\"td\")),$tdLoad=jQuery(document.createElement(\"td\")),$tdDesc=jQuery(document.createElement(\"td\")),$tdDele=jQuery(document.createElement(\"td\"));$tdSlot.append(document.createTextNode(i+1)),saves.slots[i]?($tdLoad.append(createButton(\"load\",\"ui-close\",L10n.get(\"savesLabelLoad\"),i,(slot=>{jQuery(document).one(\":dialogclosed\",(()=>Save.slots.load(slot)))})),createButton(\"save\",\"ui-close\",L10n.get(\"savesLabelSave\"),i,Save.slots.save)),jQuery(document.createElement(\"div\")).text(saves.slots[i].title).appendTo($tdDesc),jQuery(document.createElement(\"div\")).addClass(\"datestamp\").html(saves.slots[i].date?`${new Date(saves.slots[i].date).toLocaleString()}`:`<em>${L10n.get(\"savesUnknownDate\")}</em>`).appendTo($tdDesc),$tdDele.append(createButton(\"delete\",null,L10n.get(\"savesLabelDelete\"),i,(slot=>{Save.slots.delete(slot),uiBuildSaves()})))):($tdLoad.append(createButton(\"save\",\"ui-close\",L10n.get(\"savesLabelSave\"),i,savesAllowed?Save.slots.save:null)),$tdDesc.addClass(\"empty\").text(\"•  •  •\"),$tdDele.append(createButton(\"delete\",null,L10n.get(\"savesLabelDelete\"),i))),jQuery(document.createElement(\"tr\")).append($tdSlot).append($tdLoad).append($tdDesc).append($tdDele).appendTo($tbody)}return jQuery(document.createElement(\"table\")).attr(\"id\",\"saves-list\").append($tbody)}()),jQuery(document.createElement(\"label\")).attr(\"id\",\"idbToggleSaves\").append(jQuery(document.createElement(\"input\")).attr({id:\"checkbox-idbactive\",name:\"checkbox-idbactive\",type:\"checkbox\",checked:idb.active&&!V.ironmanmode,disabled:idb.lock||V.ironmanmode}).addClass(\"macro-checkbox\").on(\"change.macros\",(()=>{idb.active=document.getElementById(\"checkbox-idbactive\").checked,document.getElementById(\"ui-dialog-body\").className=\"saveList\",idb.saveList()}))).appendTo($dialogBody).append(\" Enable indexedDB \"),savesOk||fileOk){const $btnBar=jQuery(document.createElement(\"ul\")).addClass(\"buttons\").appendTo($dialogBody);return fileOk&&($btnBar.append(createActionItem(\"export\",\"ui-close\",L10n.get(\"savesLabelExport\"),savesAllowed?()=>Save.export():null)),$btnBar.append(createActionItem(\"import\",null,L10n.get(\"savesLabelImport\"),(()=>$dialogBody.find(\"#saves-import-file\").trigger(\"click\")))),jQuery(document.createElement(\"input\")).css({display:\"block\",visibility:\"hidden\",position:\"fixed\",left:\"-9999px\",top:\"-9999px\",width:\"1px\",height:\"1px\"}).attr({type:\"file\",id:\"saves-import-file\",tabindex:-1,\"aria-hidden\":!0}).on(\"change\",(ev=>{jQuery(document).one(\":dialogclosed\",(()=>Save.import(ev))),Dialog.close()})).appendTo($dialogBody)),savesOk&&$btnBar.append(createActionItem(\"clear\",null,L10n.get(\"savesLabelClear\"),Save.autosave.has()||!Save.slots.isEmpty()?()=>{Save.clear(),uiBuildSaves()}:null)),!0}return uiOpenAlert(L10n.get(\"savesIncapable\")),!1}function uiBuildSettings(){const $dialogBody=jQuery(Dialog.setup(L10n.get(\"settingsTitle\"),\"settings\"));return Setting.forEach((control=>{if(control.type===Setting.Types.Header){const name=control.name,id=Util.slugify(name),$header=jQuery(document.createElement(\"div\")),$heading=jQuery(document.createElement(\"h2\"));return $header.attr(\"id\",`header-body-${id}`).append($heading).appendTo($dialogBody),$heading.attr(\"id\",`header-heading-${id}`).wiki(name),void(control.desc&&jQuery(document.createElement(\"p\")).attr(\"id\",`header-desc-${id}`).wiki(control.desc).appendTo($header))}const name=control.name,id=Util.slugify(name),$setting=jQuery(document.createElement(\"div\")),$label=jQuery(document.createElement(\"label\")),$controlBox=jQuery(document.createElement(\"div\"));let $control;switch(jQuery(document.createElement(\"div\")).append($label).append($controlBox).appendTo($setting),control.desc&&jQuery(document.createElement(\"p\")).attr(\"id\",`setting-desc-${id}`).wiki(control.desc).appendTo($setting),$label.attr({id:`setting-label-${id}`,for:`setting-control-${id}`}).wiki(control.label),null==settings[name]&&(settings[name]=control.default),control.type){case Setting.Types.Toggle:$control=jQuery(document.createElement(\"button\")),settings[name]?$control.addClass(\"enabled\").text(L10n.get(\"settingsOn\")):$control.text(L10n.get(\"settingsOff\")),$control.ariaClick((function(){settings[name]?(jQuery(this).removeClass(\"enabled\").text(L10n.get(\"settingsOff\")),settings[name]=!1):(jQuery(this).addClass(\"enabled\").text(L10n.get(\"settingsOn\")),settings[name]=!0),Setting.save(),control.hasOwnProperty(\"onChange\")&&control.onChange.call({name:name,value:settings[name],default:control.default})}));break;case Setting.Types.List:$control=jQuery(document.createElement(\"select\"));for(let i=0,iend=control.list.length;i<iend;++i)jQuery(document.createElement(\"option\")).val(i).text(control.list[i]).appendTo($control);$control.val(control.list.indexOf(settings[name])).attr(\"tabindex\",0).on(\"change\",(function(){settings[name]=control.list[Number(this.value)],Setting.save(),control.hasOwnProperty(\"onChange\")&&control.onChange.call({name:name,value:settings[name],default:control.default,list:control.list})}));break;case Setting.Types.Range:$control=jQuery(document.createElement(\"input\")),$control.attr({type:\"range\",min:control.min,max:control.max,step:control.step,value:settings[name],tabindex:0}).on(\"change input\",(function(){settings[name]=Number(this.value),Setting.save(),control.hasOwnProperty(\"onChange\")&&control.onChange.call({name:name,value:settings[name],default:control.default,min:control.min,max:control.max,step:control.step})})).on(\"keypress\",(ev=>{13===ev.which&&(ev.preventDefault(),$control.trigger(\"change\"))}))}$control.attr(\"id\",`setting-control-${id}`).appendTo($controlBox),$setting.attr(\"id\",`setting-body-${id}`).appendTo($dialogBody)})),$dialogBody.append(`<ul class=\"buttons\"><li><button id=\"settings-ok\" class=\"ui-close\">${L10n.get([\"settingsOk\",\"ok\"])}</button></li><li><button id=\"settings-reset\">${L10n.get(\"settingsReset\")}</button></li></ul>`).find(\"#settings-reset\").ariaClick({one:!0},(()=>{jQuery(document).one(\":dialogclosed\",(()=>{Setting.reset(),window.location.reload()})),Dialog.close()})),!0}function uiBuildShare(){try{jQuery(Dialog.setup(L10n.get(\"shareTitle\"),\"share list\")).append(uiAssembleLinkList(\"StoryShare\"))}catch(ex){return console.error(ex),Alert.error(\"StoryShare\",ex.message),!1}return!0}return Object.freeze(Object.defineProperties({},{assembleLinkList:{value:uiAssembleLinkList},alert:{value:uiOpenAlert},jumpto:{value:function(...args){uiBuildJumpto(),Dialog.open(...args)}},restart:{value:function(...args){uiBuildRestart(),Dialog.open(...args)}},saves:{value:function(...args){uiBuildSaves(),Dialog.open(...args)}},settings:{value:function(...args){uiBuildSettings(),Dialog.open(...args)}},share:{value:function(...args){uiBuildShare(),Dialog.open(...args)}},buildAutoload:{value:uiBuildAutoload},buildJumpto:{value:uiBuildJumpto},buildRestart:{value:uiBuildRestart},buildSaves:{value:uiBuildSaves},buildSettings:{value:uiBuildSettings},buildShare:{value:uiBuildShare},stow:{value:()=>UIBar.stow()},unstow:{value:()=>UIBar.unstow()},setStoryElements:{value:()=>UIBar.update()},isOpen:{value:(...args)=>Dialog.isOpen(...args)},body:{value:()=>Dialog.body()},setup:{value:(...args)=>Dialog.setup(...args)},addClickHandler:{value:(...args)=>Dialog.addClickHandler(...args)},open:{value:(...args)=>Dialog.open(...args)},close:{value:(...args)=>Dialog.close(...args)},resize:{value:()=>Dialog.resize()},buildDialogAutoload:{value:uiBuildAutoload},buildDialogJumpto:{value:uiBuildJumpto},buildDialogRestart:{value:uiBuildRestart},buildDialogSaves:{value:uiBuildSaves},buildDialogSettings:{value:uiBuildSettings},buildDialogShare:{value:uiBuildShare},buildLinkListFromPassage:{value:uiAssembleLinkList}}))})(),UIBar=(()=>{let _$uiBar=null;function uiBarStow(noAnimation){if(_$uiBar&&!_$uiBar.hasClass(\"stowed\")){let $story;noAnimation&&($story=jQuery(\"#story\"),$story.addClass(\"no-transition\"),_$uiBar.addClass(\"no-transition\")),_$uiBar.addClass(\"stowed\"),noAnimation&&setTimeout((()=>{$story.removeClass(\"no-transition\"),_$uiBar.removeClass(\"no-transition\")}),Engine.minDomActionDelay)}return this}function uiBarUpdate(){if(Story.has(\"StoryDisplayTitle\")&&setDisplayTitle(Story.get(\"StoryDisplayTitle\").processText()),!_$uiBar)return;setPageElement(\"story-banner\",\"StoryBanner\"),setPageElement(\"story-subtitle\",\"StorySubtitle\"),setPageElement(\"story-author\",\"StoryAuthor\"),setPageElement(\"story-caption\",\"StoryCaption\");const menuStory=document.getElementById(\"menu-story\");if(null!==menuStory&&(jQuery(menuStory).empty(),Story.has(\"StoryMenu\")))try{UI.assembleLinkList(\"StoryMenu\",menuStory)}catch(ex){console.error(ex),Alert.error(\"StoryMenu\",ex.message)}}return Object.freeze(Object.defineProperties({},{destroy:{value:function(){_$uiBar&&(_$uiBar.hide(),jQuery(document).off(\".ui-bar\"),jQuery(document.head).find(\"#style-ui-bar\").remove(),_$uiBar.remove(),_$uiBar=null)}},hide:{value:function(){return _$uiBar&&_$uiBar.hide(),this}},init:{value:function(){if(document.getElementById(\"ui-bar\"))return;const $elems=(()=>{const toggleLabel=L10n.get(\"uiBarToggle\"),backwardLabel=L10n.get(\"uiBarBackward\"),jumptoLabel=L10n.get(\"uiBarJumpto\"),forwardLabel=L10n.get(\"uiBarForward\");return jQuery(document.createDocumentFragment()).append(`<div id=\"ui-bar\" aria-live=\"polite\"><div id=\"ui-bar-tray\"><button id=\"ui-bar-toggle\" tabindex=\"0\" title=\"${toggleLabel}\" aria-label=\"${toggleLabel}\"></button><div id=\"ui-bar-history\"><button id=\"history-backward\" tabindex=\"0\" title=\"${backwardLabel}\" aria-label=\"${backwardLabel}\"></button><button id=\"history-jumpto\" tabindex=\"0\" title=\"${jumptoLabel}\" aria-label=\"${jumptoLabel}\"></button><button id=\"history-forward\" tabindex=\"0\" title=\"${forwardLabel}\" aria-label=\"${forwardLabel}\"></button></div></div><div id=\"ui-bar-body\"><header id=\"title\" role=\"banner\"><div id=\"story-banner\"></div><h1 id=\"story-title\"></h1><div id=\"story-subtitle\"></div><div id=\"story-title-separator\"></div><p id=\"story-author\"></p></header><div id=\"story-caption\"></div><nav id=\"menu\" role=\"navigation\"><ul id=\"menu-story\"></ul><ul id=\"menu-core\"><li id=\"menu-item-saves\"><a tabindex=\"0\">${L10n.get(\"savesTitle\")}</a></li><li id=\"menu-item-settings\"><a tabindex=\"0\">${L10n.get(\"settingsTitle\")}</a></li><li id=\"menu-item-restart\"><a tabindex=\"0\">${L10n.get(\"restartTitle\")}</a></li><li id=\"menu-item-share\"><a tabindex=\"0\">${L10n.get(\"shareTitle\")}</a></li></ul></nav></div></div>`)})();var $backward,$forward;_$uiBar=jQuery($elems.find(\"#ui-bar\").get(0)),$elems.insertBefore(\"body>script#script-sugarcube\"),jQuery(document).on(\":historyupdate.ui-bar\",($backward=jQuery(\"#history-backward\"),$forward=jQuery(\"#history-forward\"),()=>{$backward.ariaDisabled(State.length<2),$forward.ariaDisabled(State.length===State.size)}))}},isHidden:{value:function(){return _$uiBar&&\"none\"===_$uiBar.css(\"display\")}},isStowed:{value:function(){return _$uiBar&&_$uiBar.hasClass(\"stowed\")}},show:{value:function(){return _$uiBar&&_$uiBar.show(),this}},start:{value:function(){_$uiBar&&((\"boolean\"==typeof Config.ui.stowBarInitially?Config.ui.stowBarInitially:jQuery(window).width()<=Config.ui.stowBarInitially)&&uiBarStow(!0),jQuery(\"#ui-bar-toggle\").ariaClick({label:L10n.get(\"uiBarToggle\")},(()=>_$uiBar.toggleClass(\"stowed\"))),jQuery(\"#history-backward\").ariaDisabled(State.length<2).ariaClick({label:L10n.get(\"uiBarBackward\")},(()=>Engine.backward())),Story.lookup(\"tags\",\"bookmark\").length>0?jQuery(\"#history-jumpto\").ariaClick({label:L10n.get(\"uiBarJumpto\")},(()=>UI.jumpto())):jQuery(\"#history-jumpto\").remove(),jQuery(\"#history-forward\").ariaDisabled(State.length===State.size).ariaClick({label:L10n.get(\"uiBarForward\")},(()=>Engine.forward())),Config.history.controls||jQuery(\"#ui-bar-history\").hide(),Story.has(\"StoryDisplayTitle\")?setDisplayTitle(Story.get(\"StoryDisplayTitle\").processText()):jQuery(\"#story-title\").text(Story.title),Story.has(\"StoryCaption\")||jQuery(\"#story-caption\").remove(),Story.has(\"StoryMenu\")||jQuery(\"#menu-story\").remove(),Config.ui.updateStoryElements||uiBarUpdate(),jQuery(\"#menu-item-saves a\").ariaClick({role:\"button\"},(ev=>{ev.preventDefault(),idb.active?(Dialog.setup(\"saves\",\"saveList\"),idb.saveList()):UI.buildSaves(),Dialog.open()})).text(L10n.get(\"savesTitle\")),Setting.isEmpty()?jQuery(\"#menu-item-settings\").remove():jQuery(\"#menu-item-settings a\").ariaClick({role:\"button\"},(ev=>{ev.preventDefault(),UI.buildSettings(),Dialog.open()})).text(L10n.get(\"settingsTitle\")),jQuery(\"#menu-item-restart a\").ariaClick({role:\"button\"},(ev=>{ev.preventDefault(),UI.buildRestart(),Dialog.open()})).text(L10n.get(\"restartTitle\")),Story.has(\"StoryShare\")?jQuery(\"#menu-item-share a\").ariaClick({role:\"button\"},(ev=>{ev.preventDefault(),UI.buildShare(),Dialog.open()})).text(L10n.get(\"shareTitle\")):jQuery(\"#menu-item-share\").remove())}},stow:{value:uiBarStow},unstow:{value:function(noAnimation){if(_$uiBar&&_$uiBar.hasClass(\"stowed\")){let $story;noAnimation&&($story=jQuery(\"#story\"),$story.addClass(\"no-transition\"),_$uiBar.addClass(\"no-transition\")),_$uiBar.removeClass(\"stowed\"),noAnimation&&setTimeout((()=>{$story.removeClass(\"no-transition\"),_$uiBar.removeClass(\"no-transition\")}),Engine.minDomActionDelay)}return this}},update:{value:uiBarUpdate},setStoryElements:{value:uiBarUpdate}}))})(),DebugBar=(()=>{const _variableRe=new RegExp(`^${Patterns.variable}$`),_numericKeyRe=/^\\d+$/,_watchList=[];let _$debugBar=null,_$watchBody=null,_$watchList=null,_$turnSelect=null,_stowed=!0;function debugBarStow(){_$debugBar.css(\"right\",`-${_$debugBar.outerWidth()}px`),_stowed=!0,_updateSession()}function debugBarUnstow(){_$debugBar.css(\"right\",0),_stowed=!1,_updateSession()}function debugBarToggle(){_stowed?debugBarUnstow():debugBarStow()}function debugBarWatchAdd(varName){_variableRe.test(varName)&&(_watchList.pushUnique(varName),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession())}function debugBarWatchAddAll(){Object.keys(State.variables).map((name=>_watchList.pushUnique(`$${name}`))),Object.keys(State.temporary).map((name=>_watchList.pushUnique(`_${name}`))),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchClear(){for(let i=_watchList.length-1;i>=0;--i)_watchList.pop();_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDelete(varName){_watchList.delete(varName),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDisable(){_debugBarWatchDisableNoUpdate(),_updateSession()}function debugBarWatchEnable(){_debugBarWatchEnableNoUpdate(),_updateSession()}function debugBarWatchIsEnabled(){return!_$watchBody.attr(\"hidden\")}function debugBarWatchToggle(){_$watchBody.attr(\"hidden\")?debugBarWatchEnable():debugBarWatchDisable()}function _debugBarWatchDisableNoUpdate(){_$watchBody.attr({\"aria-hidden\":!0,hidden:\"hidden\"})}function _debugBarWatchEnableNoUpdate(){_$watchBody.removeAttr(\"aria-hidden hidden\")}function _clearSession(){session.delete(\"debugState\")}function _hasSession(){return session.has(\"debugState\")}function _updateSession(){session.set(\"debugState\",{stowed:_stowed,watchList:_watchList,watchEnabled:debugBarWatchIsEnabled(),viewsEnabled:DebugView.isEnabled()})}function _updateWatchBody(){if(0===_watchList.length)return void _$watchBody.empty().append(`<div>${L10n.get(\"debugBarNoWatches\")}</div>`);const delLabel=L10n.get(\"debugBarDeleteWatch\"),$table=jQuery(document.createElement(\"table\")),$tbody=jQuery(document.createElement(\"tbody\"));for(let i=0,len=_watchList.length;i<len;++i){const varName=_watchList[i],varKey=varName.slice(1),store=\"$\"===varName[0]?State.variables:State.temporary,$row=jQuery(document.createElement(\"tr\")),$delBtn=jQuery(document.createElement(\"button\")),$code=jQuery(document.createElement(\"code\"));$delBtn.addClass(\"watch-delete\").attr(\"data-name\",varName).ariaClick({one:!0,label:delLabel},(()=>debugBarWatchDelete(varName))),$code.text(_toWatchString(store[varKey])),jQuery(document.createElement(\"td\")).append($delBtn).appendTo($row),jQuery(document.createElement(\"td\")).text(varName).appendTo($row),jQuery(document.createElement(\"td\")).append($code).appendTo($row),$row.appendTo($tbody)}$table.append($tbody),_$watchBody.empty().append($table)}function _updateWatchList(){const svn=Object.keys(State.variables),tvn=Object.keys(State.temporary);if(0===svn.length&&0===tvn.length)return void _$watchList.empty();const names=[...svn.map((name=>`$${name}`)),...tvn.map((name=>`_${name}`))].sort(),options=document.createDocumentFragment();names.delete(_watchList);for(let i=0,len=names.length;i<len;++i)jQuery(document.createElement(\"option\")).val(names[i]).appendTo(options);_$watchList.empty().append(options)}function _updateTurnSelect(){const histLen=State.size,expLen=State.expired.length,options=document.createDocumentFragment();for(let i=0;i<histLen;++i)jQuery(document.createElement(\"option\")).val(i).text(`${expLen+i+1}. ${Util.escape(State.history[i].title)}`).appendTo(options);_$turnSelect.empty().ariaDisabled(histLen<2).append(options).val(State.activeIndex)}function _toWatchString(value){if(null===value)return\"null\";switch(typeof value){case\"number\":if(Number.isNaN(value))return\"NaN\";if(!Number.isFinite(value))return\"Infinity\";case\"boolean\":case\"symbol\":case\"undefined\":return String(value);case\"string\":return JSON.stringify(value);case\"function\":return\"Function\"}const objType=Util.toStringTag(value);if(\"Date\"===objType)return`Date {${value.toLocaleString()}}`;if(\"RegExp\"===objType)return`RegExp ${value.toString()}`;const result=[];if(value instanceof Array||value instanceof Set){const list=value instanceof Array?value:Array.from(value);for(let i=0,len=list.length;i<len;++i)result.push(list.hasOwnProperty(i)?_toWatchString(list[i]):\"<empty>\");return Object.keys(list).filter((key=>!_numericKeyRe.test(key))).forEach((key=>result.push(`${_toWatchString(key)}: ${_toWatchString(list[key])}`))),`${objType}(${list.length}) [${result.join(\", \")}]`}return value instanceof Map?(value.forEach(((val,key)=>result.push(`${_toWatchString(key)} → ${_toWatchString(val)}`))),`${objType}(${value.size}) {${result.join(\", \")}}`):(Object.keys(value).forEach((key=>result.push(`${_toWatchString(key)}: ${_toWatchString(value[key])}`))),`${objType} {${result.join(\", \")}}`)}return Object.freeze(Object.defineProperties({},{init:{value:function(){const barToggleLabel=L10n.get(\"debugBarToggle\"),watchAddLabel=L10n.get(\"debugBarAddWatch\"),watchAllLabel=L10n.get(\"debugBarWatchAll\"),watchNoneLabel=L10n.get(\"debugBarWatchNone\"),watchToggleLabel=L10n.get(\"debugBarWatchToggle\"),viewsToggleLabel=L10n.get(\"debugBarViewsToggle\");jQuery(document.createDocumentFragment()).append(`<div id=\"debug-bar\"><div id=\"debug-bar-watch\"><div>${L10n.get(\"debugBarNoWatches\")}</div>></div><div><button id=\"debug-bar-watch-toggle\" tabindex=\"0\" title=\"${watchToggleLabel}\" aria-label=\"${watchToggleLabel}\">${L10n.get(\"debugBarLabelWatch\")}</button><label id=\"debug-bar-watch-label\" for=\"debug-bar-watch-input\">${L10n.get(\"debugBarLabelAdd\")}</label><input id=\"debug-bar-watch-input\" name=\"debug-bar-watch-input\" type=\"text\" list=\"debug-bar-watch-list\" tabindex=\"0\"><datalist id=\"debug-bar-watch-list\" aria-hidden=\"true\" hidden=\"hidden\"></datalist><button id=\"debug-bar-watch-add\" tabindex=\"0\" title=\"${watchAddLabel}\" aria-label=\"${watchAddLabel}\"></button><button id=\"debug-bar-watch-all\" tabindex=\"0\" title=\"${watchAllLabel}\" aria-label=\"${watchAllLabel}\"></button><button id=\"debug-bar-watch-none\" tabindex=\"0\" title=\"${watchNoneLabel}\" aria-label=\"${watchNoneLabel}\"></button></div><div><button id=\"debug-bar-views-toggle\" tabindex=\"0\" title=\"${viewsToggleLabel}\" aria-label=\"${viewsToggleLabel}\">${L10n.get(\"debugBarLabelViews\")}</button><label id=\"debug-bar-turn-label\" for=\"debug-bar-turn-select\">${L10n.get(\"debugBarLabelTurn\")}</label><select id=\"debug-bar-turn-select\" tabindex=\"0\"></select></div><button id=\"debug-bar-toggle\" tabindex=\"0\" title=\"${barToggleLabel}\" aria-label=\"${barToggleLabel}\"></button></div><div id=\"debug-bar-hint\"></div>`).appendTo(\"body\"),_$debugBar=jQuery(\"#debug-bar\"),_$watchBody=jQuery(_$debugBar.find(\"#debug-bar-watch\").get(0)),_$watchList=jQuery(_$debugBar.find(\"#debug-bar-watch-list\").get(0)),_$turnSelect=jQuery(_$debugBar.find(\"#debug-bar-turn-select\").get(0));const $barToggle=jQuery(_$debugBar.find(\"#debug-bar-toggle\").get(0)),$watchToggle=jQuery(_$debugBar.find(\"#debug-bar-watch-toggle\").get(0)),$watchInput=jQuery(_$debugBar.find(\"#debug-bar-watch-input\").get(0)),$watchAdd=jQuery(_$debugBar.find(\"#debug-bar-watch-add\").get(0)),$watchAll=jQuery(_$debugBar.find(\"#debug-bar-watch-all\").get(0)),$watchNone=jQuery(_$debugBar.find(\"#debug-bar-watch-none\").get(0)),$viewsToggle=jQuery(_$debugBar.find(\"#debug-bar-views-toggle\").get(0));$barToggle.ariaClick(debugBarToggle),$watchToggle.ariaClick(debugBarWatchToggle),$watchInput.on(\":addwatch\",(function(){debugBarWatchAdd(this.value.trim()),this.value=\"\"})).on(\"keypress\",(ev=>{13===ev.which&&(ev.preventDefault(),$watchInput.trigger(\":addwatch\"))})),$watchAdd.ariaClick((()=>$watchInput.trigger(\":addwatch\"))),$watchAll.ariaClick(debugBarWatchAddAll),$watchNone.ariaClick(debugBarWatchClear),_$turnSelect.on(\"change\",(function(){Engine.goTo(Number(this.value))})),$viewsToggle.ariaClick((()=>{DebugView.toggle(),_updateSession()})),jQuery(document).on(\":historyupdate.debug-bar\",_updateTurnSelect).on(\":passageend.debug-bar\",(()=>{_updateWatchBody(),_updateWatchList()})).on(\":enginerestart.debug-bar\",_clearSession),_hasSession()||DebugView.enable()}},isStowed:{value:function(){return _stowed}},start:{value:function(){(function(){if(!_hasSession())return!1;const debugState=session.get(\"debugState\");_stowed=debugState.stowed,_watchList.push(...debugState.watchList),debugState.watchEnabled?_debugBarWatchEnableNoUpdate():_debugBarWatchDisableNoUpdate();debugState.viewsEnabled?DebugView.enable():DebugView.disable()})(),_stowed?debugBarStow():debugBarUnstow(),_updateTurnSelect(),_updateWatchBody(),_updateWatchList()}},stow:{value:debugBarStow},toggle:{value:debugBarToggle},unstow:{value:debugBarUnstow},watch:{value:Object.freeze(Object.defineProperties({},{add:{value:debugBarWatchAdd},all:{value:debugBarWatchAddAll},clear:{value:debugBarWatchClear},delete:{value:debugBarWatchDelete},disable:{value:debugBarWatchDisable},enable:{value:debugBarWatchEnable},isEnabled:{value:debugBarWatchIsEnabled},toggle:{value:debugBarWatchToggle}}))}}))})(),LoadScreen=(()=>{const _locks=new Set;let _autoId=0;function loadScreenHide(){jQuery(document.documentElement).removeAttr(\"data-init\")}function loadScreenShow(){jQuery(document.documentElement).attr(\"data-init\",\"loading\")}return Object.freeze(Object.defineProperties({},{init:{value:function(){jQuery(document).on(\"readystatechange.SugarCube\",(()=>{_locks.size>0||(\"complete\"===document.readyState?\"loading\"===jQuery(document.documentElement).attr(\"data-init\")&&(Config.loadDelay>0?setTimeout((()=>{0===_locks.size&&loadScreenHide()}),Math.max(Engine.minDomActionDelay,Config.loadDelay)):loadScreenHide()):loadScreenShow())}))}},clear:{value:function(){jQuery(document).off(\"readystatechange.SugarCube\"),_locks.clear(),loadScreenHide()}},hide:{value:loadScreenHide},show:{value:loadScreenShow},lock:{value:function(){return++_autoId,_locks.add(_autoId),loadScreenShow(),_autoId}},unlock:{value:function(id){if(null==id)throw new Error(\"LoadScreen.unlock called with a null or undefined ID\");_locks.has(id)&&_locks.delete(id),0===_locks.size&&jQuery(document).trigger(\"readystatechange\")}}}))})();const idb=(()=>{if(null==window.indexedDB)return Object.freeze({active:!1,lock:!0});let db,lock=!0,active=!0,dbName=\"idb\",migrationNeeded=!1,open=!1,settings={},saveDetails=[],openRequest=null;function openDB(name=dbName){return new Promise(((resolve,reject)=>{dbName=name,openRequest=indexedDB.open(idb.dbName),openRequest.onupgradeneeded=event=>{if(console.log(\"updating idb\",event.oldVersion),0===event.oldVersion)openRequest.result.createObjectStore(\"saves\",{keyPath:\"slot\"}),openRequest.result.createObjectStore(\"details\",{keyPath:\"slot\"}),migrationNeeded=!0},openRequest.onerror=()=>{console.log(\"error opening idb\",openRequest.error),reject(openRequest.error)},openRequest.onsuccess=()=>{db=openRequest.result,lock=!1,active=!0,open=!0,getSaveDetails().then((d=>saveDetails=d)),console.log(\"idbOpen success\"),navigator.storage&&\"function\"==typeof navigator.storage.persist&&navigator.storage.persist(),db.onclose=ev=>{open=!1,active=!1,console.log(\"idb connection closed, this shouldn't happen\",ev),Errors?Errors.report(\"ERROR: idb connection closed unexpectedly\",ev):alert(\"ERROR: idb connection closed unexpectedly\")},db.onerror=ev=>{console.error(`Database error: ${ev.target.errorCode}`),active=!1},migrationNeeded&&(importFromLocalStorage(),migrationNeeded=!1),resolve(db)},openRequest.onblocked=()=>{console.log(\"something went wrong\",openRequest.error),reject(openRequest.error)}}))}function updateSettings(setting,value){settings=JSON.parse(localStorage.getItem(\"idb-settings\"))||{warnSave:V.confirmSave||!1,warnLoad:V.confirmLoad||!1,warnDelete:V.confirmDelete||!0,active:!0,useDelta:!1},setting&&(settings[setting]=value),active=settings.active,localStorage.setItem(\"idb-settings\",JSON.stringify(settings))}updateSettings();const baddies=[];function funNuke(target,path=\"\",verbose=!0){if(!target)return console.log(\"no target specified\");for(const key in target){const value=target[key],newPath=path+\"['\"+key+\"']\";null!=value&&(\"function\"==typeof value||value.toJSON?(verbose&&V.idbTest&&console.log(\"Warn: \"+newPath+\" of type \"+typeof value+\" shouldn't be in STORY variables!!!\"),target[key]=JSON.stringify(value),baddies.push(newPath)):\"object\"==typeof value&&funNuke(value,newPath,verbose))}}function ekuNnuf(target=V,paths){function revive(target,path){if(\"string\"!=typeof path||\"\"===path)return console.log(\"Warn: invalid path\",clone(path));const accessors=path.slice(2,-2).split(\"']['\");let ref=target;for(let i=0,destination=accessors.length-1;i<=destination;i++)i===destination?ref[accessors[i]]=JSON.parse(ref[accessors[i]]):ref=ref[accessors[i]];return!0}let path=\"\";for(;path=paths.shift();)try{revive(target,path)}catch(ex){console.log(\"WARN: couldn't restore story var function\",path)}}async function importFromLocalStorage(){function processSave(saveObj){const save=saveObj.state;save.jdelta&&delete save.jdelta,save.delta&&(save.history=State.deltaDecode(save.delta)),delete save.delta,window.DoLSave&&DoLSave.decompressIfNeeded({state:save});const vars=save.history[save.index].variables;if(!vars.saveId){const saveId=Math.floor(9e4*Math.random())+1e4;save.history.forEach((s=>s.variables.saveId=saveId))}return[save,{date:saveObj.date,id:saveObj.id,title:saveObj.title,metadata:saveObj.metadata||{saveId:vars.saveId,saveName:vars.saveName}}]}let mtCount=0;const oldSaves=Save.get();if(null!=oldSaves.autosave){const saveData=processSave(save);await setItem(0,saveData[0],{slot:0,data:saveData[1]})}else mtCount++;for(let i=0;i<oldSaves.slots.length;i++){const slotSave=oldSaves.slots[i];if(null!=slotSave){const saveData=processSave(slotSave);await setItem(i+1,saveData[0],{slot:i+1,data:saveData[1]})}else mtCount++}if(mtCount===oldSaves.slots.length+1){const index=storage.get(\"index\");if(index&&index.slots){const autosave=storage.get(\"autosave\");if(autosave){const saveData=processSave(autosave);await setItem(0,saveData[0],{slot:0,data:saveData[1]})}for(let i=0;i<index.slots.length;i++){const slotSave=storage.get(\"slot\"+i);if(!slotSave)continue;const saveData=processSave(slotSave);await setItem(i+1,saveData[0],{slot:i+1,data:saveData[1]})}}}return await getSaveDetails().then((d=>saveDetails=d)),console.log(\"idb migration successful\"),!0}function makePromise(transaction){return new Promise(((resolve,reject)=>{transaction.onsuccess=()=>(lock=!1,resolve(transaction.result)),transaction.oncomplete=()=>(lock=!1,resolve(transaction.result)),transaction.onerror=ev=>(lock=!1,active=!1,console.log(transaction.error,ev,\"error\"),reject(transaction.error)),transaction.onabort=()=>(lock=!1,console.log(\"aborted\",transaction.error),reject(transaction.error))}))}async function getItem(slot){open||await openDB();return makePromise(db.transaction(\"saves\",\"readonly\").objectStore(\"saves\").get(slot))}async function setItem(slot,saveObj,details){if(lock)return;if(null==saveObj||!saveObj.hasOwnProperty(\"history\"))return!1;lock=!0;const savesItem={slot:slot,data:saveObj},saveVars=saveObj.history[saveObj.index].variables,metadata={saveId:saveVars.saveId,saveName:saveVars.saveName},detailsItem=details||{slot:slot,data:{id:Story.domId,title:Story.get(State.passage).description(),date:Date.now(),metadata:metadata}};detailsItem.slot=slot;try{open||await openDB();let counter=0;saveObj.history.forEach((s=>{baddies.splice(0),funNuke(s.variables,\"\",!counter++),baddies.length&&(s.baddies=clone(baddies))})),settings.useDelta&&(saveObj.delta=State.deltaEncode(saveObj.history),delete saveObj.history);const transactionRequest=db.transaction([\"saves\",\"details\"],\"readwrite\");return transactionRequest.objectStore(\"saves\").delete(slot),transactionRequest.objectStore(\"saves\").add(savesItem),transactionRequest.objectStore(\"details\").delete(slot),transactionRequest.objectStore(\"details\").add(detailsItem),makePromise(transactionRequest)}catch(ex){return window.Errors?Errors.report(\"idb.setItem failure unknown. Couldn't complete the save in slot \"+slot):alert(\"idb.setItem failure unknown. Couldn't complete the save in slot \"+slot),lock=!1,new Promise((resolve=>resolve(!1)))}}async function deleteItem(slot){if(lock)return;open||await openDB(),lock=!0;const transactionRequest=db.transaction([\"saves\",\"details\"],\"readwrite\");return transactionRequest.objectStore(\"saves\").delete(slot),transactionRequest.objectStore(\"details\").delete(slot),makePromise(transactionRequest).then(await getSaveDetails().then((d=>saveDetails=d)))}function loadState(slot){if(!lock)return getItem(slot).then((value=>{if(null==value)return!1;value.data.delta&&(value.data.history=State.deltaDecode(value.data.delta),delete value.data.delta),value.data.history.forEach((s=>{s.baddies&&(ekuNnuf(s.variables,s.baddies),delete s.baddies)})),Save.onLoad.handlers.forEach((fn=>fn({state:value.data}))),State.unmarshalForSave(value.data),State.show()}))}async function saveState(slot){if(lock)return;const saveObj=State.marshalForSave();if(!V.saveId){const saveId=Math.floor(9e4*Math.random())+1e4;V.saveId=saveId,State.history.forEach((s=>s.variables.saveId=saveId)),saveObj.history.forEach((s=>s.variables.saveId=saveId))}return Save.onSave.handlers.forEach((fn=>fn({state:saveObj,date:Date.now()},{type:slot<=0?\"autosave\":\"slot\"}))),null!=saveObj&&(await setItem(slot,saveObj),await getSaveDetails().then((d=>saveDetails=d)),!0)}async function getSaveDetails(){open||await openDB();return makePromise(db.transaction([\"details\"],\"readonly\").objectStore(\"details\").getAll())}async function clearAll(){if(lock)return;open||await openDB();const transactionRequest=db.transaction([\"saves\",\"details\"],\"readwrite\");return transactionRequest.objectStore(\"saves\").clear(),transactionRequest.objectStore(\"details\").clear(),saveDetails=[],makePromise(transactionRequest)}function savesAllowed(){return\"function\"!=typeof Config.saves.isAllowed||Config.saves.isAllowed()}let listLength,listPage;const listLengthMax=20,listPageMax=20;let extraSaveWarn,latestSave={slot:1,date:0},footerHTML=\"\";function generateSavesPage(page=listPage-1,length=listLength){const listContainer=document.createDocumentFragment(),saveUnlock=savesAllowed();let autoSaveDate;if(latestSave={slot:1,date:0},saveDetails.forEach((d=>{0===d.slot?autoSaveDate=d.data.date:d.data.date>latestSave.date&&(latestSave.slot=d.slot,latestSave.date=d.data.date)})),!listLength){const slot=saveDetails.length?saveDetails.last().slot:0;for(listLength=10;slot>listLength*listPageMax&&listLength<listLengthMax;listLength++);length=listLength}if(!Number.isInteger(page)){const latestSlot=saveDetails.find((d=>d.slot===latestSave.slot));if(latestSlot){const autoSaveExists=0===saveDetails[0].slot,ignoreAutoSave=latestSlot.data.date>autoSaveDate||latestSlot.data.metadata.saveId===saveDetails[0].data.metadata.saveId;page=!autoSaveExists||ignoreAutoSave?Math.floor((latestSave.slot-1)/length):0}else page=0;listPage=page+1}const pageField=document.getElementById(\"pageNum\");null!=pageField&&(pageField.value=listPage);const lengthField=document.getElementById(\"pageLen\");null!=lengthField&&(lengthField.value=listLength);const defaultDetailsObj={date:\"\",title:\"\",metadata:{saveId:\"\",saveName:\"\"}},autoDetailsObj=saveDetails[0]&&0===saveDetails[0].slot?saveDetails[0].data:clone(defaultDetailsObj);autoSaveDate>latestSave.date&&(autoDetailsObj.latestSlot=!0),autoDetailsObj.slot=0,Save.autosave.ok()&&listContainer.appendChild(generateSaveRow(autoDetailsObj));for(let slot=length*page+1;slot<length*(page+1)+1;slot++){let detailsObj=clone(defaultDetailsObj);const detailsIndex=saveDetails.findIndex((d=>d.slot===slot));-1!==detailsIndex&&(detailsObj=saveDetails[detailsIndex].data,Number(latestSave.slot)===slot&&(detailsObj.latestSlot=!0)),detailsObj.slot=slot,detailsObj.saveUnlock=saveUnlock,listContainer.appendChild(generateSaveRow(detailsObj))}return listContainer.appendChild(function(){const frag=document.createDocumentFragment(),savesListFooter=document.createElement(\"div\");if(savesListFooter.id=\"savesListFooter\",savesListFooter.className=\"savesListRow\",frag.appendChild(savesListFooter),footerHTML)return savesListFooter.innerHTML=footerHTML,frag;const footerImportExport=document.createElement(\"div\");savesListFooter.appendChild(footerImportExport);const exportButton=document.createElement(\"button\");Object.assign(exportButton,{id:\"exportButton\",className:\"saveButton\",innerText:L10n.get(\"savesLabelExport\"),onclick:()=>{savesAllowed()&&Save.export()}}),footerImportExport.appendChild(exportButton);const importButton=document.createElement(\"label\");Object.assign(importButton,{id:\"importButton\",htmlFor:\"saves-import\",innerText:L10n.get(\"savesLabelImport\"),className:\"saveButton saveMenuButton\"}),footerImportExport.appendChild(importButton);const importButtonInput=document.createElement(\"input\");Object.assign(importButtonInput,{type:\"file\",id:\"saves-import\",style:\"display: none\",onchange:ev=>Save.import(ev)}),importButton.appendChild(importButtonInput);const clearAllButton=document.createElement(\"button\");return Object.assign(clearAllButton,{id:\"clearButton\",className:\"saveButton saveMenuButton right\",innerText:L10n.get(\"savesLabelClear\"),onclick:()=>saveList(\"confirm clear\")}),savesListFooter.appendChild(clearAllButton),frag}()),listContainer}function generateSaveRow(details){const row=document.createElement(\"div\");details.latestSlot&&0!==details.slot&&(row.id=\"latestSaveRow\"),row.className=\"savesListRow\";const group=document.createElement(\"div\");group.className=\"saveGroup\";const saveId=document.createElement(\"div\");saveId.className=\"saveId\",saveId.innerText=0===details.slot?\"A\":details.slot,(details.slot>listPageMax*listLengthMax||details.slot<0)&&saveId.classList.add(\"red\");const saveload=document.createElement(\"div\");saveload.className=\"saveButton\";const saveButton=document.createElement(\"input\");saveButton.type=\"button\",saveButton.value=L10n.get(\"savesLabelSave\"),details.saveUnlock?(saveButton.className=\"saveMenuButton\",saveButton.onclick=()=>saveList(\"confirm save\",details)):saveButton.disabled=!0;const loadButton=document.createElement(\"input\");loadButton.type=\"button\",loadButton.value=L10n.get(\"savesLabelLoad\"),details.date?(loadButton.className=\"saveMenuButton\",loadButton.onclick=()=>saveList(\"confirm load\",details)):loadButton.disabled=!0,0!==details.slot&&saveload.appendChild(saveButton),saveload.appendChild(loadButton);const saveName=document.createElement(\"div\");saveName.className=\"saveName\",V.saveId===details.metadata.saveId&&saveName.classList.add(\"gold\"),saveName.innerText=details.metadata.saveName?details.metadata.saveName.slice(0,10):details.metadata.saveId;const saveDetails=document.createElement(\"div\");saveDetails.className=\"saveDetails\";const description=document.createElement(\"span\");description.innerText=details.title||\" \";const date=document.createElement(\"span\");date.className=\"datestamp\",details.date?(details.latestSlot?date.classList.add(\"green\"):details.date>Date.now()-18e5&&date.classList.add(\"gold\"),date.innerText=new Date(details.date).toLocaleString()):date.innerText=\" \",saveDetails.appendChild(description),saveDetails.appendChild(date);const deleteButton=document.createElement(\"input\");return Object.assign(deleteButton,{className:\"deleteButton right\",type:\"button\",value:L10n.get(\"savesLabelDelete\")}),details.date?(deleteButton.classList.add(\"saveMenuButton\"),deleteButton.onclick=()=>saveList(\"confirm delete\",details)):deleteButton.disabled=!0,group.append(saveId,saveload,saveName,saveDetails),row.appendChild(group),row.appendChild(deleteButton),row}async function saveList(mode=\"show saves\",details){open||await openDB(),active&&!settings.active&&updateSettings(\"active\",!0),await setTimeout(0);const savesDiv=document.getElementById(\"saveList\")||document.getElementsByClassName(\"saveList\")[0]||document.getElementsByClassName(\"saves\")[0],list=document.createDocumentFragment(),cancelButton=document.createElement(\"input\");function generateOldSaveDescription(details){const oldSaveDescription=document.createDocumentFragment();if(!details||!details.date)return oldSaveDescription;const oldSaveTitle=document.createElement(\"p\");oldSaveTitle.innerText=L10n.get(\"savesDescTitle\")+details.title;const oldSaveData=document.createElement(\"p\");return oldSaveData.innerText=(details.metadata.saveName?L10n.get(\"savesDescName\")+details.metadata.saveName:L10n.get(\"savesDescId\")+details.metadata.saveId)+L10n.get(\"savesDescDate\")+new Date(details.date).toLocaleString(),oldSaveDescription.append(oldSaveTitle,oldSaveData),oldSaveDescription}switch(Object.assign(cancelButton,{type:\"button\",className:\"saveMenuButton saveMenuConfirm\",value:L10n.get(\"cancel\"),onclick:()=>saveList(\"show saves\")}),mode){case\"show saves\":{if(!savesAllowed()){const notAllowedWarning=document.createElement(\"h3\");notAllowedWarning.className=\"red\",notAllowedWarning.innerText=V.replayScene?L10n.get(\"savesDisallowedReplay\"):L10n.get(\"savesDisallowed\"),list.appendChild(notAllowedWarning)}const exportReminder=document.createElement(\"p\");if(exportReminder.innerText=L10n.get(\"savesExportReminder\"),list.appendChild(exportReminder),extraSaveWarn){const lostSaves=document.createElement(\"p\");lostSaves.innerHTML='<i class=\"description\"><u>Where are my saves?</u></i> ';const lostSavesTooltip=document.createElement(\"mouse\");lostSavesTooltip.classList.add(\"tooltip\",\"linkBlue\"),lostSavesTooltip.innerText=\"(?)\",lostSavesTooltip.appendChild(document.createElement(\"span\")),lostSavesTooltip.lastChild.innerText=\"If you can't find your saves, it's possible you saved them using a different storage method. Try toggling the \\\"Use old legacy storage\\\" option below the saves list.\",lostSaves.appendChild(lostSavesTooltip),list.appendChild(lostSaves)}const savesList=document.createElement(\"div\");savesList.id=\"savesListContainer\",savesList.appendChild(function(){const frag=document.createDocumentFragment(),saveListHeader=document.createElement(\"div\");saveListHeader.className=\"savesListRow\",frag.appendChild(saveListHeader);const headerSaveGroup=document.createElement(\"div\");headerSaveGroup.className=\"saveGroup\",saveListHeader.appendChild(headerSaveGroup);const headerSaveId=document.createElement(\"div\");headerSaveId.className=\"saveId\",headerSaveId.innerText=\"#\",headerSaveGroup.appendChild(headerSaveId);const headerSaveButton=document.createElement(\"div\");headerSaveButton.className=\"saveButton\",headerSaveButton.innerText=L10n.get(\"savesHeaderSaveLoad\"),headerSaveGroup.appendChild(headerSaveButton);const headerSaveName=document.createElement(\"div\");headerSaveName.className=\"saveName\",headerSaveName.innerText=L10n.get(\"savesHeaderIDName\"),headerSaveGroup.appendChild(headerSaveName);const headerSaveDetails=document.createElement(\"div\");headerSaveDetails.className=\"saveDetails\",headerSaveDetails.innerText=L10n.get(\"savesHeaderDetails\"),headerSaveGroup.appendChild(headerSaveDetails);const headerDeleteButton=document.createElement(\"div\");return headerDeleteButton.className=\"deleteButton\",headerSaveGroup.appendChild(headerDeleteButton),frag}()),savesList.appendChild(generateSavesPage()),list.appendChild(savesList),list.appendChild(function(){const prevPage=document.createElement(\"input\");Object.assign(prevPage,{type:\"button\",value:\" < \",disabled:1===listPage,onclick:()=>{listPage>1&&listPage--,saveList()}});const pageNum=document.createElement(\"input\");Object.assign(pageNum,{id:\"pageNum\",type:\"number\",value:listPage,style:\"width: 3em\",min:1,max:listPageMax,onchange:()=>{listPage=Math.clamp(Math.round(pageNum.value),1,listPageMax),saveList()}});const nextPage=document.createElement(\"input\");Object.assign(nextPage,{type:\"button\",value:\" > \",disabled:listPage>=listPageMax,onclick:()=>{listPage<listPageMax&&listPage++,saveList()}});const pageLen=document.createElement(\"input\");Object.assign(pageLen,{id:\"pageLen\",type:\"number\",value:listLength,style:\"width: 3em\",min:1,max:listLengthMax,onchange:()=>{listLength=Math.clamp(pageLen.value,1,listLengthMax),saveList()}});const jumpToLatest=document.createElement(\"input\");Object.assign(jumpToLatest,{type:\"button\",value:L10n.get(\"savesPagerJump\"),onclick:()=>{listPage=Math.floor((latestSave.slot-1)/listLength+1),saveList(),setTimeout((()=>{const el=document.getElementById(\"latestSaveRow\");null!=el&&(el.classList.remove(\"jumpToSaveTransition\"),el.classList.add(\"jumpToSaveTransition\"))}),Engine.minDomActionDelay)}});const pager=document.createElement(\"div\");return pager.append(L10n.get(\"savesPagerPage\"),prevPage,pageNum,nextPage,L10n.get(\"savesPagerSavesPerPage\"),pageLen,jumpToLatest),pager}());const reqSaveLabel=document.createElement(\"label\");reqSaveLabel.innerText=L10n.get(\"savesLabelSave\")+\" \";const reqSave=document.createElement(\"input\");Object.assign(reqSave,{type:\"checkbox\",checked:settings.save,onchange:()=>updateSettings(\"save\",reqSave.checked)}),reqSaveLabel.appendChild(reqSave);const reqLoadLabel=document.createElement(\"label\");reqLoadLabel.innerText=L10n.get(\"savesLabelLoad\")+\" \";const reqLoad=document.createElement(\"input\");Object.assign(reqLoad,{type:\"checkbox\",checked:settings.load,onchange:()=>updateSettings(\"load\",reqLoad.checked)}),reqLoadLabel.appendChild(reqLoad);const reqDeleteLabel=document.createElement(\"label\");reqDeleteLabel.innerText=L10n.get(\"savesLabelDelete\")+\" \";const reqDelete=document.createElement(\"input\");Object.assign(reqDelete,{type:\"checkbox\",checked:settings.delete,onchange:()=>updateSettings(\"delete\",reqDelete.checked)}),reqDeleteLabel.appendChild(reqDelete);const idbToggleLabel=document.createElement(\"label\");idbToggleLabel.innerText=L10n.get(\"savesOptionsUseLegacy\");const idbToggle=document.createElement(\"input\");Object.assign(idbToggle,{type:\"checkbox\",checked:!idb.active,onchange:()=>{updateSettings(\"active\",!idbToggle.checked),idb.active||(window.DoLSave?Wikifier.wikifyEval(\"<<replace #saveList>><<saveList>><</replace>>\"):UI.buildSaves())}}),idbToggleLabel.appendChild(idbToggle),list.append(L10n.get(\"savesOptionsConfirmOn\"),\"[ \",reqSaveLabel,\" ] [ \",reqLoadLabel,\" ] [ \",reqDeleteLabel,\" ]\",document.createElement(\"br\"),idbToggleLabel),setTimeout((()=>{savesDiv.replaceChildren(list);const pageField=document.getElementById(\"pageNum\");null!=pageField&&(pageField.value=listPage);const lengthField=document.getElementById(\"pageLen\");null!=lengthField&&(lengthField.value=listLength),Dialog.resize()}),Engine.minDomActionDelay);break}case\"confirm save\":{if(!details.date||!settings.save&&details.metadata.saveId===V.saveId)return saveState(details.slot).then(window.closeOverlay());const confirmSaveWarning=document.createElement(\"div\");confirmSaveWarning.className=\"saveBorder\";const confirmSaveWarningTitle=document.createElement(\"h3\");if(confirmSaveWarningTitle.className=\"red\",confirmSaveWarningTitle.innerText=(\"\"===details.date?L10n.get(\"savesWarningSaveOnSlot\"):L10n.get(\"savesWarningOverwriteSlot\"))+details.slot+\"?\",details.date&&V.saveId!==details.metadata.saveId){const overwriteWarning=document.createElement(\"span\");overwriteWarning.className=\"red\",overwriteWarning.innerText=L10n.get(\"savesWarningOverwriteID\")}const saveButton=document.createElement(\"input\");Object.assign(saveButton,{type:\"button\",className:\"saveMenuButton saveMenuConfirm\",value:L10n.get(\"savesLabelSave\"),onclick:()=>saveState(details.slot).then((()=>window.closeOverlay()))}),confirmSaveWarning.append(confirmSaveWarningTitle,generateOldSaveDescription(details),saveButton,cancelButton),list.appendChild(confirmSaveWarning),setTimeout((()=>savesDiv.replaceChildren(list)),Engine.minDomActionDelay);break}case\"confirm delete\":{if(!settings.delete)return deleteItem(details.slot).then((()=>saveList()));const confirmDeleteWarning=document.createElement(\"div\");confirmDeleteWarning.className=\"saveBorder\";const confirmDeleteWarningTitle=document.createElement(\"h3\");confirmDeleteWarningTitle.className=\"red\",confirmDeleteWarningTitle.innerText=L10n.get(\"savesWarningDeleteInSlot\")+(0===details.slot?\"auto\":details.slot)+\"?\";const deleteButton=document.createElement(\"input\");Object.assign(deleteButton,{type:\"button\",className:\"saveMenuButton saveMenuConfirm\",value:L10n.get(\"savesLabelDelete\"),onclick:()=>deleteItem(details.slot).then((()=>saveList()))}),confirmDeleteWarning.append(confirmDeleteWarningTitle,generateOldSaveDescription(details),deleteButton,cancelButton),list.appendChild(confirmDeleteWarning),setTimeout((()=>savesDiv.replaceChildren(list)),Engine.minDomActionDelay);break}case\"confirm load\":{if(!settings.load)return loadState(details.slot).then((()=>window.closeOverlay()));const confirmLoad=document.createElement(\"div\");confirmLoad.className=\"saveBorder\";const confirmLoadTitle=document.createElement(\"h3\");confirmLoadTitle.className=\"red\",confirmLoadTitle.innerText=L10n.get(\"savesWarningLoad\")+(0===details.slot?\"auto\":details.slot)+\"?\";const loadButton=document.createElement(\"input\");Object.assign(loadButton,{type:\"button\",className:\"saveMenuButton saveMenuConfirm\",value:L10n.get(\"savesLabelLoad\"),onclick:()=>idb.loadState(details.slot).then((()=>window.closeOverlay()))}),confirmLoad.append(confirmLoadTitle,generateOldSaveDescription(details),loadButton,cancelButton),list.appendChild(confirmLoad),setTimeout((()=>savesDiv.replaceChildren(list)),Engine.minDomActionDelay);break}case\"confirm clear\":{const confirmClear=document.createElement(\"div\");confirmClear.className=\"saveBorder\";const confirmClearTitle=document.createElement(\"h2\");confirmClearTitle.className=\"red\",confirmClearTitle.innerText=L10n.get(\"savesWarningDeleteAll\");const clearButton=document.createElement(\"input\");Object.assign(clearButton,{type:\"button\",className:\"saveMenuButton saveMenuConfirm\",value:L10n.get(\"savesLabelClear\"),onclick:()=>clearAll().then((()=>saveList()))}),confirmClear.append(confirmClearTitle,clearButton,cancelButton),list.appendChild(confirmClear),setTimeout((()=>savesDiv.replaceChildren(list)),Engine.minDomActionDelay);break}}}return void 0===window.closeOverlay&&(window.closeOverlay=Dialog.close),Object.freeze({get dbName(){return dbName},set dbName(val){dbName=val},get lock(){return lock},set lock(val){lock=Boolean(val)},get active(){return active},set active(val){active=val},get listLength(){return listLength},set listLength(val){listLength=val},get listPage(){return listPage},set listPage(val){listPage=val},getItem:getItem,setItem:setItem,deleteItem:deleteItem,clearAll:clearAll,getSaveDetails:getSaveDetails,getAllSaves:async function(){return open||await openDB(),makePromise(db.transaction([\"saves\"],\"readonly\").objectStore(\"saves\").getAll())},saveState:saveState,loadState:loadState,importFromLocalStorage:importFromLocalStorage,saveList:saveList,get footerHTML(){return footerHTML},set footerHTML(val){return footerHTML=val},init:dbName=>openDB(dbName),close:function(){db.close(),open=!1},updateSettings:updateSettings,baddies:baddies,funNuke:funNuke,ekuNnuf:ekuNnuf})})();window.idb=idb;const Links=(()=>{let keyNumberMatcher,maxKeyDescLength,currentLinks=[],numberPrepend=\"(\",numberAppend=\") \",enabled=!0,disableNumbers=!1,disableRNGReload=!1,throttle=!1,shiftDown=!1,skipElements=\".no-numberify, .no-numberify *\",includeElements=\"\";function keyNumberMatcherUpdate(){keyNumberMatcher=new RegExp(RegExp.escape(numberPrepend)+\"((Ctrl|Alt|Shift) \\\\+ )?\\\\d\"+RegExp.escape(numberAppend)),maxKeyDescLength=numberAppend.length+numberPrepend.length+9}function getPrettyKeyNumber(counter){let str=\"\";switch(Math.floor((counter-1)/10)){case 3:str=\"Alt + \";break;case 2:str=\"Ctrl + \";break;case 1:str=\"Shift + \"}return str+=(counter%10).toString(),str}function generateLinkNumbers(content,visibility){if(!enabled||disableNumbers||V.options&&!V.options.numberify_enabled)return;const stamp=performance.now();if(throttle+100>stamp)return throttle=stamp,void generateDebounce();if(throttle=stamp,currentLinks=visibility?$(content).find(\".link-internal\").not(\":hidden\"):$(content).find(\".link-internal\").filter(((i,link)=>\"none\"!==getComputedStyle(link).display)),skipElements&&includeElements){const goodies=$(content).find(includeElements),baddies=$(content).find(skipElements).not(goodies);currentLinks=currentLinks.not(baddies)}else if(skipElements){const baddies=$(content).find(skipElements);currentLinks=currentLinks.not(baddies)}for(let i=0;i<Math.min(currentLinks.length,40);i++){const el=currentLinks[i],keyNumber=numberPrepend+getPrettyKeyNumber(i+1)+numberAppend;keyNumberMatcher.test(el.innerHTML.slice(0,maxKeyDescLength))?el.innerHTML=el.innerHTML.replace(keyNumberMatcher,keyNumber):el.prepend(keyNumber)}\"debug\"===enabled&&console.log(`Links: generated ${currentLinks.length} links, took ${performance.now()-stamp}ms\"`)}function generate(){return generateLinkNumbers(document.getElementsByClassName(\"passage\")[0]||document,!0)}keyNumberMatcherUpdate();const generateDebounce=$.debounce(200,generate);function linkFollow(index){disableNumbers||$(currentLinks).length>=index&&$(currentLinks[index-1].click())}function inputFocused(){return!(![\"INPUT\",\"TEXTAREA\"].includes(document.activeElement.tagName)||[\"radio\",\"button\",\"checkbox\",\"submit\",\"reset\",\"image\"].includes(document.activeElement.type))}return Object.freeze(Object.defineProperties({},{init:{value:function(){$(document).on(\":passagerender\",(ev=>{currentLinks=[],throttle=0,generateLinkNumbers(ev.content)})),$(document).on(\"keydown\",(ev=>{if(ev.code.startsWith(\"Shift\"))return shiftDown=!0;inputFocused()||ev.code.startsWith(\"Numpad\")&&ev.preventDefault()})),$(document).on(\"keyup\",(ev=>{if(ev.code.startsWith(\"Shift\"))return shiftDown=!1;if(!enabled||V.tempDisable||V.options&&!V.options.numberify_enabled||inputFocused())return;if(\"INPUT\"===document.activeElement.tagName&&\"radio\"!==document.activeElement.type&&\"checkbox\"!==document.activeElement.type)return;let offset=0;switch(ev.shiftKey||ev.code.startsWith(\"Numpad\")&&shiftDown?offset=10:ev.ctrlKey?offset=20:ev.altKey&&(offset=30),ev.code){case\"Digit1\":case\"Numpad1\":case\"KeyN\":linkFollow(offset+1);break;case\"Digit2\":case\"Numpad2\":linkFollow(offset+2);break;case\"Digit3\":case\"Numpad3\":linkFollow(offset+3);break;case\"Digit4\":case\"Numpad4\":linkFollow(offset+4);break;case\"Digit5\":case\"Numpad5\":linkFollow(offset+5);break;case\"Digit6\":case\"Numpad6\":linkFollow(offset+6);break;case\"Digit7\":case\"Numpad7\":linkFollow(offset+7);break;case\"Digit8\":case\"Numpad8\":linkFollow(offset+8);break;case\"Digit9\":case\"Numpad9\":linkFollow(offset+9);break;case\"Digit0\":case\"Numpad0\":linkFollow(offset+10);break;case\"NumpadDivide\":ev.shiftKey?Engine.go(-2):Engine.backward();break;case\"NumpadMultiply\":if(disableRNGReload)break;if(State.restore(!0),State.prng.isEnabled()){State.random();const frame=State.history[State.activeIndex];frame.pull=State.prng.pull,frame.prng=clone(State.prng.state)}Engine.show();break;case\"NumpadSubtract\":ev.shiftKey?Engine.go(2):Engine.forward()}}))}},generate:{value:generate},generateLinkNumbers:{value:generateLinkNumbers},pushTheButton:{value:linkFollow},numberPrepend:{get:()=>numberPrepend,set(val){numberPrepend=val,keyNumberMatcherUpdate()}},numberAppend:{get:()=>numberAppend,set(val){numberAppend=val,keyNumberMatcherUpdate()}},skipElements:{get:()=>skipElements,set(val){skipElements=val}},includeElements:{get:()=>includeElements,set(val){includeElements=val}},enabled:{get:()=>enabled,set(val){enabled=val}},disableRNGReload:{get:()=>disableRNGReload,set(val){disableRNGReload=val}},disableNumbers:{get:()=>disableNumbers,set(val){disableNumbers=val}},throttle:{get:()=>throttle,set(val){throttle=val}},currentLinks:{get:()=>currentLinks}}))})();window.Links=Links;var version=Object.freeze({title:\"SugarCube\",major:2,minor:36,patch:1,prerelease:null,build:577,date:new Date(\"2024-03-08T15:36:00.604Z\"),extensions:{},toString(){const prerelease=this.prerelease?`-${this.prerelease}`:\"\";return`${this.major}.${this.minor}.${this.patch}${prerelease}+${this.build}`},short(){const prerelease=this.prerelease?`-${this.prerelease}`:\"\";return`${this.title} (v${this.major}.${this.minor}.${this.patch}${prerelease})`},long(){return`${this.title} v${this.toString()} (${this.date.toUTCString()})`}}),TempState={},macros={},postdisplay={},postrender={},predisplay={},prehistory={},prerender={},session=null,settings={},setup={},storage=null,browser=Browser,config=Config,has=Has,History=State,state=State,tale=Story,TempVariables=State.temporary;window.SugarCube={},jQuery((()=>{try{const lockId=LoadScreen.lock();LoadScreen.init(),document.normalize&&document.normalize(),Story.load(),storage=SimpleStore.create(Story.domId,!0),session=SimpleStore.create(Story.domId,!1),Dialog.init(),UIBar.init(),Engine.init(),Story.init(),L10n.init(),session.has(\"rcWarn\")||\"cookie\"!==storage.name||(session.set(\"rcWarn\",1),window.alert(L10n.get(\"warningNoWebStorage\"))),Save.init(),Setting.init(),idb.init(Story.domId),Links.init(),Macro.init(),Engine.start(),Config.debug&&DebugBar.init();const $window=$(window),vprCheckId=setInterval((()=>{$window.width()&&(clearInterval(vprCheckId),UIBar.start(),Config.debug&&DebugBar.start(),jQuery.event.trigger({type:\":storyready\"}),setTimeout((()=>LoadScreen.unlock(lockId)),2*Engine.minDomActionDelay))}),Engine.minDomActionDelay);Object.defineProperty(window,\"SugarCube\",{value:Object.seal(Object.assign(Object.create(null),{Browser:Browser,Config:Config,Dialog:Dialog,Engine:Engine,Fullscreen:Fullscreen,Has:Has,L10n:L10n,Macro:Macro,Passage:Passage,Save:Save,Scripting:Scripting,Setting:Setting,SimpleAudio:SimpleAudio,State:State,Story:Story,UI:UI,UIBar:UIBar,DebugBar:DebugBar,Util:Util,Visibility:Visibility,Wikifier:Wikifier,session:session,settings:settings,setup:setup,storage:storage,version:version}))})}catch(ex){return console.error(ex),LoadScreen.clear(),Alert.fatal(null,ex.message,ex)}}))})(window,window.document,jQuery);}\n\t</script>\n</body>\n</html>\n"});